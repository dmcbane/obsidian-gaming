/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Mm=Object.create;var Yn=Object.defineProperty;var Fm=Object.getOwnPropertyDescriptor;var xm=Object.getOwnPropertyNames;var _m=Object.getPrototypeOf,Am=Object.prototype.hasOwnProperty;var Pm=(t,e,n)=>e in t?Yn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Rt=(t,e)=>()=>(t&&(e=t(t=0)),e);var W=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),$r=(t,e)=>{for(var n in e)Yn(t,n,{get:e[n],enumerable:!0})},Bl=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of xm(e))!Am.call(t,o)&&o!==n&&Yn(t,o,{get:()=>e[o],enumerable:!(i=Fm(e,o))||i.enumerable});return t};var Kn=(t,e,n)=>(n=t!=null?Mm(_m(t)):{},Bl(e||!t||!t.__esModule?Yn(n,"default",{value:t,enumerable:!0}):n,t)),Wr=t=>Bl(Yn({},"__esModule",{value:!0}),t);var Te=(t,e,n)=>Pm(t,typeof e!="symbol"?e+"":e,n);var Jr={};$r(Jr,{GEMINI_MODELS:()=>ke,getDefaultModelForRole:()=>Tt,getUpdatedModelSettings:()=>Zn,setGeminiModels:()=>Im});function Im(t){ke.length=0,ke.push(...t)}function Tt(t){let e=ke.find(n=>{var i;return(i=n.defaultForRoles)==null?void 0:i.includes(t)});if(e)return e.value;if(ke.length>0)return console.warn(`No default model specified for role '${t}'. Falling back to the first model in GEMINI_MODELS: ${ke[0].label}`),ke[0].value;throw console.error("CRITICAL: GEMINI_MODELS is empty. Cannot determine a fallback model."),new Error("CRITICAL: GEMINI_MODELS array is empty. Please configure available models.")}function Zn(t){let e=new Set(ke.map(s=>s.value)),n=!1,i=[],o={...t},r=s=>!(!s||e.has(s));if(r(o.chatModelName)){let s=Tt("chat");s&&(i.push(`Chat model: '${o.chatModelName}' -> '${s}' (legacy model update)`),o.chatModelName=s,n=!0)}if(r(o.summaryModelName)){let s=Tt("summary");s&&(i.push(`Summary model: '${o.summaryModelName}' -> '${s}' (legacy model update)`),o.summaryModelName=s,n=!0)}if(r(o.completionsModelName)){let s=Tt("completions");s&&(i.push(`Completions model: '${o.completionsModelName}' -> '${s}' (legacy model update)`),o.completionsModelName=s,n=!0)}return{updatedSettings:o,settingsChanged:n,changedSettingsInfo:i}}var ke,Nt=Rt(()=>{ke=[{value:"gemini-2.5-pro",label:"Gemini 2.5 Pro",defaultForRoles:["chat"]},{value:"gemini-2.5-flash",label:"Gemini 2.5 Flash",defaultForRoles:["summary"]},{value:"gemini-2.5-flash-lite-preview-06-17",label:"Gemini 2.5 Flash Lite",defaultForRoles:["completions"]}]});function Rm(){return{geminiUrl:bm,vertexUrl:km}}function Nm(t,e,n){var i,o,r;if(!(!((i=t.httpOptions)===null||i===void 0)&&i.baseUrl)){let s=Rm();return t.vertexai?(o=s.vertexUrl)!==null&&o!==void 0?o:e:(r=s.geminiUrl)!==null&&r!==void 0?r:n}return t.httpOptions.baseUrl}function V(t,e){let n=/\{([^}]+)\}/g;return t.replace(n,(i,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){let r=e[o];return r!=null?String(r):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function l(t,e,n){for(let r=0;r<e.length-1;r++){let s=e[r];if(s.endsWith("[]")){let u=s.slice(0,-2);if(!(u in t))if(Array.isArray(n))t[u]=Array.from({length:n.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(t[u])){let f=t[u];if(Array.isArray(n))for(let c=0;c<f.length;c++){let d=f[c];l(d,e.slice(r+1),n[c])}else for(let c of f)l(c,e.slice(r+1),n)}return}else if(s.endsWith("[0]")){let u=s.slice(0,-3);u in t||(t[u]=[{}]);let f=t[u];l(f[0],e.slice(r+1),n);return}(!t[s]||typeof t[s]!="object")&&(t[s]={}),t=t[s]}let i=e[e.length-1],o=t[i];if(o!==void 0){if(!n||typeof n=="object"&&Object.keys(n).length===0||n===o)return;if(typeof o=="object"&&typeof n=="object"&&o!==null&&n!==null)Object.assign(o,n);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else t[i]=n}function a(t,e){try{if(e.length===1&&e[0]==="_self")return t;for(let n=0;n<e.length;n++){if(typeof t!="object"||t===null)return;let i=e[n];if(i.endsWith("[]")){let o=i.slice(0,-2);if(o in t){let r=t[o];return Array.isArray(r)?r.map(s=>a(s,e.slice(n+1))):void 0}else return}else t=t[i]}return t}catch(n){if(n instanceof TypeError)return;throw n}}function Q(t,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(t.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){let n=e.split("/",2);return`publishers/${n[0]}/models/${n[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Ju(t,e){let n=Q(t,e);return n?n.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:n.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${n}`:n:""}function zu(t){return Array.isArray(t)?t.map(e=>ro(e)):[ro(t)]}function ro(t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function Yu(t){let e=ro(t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Ku(t){let e=ro(t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Su(t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Zu(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Su(e)):[Su(t)]}function is(t){return t!=null&&typeof t=="object"&&"parts"in t&&Array.isArray(t.parts)}function wu(t){return t!=null&&typeof t=="object"&&"functionCall"in t}function Mu(t){return t!=null&&typeof t=="object"&&"functionResponse"in t}function ve(t){if(t==null)throw new Error("ContentUnion is required");return is(t)?t:{role:"user",parts:Zu(t)}}function Qu(t,e){if(!e)return[];if(t.isVertexAI()&&Array.isArray(e))return e.flatMap(n=>{let i=ve(n);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(t.isVertexAI()){let n=ve(e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]}return Array.isArray(e)?e.map(n=>ve(n)):[ve(e)]}function Re(t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(wu(t)||Mu(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[ve(t)]}let e=[],n=[],i=is(t[0]);for(let o of t){let r=is(o);if(r!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(o);else{if(wu(o)||Mu(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(o)}}return i||e.push({role:"user",parts:Zu(n)}),e}function Lm(t,e){t.includes("null")&&(e.nullable=!0);let n=t.filter(i=>i!=="null");if(n.length===1)e.type=Object.values(Et).includes(n[0].toUpperCase())?n[0].toUpperCase():Et.TYPE_UNSPECIFIED;else{e.anyOf=[];for(let i of n)e.anyOf.push({type:Object.values(Et).includes(i.toUpperCase())?i.toUpperCase():Et.TYPE_UNSPECIFIED})}}function sn(t){let e={},n=["items"],i=["anyOf"],o=["properties"];if(t.type&&t.anyOf)throw new Error("type and anyOf cannot be both populated.");let r=t.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,t=r[1]):r[1].type==="null"&&(e.nullable=!0,t=r[0])),t.type instanceof Array&&Lm(t.type,e);for(let[s,u]of Object.entries(t))if(u!=null)if(s=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(Et).includes(u.toUpperCase())?u.toUpperCase():Et.TYPE_UNSPECIFIED}else if(n.includes(s))e[s]=sn(u);else if(i.includes(s)){let f=[];for(let c of u){if(c.type=="null"){e.nullable=!0;continue}f.push(sn(c))}e[s]=f}else if(o.includes(s)){let f={};for(let[c,d]of Object.entries(u))f[c]=sn(d);e[s]=f}else{if(s==="additionalProperties")continue;e[s]=u}return e}function bs(t){return sn(t)}function ks(t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function Rs(t){if("multiSpeakerVoiceConfig"in t)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return t}function ln(t){if(t.functionDeclarations)for(let e of t.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=sn(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=sn(e.response));return t}function un(t){if(t==null)throw new Error("tools is required");if(!Array.isArray(t))throw new Error("tools is required and must be an array of Tools");let e=[];for(let n of t)e.push(n);return e}function Bm(t,e,n,i=1){let o=!e.startsWith(`${n}/`)&&e.split("/").length===i;return t.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${t.getProject()}/${e}`:e.startsWith(`${n}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${e}`:o?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}/${e}`:e:o?`${n}/${e}`:e}function ct(t,e){if(typeof e!="string")throw new Error("name must be a string");return Bm(t,e,"cachedContents")}function Xu(t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function ft(t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function Om(t){return t!=null&&typeof t=="object"&&"name"in t}function Um(t){return t!=null&&typeof t=="object"&&"video"in t}function Vm(t){return t!=null&&typeof t=="object"&&"uri"in t}function ju(t){var e;let n;if(Om(t)&&(n=t.name),!(Vm(t)&&(n=t.uri,n===void 0))&&!(Um(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){let o=n.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${n}`);n=o[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function ec(t,e){let n;return t.isVertexAI()?n=e?"publishers/google/models":"models":n=e?"models":"tunedModels",n}function tc(t){for(let e of["models","tunedModels","publisherModels"])if(Gm(t,e))return t[e];return[]}function Gm(t,e){return t!==null&&typeof t=="object"&&e in t}function Hm(t,e={}){let n=t,i={name:n.name,description:n.description,parametersJsonSchema:n.inputSchema};return e.behavior&&(i.behavior=e.behavior),{functionDeclarations:[i]}}function qm(t,e={}){let n=[],i=new Set;for(let o of t){let r=o.name;if(i.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);i.add(r);let s=Hm(o,e);s.functionDeclarations&&n.push(...s.functionDeclarations)}return{functionDeclarations:n}}function nc(t,e){if(typeof e!="string"&&!Array.isArray(e)){if(t&&t.isVertexAI()){if(e.gcsUri&&e.bigqueryUri)throw new Error("Only one of `gcsUri` or `bigqueryUri` can be set.");if(!e.gcsUri&&!e.bigqueryUri)throw new Error("One of `gcsUri` or `bigqueryUri` must be set.")}else{if(e.inlinedRequests&&e.fileName)throw new Error("Only one of `inlinedRequests` or `fileName` can be set.");if(!e.inlinedRequests&&!e.fileName)throw new Error("One of `inlinedRequests` or `fileName` must be set.")}return e}else{if(Array.isArray(e))return{inlinedRequests:e};if(typeof e=="string"){if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:[e]};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};if(e.startsWith("files/"))return{fileName:e}}}throw new Error(`Unsupported source: ${e}`)}function $m(t){let e=t;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function cn(t,e){let n=e;if(!t.isVertexAI()){if(/batches\/[^/]+$/.test(n))return n.split("/").pop();throw new Error(`Invalid batch job name: ${n}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(n))return n.split("/").pop();if(/^\d+$/.test(n))return n;throw new Error(`Invalid batch job name: ${n}.`)}function ic(t){let e=t;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e}function Wm(t){let e={},n=a(t,["fps"]);n!=null&&l(e,["fps"],n);let i=a(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let o=a(t,["startOffset"]);return o!=null&&l(e,["startOffset"],o),e}function Jm(t){let e={};if(a(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=a(t,["data"]);n!=null&&l(e,["data"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function zm(t){let e={};if(a(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=a(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Ym(t){let e={},n=a(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],Wm(n));let i=a(t,["thought"]);i!=null&&l(e,["thought"],i);let o=a(t,["inlineData"]);o!=null&&l(e,["inlineData"],Jm(o));let r=a(t,["fileData"]);r!=null&&l(e,["fileData"],zm(r));let s=a(t,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);let u=a(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let f=a(t,["executableCode"]);f!=null&&l(e,["executableCode"],f);let c=a(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);let d=a(t,["functionResponse"]);d!=null&&l(e,["functionResponse"],d);let p=a(t,["text"]);return p!=null&&l(e,["text"],p),e}function oc(t){let e={},n=a(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Ym(r))),l(e,["parts"],o)}let i=a(t,["role"]);return i!=null&&l(e,["role"],i),e}function Km(t){let e={},n=a(t,["anyOf"]);n!=null&&l(e,["anyOf"],n);let i=a(t,["default"]);i!=null&&l(e,["default"],i);let o=a(t,["description"]);o!=null&&l(e,["description"],o);let r=a(t,["enum"]);r!=null&&l(e,["enum"],r);let s=a(t,["example"]);s!=null&&l(e,["example"],s);let u=a(t,["format"]);u!=null&&l(e,["format"],u);let f=a(t,["items"]);f!=null&&l(e,["items"],f);let c=a(t,["maxItems"]);c!=null&&l(e,["maxItems"],c);let d=a(t,["maxLength"]);d!=null&&l(e,["maxLength"],d);let p=a(t,["maxProperties"]);p!=null&&l(e,["maxProperties"],p);let m=a(t,["maximum"]);m!=null&&l(e,["maximum"],m);let h=a(t,["minItems"]);h!=null&&l(e,["minItems"],h);let y=a(t,["minLength"]);y!=null&&l(e,["minLength"],y);let v=a(t,["minProperties"]);v!=null&&l(e,["minProperties"],v);let T=a(t,["minimum"]);T!=null&&l(e,["minimum"],T);let S=a(t,["nullable"]);S!=null&&l(e,["nullable"],S);let _=a(t,["pattern"]);_!=null&&l(e,["pattern"],_);let x=a(t,["properties"]);x!=null&&l(e,["properties"],x);let C=a(t,["propertyOrdering"]);C!=null&&l(e,["propertyOrdering"],C);let w=a(t,["required"]);w!=null&&l(e,["required"],w);let P=a(t,["title"]);P!=null&&l(e,["title"],P);let M=a(t,["type"]);return M!=null&&l(e,["type"],M),e}function Zm(t){let e={};if(a(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=a(t,["category"]);n!=null&&l(e,["category"],n);let i=a(t,["threshold"]);return i!=null&&l(e,["threshold"],i),e}function Qm(t){let e={},n=a(t,["behavior"]);n!=null&&l(e,["behavior"],n);let i=a(t,["description"]);i!=null&&l(e,["description"],i);let o=a(t,["name"]);o!=null&&l(e,["name"],o);let r=a(t,["parameters"]);r!=null&&l(e,["parameters"],r);let s=a(t,["parametersJsonSchema"]);s!=null&&l(e,["parametersJsonSchema"],s);let u=a(t,["response"]);u!=null&&l(e,["response"],u);let f=a(t,["responseJsonSchema"]);return f!=null&&l(e,["responseJsonSchema"],f),e}function Xm(t){let e={},n=a(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=a(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function jm(t){let e={},n=a(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],Xm(n)),e}function eh(t){let e={},n=a(t,["mode"]);n!=null&&l(e,["mode"],n);let i=a(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function th(t){let e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],eh(n)),e}function nh(){return{}}function ih(t){let e={},n=a(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(c=>Qm(c))),l(e,["functionDeclarations"],f)}if(a(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=a(t,["googleSearch"]);i!=null&&l(e,["googleSearch"],jm(i));let o=a(t,["googleSearchRetrieval"]);if(o!=null&&l(e,["googleSearchRetrieval"],th(o)),a(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(t,["urlContext"])!=null&&l(e,["urlContext"],nh());let s=a(t,["codeExecution"]);s!=null&&l(e,["codeExecution"],s);let u=a(t,["computerUse"]);return u!=null&&l(e,["computerUse"],u),e}function oh(t){let e={},n=a(t,["mode"]);n!=null&&l(e,["mode"],n);let i=a(t,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function rh(t){let e={},n=a(t,["latitude"]);n!=null&&l(e,["latitude"],n);let i=a(t,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function sh(t){let e={},n=a(t,["latLng"]);n!=null&&l(e,["latLng"],rh(n));let i=a(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function ah(t){let e={},n=a(t,["functionCallingConfig"]);n!=null&&l(e,["functionCallingConfig"],oh(n));let i=a(t,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],sh(i)),e}function lh(t){let e={},n=a(t,["voiceName"]);return n!=null&&l(e,["voiceName"],n),e}function rc(t){let e={},n=a(t,["prebuiltVoiceConfig"]);return n!=null&&l(e,["prebuiltVoiceConfig"],lh(n)),e}function uh(t){let e={},n=a(t,["speaker"]);n!=null&&l(e,["speaker"],n);let i=a(t,["voiceConfig"]);return i!=null&&l(e,["voiceConfig"],rc(i)),e}function ch(t){let e={},n=a(t,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>uh(o))),l(e,["speakerVoiceConfigs"],i)}return e}function fh(t){let e={},n=a(t,["voiceConfig"]);n!=null&&l(e,["voiceConfig"],rc(n));let i=a(t,["multiSpeakerVoiceConfig"]);i!=null&&l(e,["multiSpeakerVoiceConfig"],ch(i));let o=a(t,["languageCode"]);return o!=null&&l(e,["languageCode"],o),e}function dh(t){let e={},n=a(t,["includeThoughts"]);n!=null&&l(e,["includeThoughts"],n);let i=a(t,["thinkingBudget"]);return i!=null&&l(e,["thinkingBudget"],i),e}function ph(t,e,n){let i={},o=a(e,["systemInstruction"]);n!==void 0&&o!=null&&l(n,["systemInstruction"],oc(ve(o)));let r=a(e,["temperature"]);r!=null&&l(i,["temperature"],r);let s=a(e,["topP"]);s!=null&&l(i,["topP"],s);let u=a(e,["topK"]);u!=null&&l(i,["topK"],u);let f=a(e,["candidateCount"]);f!=null&&l(i,["candidateCount"],f);let c=a(e,["maxOutputTokens"]);c!=null&&l(i,["maxOutputTokens"],c);let d=a(e,["stopSequences"]);d!=null&&l(i,["stopSequences"],d);let p=a(e,["responseLogprobs"]);p!=null&&l(i,["responseLogprobs"],p);let m=a(e,["logprobs"]);m!=null&&l(i,["logprobs"],m);let h=a(e,["presencePenalty"]);h!=null&&l(i,["presencePenalty"],h);let y=a(e,["frequencyPenalty"]);y!=null&&l(i,["frequencyPenalty"],y);let v=a(e,["seed"]);v!=null&&l(i,["seed"],v);let T=a(e,["responseMimeType"]);T!=null&&l(i,["responseMimeType"],T);let S=a(e,["responseSchema"]);S!=null&&l(i,["responseSchema"],Km(bs(S)));let _=a(e,["responseJsonSchema"]);if(_!=null&&l(i,["responseJsonSchema"],_),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let x=a(e,["safetySettings"]);if(n!==void 0&&x!=null){let O=x;Array.isArray(O)&&(O=O.map($=>Zm($))),l(n,["safetySettings"],O)}let C=a(e,["tools"]);if(n!==void 0&&C!=null){let O=un(C);Array.isArray(O)&&(O=O.map($=>ih(ln($)))),l(n,["tools"],O)}let w=a(e,["toolConfig"]);if(n!==void 0&&w!=null&&l(n,["toolConfig"],ah(w)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let P=a(e,["cachedContent"]);n!==void 0&&P!=null&&l(n,["cachedContent"],ct(t,P));let M=a(e,["responseModalities"]);M!=null&&l(i,["responseModalities"],M);let b=a(e,["mediaResolution"]);b!=null&&l(i,["mediaResolution"],b);let k=a(e,["speechConfig"]);if(k!=null&&l(i,["speechConfig"],fh(ks(k))),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let L=a(e,["thinkingConfig"]);return L!=null&&l(i,["thinkingConfig"],dh(L)),i}function mh(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["request","model"],Q(t,i));let o=a(e,["contents"]);if(o!=null){let s=Re(o);Array.isArray(s)&&(s=s.map(u=>oc(u))),l(n,["request","contents"],s)}let r=a(e,["config"]);return r!=null&&l(n,["request","generationConfig"],ph(t,r,n)),n}function hh(t,e){let n={};if(a(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(a(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");let i=a(e,["fileName"]);i!=null&&l(n,["fileName"],i);let o=a(e,["inlinedRequests"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(s=>mh(t,s))),l(n,["requests","requests"],r)}return n}function gh(t,e){let n={},i=a(t,["displayName"]);if(e!==void 0&&i!=null&&l(e,["batch","displayName"],i),a(t,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return n}function yh(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["src"]);o!=null&&l(n,["batch","inputConfig"],hh(t,nc(t,o)));let r=a(e,["config"]);return r!=null&&l(n,["config"],gh(r,n)),n}function vh(t,e){let n={},i=a(e,["name"]);i!=null&&l(n,["_url","name"],cn(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function Ch(t,e){let n={},i=a(e,["name"]);i!=null&&l(n,["_url","name"],cn(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function Dh(t,e){let n={},i=a(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let o=a(t,["pageToken"]);if(e!==void 0&&o!=null&&l(e,["_query","pageToken"],o),a(t,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return n}function Th(t){let e={},n=a(t,["config"]);return n!=null&&l(e,["config"],Dh(n,e)),e}function Eh(t,e){let n={},i=a(e,["name"]);i!=null&&l(n,["_url","name"],cn(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function Sh(t){let e={},n=a(t,["format"]);n!=null&&l(e,["instancesFormat"],n);let i=a(t,["gcsUri"]);i!=null&&l(e,["gcsSource","uris"],i);let o=a(t,["bigqueryUri"]);if(o!=null&&l(e,["bigquerySource","inputUri"],o),a(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(t,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function wh(t){let e={},n=a(t,["format"]);n!=null&&l(e,["predictionsFormat"],n);let i=a(t,["gcsUri"]);i!=null&&l(e,["gcsDestination","outputUriPrefix"],i);let o=a(t,["bigqueryUri"]);if(o!=null&&l(e,["bigqueryDestination","outputUri"],o),a(t,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(t,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");return e}function Mh(t,e){let n={},i=a(t,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);let o=a(t,["dest"]);return e!==void 0&&o!=null&&l(e,["outputConfig"],wh($m(o))),n}function Fh(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["model"],Q(t,i));let o=a(e,["src"]);o!=null&&l(n,["inputConfig"],Sh(nc(t,o)));let r=a(e,["config"]);return r!=null&&l(n,["config"],Mh(r,n)),n}function xh(t,e){let n={},i=a(e,["name"]);i!=null&&l(n,["_url","name"],cn(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function _h(t,e){let n={},i=a(e,["name"]);i!=null&&l(n,["_url","name"],cn(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function Ah(t,e){let n={},i=a(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let o=a(t,["pageToken"]);e!==void 0&&o!=null&&l(e,["_query","pageToken"],o);let r=a(t,["filter"]);return e!==void 0&&r!=null&&l(e,["_query","filter"],r),n}function Ph(t){let e={},n=a(t,["config"]);return n!=null&&l(e,["config"],Ah(n,e)),e}function Ih(t,e){let n={},i=a(e,["name"]);i!=null&&l(n,["_url","name"],cn(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function sc(){return{}}function bh(t){let e={},n=a(t,["fps"]);n!=null&&l(e,["fps"],n);let i=a(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let o=a(t,["startOffset"]);return o!=null&&l(e,["startOffset"],o),e}function kh(t){let e={},n=a(t,["data"]);n!=null&&l(e,["data"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Rh(t){let e={},n=a(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Nh(t){let e={},n=a(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],bh(n));let i=a(t,["thought"]);i!=null&&l(e,["thought"],i);let o=a(t,["inlineData"]);o!=null&&l(e,["inlineData"],kh(o));let r=a(t,["fileData"]);r!=null&&l(e,["fileData"],Rh(r));let s=a(t,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);let u=a(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let f=a(t,["executableCode"]);f!=null&&l(e,["executableCode"],f);let c=a(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);let d=a(t,["functionResponse"]);d!=null&&l(e,["functionResponse"],d);let p=a(t,["text"]);return p!=null&&l(e,["text"],p),e}function Lh(t){let e={},n=a(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Nh(r))),l(e,["parts"],o)}let i=a(t,["role"]);return i!=null&&l(e,["role"],i),e}function Bh(t){let e={},n=a(t,["citationSources"]);return n!=null&&l(e,["citations"],n),e}function Oh(t){let e={},n=a(t,["retrievedUrl"]);n!=null&&l(e,["retrievedUrl"],n);let i=a(t,["urlRetrievalStatus"]);return i!=null&&l(e,["urlRetrievalStatus"],i),e}function Uh(t){let e={},n=a(t,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Oh(o))),l(e,["urlMetadata"],i)}return e}function Vh(t){let e={},n=a(t,["content"]);n!=null&&l(e,["content"],Lh(n));let i=a(t,["citationMetadata"]);i!=null&&l(e,["citationMetadata"],Bh(i));let o=a(t,["tokenCount"]);o!=null&&l(e,["tokenCount"],o);let r=a(t,["finishReason"]);r!=null&&l(e,["finishReason"],r);let s=a(t,["urlContextMetadata"]);s!=null&&l(e,["urlContextMetadata"],Uh(s));let u=a(t,["avgLogprobs"]);u!=null&&l(e,["avgLogprobs"],u);let f=a(t,["groundingMetadata"]);f!=null&&l(e,["groundingMetadata"],f);let c=a(t,["index"]);c!=null&&l(e,["index"],c);let d=a(t,["logprobsResult"]);d!=null&&l(e,["logprobsResult"],d);let p=a(t,["safetyRatings"]);return p!=null&&l(e,["safetyRatings"],p),e}function Gh(t){let e={},n=a(t,["candidates"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(u=>Vh(u))),l(e,["candidates"],s)}let i=a(t,["modelVersion"]);i!=null&&l(e,["modelVersion"],i);let o=a(t,["promptFeedback"]);o!=null&&l(e,["promptFeedback"],o);let r=a(t,["usageMetadata"]);return r!=null&&l(e,["usageMetadata"],r),e}function Hh(t){let e={},n=a(t,["response"]);return n!=null&&l(e,["response"],Gh(n)),a(t,["error"])!=null&&l(e,["error"],sc()),e}function qh(t){let e={},n=a(t,["responsesFile"]);n!=null&&l(e,["fileName"],n);let i=a(t,["inlinedResponses","inlinedResponses"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>Hh(r))),l(e,["inlinedResponses"],o)}return e}function os(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["metadata","displayName"]);i!=null&&l(e,["displayName"],i);let o=a(t,["metadata","state"]);o!=null&&l(e,["state"],ic(o));let r=a(t,["metadata","createTime"]);r!=null&&l(e,["createTime"],r);let s=a(t,["metadata","endTime"]);s!=null&&l(e,["endTime"],s);let u=a(t,["metadata","updateTime"]);u!=null&&l(e,["updateTime"],u);let f=a(t,["metadata","model"]);f!=null&&l(e,["model"],f);let c=a(t,["metadata","output"]);return c!=null&&l(e,["dest"],qh(c)),e}function $h(t){let e={},n=a(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=a(t,["operations"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>os(r))),l(e,["batchJobs"],o)}return e}function Wh(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["done"]);return i!=null&&l(e,["done"],i),a(t,["error"])!=null&&l(e,["error"],sc()),e}function ac(t){let e={},n=a(t,["details"]);n!=null&&l(e,["details"],n);let i=a(t,["code"]);i!=null&&l(e,["code"],i);let o=a(t,["message"]);return o!=null&&l(e,["message"],o),e}function Jh(t){let e={},n=a(t,["instancesFormat"]);n!=null&&l(e,["format"],n);let i=a(t,["gcsSource","uris"]);i!=null&&l(e,["gcsUri"],i);let o=a(t,["bigquerySource","inputUri"]);return o!=null&&l(e,["bigqueryUri"],o),e}function zh(t){let e={},n=a(t,["predictionsFormat"]);n!=null&&l(e,["format"],n);let i=a(t,["gcsDestination","outputUriPrefix"]);i!=null&&l(e,["gcsUri"],i);let o=a(t,["bigqueryDestination","outputUri"]);return o!=null&&l(e,["bigqueryUri"],o),e}function rs(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["displayName"]);i!=null&&l(e,["displayName"],i);let o=a(t,["state"]);o!=null&&l(e,["state"],ic(o));let r=a(t,["error"]);r!=null&&l(e,["error"],ac(r));let s=a(t,["createTime"]);s!=null&&l(e,["createTime"],s);let u=a(t,["startTime"]);u!=null&&l(e,["startTime"],u);let f=a(t,["endTime"]);f!=null&&l(e,["endTime"],f);let c=a(t,["updateTime"]);c!=null&&l(e,["updateTime"],c);let d=a(t,["model"]);d!=null&&l(e,["model"],d);let p=a(t,["inputConfig"]);p!=null&&l(e,["src"],Jh(p));let m=a(t,["outputConfig"]);return m!=null&&l(e,["dest"],zh(m)),e}function Yh(t){let e={},n=a(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=a(t,["batchPredictionJobs"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>rs(r))),l(e,["batchJobs"],o)}return e}function Kh(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["done"]);i!=null&&l(e,["done"],i);let o=a(t,["error"]);return o!=null&&l(e,["error"],ac(o)),e}function Zh(t){let e={},n=a(t,["fps"]);n!=null&&l(e,["fps"],n);let i=a(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let o=a(t,["startOffset"]);return o!=null&&l(e,["startOffset"],o),e}function Qh(t){let e={};if(a(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=a(t,["data"]);n!=null&&l(e,["data"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Xh(t){let e={};if(a(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=a(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function jh(t){let e={},n=a(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],Zh(n));let i=a(t,["thought"]);i!=null&&l(e,["thought"],i);let o=a(t,["inlineData"]);o!=null&&l(e,["inlineData"],Qh(o));let r=a(t,["fileData"]);r!=null&&l(e,["fileData"],Xh(r));let s=a(t,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);let u=a(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let f=a(t,["executableCode"]);f!=null&&l(e,["executableCode"],f);let c=a(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);let d=a(t,["functionResponse"]);d!=null&&l(e,["functionResponse"],d);let p=a(t,["text"]);return p!=null&&l(e,["text"],p),e}function Fu(t){let e={},n=a(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>jh(r))),l(e,["parts"],o)}let i=a(t,["role"]);return i!=null&&l(e,["role"],i),e}function eg(t){let e={},n=a(t,["behavior"]);n!=null&&l(e,["behavior"],n);let i=a(t,["description"]);i!=null&&l(e,["description"],i);let o=a(t,["name"]);o!=null&&l(e,["name"],o);let r=a(t,["parameters"]);r!=null&&l(e,["parameters"],r);let s=a(t,["parametersJsonSchema"]);s!=null&&l(e,["parametersJsonSchema"],s);let u=a(t,["response"]);u!=null&&l(e,["response"],u);let f=a(t,["responseJsonSchema"]);return f!=null&&l(e,["responseJsonSchema"],f),e}function tg(t){let e={},n=a(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=a(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function ng(t){let e={},n=a(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],tg(n)),e}function ig(t){let e={},n=a(t,["mode"]);n!=null&&l(e,["mode"],n);let i=a(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function og(t){let e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],ig(n)),e}function rg(){return{}}function sg(t){let e={},n=a(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(c=>eg(c))),l(e,["functionDeclarations"],f)}if(a(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=a(t,["googleSearch"]);i!=null&&l(e,["googleSearch"],ng(i));let o=a(t,["googleSearchRetrieval"]);if(o!=null&&l(e,["googleSearchRetrieval"],og(o)),a(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(t,["urlContext"])!=null&&l(e,["urlContext"],rg());let s=a(t,["codeExecution"]);s!=null&&l(e,["codeExecution"],s);let u=a(t,["computerUse"]);return u!=null&&l(e,["computerUse"],u),e}function ag(t){let e={},n=a(t,["mode"]);n!=null&&l(e,["mode"],n);let i=a(t,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function lg(t){let e={},n=a(t,["latitude"]);n!=null&&l(e,["latitude"],n);let i=a(t,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function ug(t){let e={},n=a(t,["latLng"]);n!=null&&l(e,["latLng"],lg(n));let i=a(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function cg(t){let e={},n=a(t,["functionCallingConfig"]);n!=null&&l(e,["functionCallingConfig"],ag(n));let i=a(t,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],ug(i)),e}function fg(t,e){let n={},i=a(t,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);let o=a(t,["expireTime"]);e!==void 0&&o!=null&&l(e,["expireTime"],o);let r=a(t,["displayName"]);e!==void 0&&r!=null&&l(e,["displayName"],r);let s=a(t,["contents"]);if(e!==void 0&&s!=null){let d=Re(s);Array.isArray(d)&&(d=d.map(p=>Fu(p))),l(e,["contents"],d)}let u=a(t,["systemInstruction"]);e!==void 0&&u!=null&&l(e,["systemInstruction"],Fu(ve(u)));let f=a(t,["tools"]);if(e!==void 0&&f!=null){let d=f;Array.isArray(d)&&(d=d.map(p=>sg(p))),l(e,["tools"],d)}let c=a(t,["toolConfig"]);if(e!==void 0&&c!=null&&l(e,["toolConfig"],cg(c)),a(t,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return n}function dg(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["model"],Ju(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],fg(o,n)),n}function pg(t,e){let n={},i=a(e,["name"]);i!=null&&l(n,["_url","name"],ct(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function mg(t,e){let n={},i=a(e,["name"]);i!=null&&l(n,["_url","name"],ct(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function hg(t,e){let n={},i=a(t,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);let o=a(t,["expireTime"]);return e!==void 0&&o!=null&&l(e,["expireTime"],o),n}function gg(t,e){let n={},i=a(e,["name"]);i!=null&&l(n,["_url","name"],ct(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],hg(o,n)),n}function yg(t,e){let n={},i=a(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let o=a(t,["pageToken"]);return e!==void 0&&o!=null&&l(e,["_query","pageToken"],o),n}function vg(t){let e={},n=a(t,["config"]);return n!=null&&l(e,["config"],yg(n,e)),e}function Cg(t){let e={},n=a(t,["fps"]);n!=null&&l(e,["fps"],n);let i=a(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let o=a(t,["startOffset"]);return o!=null&&l(e,["startOffset"],o),e}function Dg(t){let e={},n=a(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=a(t,["data"]);i!=null&&l(e,["data"],i);let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function Tg(t){let e={},n=a(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=a(t,["fileUri"]);i!=null&&l(e,["fileUri"],i);let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function Eg(t){let e={},n=a(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],Cg(n));let i=a(t,["thought"]);i!=null&&l(e,["thought"],i);let o=a(t,["inlineData"]);o!=null&&l(e,["inlineData"],Dg(o));let r=a(t,["fileData"]);r!=null&&l(e,["fileData"],Tg(r));let s=a(t,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);let u=a(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let f=a(t,["executableCode"]);f!=null&&l(e,["executableCode"],f);let c=a(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);let d=a(t,["functionResponse"]);d!=null&&l(e,["functionResponse"],d);let p=a(t,["text"]);return p!=null&&l(e,["text"],p),e}function xu(t){let e={},n=a(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Eg(r))),l(e,["parts"],o)}let i=a(t,["role"]);return i!=null&&l(e,["role"],i),e}function Sg(t){let e={};if(a(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let n=a(t,["description"]);n!=null&&l(e,["description"],n);let i=a(t,["name"]);i!=null&&l(e,["name"],i);let o=a(t,["parameters"]);o!=null&&l(e,["parameters"],o);let r=a(t,["parametersJsonSchema"]);r!=null&&l(e,["parametersJsonSchema"],r);let s=a(t,["response"]);s!=null&&l(e,["response"],s);let u=a(t,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function wg(t){let e={},n=a(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=a(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function Mg(t){let e={},n=a(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],wg(n)),e}function Fg(t){let e={},n=a(t,["mode"]);n!=null&&l(e,["mode"],n);let i=a(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function xg(t){let e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],Fg(n)),e}function _g(){return{}}function Ag(t){let e={},n=a(t,["apiKeyString"]);return n!=null&&l(e,["apiKeyString"],n),e}function Pg(t){let e={},n=a(t,["apiKeyConfig"]);n!=null&&l(e,["apiKeyConfig"],Ag(n));let i=a(t,["authType"]);i!=null&&l(e,["authType"],i);let o=a(t,["googleServiceAccountConfig"]);o!=null&&l(e,["googleServiceAccountConfig"],o);let r=a(t,["httpBasicAuthConfig"]);r!=null&&l(e,["httpBasicAuthConfig"],r);let s=a(t,["oauthConfig"]);s!=null&&l(e,["oauthConfig"],s);let u=a(t,["oidcConfig"]);return u!=null&&l(e,["oidcConfig"],u),e}function Ig(t){let e={},n=a(t,["authConfig"]);return n!=null&&l(e,["authConfig"],Pg(n)),e}function bg(){return{}}function kg(t){let e={},n=a(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(m=>Sg(m))),l(e,["functionDeclarations"],p)}let i=a(t,["retrieval"]);i!=null&&l(e,["retrieval"],i);let o=a(t,["googleSearch"]);o!=null&&l(e,["googleSearch"],Mg(o));let r=a(t,["googleSearchRetrieval"]);r!=null&&l(e,["googleSearchRetrieval"],xg(r)),a(t,["enterpriseWebSearch"])!=null&&l(e,["enterpriseWebSearch"],_g());let u=a(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],Ig(u)),a(t,["urlContext"])!=null&&l(e,["urlContext"],bg());let c=a(t,["codeExecution"]);c!=null&&l(e,["codeExecution"],c);let d=a(t,["computerUse"]);return d!=null&&l(e,["computerUse"],d),e}function Rg(t){let e={},n=a(t,["mode"]);n!=null&&l(e,["mode"],n);let i=a(t,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function Ng(t){let e={},n=a(t,["latitude"]);n!=null&&l(e,["latitude"],n);let i=a(t,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function Lg(t){let e={},n=a(t,["latLng"]);n!=null&&l(e,["latLng"],Ng(n));let i=a(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function Bg(t){let e={},n=a(t,["functionCallingConfig"]);n!=null&&l(e,["functionCallingConfig"],Rg(n));let i=a(t,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],Lg(i)),e}function Og(t,e){let n={},i=a(t,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);let o=a(t,["expireTime"]);e!==void 0&&o!=null&&l(e,["expireTime"],o);let r=a(t,["displayName"]);e!==void 0&&r!=null&&l(e,["displayName"],r);let s=a(t,["contents"]);if(e!==void 0&&s!=null){let p=Re(s);Array.isArray(p)&&(p=p.map(m=>xu(m))),l(e,["contents"],p)}let u=a(t,["systemInstruction"]);e!==void 0&&u!=null&&l(e,["systemInstruction"],xu(ve(u)));let f=a(t,["tools"]);if(e!==void 0&&f!=null){let p=f;Array.isArray(p)&&(p=p.map(m=>kg(m))),l(e,["tools"],p)}let c=a(t,["toolConfig"]);e!==void 0&&c!=null&&l(e,["toolConfig"],Bg(c));let d=a(t,["kmsKeyName"]);return e!==void 0&&d!=null&&l(e,["encryption_spec","kmsKeyName"],d),n}function Ug(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["model"],Ju(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],Og(o,n)),n}function Vg(t,e){let n={},i=a(e,["name"]);i!=null&&l(n,["_url","name"],ct(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function Gg(t,e){let n={},i=a(e,["name"]);i!=null&&l(n,["_url","name"],ct(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function Hg(t,e){let n={},i=a(t,["ttl"]);e!==void 0&&i!=null&&l(e,["ttl"],i);let o=a(t,["expireTime"]);return e!==void 0&&o!=null&&l(e,["expireTime"],o),n}function qg(t,e){let n={},i=a(e,["name"]);i!=null&&l(n,["_url","name"],ct(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],Hg(o,n)),n}function $g(t,e){let n={},i=a(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let o=a(t,["pageToken"]);return e!==void 0&&o!=null&&l(e,["_query","pageToken"],o),n}function Wg(t){let e={},n=a(t,["config"]);return n!=null&&l(e,["config"],$g(n,e)),e}function Ji(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["displayName"]);i!=null&&l(e,["displayName"],i);let o=a(t,["model"]);o!=null&&l(e,["model"],o);let r=a(t,["createTime"]);r!=null&&l(e,["createTime"],r);let s=a(t,["updateTime"]);s!=null&&l(e,["updateTime"],s);let u=a(t,["expireTime"]);u!=null&&l(e,["expireTime"],u);let f=a(t,["usageMetadata"]);return f!=null&&l(e,["usageMetadata"],f),e}function Jg(){return{}}function zg(t){let e={},n=a(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=a(t,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>Ji(r))),l(e,["cachedContents"],o)}return e}function zi(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["displayName"]);i!=null&&l(e,["displayName"],i);let o=a(t,["model"]);o!=null&&l(e,["model"],o);let r=a(t,["createTime"]);r!=null&&l(e,["createTime"],r);let s=a(t,["updateTime"]);s!=null&&l(e,["updateTime"],s);let u=a(t,["expireTime"]);u!=null&&l(e,["expireTime"],u);let f=a(t,["usageMetadata"]);return f!=null&&l(e,["usageMetadata"],f),e}function Yg(){return{}}function Kg(t){let e={},n=a(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=a(t,["cachedContents"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>zi(r))),l(e,["cachedContents"],o)}return e}function _u(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ee(t){return this instanceof ee?(this.v=t,this):new ee(t)}function an(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),o,r=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(h){return function(y){return Promise.resolve(y).then(h,p)}}function u(h,y){i[h]&&(o[h]=function(v){return new Promise(function(T,S){r.push([h,v,T,S])>1||f(h,v)})},y&&(o[h]=y(o[h])))}function f(h,y){try{c(i[h](y))}catch(v){m(r[0][3],v)}}function c(h){h.value instanceof ee?Promise.resolve(h.value.v).then(d,p):m(r[0][2],h)}function d(h){f("next",h)}function p(h){f("throw",h)}function m(h,y){h(y),r.shift(),r.length&&f(r[0][0],r[0][1])}}function Qn(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof _u=="function"?_u(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(r){n[r]=t[r]&&function(s){return new Promise(function(u,f){s=t[r](s),o(u,f,s.done,s.value)})}}function o(r,s,u,f){Promise.resolve(f).then(function(c){r({value:c,done:u})},s)}}function Zg(t){var e;if(t.candidates==null||t.candidates.length===0)return!1;let n=(e=t.candidates[0])===null||e===void 0?void 0:e.content;return n===void 0?!1:lc(n)}function lc(t){if(t.parts===void 0||t.parts.length===0)return!1;for(let e of t.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function Qg(t){if(t.length!==0){for(let e of t)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Au(t){if(t===void 0||t.length===0)return[];let e=[],n=t.length,i=0;for(;i<n;)if(t[i].role==="user")e.push(t[i]),i++;else{let o=[],r=!0;for(;i<n&&t[i].role==="model";)o.push(t[i]),r&&!lc(t[i])&&(r=!1),i++;r?e.push(...o):e.pop()}return e}function Xg(t,e){let n={},i=a(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let o=a(t,["pageToken"]);return e!==void 0&&o!=null&&l(e,["_query","pageToken"],o),n}function jg(t){let e={},n=a(t,["config"]);return n!=null&&l(e,["config"],Xg(n,e)),e}function ey(t){let e={},n=a(t,["details"]);n!=null&&l(e,["details"],n);let i=a(t,["message"]);i!=null&&l(e,["message"],i);let o=a(t,["code"]);return o!=null&&l(e,["code"],o),e}function ty(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["displayName"]);i!=null&&l(e,["displayName"],i);let o=a(t,["mimeType"]);o!=null&&l(e,["mimeType"],o);let r=a(t,["sizeBytes"]);r!=null&&l(e,["sizeBytes"],r);let s=a(t,["createTime"]);s!=null&&l(e,["createTime"],s);let u=a(t,["expirationTime"]);u!=null&&l(e,["expirationTime"],u);let f=a(t,["updateTime"]);f!=null&&l(e,["updateTime"],f);let c=a(t,["sha256Hash"]);c!=null&&l(e,["sha256Hash"],c);let d=a(t,["uri"]);d!=null&&l(e,["uri"],d);let p=a(t,["downloadUri"]);p!=null&&l(e,["downloadUri"],p);let m=a(t,["state"]);m!=null&&l(e,["state"],m);let h=a(t,["source"]);h!=null&&l(e,["source"],h);let y=a(t,["videoMetadata"]);y!=null&&l(e,["videoMetadata"],y);let v=a(t,["error"]);return v!=null&&l(e,["error"],ey(v)),e}function ny(t){let e={},n=a(t,["file"]);n!=null&&l(e,["file"],ty(n));let i=a(t,["config"]);return i!=null&&l(e,["config"],i),e}function iy(t){let e={},n=a(t,["name"]);n!=null&&l(e,["_url","file"],ju(n));let i=a(t,["config"]);return i!=null&&l(e,["config"],i),e}function oy(t){let e={},n=a(t,["name"]);n!=null&&l(e,["_url","file"],ju(n));let i=a(t,["config"]);return i!=null&&l(e,["config"],i),e}function ry(t){let e={},n=a(t,["details"]);n!=null&&l(e,["details"],n);let i=a(t,["message"]);i!=null&&l(e,["message"],i);let o=a(t,["code"]);return o!=null&&l(e,["code"],o),e}function cs(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["displayName"]);i!=null&&l(e,["displayName"],i);let o=a(t,["mimeType"]);o!=null&&l(e,["mimeType"],o);let r=a(t,["sizeBytes"]);r!=null&&l(e,["sizeBytes"],r);let s=a(t,["createTime"]);s!=null&&l(e,["createTime"],s);let u=a(t,["expirationTime"]);u!=null&&l(e,["expirationTime"],u);let f=a(t,["updateTime"]);f!=null&&l(e,["updateTime"],f);let c=a(t,["sha256Hash"]);c!=null&&l(e,["sha256Hash"],c);let d=a(t,["uri"]);d!=null&&l(e,["uri"],d);let p=a(t,["downloadUri"]);p!=null&&l(e,["downloadUri"],p);let m=a(t,["state"]);m!=null&&l(e,["state"],m);let h=a(t,["source"]);h!=null&&l(e,["source"],h);let y=a(t,["videoMetadata"]);y!=null&&l(e,["videoMetadata"],y);let v=a(t,["error"]);return v!=null&&l(e,["error"],ry(v)),e}function sy(t){let e={},n=a(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=a(t,["files"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>cs(r))),l(e,["files"],o)}return e}function ay(){return{}}function ly(){return{}}function uy(t){let e={},n=a(t,["voiceName"]);return n!=null&&l(e,["voiceName"],n),e}function cy(t){let e={},n=a(t,["voiceName"]);return n!=null&&l(e,["voiceName"],n),e}function uc(t){let e={},n=a(t,["prebuiltVoiceConfig"]);return n!=null&&l(e,["prebuiltVoiceConfig"],uy(n)),e}function fy(t){let e={},n=a(t,["prebuiltVoiceConfig"]);return n!=null&&l(e,["prebuiltVoiceConfig"],cy(n)),e}function dy(t){let e={},n=a(t,["speaker"]);n!=null&&l(e,["speaker"],n);let i=a(t,["voiceConfig"]);return i!=null&&l(e,["voiceConfig"],uc(i)),e}function py(t){let e={},n=a(t,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>dy(o))),l(e,["speakerVoiceConfigs"],i)}return e}function my(t){let e={},n=a(t,["voiceConfig"]);n!=null&&l(e,["voiceConfig"],uc(n));let i=a(t,["multiSpeakerVoiceConfig"]);i!=null&&l(e,["multiSpeakerVoiceConfig"],py(i));let o=a(t,["languageCode"]);return o!=null&&l(e,["languageCode"],o),e}function hy(t){let e={},n=a(t,["voiceConfig"]);if(n!=null&&l(e,["voiceConfig"],fy(n)),a(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let i=a(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function gy(t){let e={},n=a(t,["fps"]);n!=null&&l(e,["fps"],n);let i=a(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let o=a(t,["startOffset"]);return o!=null&&l(e,["startOffset"],o),e}function yy(t){let e={},n=a(t,["fps"]);n!=null&&l(e,["fps"],n);let i=a(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let o=a(t,["startOffset"]);return o!=null&&l(e,["startOffset"],o),e}function vy(t){let e={};if(a(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=a(t,["data"]);n!=null&&l(e,["data"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Cy(t){let e={},n=a(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=a(t,["data"]);i!=null&&l(e,["data"],i);let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function Dy(t){let e={};if(a(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=a(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Ty(t){let e={},n=a(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=a(t,["fileUri"]);i!=null&&l(e,["fileUri"],i);let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function Ey(t){let e={},n=a(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],gy(n));let i=a(t,["thought"]);i!=null&&l(e,["thought"],i);let o=a(t,["inlineData"]);o!=null&&l(e,["inlineData"],vy(o));let r=a(t,["fileData"]);r!=null&&l(e,["fileData"],Dy(r));let s=a(t,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);let u=a(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let f=a(t,["executableCode"]);f!=null&&l(e,["executableCode"],f);let c=a(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);let d=a(t,["functionResponse"]);d!=null&&l(e,["functionResponse"],d);let p=a(t,["text"]);return p!=null&&l(e,["text"],p),e}function Sy(t){let e={},n=a(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],yy(n));let i=a(t,["thought"]);i!=null&&l(e,["thought"],i);let o=a(t,["inlineData"]);o!=null&&l(e,["inlineData"],Cy(o));let r=a(t,["fileData"]);r!=null&&l(e,["fileData"],Ty(r));let s=a(t,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);let u=a(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let f=a(t,["executableCode"]);f!=null&&l(e,["executableCode"],f);let c=a(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);let d=a(t,["functionResponse"]);d!=null&&l(e,["functionResponse"],d);let p=a(t,["text"]);return p!=null&&l(e,["text"],p),e}function wy(t){let e={},n=a(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Ey(r))),l(e,["parts"],o)}let i=a(t,["role"]);return i!=null&&l(e,["role"],i),e}function My(t){let e={},n=a(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Sy(r))),l(e,["parts"],o)}let i=a(t,["role"]);return i!=null&&l(e,["role"],i),e}function Fy(t){let e={},n=a(t,["behavior"]);n!=null&&l(e,["behavior"],n);let i=a(t,["description"]);i!=null&&l(e,["description"],i);let o=a(t,["name"]);o!=null&&l(e,["name"],o);let r=a(t,["parameters"]);r!=null&&l(e,["parameters"],r);let s=a(t,["parametersJsonSchema"]);s!=null&&l(e,["parametersJsonSchema"],s);let u=a(t,["response"]);u!=null&&l(e,["response"],u);let f=a(t,["responseJsonSchema"]);return f!=null&&l(e,["responseJsonSchema"],f),e}function xy(t){let e={};if(a(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let n=a(t,["description"]);n!=null&&l(e,["description"],n);let i=a(t,["name"]);i!=null&&l(e,["name"],i);let o=a(t,["parameters"]);o!=null&&l(e,["parameters"],o);let r=a(t,["parametersJsonSchema"]);r!=null&&l(e,["parametersJsonSchema"],r);let s=a(t,["response"]);s!=null&&l(e,["response"],s);let u=a(t,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function _y(t){let e={},n=a(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=a(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function Ay(t){let e={},n=a(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=a(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function Py(t){let e={},n=a(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],_y(n)),e}function Iy(t){let e={},n=a(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],Ay(n)),e}function by(t){let e={},n=a(t,["mode"]);n!=null&&l(e,["mode"],n);let i=a(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function ky(t){let e={},n=a(t,["mode"]);n!=null&&l(e,["mode"],n);let i=a(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function Ry(t){let e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],by(n)),e}function Ny(t){let e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],ky(n)),e}function Ly(){return{}}function By(t){let e={},n=a(t,["apiKeyString"]);return n!=null&&l(e,["apiKeyString"],n),e}function Oy(t){let e={},n=a(t,["apiKeyConfig"]);n!=null&&l(e,["apiKeyConfig"],By(n));let i=a(t,["authType"]);i!=null&&l(e,["authType"],i);let o=a(t,["googleServiceAccountConfig"]);o!=null&&l(e,["googleServiceAccountConfig"],o);let r=a(t,["httpBasicAuthConfig"]);r!=null&&l(e,["httpBasicAuthConfig"],r);let s=a(t,["oauthConfig"]);s!=null&&l(e,["oauthConfig"],s);let u=a(t,["oidcConfig"]);return u!=null&&l(e,["oidcConfig"],u),e}function Uy(t){let e={},n=a(t,["authConfig"]);return n!=null&&l(e,["authConfig"],Oy(n)),e}function Vy(){return{}}function Gy(){return{}}function Hy(t){let e={},n=a(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(c=>Fy(c))),l(e,["functionDeclarations"],f)}if(a(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=a(t,["googleSearch"]);i!=null&&l(e,["googleSearch"],Py(i));let o=a(t,["googleSearchRetrieval"]);if(o!=null&&l(e,["googleSearchRetrieval"],Ry(o)),a(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(t,["urlContext"])!=null&&l(e,["urlContext"],Vy());let s=a(t,["codeExecution"]);s!=null&&l(e,["codeExecution"],s);let u=a(t,["computerUse"]);return u!=null&&l(e,["computerUse"],u),e}function qy(t){let e={},n=a(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(m=>xy(m))),l(e,["functionDeclarations"],p)}let i=a(t,["retrieval"]);i!=null&&l(e,["retrieval"],i);let o=a(t,["googleSearch"]);o!=null&&l(e,["googleSearch"],Iy(o));let r=a(t,["googleSearchRetrieval"]);r!=null&&l(e,["googleSearchRetrieval"],Ny(r)),a(t,["enterpriseWebSearch"])!=null&&l(e,["enterpriseWebSearch"],Ly());let u=a(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],Uy(u)),a(t,["urlContext"])!=null&&l(e,["urlContext"],Gy());let c=a(t,["codeExecution"]);c!=null&&l(e,["codeExecution"],c);let d=a(t,["computerUse"]);return d!=null&&l(e,["computerUse"],d),e}function $y(t){let e={},n=a(t,["handle"]);if(n!=null&&l(e,["handle"],n),a(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Wy(t){let e={},n=a(t,["handle"]);n!=null&&l(e,["handle"],n);let i=a(t,["transparent"]);return i!=null&&l(e,["transparent"],i),e}function Pu(){return{}}function Iu(){return{}}function Jy(t){let e={},n=a(t,["disabled"]);n!=null&&l(e,["disabled"],n);let i=a(t,["startOfSpeechSensitivity"]);i!=null&&l(e,["startOfSpeechSensitivity"],i);let o=a(t,["endOfSpeechSensitivity"]);o!=null&&l(e,["endOfSpeechSensitivity"],o);let r=a(t,["prefixPaddingMs"]);r!=null&&l(e,["prefixPaddingMs"],r);let s=a(t,["silenceDurationMs"]);return s!=null&&l(e,["silenceDurationMs"],s),e}function zy(t){let e={},n=a(t,["disabled"]);n!=null&&l(e,["disabled"],n);let i=a(t,["startOfSpeechSensitivity"]);i!=null&&l(e,["startOfSpeechSensitivity"],i);let o=a(t,["endOfSpeechSensitivity"]);o!=null&&l(e,["endOfSpeechSensitivity"],o);let r=a(t,["prefixPaddingMs"]);r!=null&&l(e,["prefixPaddingMs"],r);let s=a(t,["silenceDurationMs"]);return s!=null&&l(e,["silenceDurationMs"],s),e}function Yy(t){let e={},n=a(t,["automaticActivityDetection"]);n!=null&&l(e,["automaticActivityDetection"],Jy(n));let i=a(t,["activityHandling"]);i!=null&&l(e,["activityHandling"],i);let o=a(t,["turnCoverage"]);return o!=null&&l(e,["turnCoverage"],o),e}function Ky(t){let e={},n=a(t,["automaticActivityDetection"]);n!=null&&l(e,["automaticActivityDetection"],zy(n));let i=a(t,["activityHandling"]);i!=null&&l(e,["activityHandling"],i);let o=a(t,["turnCoverage"]);return o!=null&&l(e,["turnCoverage"],o),e}function Zy(t){let e={},n=a(t,["targetTokens"]);return n!=null&&l(e,["targetTokens"],n),e}function Qy(t){let e={},n=a(t,["targetTokens"]);return n!=null&&l(e,["targetTokens"],n),e}function Xy(t){let e={},n=a(t,["triggerTokens"]);n!=null&&l(e,["triggerTokens"],n);let i=a(t,["slidingWindow"]);return i!=null&&l(e,["slidingWindow"],Zy(i)),e}function jy(t){let e={},n=a(t,["triggerTokens"]);n!=null&&l(e,["triggerTokens"],n);let i=a(t,["slidingWindow"]);return i!=null&&l(e,["slidingWindow"],Qy(i)),e}function ev(t){let e={},n=a(t,["proactiveAudio"]);return n!=null&&l(e,["proactiveAudio"],n),e}function tv(t){let e={},n=a(t,["proactiveAudio"]);return n!=null&&l(e,["proactiveAudio"],n),e}function nv(t,e){let n={},i=a(t,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],i);let o=a(t,["responseModalities"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","responseModalities"],o);let r=a(t,["temperature"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","temperature"],r);let s=a(t,["topP"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","topP"],s);let u=a(t,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);let f=a(t,["maxOutputTokens"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","maxOutputTokens"],f);let c=a(t,["mediaResolution"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","mediaResolution"],c);let d=a(t,["seed"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","seed"],d);let p=a(t,["speechConfig"]);e!==void 0&&p!=null&&l(e,["setup","generationConfig","speechConfig"],my(Rs(p)));let m=a(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],m);let h=a(t,["systemInstruction"]);e!==void 0&&h!=null&&l(e,["setup","systemInstruction"],wy(ve(h)));let y=a(t,["tools"]);if(e!==void 0&&y!=null){let w=un(y);Array.isArray(w)&&(w=w.map(P=>Hy(ln(P)))),l(e,["setup","tools"],w)}let v=a(t,["sessionResumption"]);e!==void 0&&v!=null&&l(e,["setup","sessionResumption"],$y(v));let T=a(t,["inputAudioTranscription"]);e!==void 0&&T!=null&&l(e,["setup","inputAudioTranscription"],Pu());let S=a(t,["outputAudioTranscription"]);e!==void 0&&S!=null&&l(e,["setup","outputAudioTranscription"],Pu());let _=a(t,["realtimeInputConfig"]);e!==void 0&&_!=null&&l(e,["setup","realtimeInputConfig"],Yy(_));let x=a(t,["contextWindowCompression"]);e!==void 0&&x!=null&&l(e,["setup","contextWindowCompression"],Xy(x));let C=a(t,["proactivity"]);return e!==void 0&&C!=null&&l(e,["setup","proactivity"],ev(C)),n}function iv(t,e){let n={},i=a(t,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],i);let o=a(t,["responseModalities"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","responseModalities"],o);let r=a(t,["temperature"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","temperature"],r);let s=a(t,["topP"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","topP"],s);let u=a(t,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);let f=a(t,["maxOutputTokens"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","maxOutputTokens"],f);let c=a(t,["mediaResolution"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","mediaResolution"],c);let d=a(t,["seed"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","seed"],d);let p=a(t,["speechConfig"]);e!==void 0&&p!=null&&l(e,["setup","generationConfig","speechConfig"],hy(Rs(p)));let m=a(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],m);let h=a(t,["systemInstruction"]);e!==void 0&&h!=null&&l(e,["setup","systemInstruction"],My(ve(h)));let y=a(t,["tools"]);if(e!==void 0&&y!=null){let w=un(y);Array.isArray(w)&&(w=w.map(P=>qy(ln(P)))),l(e,["setup","tools"],w)}let v=a(t,["sessionResumption"]);e!==void 0&&v!=null&&l(e,["setup","sessionResumption"],Wy(v));let T=a(t,["inputAudioTranscription"]);e!==void 0&&T!=null&&l(e,["setup","inputAudioTranscription"],Iu());let S=a(t,["outputAudioTranscription"]);e!==void 0&&S!=null&&l(e,["setup","outputAudioTranscription"],Iu());let _=a(t,["realtimeInputConfig"]);e!==void 0&&_!=null&&l(e,["setup","realtimeInputConfig"],Ky(_));let x=a(t,["contextWindowCompression"]);e!==void 0&&x!=null&&l(e,["setup","contextWindowCompression"],jy(x));let C=a(t,["proactivity"]);return e!==void 0&&C!=null&&l(e,["setup","proactivity"],tv(C)),n}function ov(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["setup","model"],Q(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],nv(o,n)),n}function rv(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["setup","model"],Q(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],iv(o,n)),n}function sv(){return{}}function av(){return{}}function lv(){return{}}function uv(){return{}}function cv(t){let e={},n=a(t,["media"]);n!=null&&l(e,["mediaChunks"],zu(n));let i=a(t,["audio"]);i!=null&&l(e,["audio"],Ku(i));let o=a(t,["audioStreamEnd"]);o!=null&&l(e,["audioStreamEnd"],o);let r=a(t,["video"]);r!=null&&l(e,["video"],Yu(r));let s=a(t,["text"]);return s!=null&&l(e,["text"],s),a(t,["activityStart"])!=null&&l(e,["activityStart"],sv()),a(t,["activityEnd"])!=null&&l(e,["activityEnd"],lv()),e}function fv(t){let e={},n=a(t,["media"]);n!=null&&l(e,["mediaChunks"],zu(n));let i=a(t,["audio"]);i!=null&&l(e,["audio"],Ku(i));let o=a(t,["audioStreamEnd"]);o!=null&&l(e,["audioStreamEnd"],o);let r=a(t,["video"]);r!=null&&l(e,["video"],Yu(r));let s=a(t,["text"]);return s!=null&&l(e,["text"],s),a(t,["activityStart"])!=null&&l(e,["activityStart"],av()),a(t,["activityEnd"])!=null&&l(e,["activityEnd"],uv()),e}function cc(t){let e={},n=a(t,["text"]);n!=null&&l(e,["text"],n);let i=a(t,["weight"]);return i!=null&&l(e,["weight"],i),e}function dv(t){let e={},n=a(t,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>cc(o))),l(e,["weightedPrompts"],i)}return e}function fc(t){let e={},n=a(t,["temperature"]);n!=null&&l(e,["temperature"],n);let i=a(t,["topK"]);i!=null&&l(e,["topK"],i);let o=a(t,["seed"]);o!=null&&l(e,["seed"],o);let r=a(t,["guidance"]);r!=null&&l(e,["guidance"],r);let s=a(t,["bpm"]);s!=null&&l(e,["bpm"],s);let u=a(t,["density"]);u!=null&&l(e,["density"],u);let f=a(t,["brightness"]);f!=null&&l(e,["brightness"],f);let c=a(t,["scale"]);c!=null&&l(e,["scale"],c);let d=a(t,["muteBass"]);d!=null&&l(e,["muteBass"],d);let p=a(t,["muteDrums"]);p!=null&&l(e,["muteDrums"],p);let m=a(t,["onlyBassAndDrums"]);return m!=null&&l(e,["onlyBassAndDrums"],m),e}function pv(t){let e={},n=a(t,["musicGenerationConfig"]);return n!=null&&l(e,["musicGenerationConfig"],fc(n)),e}function dc(t){let e={},n=a(t,["model"]);return n!=null&&l(e,["model"],n),e}function pc(t){let e={},n=a(t,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>cc(o))),l(e,["weightedPrompts"],i)}return e}function ds(t){let e={},n=a(t,["setup"]);n!=null&&l(e,["setup"],dc(n));let i=a(t,["clientContent"]);i!=null&&l(e,["clientContent"],pc(i));let o=a(t,["musicGenerationConfig"]);o!=null&&l(e,["musicGenerationConfig"],fc(o));let r=a(t,["playbackControl"]);return r!=null&&l(e,["playbackControl"],r),e}function mv(){return{}}function hv(t){let e={},n=a(t,["sessionId"]);return n!=null&&l(e,["sessionId"],n),e}function gv(t){let e={},n=a(t,["fps"]);n!=null&&l(e,["fps"],n);let i=a(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let o=a(t,["startOffset"]);return o!=null&&l(e,["startOffset"],o),e}function yv(t){let e={},n=a(t,["fps"]);n!=null&&l(e,["fps"],n);let i=a(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let o=a(t,["startOffset"]);return o!=null&&l(e,["startOffset"],o),e}function vv(t){let e={},n=a(t,["data"]);n!=null&&l(e,["data"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Cv(t){let e={},n=a(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=a(t,["data"]);i!=null&&l(e,["data"],i);let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function Dv(t){let e={},n=a(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function Tv(t){let e={},n=a(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=a(t,["fileUri"]);i!=null&&l(e,["fileUri"],i);let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function Ev(t){let e={},n=a(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],gv(n));let i=a(t,["thought"]);i!=null&&l(e,["thought"],i);let o=a(t,["inlineData"]);o!=null&&l(e,["inlineData"],vv(o));let r=a(t,["fileData"]);r!=null&&l(e,["fileData"],Dv(r));let s=a(t,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);let u=a(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let f=a(t,["executableCode"]);f!=null&&l(e,["executableCode"],f);let c=a(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);let d=a(t,["functionResponse"]);d!=null&&l(e,["functionResponse"],d);let p=a(t,["text"]);return p!=null&&l(e,["text"],p),e}function Sv(t){let e={},n=a(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],yv(n));let i=a(t,["thought"]);i!=null&&l(e,["thought"],i);let o=a(t,["inlineData"]);o!=null&&l(e,["inlineData"],Cv(o));let r=a(t,["fileData"]);r!=null&&l(e,["fileData"],Tv(r));let s=a(t,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);let u=a(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let f=a(t,["executableCode"]);f!=null&&l(e,["executableCode"],f);let c=a(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);let d=a(t,["functionResponse"]);d!=null&&l(e,["functionResponse"],d);let p=a(t,["text"]);return p!=null&&l(e,["text"],p),e}function wv(t){let e={},n=a(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Ev(r))),l(e,["parts"],o)}let i=a(t,["role"]);return i!=null&&l(e,["role"],i),e}function Mv(t){let e={},n=a(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Sv(r))),l(e,["parts"],o)}let i=a(t,["role"]);return i!=null&&l(e,["role"],i),e}function bu(t){let e={},n=a(t,["text"]);n!=null&&l(e,["text"],n);let i=a(t,["finished"]);return i!=null&&l(e,["finished"],i),e}function ku(t){let e={},n=a(t,["text"]);n!=null&&l(e,["text"],n);let i=a(t,["finished"]);return i!=null&&l(e,["finished"],i),e}function Fv(t){let e={},n=a(t,["retrievedUrl"]);n!=null&&l(e,["retrievedUrl"],n);let i=a(t,["urlRetrievalStatus"]);return i!=null&&l(e,["urlRetrievalStatus"],i),e}function xv(t){let e={},n=a(t,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Fv(o))),l(e,["urlMetadata"],i)}return e}function _v(t){let e={},n=a(t,["modelTurn"]);n!=null&&l(e,["modelTurn"],wv(n));let i=a(t,["turnComplete"]);i!=null&&l(e,["turnComplete"],i);let o=a(t,["interrupted"]);o!=null&&l(e,["interrupted"],o);let r=a(t,["groundingMetadata"]);r!=null&&l(e,["groundingMetadata"],r);let s=a(t,["generationComplete"]);s!=null&&l(e,["generationComplete"],s);let u=a(t,["inputTranscription"]);u!=null&&l(e,["inputTranscription"],bu(u));let f=a(t,["outputTranscription"]);f!=null&&l(e,["outputTranscription"],bu(f));let c=a(t,["urlContextMetadata"]);return c!=null&&l(e,["urlContextMetadata"],xv(c)),e}function Av(t){let e={},n=a(t,["modelTurn"]);n!=null&&l(e,["modelTurn"],Mv(n));let i=a(t,["turnComplete"]);i!=null&&l(e,["turnComplete"],i);let o=a(t,["interrupted"]);o!=null&&l(e,["interrupted"],o);let r=a(t,["groundingMetadata"]);r!=null&&l(e,["groundingMetadata"],r);let s=a(t,["generationComplete"]);s!=null&&l(e,["generationComplete"],s);let u=a(t,["inputTranscription"]);u!=null&&l(e,["inputTranscription"],ku(u));let f=a(t,["outputTranscription"]);return f!=null&&l(e,["outputTranscription"],ku(f)),e}function Pv(t){let e={},n=a(t,["id"]);n!=null&&l(e,["id"],n);let i=a(t,["args"]);i!=null&&l(e,["args"],i);let o=a(t,["name"]);return o!=null&&l(e,["name"],o),e}function Iv(t){let e={},n=a(t,["args"]);n!=null&&l(e,["args"],n);let i=a(t,["name"]);return i!=null&&l(e,["name"],i),e}function bv(t){let e={},n=a(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Pv(o))),l(e,["functionCalls"],i)}return e}function kv(t){let e={},n=a(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Iv(o))),l(e,["functionCalls"],i)}return e}function Rv(t){let e={},n=a(t,["ids"]);return n!=null&&l(e,["ids"],n),e}function Nv(t){let e={},n=a(t,["ids"]);return n!=null&&l(e,["ids"],n),e}function $i(t){let e={},n=a(t,["modality"]);n!=null&&l(e,["modality"],n);let i=a(t,["tokenCount"]);return i!=null&&l(e,["tokenCount"],i),e}function Wi(t){let e={},n=a(t,["modality"]);n!=null&&l(e,["modality"],n);let i=a(t,["tokenCount"]);return i!=null&&l(e,["tokenCount"],i),e}function Lv(t){let e={},n=a(t,["promptTokenCount"]);n!=null&&l(e,["promptTokenCount"],n);let i=a(t,["cachedContentTokenCount"]);i!=null&&l(e,["cachedContentTokenCount"],i);let o=a(t,["responseTokenCount"]);o!=null&&l(e,["responseTokenCount"],o);let r=a(t,["toolUsePromptTokenCount"]);r!=null&&l(e,["toolUsePromptTokenCount"],r);let s=a(t,["thoughtsTokenCount"]);s!=null&&l(e,["thoughtsTokenCount"],s);let u=a(t,["totalTokenCount"]);u!=null&&l(e,["totalTokenCount"],u);let f=a(t,["promptTokensDetails"]);if(f!=null){let m=f;Array.isArray(m)&&(m=m.map(h=>$i(h))),l(e,["promptTokensDetails"],m)}let c=a(t,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(h=>$i(h))),l(e,["cacheTokensDetails"],m)}let d=a(t,["responseTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(h=>$i(h))),l(e,["responseTokensDetails"],m)}let p=a(t,["toolUsePromptTokensDetails"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(h=>$i(h))),l(e,["toolUsePromptTokensDetails"],m)}return e}function Bv(t){let e={},n=a(t,["promptTokenCount"]);n!=null&&l(e,["promptTokenCount"],n);let i=a(t,["cachedContentTokenCount"]);i!=null&&l(e,["cachedContentTokenCount"],i);let o=a(t,["candidatesTokenCount"]);o!=null&&l(e,["responseTokenCount"],o);let r=a(t,["toolUsePromptTokenCount"]);r!=null&&l(e,["toolUsePromptTokenCount"],r);let s=a(t,["thoughtsTokenCount"]);s!=null&&l(e,["thoughtsTokenCount"],s);let u=a(t,["totalTokenCount"]);u!=null&&l(e,["totalTokenCount"],u);let f=a(t,["promptTokensDetails"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(y=>Wi(y))),l(e,["promptTokensDetails"],h)}let c=a(t,["cacheTokensDetails"]);if(c!=null){let h=c;Array.isArray(h)&&(h=h.map(y=>Wi(y))),l(e,["cacheTokensDetails"],h)}let d=a(t,["candidatesTokensDetails"]);if(d!=null){let h=d;Array.isArray(h)&&(h=h.map(y=>Wi(y))),l(e,["responseTokensDetails"],h)}let p=a(t,["toolUsePromptTokensDetails"]);if(p!=null){let h=p;Array.isArray(h)&&(h=h.map(y=>Wi(y))),l(e,["toolUsePromptTokensDetails"],h)}let m=a(t,["trafficType"]);return m!=null&&l(e,["trafficType"],m),e}function Ov(t){let e={},n=a(t,["timeLeft"]);return n!=null&&l(e,["timeLeft"],n),e}function Uv(t){let e={},n=a(t,["timeLeft"]);return n!=null&&l(e,["timeLeft"],n),e}function Vv(t){let e={},n=a(t,["newHandle"]);n!=null&&l(e,["newHandle"],n);let i=a(t,["resumable"]);i!=null&&l(e,["resumable"],i);let o=a(t,["lastConsumedClientMessageIndex"]);return o!=null&&l(e,["lastConsumedClientMessageIndex"],o),e}function Gv(t){let e={},n=a(t,["newHandle"]);n!=null&&l(e,["newHandle"],n);let i=a(t,["resumable"]);i!=null&&l(e,["resumable"],i);let o=a(t,["lastConsumedClientMessageIndex"]);return o!=null&&l(e,["lastConsumedClientMessageIndex"],o),e}function Hv(t){let e={};a(t,["setupComplete"])!=null&&l(e,["setupComplete"],mv());let i=a(t,["serverContent"]);i!=null&&l(e,["serverContent"],_v(i));let o=a(t,["toolCall"]);o!=null&&l(e,["toolCall"],bv(o));let r=a(t,["toolCallCancellation"]);r!=null&&l(e,["toolCallCancellation"],Rv(r));let s=a(t,["usageMetadata"]);s!=null&&l(e,["usageMetadata"],Lv(s));let u=a(t,["goAway"]);u!=null&&l(e,["goAway"],Ov(u));let f=a(t,["sessionResumptionUpdate"]);return f!=null&&l(e,["sessionResumptionUpdate"],Vv(f)),e}function qv(t){let e={},n=a(t,["setupComplete"]);n!=null&&l(e,["setupComplete"],hv(n));let i=a(t,["serverContent"]);i!=null&&l(e,["serverContent"],Av(i));let o=a(t,["toolCall"]);o!=null&&l(e,["toolCall"],kv(o));let r=a(t,["toolCallCancellation"]);r!=null&&l(e,["toolCallCancellation"],Nv(r));let s=a(t,["usageMetadata"]);s!=null&&l(e,["usageMetadata"],Bv(s));let u=a(t,["goAway"]);u!=null&&l(e,["goAway"],Uv(u));let f=a(t,["sessionResumptionUpdate"]);return f!=null&&l(e,["sessionResumptionUpdate"],Gv(f)),e}function $v(){return{}}function Wv(t){let e={},n=a(t,["text"]);n!=null&&l(e,["text"],n);let i=a(t,["weight"]);return i!=null&&l(e,["weight"],i),e}function Jv(t){let e={},n=a(t,["weightedPrompts"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Wv(o))),l(e,["weightedPrompts"],i)}return e}function zv(t){let e={},n=a(t,["temperature"]);n!=null&&l(e,["temperature"],n);let i=a(t,["topK"]);i!=null&&l(e,["topK"],i);let o=a(t,["seed"]);o!=null&&l(e,["seed"],o);let r=a(t,["guidance"]);r!=null&&l(e,["guidance"],r);let s=a(t,["bpm"]);s!=null&&l(e,["bpm"],s);let u=a(t,["density"]);u!=null&&l(e,["density"],u);let f=a(t,["brightness"]);f!=null&&l(e,["brightness"],f);let c=a(t,["scale"]);c!=null&&l(e,["scale"],c);let d=a(t,["muteBass"]);d!=null&&l(e,["muteBass"],d);let p=a(t,["muteDrums"]);p!=null&&l(e,["muteDrums"],p);let m=a(t,["onlyBassAndDrums"]);return m!=null&&l(e,["onlyBassAndDrums"],m),e}function Yv(t){let e={},n=a(t,["clientContent"]);n!=null&&l(e,["clientContent"],Jv(n));let i=a(t,["musicGenerationConfig"]);return i!=null&&l(e,["musicGenerationConfig"],zv(i)),e}function Kv(t){let e={},n=a(t,["data"]);n!=null&&l(e,["data"],n);let i=a(t,["mimeType"]);i!=null&&l(e,["mimeType"],i);let o=a(t,["sourceMetadata"]);return o!=null&&l(e,["sourceMetadata"],Yv(o)),e}function Zv(t){let e={},n=a(t,["audioChunks"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Kv(o))),l(e,["audioChunks"],i)}return e}function Qv(t){let e={},n=a(t,["text"]);n!=null&&l(e,["text"],n);let i=a(t,["filteredReason"]);return i!=null&&l(e,["filteredReason"],i),e}function Xv(t){let e={};a(t,["setupComplete"])!=null&&l(e,["setupComplete"],$v());let i=a(t,["serverContent"]);i!=null&&l(e,["serverContent"],Zv(i));let o=a(t,["filteredPrompt"]);return o!=null&&l(e,["filteredPrompt"],Qv(o)),e}function jv(t){let e={},n=a(t,["fps"]);n!=null&&l(e,["fps"],n);let i=a(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let o=a(t,["startOffset"]);return o!=null&&l(e,["startOffset"],o),e}function eC(t){let e={};if(a(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=a(t,["data"]);n!=null&&l(e,["data"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function tC(t){let e={};if(a(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=a(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function nC(t){let e={},n=a(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],jv(n));let i=a(t,["thought"]);i!=null&&l(e,["thought"],i);let o=a(t,["inlineData"]);o!=null&&l(e,["inlineData"],eC(o));let r=a(t,["fileData"]);r!=null&&l(e,["fileData"],tC(r));let s=a(t,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);let u=a(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let f=a(t,["executableCode"]);f!=null&&l(e,["executableCode"],f);let c=a(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);let d=a(t,["functionResponse"]);d!=null&&l(e,["functionResponse"],d);let p=a(t,["text"]);return p!=null&&l(e,["text"],p),e}function ao(t){let e={},n=a(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>nC(r))),l(e,["parts"],o)}let i=a(t,["role"]);return i!=null&&l(e,["role"],i),e}function iC(t){let e={},n=a(t,["anyOf"]);n!=null&&l(e,["anyOf"],n);let i=a(t,["default"]);i!=null&&l(e,["default"],i);let o=a(t,["description"]);o!=null&&l(e,["description"],o);let r=a(t,["enum"]);r!=null&&l(e,["enum"],r);let s=a(t,["example"]);s!=null&&l(e,["example"],s);let u=a(t,["format"]);u!=null&&l(e,["format"],u);let f=a(t,["items"]);f!=null&&l(e,["items"],f);let c=a(t,["maxItems"]);c!=null&&l(e,["maxItems"],c);let d=a(t,["maxLength"]);d!=null&&l(e,["maxLength"],d);let p=a(t,["maxProperties"]);p!=null&&l(e,["maxProperties"],p);let m=a(t,["maximum"]);m!=null&&l(e,["maximum"],m);let h=a(t,["minItems"]);h!=null&&l(e,["minItems"],h);let y=a(t,["minLength"]);y!=null&&l(e,["minLength"],y);let v=a(t,["minProperties"]);v!=null&&l(e,["minProperties"],v);let T=a(t,["minimum"]);T!=null&&l(e,["minimum"],T);let S=a(t,["nullable"]);S!=null&&l(e,["nullable"],S);let _=a(t,["pattern"]);_!=null&&l(e,["pattern"],_);let x=a(t,["properties"]);x!=null&&l(e,["properties"],x);let C=a(t,["propertyOrdering"]);C!=null&&l(e,["propertyOrdering"],C);let w=a(t,["required"]);w!=null&&l(e,["required"],w);let P=a(t,["title"]);P!=null&&l(e,["title"],P);let M=a(t,["type"]);return M!=null&&l(e,["type"],M),e}function oC(t){let e={};if(a(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");let n=a(t,["category"]);n!=null&&l(e,["category"],n);let i=a(t,["threshold"]);return i!=null&&l(e,["threshold"],i),e}function rC(t){let e={},n=a(t,["behavior"]);n!=null&&l(e,["behavior"],n);let i=a(t,["description"]);i!=null&&l(e,["description"],i);let o=a(t,["name"]);o!=null&&l(e,["name"],o);let r=a(t,["parameters"]);r!=null&&l(e,["parameters"],r);let s=a(t,["parametersJsonSchema"]);s!=null&&l(e,["parametersJsonSchema"],s);let u=a(t,["response"]);u!=null&&l(e,["response"],u);let f=a(t,["responseJsonSchema"]);return f!=null&&l(e,["responseJsonSchema"],f),e}function sC(t){let e={},n=a(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=a(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function aC(t){let e={},n=a(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],sC(n)),e}function lC(t){let e={},n=a(t,["mode"]);n!=null&&l(e,["mode"],n);let i=a(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function uC(t){let e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],lC(n)),e}function cC(){return{}}function fC(t){let e={},n=a(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(c=>rC(c))),l(e,["functionDeclarations"],f)}if(a(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=a(t,["googleSearch"]);i!=null&&l(e,["googleSearch"],aC(i));let o=a(t,["googleSearchRetrieval"]);if(o!=null&&l(e,["googleSearchRetrieval"],uC(o)),a(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(t,["urlContext"])!=null&&l(e,["urlContext"],cC());let s=a(t,["codeExecution"]);s!=null&&l(e,["codeExecution"],s);let u=a(t,["computerUse"]);return u!=null&&l(e,["computerUse"],u),e}function dC(t){let e={},n=a(t,["mode"]);n!=null&&l(e,["mode"],n);let i=a(t,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function pC(t){let e={},n=a(t,["latitude"]);n!=null&&l(e,["latitude"],n);let i=a(t,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function mC(t){let e={},n=a(t,["latLng"]);n!=null&&l(e,["latLng"],pC(n));let i=a(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function hC(t){let e={},n=a(t,["functionCallingConfig"]);n!=null&&l(e,["functionCallingConfig"],dC(n));let i=a(t,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],mC(i)),e}function gC(t){let e={},n=a(t,["voiceName"]);return n!=null&&l(e,["voiceName"],n),e}function mc(t){let e={},n=a(t,["prebuiltVoiceConfig"]);return n!=null&&l(e,["prebuiltVoiceConfig"],gC(n)),e}function yC(t){let e={},n=a(t,["speaker"]);n!=null&&l(e,["speaker"],n);let i=a(t,["voiceConfig"]);return i!=null&&l(e,["voiceConfig"],mc(i)),e}function vC(t){let e={},n=a(t,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>yC(o))),l(e,["speakerVoiceConfigs"],i)}return e}function CC(t){let e={},n=a(t,["voiceConfig"]);n!=null&&l(e,["voiceConfig"],mc(n));let i=a(t,["multiSpeakerVoiceConfig"]);i!=null&&l(e,["multiSpeakerVoiceConfig"],vC(i));let o=a(t,["languageCode"]);return o!=null&&l(e,["languageCode"],o),e}function DC(t){let e={},n=a(t,["includeThoughts"]);n!=null&&l(e,["includeThoughts"],n);let i=a(t,["thinkingBudget"]);return i!=null&&l(e,["thinkingBudget"],i),e}function TC(t,e,n){let i={},o=a(e,["systemInstruction"]);n!==void 0&&o!=null&&l(n,["systemInstruction"],ao(ve(o)));let r=a(e,["temperature"]);r!=null&&l(i,["temperature"],r);let s=a(e,["topP"]);s!=null&&l(i,["topP"],s);let u=a(e,["topK"]);u!=null&&l(i,["topK"],u);let f=a(e,["candidateCount"]);f!=null&&l(i,["candidateCount"],f);let c=a(e,["maxOutputTokens"]);c!=null&&l(i,["maxOutputTokens"],c);let d=a(e,["stopSequences"]);d!=null&&l(i,["stopSequences"],d);let p=a(e,["responseLogprobs"]);p!=null&&l(i,["responseLogprobs"],p);let m=a(e,["logprobs"]);m!=null&&l(i,["logprobs"],m);let h=a(e,["presencePenalty"]);h!=null&&l(i,["presencePenalty"],h);let y=a(e,["frequencyPenalty"]);y!=null&&l(i,["frequencyPenalty"],y);let v=a(e,["seed"]);v!=null&&l(i,["seed"],v);let T=a(e,["responseMimeType"]);T!=null&&l(i,["responseMimeType"],T);let S=a(e,["responseSchema"]);S!=null&&l(i,["responseSchema"],iC(bs(S)));let _=a(e,["responseJsonSchema"]);if(_!=null&&l(i,["responseJsonSchema"],_),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");let x=a(e,["safetySettings"]);if(n!==void 0&&x!=null){let O=x;Array.isArray(O)&&(O=O.map($=>oC($))),l(n,["safetySettings"],O)}let C=a(e,["tools"]);if(n!==void 0&&C!=null){let O=un(C);Array.isArray(O)&&(O=O.map($=>fC(ln($)))),l(n,["tools"],O)}let w=a(e,["toolConfig"]);if(n!==void 0&&w!=null&&l(n,["toolConfig"],hC(w)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");let P=a(e,["cachedContent"]);n!==void 0&&P!=null&&l(n,["cachedContent"],ct(t,P));let M=a(e,["responseModalities"]);M!=null&&l(i,["responseModalities"],M);let b=a(e,["mediaResolution"]);b!=null&&l(i,["mediaResolution"],b);let k=a(e,["speechConfig"]);if(k!=null&&l(i,["speechConfig"],CC(ks(k))),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");let L=a(e,["thinkingConfig"]);return L!=null&&l(i,["thinkingConfig"],DC(L)),i}function Ru(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["contents"]);if(o!=null){let s=Re(o);Array.isArray(s)&&(s=s.map(u=>ao(u))),l(n,["contents"],s)}let r=a(e,["config"]);return r!=null&&l(n,["generationConfig"],TC(t,r,n)),n}function EC(t,e){let n={},i=a(t,["taskType"]);e!==void 0&&i!=null&&l(e,["requests[]","taskType"],i);let o=a(t,["title"]);e!==void 0&&o!=null&&l(e,["requests[]","title"],o);let r=a(t,["outputDimensionality"]);if(e!==void 0&&r!=null&&l(e,["requests[]","outputDimensionality"],r),a(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function SC(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["contents"]);o!=null&&l(n,["requests[]","content"],Qu(t,o));let r=a(e,["config"]);r!=null&&l(n,["config"],EC(r,n));let s=a(e,["model"]);return s!==void 0&&l(n,["requests[]","model"],Q(t,s)),n}function wC(t,e){let n={};if(a(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");let i=a(t,["numberOfImages"]);e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i);let o=a(t,["aspectRatio"]);e!==void 0&&o!=null&&l(e,["parameters","aspectRatio"],o);let r=a(t,["guidanceScale"]);if(e!==void 0&&r!=null&&l(e,["parameters","guidanceScale"],r),a(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let s=a(t,["safetyFilterLevel"]);e!==void 0&&s!=null&&l(e,["parameters","safetySetting"],s);let u=a(t,["personGeneration"]);e!==void 0&&u!=null&&l(e,["parameters","personGeneration"],u);let f=a(t,["includeSafetyAttributes"]);e!==void 0&&f!=null&&l(e,["parameters","includeSafetyAttributes"],f);let c=a(t,["includeRaiReason"]);e!==void 0&&c!=null&&l(e,["parameters","includeRaiReason"],c);let d=a(t,["language"]);e!==void 0&&d!=null&&l(e,["parameters","language"],d);let p=a(t,["outputMimeType"]);e!==void 0&&p!=null&&l(e,["parameters","outputOptions","mimeType"],p);let m=a(t,["outputCompressionQuality"]);if(e!==void 0&&m!=null&&l(e,["parameters","outputOptions","compressionQuality"],m),a(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(a(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function MC(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["prompt"]);o!=null&&l(n,["instances[0]","prompt"],o);let r=a(e,["config"]);return r!=null&&l(n,["config"],wC(r,n)),n}function FC(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","name"],Q(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function xC(t,e,n){let i={},o=a(e,["pageSize"]);n!==void 0&&o!=null&&l(n,["_query","pageSize"],o);let r=a(e,["pageToken"]);n!==void 0&&r!=null&&l(n,["_query","pageToken"],r);let s=a(e,["filter"]);n!==void 0&&s!=null&&l(n,["_query","filter"],s);let u=a(e,["queryBase"]);return n!==void 0&&u!=null&&l(n,["_url","models_url"],ec(t,u)),i}function _C(t,e){let n={},i=a(e,["config"]);return i!=null&&l(n,["config"],xC(t,i,n)),n}function AC(t,e){let n={},i=a(t,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);let o=a(t,["description"]);e!==void 0&&o!=null&&l(e,["description"],o);let r=a(t,["defaultCheckpointId"]);return e!==void 0&&r!=null&&l(e,["defaultCheckpointId"],r),n}function PC(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","name"],Q(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],AC(o,n)),n}function IC(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","name"],Q(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function bC(t){let e={};if(a(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(a(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(a(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function kC(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["contents"]);if(o!=null){let s=Re(o);Array.isArray(s)&&(s=s.map(u=>ao(u))),l(n,["contents"],s)}let r=a(e,["config"]);return r!=null&&l(n,["config"],bC(r)),n}function RC(t){let e={};if(a(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");let n=a(t,["imageBytes"]);n!=null&&l(e,["bytesBase64Encoded"],ft(n));let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function NC(t,e){let n={},i=a(t,["numberOfVideos"]);if(e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i),a(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");let o=a(t,["durationSeconds"]);if(e!==void 0&&o!=null&&l(e,["parameters","durationSeconds"],o),a(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");let r=a(t,["aspectRatio"]);if(e!==void 0&&r!=null&&l(e,["parameters","aspectRatio"],r),a(t,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");let s=a(t,["personGeneration"]);if(e!==void 0&&s!=null&&l(e,["parameters","personGeneration"],s),a(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");let u=a(t,["negativePrompt"]);e!==void 0&&u!=null&&l(e,["parameters","negativePrompt"],u);let f=a(t,["enhancePrompt"]);if(e!==void 0&&f!=null&&l(e,["parameters","enhancePrompt"],f),a(t,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");if(a(t,["lastFrame"])!==void 0)throw new Error("lastFrame parameter is not supported in Gemini API.");if(a(t,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function LC(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["prompt"]);o!=null&&l(n,["instances[0]","prompt"],o);let r=a(e,["image"]);if(r!=null&&l(n,["instances[0]","image"],RC(r)),a(e,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");let s=a(e,["config"]);return s!=null&&l(n,["config"],NC(s,n)),n}function BC(t){let e={},n=a(t,["fps"]);n!=null&&l(e,["fps"],n);let i=a(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let o=a(t,["startOffset"]);return o!=null&&l(e,["startOffset"],o),e}function OC(t){let e={},n=a(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=a(t,["data"]);i!=null&&l(e,["data"],i);let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function UC(t){let e={},n=a(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=a(t,["fileUri"]);i!=null&&l(e,["fileUri"],i);let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function VC(t){let e={},n=a(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],BC(n));let i=a(t,["thought"]);i!=null&&l(e,["thought"],i);let o=a(t,["inlineData"]);o!=null&&l(e,["inlineData"],OC(o));let r=a(t,["fileData"]);r!=null&&l(e,["fileData"],UC(r));let s=a(t,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);let u=a(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let f=a(t,["executableCode"]);f!=null&&l(e,["executableCode"],f);let c=a(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);let d=a(t,["functionResponse"]);d!=null&&l(e,["functionResponse"],d);let p=a(t,["text"]);return p!=null&&l(e,["text"],p),e}function fn(t){let e={},n=a(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>VC(r))),l(e,["parts"],o)}let i=a(t,["role"]);return i!=null&&l(e,["role"],i),e}function GC(t){let e={},n=a(t,["anyOf"]);n!=null&&l(e,["anyOf"],n);let i=a(t,["default"]);i!=null&&l(e,["default"],i);let o=a(t,["description"]);o!=null&&l(e,["description"],o);let r=a(t,["enum"]);r!=null&&l(e,["enum"],r);let s=a(t,["example"]);s!=null&&l(e,["example"],s);let u=a(t,["format"]);u!=null&&l(e,["format"],u);let f=a(t,["items"]);f!=null&&l(e,["items"],f);let c=a(t,["maxItems"]);c!=null&&l(e,["maxItems"],c);let d=a(t,["maxLength"]);d!=null&&l(e,["maxLength"],d);let p=a(t,["maxProperties"]);p!=null&&l(e,["maxProperties"],p);let m=a(t,["maximum"]);m!=null&&l(e,["maximum"],m);let h=a(t,["minItems"]);h!=null&&l(e,["minItems"],h);let y=a(t,["minLength"]);y!=null&&l(e,["minLength"],y);let v=a(t,["minProperties"]);v!=null&&l(e,["minProperties"],v);let T=a(t,["minimum"]);T!=null&&l(e,["minimum"],T);let S=a(t,["nullable"]);S!=null&&l(e,["nullable"],S);let _=a(t,["pattern"]);_!=null&&l(e,["pattern"],_);let x=a(t,["properties"]);x!=null&&l(e,["properties"],x);let C=a(t,["propertyOrdering"]);C!=null&&l(e,["propertyOrdering"],C);let w=a(t,["required"]);w!=null&&l(e,["required"],w);let P=a(t,["title"]);P!=null&&l(e,["title"],P);let M=a(t,["type"]);return M!=null&&l(e,["type"],M),e}function HC(t){let e={},n=a(t,["featureSelectionPreference"]);return n!=null&&l(e,["featureSelectionPreference"],n),e}function qC(t){let e={},n=a(t,["method"]);n!=null&&l(e,["method"],n);let i=a(t,["category"]);i!=null&&l(e,["category"],i);let o=a(t,["threshold"]);return o!=null&&l(e,["threshold"],o),e}function $C(t){let e={};if(a(t,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");let n=a(t,["description"]);n!=null&&l(e,["description"],n);let i=a(t,["name"]);i!=null&&l(e,["name"],i);let o=a(t,["parameters"]);o!=null&&l(e,["parameters"],o);let r=a(t,["parametersJsonSchema"]);r!=null&&l(e,["parametersJsonSchema"],r);let s=a(t,["response"]);s!=null&&l(e,["response"],s);let u=a(t,["responseJsonSchema"]);return u!=null&&l(e,["responseJsonSchema"],u),e}function WC(t){let e={},n=a(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=a(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function JC(t){let e={},n=a(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],WC(n)),e}function zC(t){let e={},n=a(t,["mode"]);n!=null&&l(e,["mode"],n);let i=a(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function YC(t){let e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],zC(n)),e}function KC(){return{}}function ZC(t){let e={},n=a(t,["apiKeyString"]);return n!=null&&l(e,["apiKeyString"],n),e}function QC(t){let e={},n=a(t,["apiKeyConfig"]);n!=null&&l(e,["apiKeyConfig"],ZC(n));let i=a(t,["authType"]);i!=null&&l(e,["authType"],i);let o=a(t,["googleServiceAccountConfig"]);o!=null&&l(e,["googleServiceAccountConfig"],o);let r=a(t,["httpBasicAuthConfig"]);r!=null&&l(e,["httpBasicAuthConfig"],r);let s=a(t,["oauthConfig"]);s!=null&&l(e,["oauthConfig"],s);let u=a(t,["oidcConfig"]);return u!=null&&l(e,["oidcConfig"],u),e}function XC(t){let e={},n=a(t,["authConfig"]);return n!=null&&l(e,["authConfig"],QC(n)),e}function jC(){return{}}function hc(t){let e={},n=a(t,["functionDeclarations"]);if(n!=null){let p=n;Array.isArray(p)&&(p=p.map(m=>$C(m))),l(e,["functionDeclarations"],p)}let i=a(t,["retrieval"]);i!=null&&l(e,["retrieval"],i);let o=a(t,["googleSearch"]);o!=null&&l(e,["googleSearch"],JC(o));let r=a(t,["googleSearchRetrieval"]);r!=null&&l(e,["googleSearchRetrieval"],YC(r)),a(t,["enterpriseWebSearch"])!=null&&l(e,["enterpriseWebSearch"],KC());let u=a(t,["googleMaps"]);u!=null&&l(e,["googleMaps"],XC(u)),a(t,["urlContext"])!=null&&l(e,["urlContext"],jC());let c=a(t,["codeExecution"]);c!=null&&l(e,["codeExecution"],c);let d=a(t,["computerUse"]);return d!=null&&l(e,["computerUse"],d),e}function eD(t){let e={},n=a(t,["mode"]);n!=null&&l(e,["mode"],n);let i=a(t,["allowedFunctionNames"]);return i!=null&&l(e,["allowedFunctionNames"],i),e}function tD(t){let e={},n=a(t,["latitude"]);n!=null&&l(e,["latitude"],n);let i=a(t,["longitude"]);return i!=null&&l(e,["longitude"],i),e}function nD(t){let e={},n=a(t,["latLng"]);n!=null&&l(e,["latLng"],tD(n));let i=a(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function iD(t){let e={},n=a(t,["functionCallingConfig"]);n!=null&&l(e,["functionCallingConfig"],eD(n));let i=a(t,["retrievalConfig"]);return i!=null&&l(e,["retrievalConfig"],nD(i)),e}function oD(t){let e={},n=a(t,["voiceName"]);return n!=null&&l(e,["voiceName"],n),e}function rD(t){let e={},n=a(t,["prebuiltVoiceConfig"]);return n!=null&&l(e,["prebuiltVoiceConfig"],oD(n)),e}function sD(t){let e={},n=a(t,["voiceConfig"]);if(n!=null&&l(e,["voiceConfig"],rD(n)),a(t,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");let i=a(t,["languageCode"]);return i!=null&&l(e,["languageCode"],i),e}function aD(t){let e={},n=a(t,["includeThoughts"]);n!=null&&l(e,["includeThoughts"],n);let i=a(t,["thinkingBudget"]);return i!=null&&l(e,["thinkingBudget"],i),e}function lD(t,e,n){let i={},o=a(e,["systemInstruction"]);n!==void 0&&o!=null&&l(n,["systemInstruction"],fn(ve(o)));let r=a(e,["temperature"]);r!=null&&l(i,["temperature"],r);let s=a(e,["topP"]);s!=null&&l(i,["topP"],s);let u=a(e,["topK"]);u!=null&&l(i,["topK"],u);let f=a(e,["candidateCount"]);f!=null&&l(i,["candidateCount"],f);let c=a(e,["maxOutputTokens"]);c!=null&&l(i,["maxOutputTokens"],c);let d=a(e,["stopSequences"]);d!=null&&l(i,["stopSequences"],d);let p=a(e,["responseLogprobs"]);p!=null&&l(i,["responseLogprobs"],p);let m=a(e,["logprobs"]);m!=null&&l(i,["logprobs"],m);let h=a(e,["presencePenalty"]);h!=null&&l(i,["presencePenalty"],h);let y=a(e,["frequencyPenalty"]);y!=null&&l(i,["frequencyPenalty"],y);let v=a(e,["seed"]);v!=null&&l(i,["seed"],v);let T=a(e,["responseMimeType"]);T!=null&&l(i,["responseMimeType"],T);let S=a(e,["responseSchema"]);S!=null&&l(i,["responseSchema"],GC(bs(S)));let _=a(e,["responseJsonSchema"]);_!=null&&l(i,["responseJsonSchema"],_);let x=a(e,["routingConfig"]);x!=null&&l(i,["routingConfig"],x);let C=a(e,["modelSelectionConfig"]);C!=null&&l(i,["modelConfig"],HC(C));let w=a(e,["safetySettings"]);if(n!==void 0&&w!=null){let ne=w;Array.isArray(ne)&&(ne=ne.map(ie=>qC(ie))),l(n,["safetySettings"],ne)}let P=a(e,["tools"]);if(n!==void 0&&P!=null){let ne=un(P);Array.isArray(ne)&&(ne=ne.map(ie=>hc(ln(ie)))),l(n,["tools"],ne)}let M=a(e,["toolConfig"]);n!==void 0&&M!=null&&l(n,["toolConfig"],iD(M));let b=a(e,["labels"]);n!==void 0&&b!=null&&l(n,["labels"],b);let k=a(e,["cachedContent"]);n!==void 0&&k!=null&&l(n,["cachedContent"],ct(t,k));let L=a(e,["responseModalities"]);L!=null&&l(i,["responseModalities"],L);let O=a(e,["mediaResolution"]);O!=null&&l(i,["mediaResolution"],O);let $=a(e,["speechConfig"]);$!=null&&l(i,["speechConfig"],sD(ks($)));let le=a(e,["audioTimestamp"]);le!=null&&l(i,["audioTimestamp"],le);let ue=a(e,["thinkingConfig"]);return ue!=null&&l(i,["thinkingConfig"],aD(ue)),i}function Nu(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["contents"]);if(o!=null){let s=Re(o);Array.isArray(s)&&(s=s.map(u=>fn(u))),l(n,["contents"],s)}let r=a(e,["config"]);return r!=null&&l(n,["generationConfig"],lD(t,r,n)),n}function uD(t,e){let n={},i=a(t,["taskType"]);e!==void 0&&i!=null&&l(e,["instances[]","task_type"],i);let o=a(t,["title"]);e!==void 0&&o!=null&&l(e,["instances[]","title"],o);let r=a(t,["outputDimensionality"]);e!==void 0&&r!=null&&l(e,["parameters","outputDimensionality"],r);let s=a(t,["mimeType"]);e!==void 0&&s!=null&&l(e,["instances[]","mimeType"],s);let u=a(t,["autoTruncate"]);return e!==void 0&&u!=null&&l(e,["parameters","autoTruncate"],u),n}function cD(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["contents"]);o!=null&&l(n,["instances[]","content"],Qu(t,o));let r=a(e,["config"]);return r!=null&&l(n,["config"],uD(r,n)),n}function fD(t,e){let n={},i=a(t,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);let o=a(t,["negativePrompt"]);e!==void 0&&o!=null&&l(e,["parameters","negativePrompt"],o);let r=a(t,["numberOfImages"]);e!==void 0&&r!=null&&l(e,["parameters","sampleCount"],r);let s=a(t,["aspectRatio"]);e!==void 0&&s!=null&&l(e,["parameters","aspectRatio"],s);let u=a(t,["guidanceScale"]);e!==void 0&&u!=null&&l(e,["parameters","guidanceScale"],u);let f=a(t,["seed"]);e!==void 0&&f!=null&&l(e,["parameters","seed"],f);let c=a(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&l(e,["parameters","safetySetting"],c);let d=a(t,["personGeneration"]);e!==void 0&&d!=null&&l(e,["parameters","personGeneration"],d);let p=a(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&l(e,["parameters","includeSafetyAttributes"],p);let m=a(t,["includeRaiReason"]);e!==void 0&&m!=null&&l(e,["parameters","includeRaiReason"],m);let h=a(t,["language"]);e!==void 0&&h!=null&&l(e,["parameters","language"],h);let y=a(t,["outputMimeType"]);e!==void 0&&y!=null&&l(e,["parameters","outputOptions","mimeType"],y);let v=a(t,["outputCompressionQuality"]);e!==void 0&&v!=null&&l(e,["parameters","outputOptions","compressionQuality"],v);let T=a(t,["addWatermark"]);e!==void 0&&T!=null&&l(e,["parameters","addWatermark"],T);let S=a(t,["enhancePrompt"]);return e!==void 0&&S!=null&&l(e,["parameters","enhancePrompt"],S),n}function dD(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["prompt"]);o!=null&&l(n,["instances[0]","prompt"],o);let r=a(e,["config"]);return r!=null&&l(n,["config"],fD(r,n)),n}function lo(t){let e={},n=a(t,["gcsUri"]);n!=null&&l(e,["gcsUri"],n);let i=a(t,["imageBytes"]);i!=null&&l(e,["bytesBase64Encoded"],ft(i));let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function pD(t){let e={},n=a(t,["maskMode"]);n!=null&&l(e,["maskMode"],n);let i=a(t,["segmentationClasses"]);i!=null&&l(e,["maskClasses"],i);let o=a(t,["maskDilation"]);return o!=null&&l(e,["dilation"],o),e}function mD(t){let e={},n=a(t,["controlType"]);n!=null&&l(e,["controlType"],n);let i=a(t,["enableControlImageComputation"]);return i!=null&&l(e,["computeControl"],i),e}function hD(t){let e={},n=a(t,["styleDescription"]);return n!=null&&l(e,["styleDescription"],n),e}function gD(t){let e={},n=a(t,["subjectType"]);n!=null&&l(e,["subjectType"],n);let i=a(t,["subjectDescription"]);return i!=null&&l(e,["subjectDescription"],i),e}function yD(t){let e={},n=a(t,["referenceImage"]);n!=null&&l(e,["referenceImage"],lo(n));let i=a(t,["referenceId"]);i!=null&&l(e,["referenceId"],i);let o=a(t,["referenceType"]);o!=null&&l(e,["referenceType"],o);let r=a(t,["maskImageConfig"]);r!=null&&l(e,["maskImageConfig"],pD(r));let s=a(t,["controlImageConfig"]);s!=null&&l(e,["controlImageConfig"],mD(s));let u=a(t,["styleImageConfig"]);u!=null&&l(e,["styleImageConfig"],hD(u));let f=a(t,["subjectImageConfig"]);return f!=null&&l(e,["subjectImageConfig"],gD(f)),e}function vD(t,e){let n={},i=a(t,["outputGcsUri"]);e!==void 0&&i!=null&&l(e,["parameters","storageUri"],i);let o=a(t,["negativePrompt"]);e!==void 0&&o!=null&&l(e,["parameters","negativePrompt"],o);let r=a(t,["numberOfImages"]);e!==void 0&&r!=null&&l(e,["parameters","sampleCount"],r);let s=a(t,["aspectRatio"]);e!==void 0&&s!=null&&l(e,["parameters","aspectRatio"],s);let u=a(t,["guidanceScale"]);e!==void 0&&u!=null&&l(e,["parameters","guidanceScale"],u);let f=a(t,["seed"]);e!==void 0&&f!=null&&l(e,["parameters","seed"],f);let c=a(t,["safetyFilterLevel"]);e!==void 0&&c!=null&&l(e,["parameters","safetySetting"],c);let d=a(t,["personGeneration"]);e!==void 0&&d!=null&&l(e,["parameters","personGeneration"],d);let p=a(t,["includeSafetyAttributes"]);e!==void 0&&p!=null&&l(e,["parameters","includeSafetyAttributes"],p);let m=a(t,["includeRaiReason"]);e!==void 0&&m!=null&&l(e,["parameters","includeRaiReason"],m);let h=a(t,["language"]);e!==void 0&&h!=null&&l(e,["parameters","language"],h);let y=a(t,["outputMimeType"]);e!==void 0&&y!=null&&l(e,["parameters","outputOptions","mimeType"],y);let v=a(t,["outputCompressionQuality"]);e!==void 0&&v!=null&&l(e,["parameters","outputOptions","compressionQuality"],v);let T=a(t,["editMode"]);e!==void 0&&T!=null&&l(e,["parameters","editMode"],T);let S=a(t,["baseSteps"]);return e!==void 0&&S!=null&&l(e,["parameters","editConfig","baseSteps"],S),n}function CD(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["prompt"]);o!=null&&l(n,["instances[0]","prompt"],o);let r=a(e,["referenceImages"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(f=>yD(f))),l(n,["instances[0]","referenceImages"],u)}let s=a(e,["config"]);return s!=null&&l(n,["config"],vD(s,n)),n}function DD(t,e){let n={},i=a(t,["includeRaiReason"]);e!==void 0&&i!=null&&l(e,["parameters","includeRaiReason"],i);let o=a(t,["outputMimeType"]);e!==void 0&&o!=null&&l(e,["parameters","outputOptions","mimeType"],o);let r=a(t,["outputCompressionQuality"]);e!==void 0&&r!=null&&l(e,["parameters","outputOptions","compressionQuality"],r);let s=a(t,["enhanceInputImage"]);e!==void 0&&s!=null&&l(e,["parameters","upscaleConfig","enhanceInputImage"],s);let u=a(t,["imagePreservationFactor"]);e!==void 0&&u!=null&&l(e,["parameters","upscaleConfig","imagePreservationFactor"],u);let f=a(t,["numberOfImages"]);e!==void 0&&f!=null&&l(e,["parameters","sampleCount"],f);let c=a(t,["mode"]);return e!==void 0&&c!=null&&l(e,["parameters","mode"],c),n}function TD(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["image"]);o!=null&&l(n,["instances[0]","image"],lo(o));let r=a(e,["upscaleFactor"]);r!=null&&l(n,["parameters","upscaleConfig","upscaleFactor"],r);let s=a(e,["config"]);return s!=null&&l(n,["config"],DD(s,n)),n}function ED(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","name"],Q(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function SD(t,e,n){let i={},o=a(e,["pageSize"]);n!==void 0&&o!=null&&l(n,["_query","pageSize"],o);let r=a(e,["pageToken"]);n!==void 0&&r!=null&&l(n,["_query","pageToken"],r);let s=a(e,["filter"]);n!==void 0&&s!=null&&l(n,["_query","filter"],s);let u=a(e,["queryBase"]);return n!==void 0&&u!=null&&l(n,["_url","models_url"],ec(t,u)),i}function wD(t,e){let n={},i=a(e,["config"]);return i!=null&&l(n,["config"],SD(t,i,n)),n}function MD(t,e){let n={},i=a(t,["displayName"]);e!==void 0&&i!=null&&l(e,["displayName"],i);let o=a(t,["description"]);e!==void 0&&o!=null&&l(e,["description"],o);let r=a(t,["defaultCheckpointId"]);return e!==void 0&&r!=null&&l(e,["defaultCheckpointId"],r),n}function FD(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],MD(o,n)),n}function xD(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","name"],Q(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],o),n}function _D(t,e){let n={},i=a(t,["systemInstruction"]);e!==void 0&&i!=null&&l(e,["systemInstruction"],fn(ve(i)));let o=a(t,["tools"]);if(e!==void 0&&o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>hc(u))),l(e,["tools"],s)}let r=a(t,["generationConfig"]);return e!==void 0&&r!=null&&l(e,["generationConfig"],r),n}function AD(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["contents"]);if(o!=null){let s=Re(o);Array.isArray(s)&&(s=s.map(u=>fn(u))),l(n,["contents"],s)}let r=a(e,["config"]);return r!=null&&l(n,["config"],_D(r,n)),n}function PD(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["contents"]);if(o!=null){let s=Re(o);Array.isArray(s)&&(s=s.map(u=>fn(u))),l(n,["contents"],s)}let r=a(e,["config"]);return r!=null&&l(n,["config"],r),n}function ID(t){let e={},n=a(t,["uri"]);n!=null&&l(e,["gcsUri"],n);let i=a(t,["videoBytes"]);i!=null&&l(e,["bytesBase64Encoded"],ft(i));let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function bD(t,e){let n={},i=a(t,["numberOfVideos"]);e!==void 0&&i!=null&&l(e,["parameters","sampleCount"],i);let o=a(t,["outputGcsUri"]);e!==void 0&&o!=null&&l(e,["parameters","storageUri"],o);let r=a(t,["fps"]);e!==void 0&&r!=null&&l(e,["parameters","fps"],r);let s=a(t,["durationSeconds"]);e!==void 0&&s!=null&&l(e,["parameters","durationSeconds"],s);let u=a(t,["seed"]);e!==void 0&&u!=null&&l(e,["parameters","seed"],u);let f=a(t,["aspectRatio"]);e!==void 0&&f!=null&&l(e,["parameters","aspectRatio"],f);let c=a(t,["resolution"]);e!==void 0&&c!=null&&l(e,["parameters","resolution"],c);let d=a(t,["personGeneration"]);e!==void 0&&d!=null&&l(e,["parameters","personGeneration"],d);let p=a(t,["pubsubTopic"]);e!==void 0&&p!=null&&l(e,["parameters","pubsubTopic"],p);let m=a(t,["negativePrompt"]);e!==void 0&&m!=null&&l(e,["parameters","negativePrompt"],m);let h=a(t,["enhancePrompt"]);e!==void 0&&h!=null&&l(e,["parameters","enhancePrompt"],h);let y=a(t,["generateAudio"]);e!==void 0&&y!=null&&l(e,["parameters","generateAudio"],y);let v=a(t,["lastFrame"]);e!==void 0&&v!=null&&l(e,["instances[0]","lastFrame"],lo(v));let T=a(t,["compressionQuality"]);return e!==void 0&&T!=null&&l(e,["parameters","compressionQuality"],T),n}function kD(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["_url","model"],Q(t,i));let o=a(e,["prompt"]);o!=null&&l(n,["instances[0]","prompt"],o);let r=a(e,["image"]);r!=null&&l(n,["instances[0]","image"],lo(r));let s=a(e,["video"]);s!=null&&l(n,["instances[0]","video"],ID(s));let u=a(e,["config"]);return u!=null&&l(n,["config"],bD(u,n)),n}function RD(t){let e={},n=a(t,["fps"]);n!=null&&l(e,["fps"],n);let i=a(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let o=a(t,["startOffset"]);return o!=null&&l(e,["startOffset"],o),e}function ND(t){let e={},n=a(t,["data"]);n!=null&&l(e,["data"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function LD(t){let e={},n=a(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function BD(t){let e={},n=a(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],RD(n));let i=a(t,["thought"]);i!=null&&l(e,["thought"],i);let o=a(t,["inlineData"]);o!=null&&l(e,["inlineData"],ND(o));let r=a(t,["fileData"]);r!=null&&l(e,["fileData"],LD(r));let s=a(t,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);let u=a(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let f=a(t,["executableCode"]);f!=null&&l(e,["executableCode"],f);let c=a(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);let d=a(t,["functionResponse"]);d!=null&&l(e,["functionResponse"],d);let p=a(t,["text"]);return p!=null&&l(e,["text"],p),e}function OD(t){let e={},n=a(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>BD(r))),l(e,["parts"],o)}let i=a(t,["role"]);return i!=null&&l(e,["role"],i),e}function UD(t){let e={},n=a(t,["citationSources"]);return n!=null&&l(e,["citations"],n),e}function VD(t){let e={},n=a(t,["retrievedUrl"]);n!=null&&l(e,["retrievedUrl"],n);let i=a(t,["urlRetrievalStatus"]);return i!=null&&l(e,["urlRetrievalStatus"],i),e}function GD(t){let e={},n=a(t,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>VD(o))),l(e,["urlMetadata"],i)}return e}function HD(t){let e={},n=a(t,["content"]);n!=null&&l(e,["content"],OD(n));let i=a(t,["citationMetadata"]);i!=null&&l(e,["citationMetadata"],UD(i));let o=a(t,["tokenCount"]);o!=null&&l(e,["tokenCount"],o);let r=a(t,["finishReason"]);r!=null&&l(e,["finishReason"],r);let s=a(t,["urlContextMetadata"]);s!=null&&l(e,["urlContextMetadata"],GD(s));let u=a(t,["avgLogprobs"]);u!=null&&l(e,["avgLogprobs"],u);let f=a(t,["groundingMetadata"]);f!=null&&l(e,["groundingMetadata"],f);let c=a(t,["index"]);c!=null&&l(e,["index"],c);let d=a(t,["logprobsResult"]);d!=null&&l(e,["logprobsResult"],d);let p=a(t,["safetyRatings"]);return p!=null&&l(e,["safetyRatings"],p),e}function Lu(t){let e={},n=a(t,["candidates"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(u=>HD(u))),l(e,["candidates"],s)}let i=a(t,["modelVersion"]);i!=null&&l(e,["modelVersion"],i);let o=a(t,["promptFeedback"]);o!=null&&l(e,["promptFeedback"],o);let r=a(t,["usageMetadata"]);return r!=null&&l(e,["usageMetadata"],r),e}function qD(t){let e={},n=a(t,["values"]);return n!=null&&l(e,["values"],n),e}function $D(){return{}}function WD(t){let e={},n=a(t,["embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>qD(r))),l(e,["embeddings"],o)}return a(t,["metadata"])!=null&&l(e,["metadata"],$D()),e}function JD(t){let e={},n=a(t,["bytesBase64Encoded"]);n!=null&&l(e,["imageBytes"],ft(n));let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function gc(t){let e={},n=a(t,["safetyAttributes","categories"]);n!=null&&l(e,["categories"],n);let i=a(t,["safetyAttributes","scores"]);i!=null&&l(e,["scores"],i);let o=a(t,["contentType"]);return o!=null&&l(e,["contentType"],o),e}function zD(t){let e={},n=a(t,["_self"]);n!=null&&l(e,["image"],JD(n));let i=a(t,["raiFilteredReason"]);i!=null&&l(e,["raiFilteredReason"],i);let o=a(t,["_self"]);return o!=null&&l(e,["safetyAttributes"],gc(o)),e}function YD(t){let e={},n=a(t,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>zD(r))),l(e,["generatedImages"],o)}let i=a(t,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],gc(i)),e}function KD(t){let e={},n=a(t,["baseModel"]);n!=null&&l(e,["baseModel"],n);let i=a(t,["createTime"]);i!=null&&l(e,["createTime"],i);let o=a(t,["updateTime"]);return o!=null&&l(e,["updateTime"],o),e}function ps(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["displayName"]);i!=null&&l(e,["displayName"],i);let o=a(t,["description"]);o!=null&&l(e,["description"],o);let r=a(t,["version"]);r!=null&&l(e,["version"],r);let s=a(t,["_self"]);s!=null&&l(e,["tunedModelInfo"],KD(s));let u=a(t,["inputTokenLimit"]);u!=null&&l(e,["inputTokenLimit"],u);let f=a(t,["outputTokenLimit"]);f!=null&&l(e,["outputTokenLimit"],f);let c=a(t,["supportedGenerationMethods"]);return c!=null&&l(e,["supportedActions"],c),e}function ZD(t){let e={},n=a(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=a(t,["_self"]);if(i!=null){let o=tc(i);Array.isArray(o)&&(o=o.map(r=>ps(r))),l(e,["models"],o)}return e}function QD(){return{}}function XD(t){let e={},n=a(t,["totalTokens"]);n!=null&&l(e,["totalTokens"],n);let i=a(t,["cachedContentTokenCount"]);return i!=null&&l(e,["cachedContentTokenCount"],i),e}function jD(t){let e={},n=a(t,["video","uri"]);n!=null&&l(e,["uri"],n);let i=a(t,["video","encodedVideo"]);i!=null&&l(e,["videoBytes"],ft(i));let o=a(t,["encoding"]);return o!=null&&l(e,["mimeType"],o),e}function eT(t){let e={},n=a(t,["_self"]);return n!=null&&l(e,["video"],jD(n)),e}function tT(t){let e={},n=a(t,["generatedSamples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(s=>eT(s))),l(e,["generatedVideos"],r)}let i=a(t,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);let o=a(t,["raiMediaFilteredReasons"]);return o!=null&&l(e,["raiMediaFilteredReasons"],o),e}function nT(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["metadata"]);i!=null&&l(e,["metadata"],i);let o=a(t,["done"]);o!=null&&l(e,["done"],o);let r=a(t,["error"]);r!=null&&l(e,["error"],r);let s=a(t,["response","generateVideoResponse"]);return s!=null&&l(e,["response"],tT(s)),e}function iT(t){let e={},n=a(t,["fps"]);n!=null&&l(e,["fps"],n);let i=a(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let o=a(t,["startOffset"]);return o!=null&&l(e,["startOffset"],o),e}function oT(t){let e={},n=a(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=a(t,["data"]);i!=null&&l(e,["data"],i);let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function rT(t){let e={},n=a(t,["displayName"]);n!=null&&l(e,["displayName"],n);let i=a(t,["fileUri"]);i!=null&&l(e,["fileUri"],i);let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function sT(t){let e={},n=a(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],iT(n));let i=a(t,["thought"]);i!=null&&l(e,["thought"],i);let o=a(t,["inlineData"]);o!=null&&l(e,["inlineData"],oT(o));let r=a(t,["fileData"]);r!=null&&l(e,["fileData"],rT(r));let s=a(t,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);let u=a(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let f=a(t,["executableCode"]);f!=null&&l(e,["executableCode"],f);let c=a(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);let d=a(t,["functionResponse"]);d!=null&&l(e,["functionResponse"],d);let p=a(t,["text"]);return p!=null&&l(e,["text"],p),e}function aT(t){let e={},n=a(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>sT(r))),l(e,["parts"],o)}let i=a(t,["role"]);return i!=null&&l(e,["role"],i),e}function lT(t){let e={},n=a(t,["citations"]);return n!=null&&l(e,["citations"],n),e}function uT(t){let e={},n=a(t,["retrievedUrl"]);n!=null&&l(e,["retrievedUrl"],n);let i=a(t,["urlRetrievalStatus"]);return i!=null&&l(e,["urlRetrievalStatus"],i),e}function cT(t){let e={},n=a(t,["urlMetadata"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>uT(o))),l(e,["urlMetadata"],i)}return e}function fT(t){let e={},n=a(t,["content"]);n!=null&&l(e,["content"],aT(n));let i=a(t,["citationMetadata"]);i!=null&&l(e,["citationMetadata"],lT(i));let o=a(t,["finishMessage"]);o!=null&&l(e,["finishMessage"],o);let r=a(t,["finishReason"]);r!=null&&l(e,["finishReason"],r);let s=a(t,["urlContextMetadata"]);s!=null&&l(e,["urlContextMetadata"],cT(s));let u=a(t,["avgLogprobs"]);u!=null&&l(e,["avgLogprobs"],u);let f=a(t,["groundingMetadata"]);f!=null&&l(e,["groundingMetadata"],f);let c=a(t,["index"]);c!=null&&l(e,["index"],c);let d=a(t,["logprobsResult"]);d!=null&&l(e,["logprobsResult"],d);let p=a(t,["safetyRatings"]);return p!=null&&l(e,["safetyRatings"],p),e}function Bu(t){let e={},n=a(t,["candidates"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(c=>fT(c))),l(e,["candidates"],f)}let i=a(t,["createTime"]);i!=null&&l(e,["createTime"],i);let o=a(t,["responseId"]);o!=null&&l(e,["responseId"],o);let r=a(t,["modelVersion"]);r!=null&&l(e,["modelVersion"],r);let s=a(t,["promptFeedback"]);s!=null&&l(e,["promptFeedback"],s);let u=a(t,["usageMetadata"]);return u!=null&&l(e,["usageMetadata"],u),e}function dT(t){let e={},n=a(t,["truncated"]);n!=null&&l(e,["truncated"],n);let i=a(t,["token_count"]);return i!=null&&l(e,["tokenCount"],i),e}function pT(t){let e={},n=a(t,["values"]);n!=null&&l(e,["values"],n);let i=a(t,["statistics"]);return i!=null&&l(e,["statistics"],dT(i)),e}function mT(t){let e={},n=a(t,["billableCharacterCount"]);return n!=null&&l(e,["billableCharacterCount"],n),e}function hT(t){let e={},n=a(t,["predictions[]","embeddings"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>pT(r))),l(e,["embeddings"],o)}let i=a(t,["metadata"]);return i!=null&&l(e,["metadata"],mT(i)),e}function gT(t){let e={},n=a(t,["gcsUri"]);n!=null&&l(e,["gcsUri"],n);let i=a(t,["bytesBase64Encoded"]);i!=null&&l(e,["imageBytes"],ft(i));let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function yc(t){let e={},n=a(t,["safetyAttributes","categories"]);n!=null&&l(e,["categories"],n);let i=a(t,["safetyAttributes","scores"]);i!=null&&l(e,["scores"],i);let o=a(t,["contentType"]);return o!=null&&l(e,["contentType"],o),e}function Ns(t){let e={},n=a(t,["_self"]);n!=null&&l(e,["image"],gT(n));let i=a(t,["raiFilteredReason"]);i!=null&&l(e,["raiFilteredReason"],i);let o=a(t,["_self"]);o!=null&&l(e,["safetyAttributes"],yc(o));let r=a(t,["prompt"]);return r!=null&&l(e,["enhancedPrompt"],r),e}function yT(t){let e={},n=a(t,["predictions"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>Ns(r))),l(e,["generatedImages"],o)}let i=a(t,["positivePromptSafetyAttributes"]);return i!=null&&l(e,["positivePromptSafetyAttributes"],yc(i)),e}function vT(t){let e={},n=a(t,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Ns(o))),l(e,["generatedImages"],i)}return e}function CT(t){let e={},n=a(t,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>Ns(o))),l(e,["generatedImages"],i)}return e}function DT(t){let e={},n=a(t,["endpoint"]);n!=null&&l(e,["name"],n);let i=a(t,["deployedModelId"]);return i!=null&&l(e,["deployedModelId"],i),e}function TT(t){let e={},n=a(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&l(e,["baseModel"],n);let i=a(t,["createTime"]);i!=null&&l(e,["createTime"],i);let o=a(t,["updateTime"]);return o!=null&&l(e,["updateTime"],o),e}function ET(t){let e={},n=a(t,["checkpointId"]);n!=null&&l(e,["checkpointId"],n);let i=a(t,["epoch"]);i!=null&&l(e,["epoch"],i);let o=a(t,["step"]);return o!=null&&l(e,["step"],o),e}function ms(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["displayName"]);i!=null&&l(e,["displayName"],i);let o=a(t,["description"]);o!=null&&l(e,["description"],o);let r=a(t,["versionId"]);r!=null&&l(e,["version"],r);let s=a(t,["deployedModels"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(m=>DT(m))),l(e,["endpoints"],p)}let u=a(t,["labels"]);u!=null&&l(e,["labels"],u);let f=a(t,["_self"]);f!=null&&l(e,["tunedModelInfo"],TT(f));let c=a(t,["defaultCheckpointId"]);c!=null&&l(e,["defaultCheckpointId"],c);let d=a(t,["checkpoints"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(m=>ET(m))),l(e,["checkpoints"],p)}return e}function ST(t){let e={},n=a(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=a(t,["_self"]);if(i!=null){let o=tc(i);Array.isArray(o)&&(o=o.map(r=>ms(r))),l(e,["models"],o)}return e}function wT(){return{}}function MT(t){let e={},n=a(t,["totalTokens"]);return n!=null&&l(e,["totalTokens"],n),e}function FT(t){let e={},n=a(t,["tokensInfo"]);return n!=null&&l(e,["tokensInfo"],n),e}function xT(t){let e={},n=a(t,["gcsUri"]);n!=null&&l(e,["uri"],n);let i=a(t,["bytesBase64Encoded"]);i!=null&&l(e,["videoBytes"],ft(i));let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function _T(t){let e={},n=a(t,["_self"]);return n!=null&&l(e,["video"],xT(n)),e}function AT(t){let e={},n=a(t,["videos"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(s=>_T(s))),l(e,["generatedVideos"],r)}let i=a(t,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);let o=a(t,["raiMediaFilteredReasons"]);return o!=null&&l(e,["raiMediaFilteredReasons"],o),e}function PT(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["metadata"]);i!=null&&l(e,["metadata"],i);let o=a(t,["done"]);o!=null&&l(e,["done"],o);let r=a(t,["error"]);r!=null&&l(e,["error"],r);let s=a(t,["response"]);return s!=null&&l(e,["response"],AT(s)),e}async function Uu(t){var e;if(t===void 0)throw new Error("response is undefined");if(!t.ok){let n=t.status,i;!((e=t.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await t.json():i={error:{message:await t.text(),code:t.status,status:t.statusText}};let o=JSON.stringify(i);throw n>=400&&n<600?new so({message:o,status:n}):new Error(o)}}function OT(t,e){if(!e||Object.keys(e).length===0)return;if(t.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if(typeof t.body=="string"&&t.body.length>0)try{let r=JSON.parse(t.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))n=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch(r){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function i(r,s){let u=Object.assign({},r);for(let f in s)if(Object.prototype.hasOwnProperty.call(s,f)){let c=s[f],d=u[f];c&&typeof c=="object"&&!Array.isArray(c)&&d&&typeof d=="object"&&!Array.isArray(d)?u[f]=i(d,c):(d&&c&&typeof d!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${f}". Original type: ${typeof d}, New type: ${typeof c}. Overwriting.`),u[f]=c)}return u}let o=i(n,e);t.body=JSON.stringify(o)}function vc(t){for(let e of t)if(Ls(e)||typeof e=="object"&&"inputSchema"in e)return!0;return!1}function Cc(t){var e;let n=(e=t[hs])!==null&&e!==void 0?e:"";t[hs]=(n+` ${UT}`).trimStart()}function VT(t){var e,n,i;return(i=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(o=>Ls(o)))!==null&&i!==void 0?i:!1}function GT(t){var e,n,i;return(i=(n=(e=t.config)===null||e===void 0?void 0:e.tools)===null||n===void 0?void 0:n.some(o=>!Ls(o)))!==null&&i!==void 0?i:!1}function Ls(t){return t!==null&&typeof t=="object"&&t instanceof ys}function HT(t,e=100){return an(this,arguments,function*(){let i,o=0;for(;o<e;){let r=yield ee(t.listTools({cursor:i}));for(let s of r.tools)yield yield ee(s),o++;if(!r.nextCursor)break;i=r.nextCursor}})}async function qT(t,e,n){let i=new ns,o;n.data instanceof Blob?o=JSON.parse(await n.data.text()):o=JSON.parse(n.data);let r=Xv(o);Object.assign(i,r),e(i)}function $T(t){let e={};return t.forEach((n,i)=>{e[i]=n}),e}function WT(t){let e=new Headers;for(let[n,i]of Object.entries(t))e.append(n,i);return e}async function zT(t,e,n){let i=new ts,o;n.data instanceof Blob?o=await n.data.text():n.data instanceof ArrayBuffer?o=new TextDecoder().decode(n.data):o=n.data;let r=JSON.parse(o);if(t.isVertexAI()){let s=qv(r);Object.assign(i,s)}else{let s=Hv(r);Object.assign(i,s)}e(i)}function KT(t){let e={};return t.forEach((n,i)=>{e[i]=n}),e}function ZT(t){let e=new Headers;for(let[n,i]of Object.entries(t))e.append(n,i);return e}function Gu(t){var e,n,i;if(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(let s of(n=t==null?void 0:t.tools)!==null&&n!==void 0?n:[])if(Yi(s)){o=!0;break}if(!o)return!0;let r=(i=t==null?void 0:t.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function Yi(t){return"callTool"in t&&typeof t.callTool=="function"}function Hu(t){var e;return!(!((e=t==null?void 0:t.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}function QT(t){let e={},n=a(t,["operationName"]);n!=null&&l(e,["_url","operationName"],n);let i=a(t,["config"]);return i!=null&&l(e,["config"],i),e}function XT(t){let e={},n=a(t,["operationName"]);n!=null&&l(e,["_url","operationName"],n);let i=a(t,["config"]);return i!=null&&l(e,["config"],i),e}function jT(t){let e={},n=a(t,["operationName"]);n!=null&&l(e,["operationName"],n);let i=a(t,["resourceName"]);i!=null&&l(e,["_url","resourceName"],i);let o=a(t,["config"]);return o!=null&&l(e,["config"],o),e}function eE(t){let e={},n=a(t,["video","uri"]);n!=null&&l(e,["uri"],n);let i=a(t,["video","encodedVideo"]);i!=null&&l(e,["videoBytes"],ft(i));let o=a(t,["encoding"]);return o!=null&&l(e,["mimeType"],o),e}function tE(t){let e={},n=a(t,["_self"]);return n!=null&&l(e,["video"],eE(n)),e}function nE(t){let e={},n=a(t,["generatedSamples"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(s=>tE(s))),l(e,["generatedVideos"],r)}let i=a(t,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);let o=a(t,["raiMediaFilteredReasons"]);return o!=null&&l(e,["raiMediaFilteredReasons"],o),e}function iE(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["metadata"]);i!=null&&l(e,["metadata"],i);let o=a(t,["done"]);o!=null&&l(e,["done"],o);let r=a(t,["error"]);r!=null&&l(e,["error"],r);let s=a(t,["response","generateVideoResponse"]);return s!=null&&l(e,["response"],nE(s)),e}function oE(t){let e={},n=a(t,["gcsUri"]);n!=null&&l(e,["uri"],n);let i=a(t,["bytesBase64Encoded"]);i!=null&&l(e,["videoBytes"],ft(i));let o=a(t,["mimeType"]);return o!=null&&l(e,["mimeType"],o),e}function rE(t){let e={},n=a(t,["_self"]);return n!=null&&l(e,["video"],oE(n)),e}function sE(t){let e={},n=a(t,["videos"]);if(n!=null){let r=n;Array.isArray(r)&&(r=r.map(s=>rE(s))),l(e,["generatedVideos"],r)}let i=a(t,["raiMediaFilteredCount"]);i!=null&&l(e,["raiMediaFilteredCount"],i);let o=a(t,["raiMediaFilteredReasons"]);return o!=null&&l(e,["raiMediaFilteredReasons"],o),e}function qu(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["metadata"]);i!=null&&l(e,["metadata"],i);let o=a(t,["done"]);o!=null&&l(e,["done"],o);let r=a(t,["error"]);r!=null&&l(e,["error"],r);let s=a(t,["response"]);return s!=null&&l(e,["response"],sE(s)),e}function aE(t){let e={},n=a(t,["voiceName"]);return n!=null&&l(e,["voiceName"],n),e}function Dc(t){let e={},n=a(t,["prebuiltVoiceConfig"]);return n!=null&&l(e,["prebuiltVoiceConfig"],aE(n)),e}function lE(t){let e={},n=a(t,["speaker"]);n!=null&&l(e,["speaker"],n);let i=a(t,["voiceConfig"]);return i!=null&&l(e,["voiceConfig"],Dc(i)),e}function uE(t){let e={},n=a(t,["speakerVoiceConfigs"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>lE(o))),l(e,["speakerVoiceConfigs"],i)}return e}function cE(t){let e={},n=a(t,["voiceConfig"]);n!=null&&l(e,["voiceConfig"],Dc(n));let i=a(t,["multiSpeakerVoiceConfig"]);i!=null&&l(e,["multiSpeakerVoiceConfig"],uE(i));let o=a(t,["languageCode"]);return o!=null&&l(e,["languageCode"],o),e}function fE(t){let e={},n=a(t,["fps"]);n!=null&&l(e,["fps"],n);let i=a(t,["endOffset"]);i!=null&&l(e,["endOffset"],i);let o=a(t,["startOffset"]);return o!=null&&l(e,["startOffset"],o),e}function dE(t){let e={};if(a(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=a(t,["data"]);n!=null&&l(e,["data"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function pE(t){let e={};if(a(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");let n=a(t,["fileUri"]);n!=null&&l(e,["fileUri"],n);let i=a(t,["mimeType"]);return i!=null&&l(e,["mimeType"],i),e}function mE(t){let e={},n=a(t,["videoMetadata"]);n!=null&&l(e,["videoMetadata"],fE(n));let i=a(t,["thought"]);i!=null&&l(e,["thought"],i);let o=a(t,["inlineData"]);o!=null&&l(e,["inlineData"],dE(o));let r=a(t,["fileData"]);r!=null&&l(e,["fileData"],pE(r));let s=a(t,["thoughtSignature"]);s!=null&&l(e,["thoughtSignature"],s);let u=a(t,["codeExecutionResult"]);u!=null&&l(e,["codeExecutionResult"],u);let f=a(t,["executableCode"]);f!=null&&l(e,["executableCode"],f);let c=a(t,["functionCall"]);c!=null&&l(e,["functionCall"],c);let d=a(t,["functionResponse"]);d!=null&&l(e,["functionResponse"],d);let p=a(t,["text"]);return p!=null&&l(e,["text"],p),e}function hE(t){let e={},n=a(t,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(r=>mE(r))),l(e,["parts"],o)}let i=a(t,["role"]);return i!=null&&l(e,["role"],i),e}function gE(t){let e={},n=a(t,["behavior"]);n!=null&&l(e,["behavior"],n);let i=a(t,["description"]);i!=null&&l(e,["description"],i);let o=a(t,["name"]);o!=null&&l(e,["name"],o);let r=a(t,["parameters"]);r!=null&&l(e,["parameters"],r);let s=a(t,["parametersJsonSchema"]);s!=null&&l(e,["parametersJsonSchema"],s);let u=a(t,["response"]);u!=null&&l(e,["response"],u);let f=a(t,["responseJsonSchema"]);return f!=null&&l(e,["responseJsonSchema"],f),e}function yE(t){let e={},n=a(t,["startTime"]);n!=null&&l(e,["startTime"],n);let i=a(t,["endTime"]);return i!=null&&l(e,["endTime"],i),e}function vE(t){let e={},n=a(t,["timeRangeFilter"]);return n!=null&&l(e,["timeRangeFilter"],yE(n)),e}function CE(t){let e={},n=a(t,["mode"]);n!=null&&l(e,["mode"],n);let i=a(t,["dynamicThreshold"]);return i!=null&&l(e,["dynamicThreshold"],i),e}function DE(t){let e={},n=a(t,["dynamicRetrievalConfig"]);return n!=null&&l(e,["dynamicRetrievalConfig"],CE(n)),e}function TE(){return{}}function EE(t){let e={},n=a(t,["functionDeclarations"]);if(n!=null){let f=n;Array.isArray(f)&&(f=f.map(c=>gE(c))),l(e,["functionDeclarations"],f)}if(a(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");let i=a(t,["googleSearch"]);i!=null&&l(e,["googleSearch"],vE(i));let o=a(t,["googleSearchRetrieval"]);if(o!=null&&l(e,["googleSearchRetrieval"],DE(o)),a(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(t,["urlContext"])!=null&&l(e,["urlContext"],TE());let s=a(t,["codeExecution"]);s!=null&&l(e,["codeExecution"],s);let u=a(t,["computerUse"]);return u!=null&&l(e,["computerUse"],u),e}function SE(t){let e={},n=a(t,["handle"]);if(n!=null&&l(e,["handle"],n),a(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function $u(){return{}}function wE(t){let e={},n=a(t,["disabled"]);n!=null&&l(e,["disabled"],n);let i=a(t,["startOfSpeechSensitivity"]);i!=null&&l(e,["startOfSpeechSensitivity"],i);let o=a(t,["endOfSpeechSensitivity"]);o!=null&&l(e,["endOfSpeechSensitivity"],o);let r=a(t,["prefixPaddingMs"]);r!=null&&l(e,["prefixPaddingMs"],r);let s=a(t,["silenceDurationMs"]);return s!=null&&l(e,["silenceDurationMs"],s),e}function ME(t){let e={},n=a(t,["automaticActivityDetection"]);n!=null&&l(e,["automaticActivityDetection"],wE(n));let i=a(t,["activityHandling"]);i!=null&&l(e,["activityHandling"],i);let o=a(t,["turnCoverage"]);return o!=null&&l(e,["turnCoverage"],o),e}function FE(t){let e={},n=a(t,["targetTokens"]);return n!=null&&l(e,["targetTokens"],n),e}function xE(t){let e={},n=a(t,["triggerTokens"]);n!=null&&l(e,["triggerTokens"],n);let i=a(t,["slidingWindow"]);return i!=null&&l(e,["slidingWindow"],FE(i)),e}function _E(t){let e={},n=a(t,["proactiveAudio"]);return n!=null&&l(e,["proactiveAudio"],n),e}function AE(t,e){let n={},i=a(t,["generationConfig"]);e!==void 0&&i!=null&&l(e,["setup","generationConfig"],i);let o=a(t,["responseModalities"]);e!==void 0&&o!=null&&l(e,["setup","generationConfig","responseModalities"],o);let r=a(t,["temperature"]);e!==void 0&&r!=null&&l(e,["setup","generationConfig","temperature"],r);let s=a(t,["topP"]);e!==void 0&&s!=null&&l(e,["setup","generationConfig","topP"],s);let u=a(t,["topK"]);e!==void 0&&u!=null&&l(e,["setup","generationConfig","topK"],u);let f=a(t,["maxOutputTokens"]);e!==void 0&&f!=null&&l(e,["setup","generationConfig","maxOutputTokens"],f);let c=a(t,["mediaResolution"]);e!==void 0&&c!=null&&l(e,["setup","generationConfig","mediaResolution"],c);let d=a(t,["seed"]);e!==void 0&&d!=null&&l(e,["setup","generationConfig","seed"],d);let p=a(t,["speechConfig"]);e!==void 0&&p!=null&&l(e,["setup","generationConfig","speechConfig"],cE(Rs(p)));let m=a(t,["enableAffectiveDialog"]);e!==void 0&&m!=null&&l(e,["setup","generationConfig","enableAffectiveDialog"],m);let h=a(t,["systemInstruction"]);e!==void 0&&h!=null&&l(e,["setup","systemInstruction"],hE(ve(h)));let y=a(t,["tools"]);if(e!==void 0&&y!=null){let w=un(y);Array.isArray(w)&&(w=w.map(P=>EE(ln(P)))),l(e,["setup","tools"],w)}let v=a(t,["sessionResumption"]);e!==void 0&&v!=null&&l(e,["setup","sessionResumption"],SE(v));let T=a(t,["inputAudioTranscription"]);e!==void 0&&T!=null&&l(e,["setup","inputAudioTranscription"],$u());let S=a(t,["outputAudioTranscription"]);e!==void 0&&S!=null&&l(e,["setup","outputAudioTranscription"],$u());let _=a(t,["realtimeInputConfig"]);e!==void 0&&_!=null&&l(e,["setup","realtimeInputConfig"],ME(_));let x=a(t,["contextWindowCompression"]);e!==void 0&&x!=null&&l(e,["setup","contextWindowCompression"],xE(x));let C=a(t,["proactivity"]);return e!==void 0&&C!=null&&l(e,["setup","proactivity"],_E(C)),n}function PE(t,e){let n={},i=a(e,["model"]);i!=null&&l(n,["setup","model"],Q(t,i));let o=a(e,["config"]);return o!=null&&l(n,["config"],AE(o,n)),n}function IE(t,e,n){let i={},o=a(e,["expireTime"]);n!==void 0&&o!=null&&l(n,["expireTime"],o);let r=a(e,["newSessionExpireTime"]);n!==void 0&&r!=null&&l(n,["newSessionExpireTime"],r);let s=a(e,["uses"]);n!==void 0&&s!=null&&l(n,["uses"],s);let u=a(e,["liveConnectConstraints"]);n!==void 0&&u!=null&&l(n,["bidiGenerateContentSetup"],PE(t,u));let f=a(e,["lockAdditionalFields"]);return n!==void 0&&f!=null&&l(n,["fieldMask"],f),i}function bE(t,e){let n={},i=a(e,["config"]);return i!=null&&l(n,["config"],IE(t,i,n)),n}function kE(t){let e={},n=a(t,["name"]);return n!=null&&l(e,["name"],n),e}function RE(t){let e=[];for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let i=t[n];if(typeof i=="object"&&i!=null&&Object.keys(i).length>0){let o=Object.keys(i).map(r=>`${n}.${r}`);e.push(...o)}else e.push(n)}return e.join(",")}function NE(t,e){let n=null,i=t.bidiGenerateContentSetup;if(typeof i=="object"&&i!==null&&"setup"in i){let r=i.setup;typeof r=="object"&&r!==null?(t.bidiGenerateContentSetup=r,n=r):delete t.bidiGenerateContentSetup}else i!==void 0&&delete t.bidiGenerateContentSetup;let o=t.fieldMask;if(n){let r=RE(n);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)r?t.fieldMask=r:delete t.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){let s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],u=[];o.length>0&&(u=o.map(c=>s.includes(c)?`generationConfig.${c}`:c));let f=[];r&&f.push(r),u.length>0&&f.push(...u),f.length>0?t.fieldMask=f.join(","):delete t.fieldMask}else delete t.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?t.fieldMask=o.join(","):delete t.fieldMask;return t}function LE(t){let e={},n=a(t,["name"]);n!=null&&l(e,["_url","name"],n);let i=a(t,["config"]);return i!=null&&l(e,["config"],i),e}function BE(t,e){let n={},i=a(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let o=a(t,["pageToken"]);e!==void 0&&o!=null&&l(e,["_query","pageToken"],o);let r=a(t,["filter"]);return e!==void 0&&r!=null&&l(e,["_query","filter"],r),n}function OE(t){let e={},n=a(t,["config"]);return n!=null&&l(e,["config"],BE(n,e)),e}function UE(t){let e={},n=a(t,["textInput"]);n!=null&&l(e,["textInput"],n);let i=a(t,["output"]);return i!=null&&l(e,["output"],i),e}function VE(t){let e={};if(a(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(t,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=a(t,["examples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(o=>UE(o))),l(e,["examples","examples"],i)}return e}function GE(t,e){let n={};if(a(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");let i=a(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&l(e,["displayName"],i),a(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");let o=a(t,["epochCount"]);e!==void 0&&o!=null&&l(e,["tuningTask","hyperparameters","epochCount"],o);let r=a(t,["learningRateMultiplier"]);if(r!=null&&l(n,["tuningTask","hyperparameters","learningRateMultiplier"],r),a(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(a(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");let s=a(t,["batchSize"]);e!==void 0&&s!=null&&l(e,["tuningTask","hyperparameters","batchSize"],s);let u=a(t,["learningRate"]);return e!==void 0&&u!=null&&l(e,["tuningTask","hyperparameters","learningRate"],u),n}function HE(t){let e={},n=a(t,["baseModel"]);n!=null&&l(e,["baseModel"],n);let i=a(t,["trainingDataset"]);i!=null&&l(e,["tuningTask","trainingData"],VE(i));let o=a(t,["config"]);return o!=null&&l(e,["config"],GE(o,e)),e}function qE(t){let e={},n=a(t,["name"]);n!=null&&l(e,["_url","name"],n);let i=a(t,["config"]);return i!=null&&l(e,["config"],i),e}function $E(t,e){let n={},i=a(t,["pageSize"]);e!==void 0&&i!=null&&l(e,["_query","pageSize"],i);let o=a(t,["pageToken"]);e!==void 0&&o!=null&&l(e,["_query","pageToken"],o);let r=a(t,["filter"]);return e!==void 0&&r!=null&&l(e,["_query","filter"],r),n}function WE(t){let e={},n=a(t,["config"]);return n!=null&&l(e,["config"],$E(n,e)),e}function JE(t,e){let n={},i=a(t,["gcsUri"]);e!==void 0&&i!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],i);let o=a(t,["vertexDatasetResource"]);if(e!==void 0&&o!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],o),a(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function zE(t,e){let n={},i=a(t,["gcsUri"]);i!=null&&l(n,["validationDatasetUri"],i);let o=a(t,["vertexDatasetResource"]);return e!==void 0&&o!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],o),n}function YE(t,e){let n={},i=a(t,["validationDataset"]);e!==void 0&&i!=null&&l(e,["supervisedTuningSpec"],zE(i,n));let o=a(t,["tunedModelDisplayName"]);e!==void 0&&o!=null&&l(e,["tunedModelDisplayName"],o);let r=a(t,["description"]);e!==void 0&&r!=null&&l(e,["description"],r);let s=a(t,["epochCount"]);e!==void 0&&s!=null&&l(e,["supervisedTuningSpec","hyperParameters","epochCount"],s);let u=a(t,["learningRateMultiplier"]);e!==void 0&&u!=null&&l(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],u);let f=a(t,["exportLastCheckpointOnly"]);e!==void 0&&f!=null&&l(e,["supervisedTuningSpec","exportLastCheckpointOnly"],f);let c=a(t,["adapterSize"]);if(e!==void 0&&c!=null&&l(e,["supervisedTuningSpec","hyperParameters","adapterSize"],c),a(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(a(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return n}function KE(t){let e={},n=a(t,["baseModel"]);n!=null&&l(e,["baseModel"],n);let i=a(t,["trainingDataset"]);i!=null&&l(e,["supervisedTuningSpec","trainingDatasetUri"],JE(i,e));let o=a(t,["config"]);return o!=null&&l(e,["config"],YE(o,e)),e}function ZE(t){let e={},n=a(t,["name"]);n!=null&&l(e,["model"],n);let i=a(t,["name"]);return i!=null&&l(e,["endpoint"],i),e}function Tc(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["state"]);i!=null&&l(e,["state"],Xu(i));let o=a(t,["createTime"]);o!=null&&l(e,["createTime"],o);let r=a(t,["tuningTask","startTime"]);r!=null&&l(e,["startTime"],r);let s=a(t,["tuningTask","completeTime"]);s!=null&&l(e,["endTime"],s);let u=a(t,["updateTime"]);u!=null&&l(e,["updateTime"],u);let f=a(t,["description"]);f!=null&&l(e,["description"],f);let c=a(t,["baseModel"]);c!=null&&l(e,["baseModel"],c);let d=a(t,["_self"]);d!=null&&l(e,["tunedModel"],ZE(d));let p=a(t,["distillationSpec"]);p!=null&&l(e,["distillationSpec"],p);let m=a(t,["experiment"]);m!=null&&l(e,["experiment"],m);let h=a(t,["labels"]);h!=null&&l(e,["labels"],h);let y=a(t,["pipelineJob"]);y!=null&&l(e,["pipelineJob"],y);let v=a(t,["satisfiesPzi"]);v!=null&&l(e,["satisfiesPzi"],v);let T=a(t,["satisfiesPzs"]);T!=null&&l(e,["satisfiesPzs"],T);let S=a(t,["serviceAccount"]);S!=null&&l(e,["serviceAccount"],S);let _=a(t,["tunedModelDisplayName"]);return _!=null&&l(e,["tunedModelDisplayName"],_),e}function QE(t){let e={},n=a(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=a(t,["tunedModels"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>Tc(r))),l(e,["tuningJobs"],o)}return e}function XE(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["metadata"]);i!=null&&l(e,["metadata"],i);let o=a(t,["done"]);o!=null&&l(e,["done"],o);let r=a(t,["error"]);return r!=null&&l(e,["error"],r),e}function jE(t){let e={},n=a(t,["checkpointId"]);n!=null&&l(e,["checkpointId"],n);let i=a(t,["epoch"]);i!=null&&l(e,["epoch"],i);let o=a(t,["step"]);o!=null&&l(e,["step"],o);let r=a(t,["endpoint"]);return r!=null&&l(e,["endpoint"],r),e}function eS(t){let e={},n=a(t,["model"]);n!=null&&l(e,["model"],n);let i=a(t,["endpoint"]);i!=null&&l(e,["endpoint"],i);let o=a(t,["checkpoints"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(s=>jE(s))),l(e,["checkpoints"],r)}return e}function Ms(t){let e={},n=a(t,["name"]);n!=null&&l(e,["name"],n);let i=a(t,["state"]);i!=null&&l(e,["state"],Xu(i));let o=a(t,["createTime"]);o!=null&&l(e,["createTime"],o);let r=a(t,["startTime"]);r!=null&&l(e,["startTime"],r);let s=a(t,["endTime"]);s!=null&&l(e,["endTime"],s);let u=a(t,["updateTime"]);u!=null&&l(e,["updateTime"],u);let f=a(t,["error"]);f!=null&&l(e,["error"],f);let c=a(t,["description"]);c!=null&&l(e,["description"],c);let d=a(t,["baseModel"]);d!=null&&l(e,["baseModel"],d);let p=a(t,["tunedModel"]);p!=null&&l(e,["tunedModel"],eS(p));let m=a(t,["supervisedTuningSpec"]);m!=null&&l(e,["supervisedTuningSpec"],m);let h=a(t,["tuningDataStats"]);h!=null&&l(e,["tuningDataStats"],h);let y=a(t,["encryptionSpec"]);y!=null&&l(e,["encryptionSpec"],y);let v=a(t,["partnerModelTuningSpec"]);v!=null&&l(e,["partnerModelTuningSpec"],v);let T=a(t,["distillationSpec"]);T!=null&&l(e,["distillationSpec"],T);let S=a(t,["experiment"]);S!=null&&l(e,["experiment"],S);let _=a(t,["labels"]);_!=null&&l(e,["labels"],_);let x=a(t,["pipelineJob"]);x!=null&&l(e,["pipelineJob"],x);let C=a(t,["satisfiesPzi"]);C!=null&&l(e,["satisfiesPzi"],C);let w=a(t,["satisfiesPzs"]);w!=null&&l(e,["satisfiesPzs"],w);let P=a(t,["serviceAccount"]);P!=null&&l(e,["serviceAccount"],P);let M=a(t,["tunedModelDisplayName"]);return M!=null&&l(e,["tunedModelDisplayName"],M),e}function tS(t){let e={},n=a(t,["nextPageToken"]);n!=null&&l(e,["nextPageToken"],n);let i=a(t,["tuningJobs"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>Ms(r))),l(e,["tuningJobs"],o)}return e}async function sS(t,e,n){var i,o,r;let s=0,u=0,f=new Xn(new Response),c="upload";for(s=t.size;u<s;){let p=Math.min(nS,s-u),m=t.slice(u,u+p);u+p>=s&&(c+=", finalize");let h=0,y=oS;for(;h<iS&&(f=await n.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(u),"Content-Length":String(p)}}}),!(!((i=f==null?void 0:f.headers)===null||i===void 0)&&i[zr]));)h++,await lS(y),y=y*rS;if(u+=p,((o=f==null?void 0:f.headers)===null||o===void 0?void 0:o[zr])!=="active")break;if(s<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}let d=await(f==null?void 0:f.json());if(((r=f==null?void 0:f.headers)===null||r===void 0?void 0:r[zr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return d.file}async function aS(t){return{size:t.size,type:t.type}}function lS(t){return new Promise(e=>setTimeout(e,t))}var bm,km,ut,Ul,Vl,Et,Gl,Hl,ql,$l,Wl,Jl,zl,Yl,Kl,Zl,Ql,Xl,jl,Ki,eu,Yr,tu,nu,iu,ou,ru,su,au,lu,uu,cu,fu,du,pu,mu,hu,gu,yu,vu,Cu,Du,Tu,Eu,rn,Xn,Lt,Zi,Qi,Kr,Zr,Xi,ji,eo,Qr,to,no,io,Xr,jr,es,oo,ts,ns,Bt,Ot,ss,as,ls,us,so,fs,IT,bT,kT,hs,RT,NT,LT,BT,Ou,gs,UT,ys,vs,Cs,JT,Ds,YT,Ts,Vu,Es,Ss,ws,Fs,xs,nS,iS,oS,rS,zr,_s,As,Ps,Wu,Is,uS,Fe,dn=Rt(()=>{ut=class{};(function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Ul||(Ul={}));(function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON"})(Vl||(Vl={}));(function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT",t.NULL="NULL"})(Et||(Et={}));(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",t.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",t.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",t.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",t.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"})(Gl||(Gl={}));(function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY"})(Hl||(Hl={}));(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF"})(ql||(ql={}));(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})($l||($l={}));(function(t){t.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",t.NO_AUTH="NO_AUTH",t.API_KEY_AUTH="API_KEY_AUTH",t.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",t.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",t.OAUTH="OAUTH",t.OIDC_AUTH="OIDC_AUTH"})(Wl||(Wl={}));(function(t){t.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",t.SIMPLE_SEARCH="SIMPLE_SEARCH",t.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Jl||(Jl={}));(function(t){t.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",t.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(zl||(zl={}));(function(t){t.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",t.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",t.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"})(Yl||(Yl={}));(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY",t.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(Kl||(Kl={}));(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(Zl||(Zl={}));(function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Ql||(Ql={}));(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY"})(Xl||(Xl={}));(function(t){t.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",t.ON_DEMAND="ON_DEMAND",t.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(jl||(jl={}));(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO"})(Ki||(Ki={}));(function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(eu||(eu={}));(function(t){t.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",t.JOB_STATE_QUEUED="JOB_STATE_QUEUED",t.JOB_STATE_PENDING="JOB_STATE_PENDING",t.JOB_STATE_RUNNING="JOB_STATE_RUNNING",t.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",t.JOB_STATE_FAILED="JOB_STATE_FAILED",t.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",t.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",t.JOB_STATE_PAUSED="JOB_STATE_PAUSED",t.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",t.JOB_STATE_UPDATING="JOB_STATE_UPDATING",t.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Yr||(Yr={}));(function(t){t.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",t.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",t.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",t.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",t.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",t.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",t.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(tu||(tu={}));(function(t){t.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",t.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",t.BALANCED="BALANCED",t.PRIORITIZE_COST="PRIORITIZE_COST"})(nu||(nu={}));(function(t){t.UNSPECIFIED="UNSPECIFIED",t.BLOCKING="BLOCKING",t.NON_BLOCKING="NON_BLOCKING"})(iu||(iu={}));(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(ou||(ou={}));(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(ru||(ru={}));(function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(su||(su={}));(function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL"})(au||(au={}));(function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi",t.zh="zh",t.pt="pt",t.es="es"})(lu||(lu={}));(function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(uu||(uu={}));(function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(cu||(cu={}));(function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(fu||(fu={}));(function(t){t.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",t.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",t.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",t.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",t.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",t.EDIT_MODE_STYLE="EDIT_MODE_STYLE",t.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",t.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(du||(du={}));(function(t){t.OPTIMIZED="OPTIMIZED",t.LOSSLESS="LOSSLESS"})(pu||(pu={}));(function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED"})(mu||(mu={}));(function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED"})(hu||(hu={}));(function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.VIDEO="VIDEO",t.AUDIO="AUDIO",t.DOCUMENT="DOCUMENT"})(gu||(gu={}));(function(t){t.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",t.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",t.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(yu||(yu={}));(function(t){t.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",t.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",t.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(vu||(vu={}));(function(t){t.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",t.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",t.NO_INTERRUPTION="NO_INTERRUPTION"})(Cu||(Cu={}));(function(t){t.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",t.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",t.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Du||(Du={}));(function(t){t.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",t.SILENT="SILENT",t.WHEN_IDLE="WHEN_IDLE",t.INTERRUPT="INTERRUPT"})(Tu||(Tu={}));(function(t){t.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",t.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",t.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",t.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",t.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",t.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",t.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",t.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",t.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",t.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",t.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",t.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",t.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Eu||(Eu={}));(function(t){t.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",t.PLAY="PLAY",t.PAUSE="PAUSE",t.STOP="STOP",t.RESET_CONTEXT="RESET_CONTEXT"})(rn||(rn={}));Xn=class{constructor(e){let n={};for(let i of e.headers.entries())n[i[0]]=i[1];this.headers=n,this.responseInternal=e}json(){return this.responseInternal.json()}},Lt=class{get text(){var e,n,i,o,r,s,u,f;if(((o=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",d=!1,p=[];for(let m of(f=(u=(s=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)!==null&&f!==void 0?f:[]){for(let[h,y]of Object.entries(m))h!=="text"&&h!=="thought"&&(y!==null||y!==void 0)&&p.push(h);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;d=!0,c+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?c:void 0}get data(){var e,n,i,o,r,s,u,f;if(((o=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="",d=[];for(let p of(f=(u=(s=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)!==null&&f!==void 0?f:[]){for(let[m,h]of Object.entries(p))m!=="inlineData"&&(h!==null||h!==void 0)&&d.push(m);p.inlineData&&typeof p.inlineData.data=="string"&&(c+=atob(p.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,n,i,o,r,s,u,f;if(((o=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let c=(f=(u=(s=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,n,i,o,r,s,u,f,c;if(((o=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let d=(f=(u=(s=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,n,i,o,r,s,u,f,c;if(((o=(i=(n=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||n===void 0?void 0:n.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let d=(f=(u=(s=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||s===void 0?void 0:s.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.output}},Zi=class{},Qi=class{},Kr=class{},Zr=class{},Xi=class{},ji=class{},eo=class{},Qr=class{},to=class{},no=class{},io=class{},Xr=class{},jr=class{},es=class{},oo=class{},ts=class{get text(){var e,n,i;let o="",r=!1,s=[];for(let u of(i=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&i!==void 0?i:[]){for(let[f,c]of Object.entries(u))f!=="text"&&f!=="thought"&&c!==null&&s.push(f);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;r=!0,o+=u.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?o:void 0}get data(){var e,n,i;let o="",r=[];for(let s of(i=(n=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||n===void 0?void 0:n.parts)!==null&&i!==void 0?i:[]){for(let[u,f]of Object.entries(s))u!=="inlineData"&&f!==null&&r.push(u);s.inlineData&&typeof s.inlineData.data=="string"&&(o+=atob(s.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}},ns=class{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}};(function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(Bt||(Bt={}));Ot=class{constructor(e,n,i,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(e,i,o)}init(e,n,i){var o,r;this.nameInternal=e,this.pageInternal=n[this.nameInternal]||[],this.idxInternal=0;let s={config:{}};i?typeof i=="object"?s=Object.assign({},i):s=i:s={config:{}},s.config&&(s.config.pageToken=n.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(r=(o=s.config)===null||o===void 0?void 0:o.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}};ss=class extends ut{constructor(e){super(),this.apiClient=e,this.create=async n=>{if(this.apiClient.isVertexAI()){let o=Date.now().toString();if(Array.isArray(n.src))throw new Error("InlinedRequest[] is not supported in Vertex AI. Please use Google Cloud Storage URI or BigQuery URI instead.");if(n.config=n.config||{},n.config.displayName===void 0&&(n.config.displayName="genaiBatchJob_${timestampStr}"),n.config.dest===void 0&&typeof n.src=="string")if(n.src.startsWith("gs://")&&n.src.endsWith(".jsonl"))n.config.dest=`${n.src.slice(0,-6)}/dest`;else if(n.src.startsWith("bq://"))n.config.dest=`${n.src}_dest_${o}`;else throw new Error("Unsupported source:"+n.src)}return await this.createInternal(n)},this.list=async(n={})=>new Ot(Bt.PAGED_ITEM_BATCH_JOBS,i=>this.listInternal(i),await this.listInternal(n),n)}async createInternal(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=Fh(this.apiClient,e);return u=V("batchPredictionJobs",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>rs(d))}else{let c=yh(this.apiClient,e);return u=V("{model}:batchGenerateContent",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>os(d))}}async get(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=xh(this.apiClient,e);return u=V("batchPredictionJobs/{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>rs(d))}else{let c=vh(this.apiClient,e);return u=V("batches/{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>os(d))}}async cancel(e){var n,i,o,r;let s="",u={};if(this.apiClient.isVertexAI()){let f=_h(this.apiClient,e);s=V("batchPredictionJobs/{name}:cancel",f._url),u=f._query,delete f.config,delete f._url,delete f._query,await this.apiClient.request({path:s,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{let f=Ch(this.apiClient,e);s=V("batches/{name}:cancel",f._url),u=f._query,delete f.config,delete f._url,delete f._query,await this.apiClient.request({path:s,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=Ph(e);return u=V("batchPredictionJobs",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>{let p=Yh(d),m=new oo;return Object.assign(m,p),m})}else{let c=Th(e);return u=V("batches",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{let p=$h(d),m=new oo;return Object.assign(m,p),m})}}async delete(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=Ih(this.apiClient,e);return u=V("batchPredictionJobs/{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>Kh(d))}else{let c=Eh(this.apiClient,e);return u=V("batches/{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>Wh(d))}}};as=class extends ut{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Ot(Bt.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(n),n)}async create(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=Ug(this.apiClient,e);return u=V("cachedContents",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>zi(d))}else{let c=dg(this.apiClient,e);return u=V("cachedContents",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>Ji(d))}}async get(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=Vg(this.apiClient,e);return u=V("{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>zi(d))}else{let c=pg(this.apiClient,e);return u=V("{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>Ji(d))}}async delete(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=Gg(this.apiClient,e);return u=V("{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(()=>{let d=Yg(),p=new no;return Object.assign(p,d),p})}else{let c=mg(this.apiClient,e);return u=V("{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(()=>{let d=Jg(),p=new no;return Object.assign(p,d),p})}}async update(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=qg(this.apiClient,e);return u=V("{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>zi(d))}else{let c=gg(this.apiClient,e);return u=V("{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>Ji(d))}}async listInternal(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=Wg(e);return u=V("cachedContents",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>{let p=Kg(d),m=new io;return Object.assign(m,p),m})}else{let c=vg(e);return u=V("cachedContents",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{let p=zg(d),m=new io;return Object.assign(m,p),m})}}};ls=class{constructor(e,n){this.modelsModule=e,this.apiClient=n}create(e){return new us(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}},us=class{constructor(e,n,i,o={},r=[]){this.apiClient=e,this.modelsModule=n,this.model=i,this.config=o,this.history=r,this.sendPromise=Promise.resolve(),Qg(r)}async sendMessage(e){var n;await this.sendPromise;let i=ve(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(n=e.config)!==null&&n!==void 0?n:this.config});return this.sendPromise=(async()=>{var r,s,u;let f=await o,c=(s=(r=f.candidates)===null||r===void 0?void 0:r[0])===null||s===void 0?void 0:s.content,d=f.automaticFunctionCallingHistory,p=this.getHistory(!0).length,m=[];d!=null&&(m=(u=d.slice(p))!==null&&u!==void 0?u:[]);let h=c?[c]:[];this.recordHistory(i,h,m)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var n;await this.sendPromise;let i=ve(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(n=e.config)!==null&&n!==void 0?n:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});let r=await o;return this.processStreamResponse(r,i)}getHistory(e=!1){let n=e?Au(this.history):this.history;return structuredClone(n)}processStreamResponse(e,n){var i,o;return an(this,arguments,function*(){var s,u,f,c;let d=[];try{for(var p=!0,m=Qn(e),h;h=yield ee(m.next()),s=h.done,!s;p=!0){c=h.value,p=!1;let y=c;if(Zg(y)){let v=(o=(i=y.candidates)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.content;v!==void 0&&d.push(v)}yield yield ee(y)}}catch(y){u={error:y}}finally{try{!p&&!s&&(f=m.return)&&(yield ee(f.call(m)))}finally{if(u)throw u.error}}this.recordHistory(n,d)})}recordHistory(e,n,i){let o=[];n.length>0&&n.every(r=>r.role!==void 0)?o=n:o.push({role:"model",parts:[]}),i&&i.length>0?this.history.push(...Au(i)):this.history.push(e),this.history.push(...o)}};so=class t extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,t.prototype)}};fs=class extends ut{constructor(e){super(),this.apiClient=e,this.list=async(n={})=>new Ot(Bt.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(n),n)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(n=>cs(n))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var n,i;let o,r="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=jg(e);return r=V("files",u._url),s=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{let c=sy(f),d=new Xr;return Object.assign(d,c),d})}}async createInternal(e){var n,i;let o,r="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=ny(e);return r=V("upload/v1beta/files",u._url),s=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(()=>{let f=ay(),c=new jr;return Object.assign(c,f),c})}}async get(e){var n,i;let o,r="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=iy(e);return r=V("files/{file}",u._url),s=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>cs(f))}}async delete(e){var n,i;let o,r="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=oy(e);return r=V("files/{file}",u._url),s=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(()=>{let f=ly(),c=new es;return Object.assign(c,f),c})}}};IT="Content-Type",bT="X-Server-Timeout",kT="User-Agent",hs="x-goog-api-client",RT="1.9.0",NT=`google-genai-sdk/${RT}`,LT="v1beta1",BT="v1beta",Ou=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/,gs=class{constructor(e){var n,i;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let o={};this.clientOptions.vertexai?(o.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:LT,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:BT,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");let i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=this.getBaseUrl(),n=new URL(e);return n.protocol=n.protocol=="http:"?"ws":"wss",n.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,n,i){let o=[this.getRequestUrlInternal(n)];return i&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let i=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,n,i);if(e.queryParams)for(let[s,u]of Object.entries(e.queryParams))o.searchParams.append(s,String(u));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,n,e.abortSignal),this.unaryApiCall(o,r,e.httpMethod)}patchHttpOptions(e,n){let i=JSON.parse(JSON.stringify(e));for(let[o,r]of Object.entries(n))typeof r=="object"?i[o]=Object.assign(Object.assign({},i[o]),r):r!==void 0&&(i[o]=r);return i}async requestStream(e){let n=this.clientOptions.httpOptions;e.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let i=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,n,i);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,n,e.abortSignal),this.streamApiCall(o,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,n,i){if(n&&n.timeout||i){let o=new AbortController,r=o.signal;if(n.timeout&&(n==null?void 0:n.timeout)>0){let s=setTimeout(()=>o.abort(),n.timeout);s&&typeof s.unref=="function"&&s.unref()}i&&i.addEventListener("abort",()=>{o.abort()}),e.signal=r}return n&&n.extraBody!==null&&OT(e,n.extraBody),e.headers=await this.getHeadersInternal(n),e}async unaryApiCall(e,n,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:i})).then(async o=>(await Uu(o),new Xn(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,n,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},n),{method:i})).then(async o=>(await Uu(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){var n;return an(this,arguments,function*(){let o=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),r=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let s="";for(;;){let{done:u,value:f}=yield ee(o.read());if(u){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}let c=r.decode(f,{stream:!0});try{let p=JSON.parse(c);if("error"in p){let m=JSON.parse(JSON.stringify(p.error)),h=m.status,y=m.code,v=`got status: ${h}. ${JSON.stringify(p)}`;if(y>=400&&y<600)throw new so({message:v,status:y})}}catch(p){if(p.name==="ApiError")throw p}s+=c;let d=s.match(Ou);for(;d;){let p=d[1];try{let m=new Response(p,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield ee(new Xn(m)),s=s.slice(d[0].length),d=s.match(Ou)}catch(m){throw new Error(`exception parsing stream chunk ${p}. ${m}`)}}}}finally{o.releaseLock()}})}async apiCall(e,n){return fetch(e,n).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){let e={},n=NT+" "+this.clientOptions.userAgentExtra;return e[kT]=n,e[hs]=n,e[IT]="application/json",e}async getHeadersInternal(e){let n=new Headers;if(e&&e.headers){for(let[i,o]of Object.entries(e.headers))n.append(i,o);e.timeout&&e.timeout>0&&n.append(bT,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n),n}async uploadFile(e,n){var i;let o={};n!=null&&(o.mimeType=n.mimeType,o.name=n.name,o.displayName=n.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);let r=this.clientOptions.uploader,s=await r.stat(e);o.sizeBytes=String(s.size);let u=(i=n==null?void 0:n.mimeType)!==null&&i!==void 0?i:s.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=u;let f=await this.fetchUploadUrl(o,n);return r.upload(e,f,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,n){var i;let o={};n!=null&&n.httpOptions?o=n.httpOptions:o={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};let r={file:e},s=await this.request({path:V("upload/v1beta/files",r._url),body:JSON.stringify(r),httpMethod:"POST",httpOptions:o});if(!s||!(s!=null&&s.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let u=(i=s==null?void 0:s.headers)===null||i===void 0?void 0:i["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}};UT="mcp_used/unknown";ys=class t{constructor(e=[],n){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=n}static create(e,n){return new t(e,n)}async initialize(){var e,n,i,o;if(this.mcpTools.length>0)return;let r={},s=[];for(let d of this.mcpClients)try{for(var u=!0,f=(n=void 0,Qn(HT(d))),c;c=await f.next(),e=c.done,!e;u=!0){o=c.value,u=!1;let p=o;s.push(p);let m=p.name;if(r[m])throw new Error(`Duplicate function name ${m} found in MCP tools. Please ensure function names are unique.`);r[m]=d}}catch(p){n={error:p}}finally{try{!u&&!e&&(i=f.return)&&await i.call(f)}finally{if(n)throw n.error}}this.mcpTools=s,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),qm(this.mcpTools,this.config)}async callTool(e){await this.initialize();let n=[];for(let i of e)if(i.name in this.functionNameToMcpClient){let o=this.functionNameToMcpClient[i.name],r;this.config.timeout&&(r={timeout:this.config.timeout});let s=await o.callTool({name:i.name,arguments:i.args},void 0,r);n.push({functionResponse:{name:i.name,response:s.isError?{error:s}:s}})}return n}};vs=class{constructor(e,n,i){this.apiClient=e,this.auth=n,this.webSocketFactory=i}async connect(e){var n,i;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let o=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),s=WT(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),f=`${o}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${u}`,c=()=>{},d=new Promise(x=>{c=x}),p=e.callbacks,m=function(){c({})},h=this.apiClient,y={onopen:m,onmessage:x=>{qT(h,p.onmessage,x)},onerror:(n=p==null?void 0:p.onerror)!==null&&n!==void 0?n:function(x){},onclose:(i=p==null?void 0:p.onclose)!==null&&i!==void 0?i:function(x){}},v=this.webSocketFactory.create(f,$T(s),y);v.connect(),await d;let T=Q(this.apiClient,e.model),S=dc({model:T}),_=ds({setup:S});return v.send(JSON.stringify(_)),new Cs(v,this.apiClient)}},Cs=class{constructor(e,n){this.conn=e,this.apiClient=n}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");let n=dv(e),i=pc(n);this.conn.send(JSON.stringify({clientContent:i}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let n=pv(e),i=ds(n);this.conn.send(JSON.stringify(i))}sendPlaybackControl(e){let n=ds({playbackControl:e});this.conn.send(JSON.stringify(n))}play(){this.sendPlaybackControl(rn.PLAY)}pause(){this.sendPlaybackControl(rn.PAUSE)}stop(){this.sendPlaybackControl(rn.STOP)}resetContext(){this.sendPlaybackControl(rn.RESET_CONTEXT)}close(){this.conn.close()}};JT="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";Ds=class{constructor(e,n,i){this.apiClient=e,this.auth=n,this.webSocketFactory=i,this.music=new vs(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var n,i,o,r,s,u;let f=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion(),d,p=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&vc(e.config.tools)&&Cc(p);let m=ZT(p);if(this.apiClient.isVertexAI())d=`${f}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m);else{let k=this.apiClient.getApiKey(),L="BidiGenerateContent",O="key";k!=null&&k.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),L="BidiGenerateContentConstrained",O="access_token"),d=`${f}/ws/google.ai.generativelanguage.${c}.GenerativeService.${L}?${O}=${k}`}let h=()=>{},y=new Promise(k=>{h=k}),v=e.callbacks,T=function(){var k;(k=v==null?void 0:v.onopen)===null||k===void 0||k.call(v),h({})},S=this.apiClient,_={onopen:T,onmessage:k=>{zT(S,v.onmessage,k)},onerror:(n=v==null?void 0:v.onerror)!==null&&n!==void 0?n:function(k){},onclose:(i=v==null?void 0:v.onclose)!==null&&i!==void 0?i:function(k){}},x=this.webSocketFactory.create(d,KT(m),_);x.connect(),await y;let C=Q(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&C.startsWith("publishers/")){let k=this.apiClient.getProject(),L=this.apiClient.getLocation();C=`projects/${k}/locations/${L}/`+C}let w={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Ki.AUDIO]}:e.config.responseModalities=[Ki.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let P=(u=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&u!==void 0?u:[],M=[];for(let k of P)if(this.isCallableTool(k)){let L=k;M.push(await L.tool())}else M.push(k);M.length>0&&(e.config.tools=M);let b={model:C,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?w=rv(this.apiClient,b):w=ov(this.apiClient,b),delete w.config,x.send(JSON.stringify(w)),new Ts(x,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}},YT={turnComplete:!0},Ts=class{constructor(e,n){this.conn=e,this.apiClient=n}tLiveClientContent(e,n){if(n.turns!==null&&n.turns!==void 0){let i=[];try{i=Re(n.turns),e.isVertexAI()?i=i.map(o=>fn(o)):i=i.map(o=>ao(o))}catch(o){throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return{clientContent:{turns:i,turnComplete:n.turnComplete}}}return{clientContent:{turnComplete:n.turnComplete}}}tLiveClienttToolResponse(e,n){let i=[];if(n.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)?i=n.functionResponses:i=[n.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(let r of i){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(JT)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},YT),e);let n=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(n))}sendRealtimeInput(e){let n={};this.apiClient.isVertexAI()?n={realtimeInput:fv(e)}:n={realtimeInput:cv(e)},this.conn.send(JSON.stringify(n))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");let n=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(n))}close(){this.conn.close()}};Vu=10;Es=class extends ut{constructor(e){super(),this.apiClient=e,this.generateContent=async n=>{var i,o,r,s,u;let f=await this.processParamsForMcpUsage(n);if(this.maybeMoveToResponseJsonSchem(n),!VT(n)||Gu(n.config))return await this.generateContentInternal(f);if(GT(n))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let c,d,p=Re(f.contents),m=(r=(o=(i=f.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&r!==void 0?r:Vu,h=0;for(;h<m&&(c=await this.generateContentInternal(f),!(!c.functionCalls||c.functionCalls.length===0));){let y=c.candidates[0].content,v=[];for(let T of(u=(s=n.config)===null||s===void 0?void 0:s.tools)!==null&&u!==void 0?u:[])if(Yi(T)){let _=await T.callTool(c.functionCalls);v.push(..._)}h++,d={role:"user",parts:v},f.contents=Re(f.contents),f.contents.push(y),f.contents.push(d),Hu(f.config)&&(p.push(y),p.push(d))}return Hu(f.config)&&(c.automaticFunctionCallingHistory=p),c},this.generateContentStream=async n=>{if(this.maybeMoveToResponseJsonSchem(n),Gu(n.config)){let i=await this.processParamsForMcpUsage(n);return await this.generateContentStreamInternal(i)}else return await this.processAfcStream(n)},this.generateImages=async n=>await this.generateImagesInternal(n).then(i=>{var o;let r,s=[];if(i!=null&&i.generatedImages)for(let f of i.generatedImages)f&&(f!=null&&f.safetyAttributes)&&((o=f==null?void 0:f.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?r=f==null?void 0:f.safetyAttributes:s.push(f);let u;return r?u={generatedImages:s,positivePromptSafetyAttributes:r}:u={generatedImages:s},u}),this.list=async n=>{var i;let s={config:Object.assign(Object.assign({},{queryBase:!0}),n==null?void 0:n.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((i=s.config)===null||i===void 0)&&i.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new Ot(Bt.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(s),s)},this.editImage=async n=>{let i={model:n.model,prompt:n.prompt,referenceImages:[],config:n.config};return n.referenceImages&&n.referenceImages&&(i.referenceImages=n.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(i)},this.upscaleImage=async n=>{let i={numberOfImages:1,mode:"upscale"};n.config&&(i=Object.assign(Object.assign({},i),n.config));let o={model:n.model,image:n.image,upscaleFactor:n.upscaleFactor,config:i};return await this.upscaleImageInternal(o)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsForMcpUsage(e){var n,i,o;let r=(n=e.config)===null||n===void 0?void 0:n.tools;if(!r)return e;let s=await Promise.all(r.map(async f=>Yi(f)?await f.tool():f)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(u.config.tools=s,e.config&&e.config.tools&&vc(e.config.tools)){let f=(o=(i=e.config.httpOptions)===null||i===void 0?void 0:i.headers)!==null&&o!==void 0?o:{},c=Object.assign({},f);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),Cc(c),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return u}async initAfcToolsMap(e){var n,i,o;let r=new Map;for(let s of(i=(n=e.config)===null||n===void 0?void 0:n.tools)!==null&&i!==void 0?i:[])if(Yi(s)){let u=s,f=await u.tool();for(let c of(o=f.functionDeclarations)!==null&&o!==void 0?o:[]){if(!c.name)throw new Error("Function declaration name is required.");if(r.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);r.set(c.name,u)}}return r}async processAfcStream(e){var n,i,o;let r=(o=(i=(n=e.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:Vu,s=!1,u=0,f=await this.initAfcToolsMap(e);return function(c,d,p){var m,h;return an(this,arguments,function*(){for(var y,v,T,S;u<r;){s&&(u++,s=!1);let w=yield ee(c.processParamsForMcpUsage(p)),P=yield ee(c.generateContentStreamInternal(w)),M=[],b=[];try{for(var _=!0,x=(v=void 0,Qn(P)),C;C=yield ee(x.next()),y=C.done,!y;_=!0){S=C.value,_=!1;let k=S;if(yield yield ee(k),k.candidates&&(!((m=k.candidates[0])===null||m===void 0)&&m.content)){b.push(k.candidates[0].content);for(let L of(h=k.candidates[0].content.parts)!==null&&h!==void 0?h:[])if(u<r&&L.functionCall){if(!L.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(L.functionCall.name)){let O=yield ee(d.get(L.functionCall.name).callTool([L.functionCall]));M.push(...O)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${L.functionCall.name}`)}}}}catch(k){v={error:k}}finally{try{!_&&!y&&(T=x.return)&&(yield ee(T.call(x)))}finally{if(v)throw v.error}}if(M.length>0){s=!0;let k=new Lt;k.candidates=[{content:{role:"user",parts:M}}],yield yield ee(k);let L=[];L.push(...b),L.push({role:"user",parts:M});let O=Re(p.contents).concat(L);p.contents=O}else break}})}(this,f,e)}async generateContentInternal(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=Nu(this.apiClient,e);return u=V("{model}:generateContent",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>{let p=Bu(d),m=new Lt;return Object.assign(m,p),m})}else{let c=Ru(this.apiClient,e);return u=V("{model}:generateContent",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{let p=Lu(d),m=new Lt;return Object.assign(m,p),m})}}async generateContentStreamInternal(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=Nu(this.apiClient,e);return u=V("{model}:streamGenerateContent?alt=sse",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.requestStream({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),s.then(function(p){return an(this,arguments,function*(){var m,h,y,v;try{for(var T=!0,S=Qn(p),_;_=yield ee(S.next()),m=_.done,!m;T=!0){v=_.value,T=!1;let C=Bu(yield ee(v.json())),w=new Lt;Object.assign(w,C),yield yield ee(w)}}catch(x){h={error:x}}finally{try{!T&&!m&&(y=S.return)&&(yield ee(y.call(S)))}finally{if(h)throw h.error}}})})}else{let c=Ru(this.apiClient,e);return u=V("{model}:streamGenerateContent?alt=sse",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.requestStream({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(p){return an(this,arguments,function*(){var m,h,y,v;try{for(var T=!0,S=Qn(p),_;_=yield ee(S.next()),m=_.done,!m;T=!0){v=_.value,T=!1;let C=Lu(yield ee(v.json())),w=new Lt;Object.assign(w,C),yield yield ee(w)}}catch(x){h={error:x}}finally{try{!T&&!m&&(y=S.return)&&(yield ee(y.call(S)))}finally{if(h)throw h.error}}})})}}async embedContent(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=cD(this.apiClient,e);return u=V("{model}:predict",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>{let p=hT(d),m=new Zi;return Object.assign(m,p),m})}else{let c=SC(this.apiClient,e);return u=V("{model}:batchEmbedContents",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{let p=WD(d),m=new Zi;return Object.assign(m,p),m})}}async generateImagesInternal(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=dD(this.apiClient,e);return u=V("{model}:predict",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>{let p=yT(d),m=new Qi;return Object.assign(m,p),m})}else{let c=MC(this.apiClient,e);return u=V("{model}:predict",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{let p=YD(d),m=new Qi;return Object.assign(m,p),m})}}async editImageInternal(e){var n,i;let o,r="",s={};if(this.apiClient.isVertexAI()){let u=CD(this.apiClient,e);return r=V("{model}:predict",u._url),s=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{let c=vT(f),d=new Kr;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var n,i;let o,r="",s={};if(this.apiClient.isVertexAI()){let u=TD(this.apiClient,e);return r=V("{model}:predict",u._url),s=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{let c=CT(f),d=new Zr;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=ED(this.apiClient,e);return u=V("{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>ms(d))}else{let c=FC(this.apiClient,e);return u=V("{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>ps(d))}}async listInternal(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=wD(this.apiClient,e);return u=V("{models_url}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>{let p=ST(d),m=new Xi;return Object.assign(m,p),m})}else{let c=_C(this.apiClient,e);return u=V("{models_url}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{let p=ZD(d),m=new Xi;return Object.assign(m,p),m})}}async update(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=FD(this.apiClient,e);return u=V("{model}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>ms(d))}else{let c=PC(this.apiClient,e);return u=V("{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>ps(d))}}async delete(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=xD(this.apiClient,e);return u=V("{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(()=>{let d=wT(),p=new ji;return Object.assign(p,d),p})}else{let c=IC(this.apiClient,e);return u=V("{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(()=>{let d=QD(),p=new ji;return Object.assign(p,d),p})}}async countTokens(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=AD(this.apiClient,e);return u=V("{model}:countTokens",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>{let p=MT(d),m=new eo;return Object.assign(m,p),m})}else{let c=kC(this.apiClient,e);return u=V("{model}:countTokens",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{let p=XD(d),m=new eo;return Object.assign(m,p),m})}}async computeTokens(e){var n,i;let o,r="",s={};if(this.apiClient.isVertexAI()){let u=PD(this.apiClient,e);return r=V("{model}:computeTokens",u._url),s=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>{let c=FT(f),d=new Qr;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=kD(this.apiClient,e);return u=V("{model}:predictLongRunning",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>PT(d))}else{let c=LC(this.apiClient,e);return u=V("{model}:predictLongRunning",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>nT(d))}}};Ss=class extends ut{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let n=e.operation,i=e.config;if(n.name===void 0||n.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){let o=n.name.split("/operations/")[0],r;return i&&"httpOptions"in i&&(r=i.httpOptions),this.fetchPredictVideosOperationInternal({operationName:n.name,resourceName:o,config:{httpOptions:r}})}else return this.getVideosOperationInternal({operationName:n.name,config:i})}async getVideosOperationInternal(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=XT(e);return u=V("{operationName}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>qu(d))}else{let c=QT(e);return u=V("{operationName}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>iE(d))}}async fetchPredictVideosOperationInternal(e){var n,i;let o,r="",s={};if(this.apiClient.isVertexAI()){let u=jT(e);return r=V("{resourceName}:fetchPredictOperation",u._url),s=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>qu(f))}else throw new Error("This method is only supported by the Vertex AI.")}};ws=class extends ut{constructor(e){super(),this.apiClient=e}async create(e){var n,i;let o,r="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let u=bE(this.apiClient,e);r=V("auth_tokens",u._url),s=u._query,delete u.config,delete u._url,delete u._query;let f=NE(u,e.config);return o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),o.then(c=>kE(c))}}};Fs=class extends ut{constructor(e){super(),this.apiClient=e,this.get=async n=>await this.getInternal(n),this.list=async(n={})=>new Ot(Bt.PAGED_ITEM_TUNING_JOBS,i=>this.listInternal(i),await this.listInternal(n),n),this.tune=async n=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(n);{let i=await this.tuneMldevInternal(n),o="";return i.metadata!==void 0&&i.metadata.tunedModel!==void 0?o=i.metadata.tunedModel:i.name!==void 0&&i.name.includes("/operations/")&&(o=i.name.split("/operations/")[0]),{name:o,state:Yr.JOB_STATE_QUEUED}}}}async getInternal(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=qE(e);return u=V("{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>Ms(d))}else{let c=LE(e);return u=V("{name}",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>Tc(d))}}async listInternal(e){var n,i,o,r;let s,u="",f={};if(this.apiClient.isVertexAI()){let c=WE(e);return u=V("tuningJobs",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),s.then(d=>{let p=tS(d),m=new to;return Object.assign(m,p),m})}else{let c=OE(e);return u=V("tunedModels",c._url),f=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{let p=QE(d),m=new to;return Object.assign(m,p),m})}}async tuneInternal(e){var n,i;let o,r="",s={};if(this.apiClient.isVertexAI()){let u=KE(e);return r=V("tuningJobs",u._url),s=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>Ms(f))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var n,i;let o,r="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{let u=HE(e);return r=V("tunedModels",u._url),s=u._query,delete u.config,delete u._url,delete u._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(n=e.config)===null||n===void 0?void 0:n.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(f=>f.json()),o.then(f=>XE(f))}}};xs=class{async download(e,n){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}},nS=1024*1024*8,iS=3,oS=1e3,rS=2,zr="x-goog-upload-status";_s=class{async upload(e,n,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await sS(e,n,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await aS(e)}};As=class{create(e,n,i){return new Ps(e,n,i)}},Ps=class{constructor(e,n,i){this.url=e,this.headers=n,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}};Wu="x-goog-api-key",Is=class{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(Wu)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Wu,this.apiKey)}}};uS="gl-node/",Fe=class{constructor(e){var n;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(n=e.vertexai)!==null&&n!==void 0?n:!1,this.apiKey=e.apiKey;let i=Nm(e,void 0,void 0);i&&(e.httpOptions?e.httpOptions.baseUrl=i:e.httpOptions={baseUrl:i}),this.apiVersion=e.apiVersion;let o=new Is(this.apiKey);this.apiClient=new gs({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:uS+"web",uploader:new _s,downloader:new xs}),this.models=new Es(this.apiClient),this.live=new Ds(this.apiClient,o,new As),this.batches=new ss(this.apiClient),this.chats=new ls(this.models,this.apiClient),this.caches=new as(this.apiClient),this.files=new fs(this.apiClient),this.operations=new Ss(this.apiClient),this.authTokens=new ws(this.apiClient),this.tunings=new Fs(this.apiClient)}}});var Ee=W(xe=>{"use strict";xe.__esModule=!0;xe.extend=Sc;xe.indexOf=vS;xe.escapeExpression=CS;xe.isEmpty=DS;xe.createFrame=TS;xe.blockParams=ES;xe.appendContextPath=SS;var mS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},hS=/[&<>"'`=]/g,gS=/[&<>"'`=]/;function yS(t){return mS[t]}function Sc(t){for(var e=1;e<arguments.length;e++)for(var n in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],n)&&(t[n]=arguments[e][n]);return t}var Us=Object.prototype.toString;xe.toString=Us;var Os=function(e){return typeof e=="function"};Os(/x/)&&(xe.isFunction=Os=function(t){return typeof t=="function"&&Us.call(t)==="[object Function]"});xe.isFunction=Os;var wc=Array.isArray||function(t){return t&&typeof t=="object"?Us.call(t)==="[object Array]":!1};xe.isArray=wc;function vS(t,e){for(var n=0,i=t.length;n<i;n++)if(t[n]===e)return n;return-1}function CS(t){if(typeof t!="string"){if(t&&t.toHTML)return t.toHTML();if(t==null)return"";if(!t)return t+"";t=""+t}return gS.test(t)?t.replace(hS,yS):t}function DS(t){return!t&&t!==0?!0:!!(wc(t)&&t.length===0)}function TS(t){var e=Sc({},t);return e._parent=t,e}function ES(t,e){return t.path=e,t}function SS(t,e){return(t?t+".":"")+e}});var Ne=W((co,Mc)=>{"use strict";co.__esModule=!0;var Vs=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function Gs(t,e){var n=e&&e.loc,i=void 0,o=void 0,r=void 0,s=void 0;n&&(i=n.start.line,o=n.end.line,r=n.start.column,s=n.end.column,t+=" - "+i+":"+r);for(var u=Error.prototype.constructor.call(this,t),f=0;f<Vs.length;f++)this[Vs[f]]=u[Vs[f]];Error.captureStackTrace&&Error.captureStackTrace(this,Gs);try{n&&(this.lineNumber=i,this.endLineNumber=o,Object.defineProperty?(Object.defineProperty(this,"column",{value:r,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:s,enumerable:!0})):(this.column=r,this.endColumn=s))}catch(c){}}Gs.prototype=new Error;co.default=Gs;Mc.exports=co.default});var xc=W((fo,Fc)=>{"use strict";fo.__esModule=!0;var Hs=Ee();fo.default=function(t){t.registerHelper("blockHelperMissing",function(e,n){var i=n.inverse,o=n.fn;if(e===!0)return o(this);if(e===!1||e==null)return i(this);if(Hs.isArray(e))return e.length>0?(n.ids&&(n.ids=[n.name]),t.helpers.each(e,n)):i(this);if(n.data&&n.ids){var r=Hs.createFrame(n.data);r.contextPath=Hs.appendContextPath(n.data.contextPath,n.name),n={data:r}}return o(e,n)})};Fc.exports=fo.default});var Ac=W((po,_c)=>{"use strict";po.__esModule=!0;function wS(t){return t&&t.__esModule?t:{default:t}}var jn=Ee(),MS=Ne(),FS=wS(MS);po.default=function(t){t.registerHelper("each",function(e,n){if(!n)throw new FS.default("Must pass iterator to #each");var i=n.fn,o=n.inverse,r=0,s="",u=void 0,f=void 0;n.data&&n.ids&&(f=jn.appendContextPath(n.data.contextPath,n.ids[0])+"."),jn.isFunction(e)&&(e=e.call(this)),n.data&&(u=jn.createFrame(n.data));function c(y,v,T){u&&(u.key=y,u.index=v,u.first=v===0,u.last=!!T,f&&(u.contextPath=f+y)),s=s+i(e[y],{data:u,blockParams:jn.blockParams([e[y],y],[f+y,null])})}if(e&&typeof e=="object")if(jn.isArray(e))for(var d=e.length;r<d;r++)r in e&&c(r,r,r===e.length-1);else if(typeof Symbol=="function"&&e[Symbol.iterator]){for(var p=[],m=e[Symbol.iterator](),h=m.next();!h.done;h=m.next())p.push(h.value);e=p;for(var d=e.length;r<d;r++)c(r,r,r===e.length-1)}else(function(){var y=void 0;Object.keys(e).forEach(function(v){y!==void 0&&c(y,r-1),y=v,r++}),y!==void 0&&c(y,r-1,!0)})();return r===0&&(s=o(this)),s})};_c.exports=po.default});var Ic=W((mo,Pc)=>{"use strict";mo.__esModule=!0;function xS(t){return t&&t.__esModule?t:{default:t}}var _S=Ne(),AS=xS(_S);mo.default=function(t){t.registerHelper("helperMissing",function(){if(arguments.length!==1)throw new AS.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})};Pc.exports=mo.default});var Nc=W((ho,Rc)=>{"use strict";ho.__esModule=!0;function PS(t){return t&&t.__esModule?t:{default:t}}var bc=Ee(),IS=Ne(),kc=PS(IS);ho.default=function(t){t.registerHelper("if",function(e,n){if(arguments.length!=2)throw new kc.default("#if requires exactly one argument");return bc.isFunction(e)&&(e=e.call(this)),!n.hash.includeZero&&!e||bc.isEmpty(e)?n.inverse(this):n.fn(this)}),t.registerHelper("unless",function(e,n){if(arguments.length!=2)throw new kc.default("#unless requires exactly one argument");return t.helpers.if.call(this,e,{fn:n.inverse,inverse:n.fn,hash:n.hash})})};Rc.exports=ho.default});var Bc=W((go,Lc)=>{"use strict";go.__esModule=!0;go.default=function(t){t.registerHelper("log",function(){for(var e=[void 0],n=arguments[arguments.length-1],i=0;i<arguments.length-1;i++)e.push(arguments[i]);var o=1;n.hash.level!=null?o=n.hash.level:n.data&&n.data.level!=null&&(o=n.data.level),e[0]=o,t.log.apply(t,e)})};Lc.exports=go.default});var Uc=W((yo,Oc)=>{"use strict";yo.__esModule=!0;yo.default=function(t){t.registerHelper("lookup",function(e,n,i){return e&&i.lookupProperty(e,n)})};Oc.exports=yo.default});var Gc=W((vo,Vc)=>{"use strict";vo.__esModule=!0;function bS(t){return t&&t.__esModule?t:{default:t}}var ei=Ee(),kS=Ne(),RS=bS(kS);vo.default=function(t){t.registerHelper("with",function(e,n){if(arguments.length!=2)throw new RS.default("#with requires exactly one argument");ei.isFunction(e)&&(e=e.call(this));var i=n.fn;if(ei.isEmpty(e))return n.inverse(this);var o=n.data;return n.data&&n.ids&&(o=ei.createFrame(n.data),o.contextPath=ei.appendContextPath(n.data.contextPath,n.ids[0])),i(e,{data:o,blockParams:ei.blockParams([e],[o&&o.contextPath])})})};Vc.exports=vo.default});var qs=W(Co=>{"use strict";Co.__esModule=!0;Co.registerDefaultHelpers=KS;Co.moveHelperToHooks=ZS;function Ut(t){return t&&t.__esModule?t:{default:t}}var NS=xc(),LS=Ut(NS),BS=Ac(),OS=Ut(BS),US=Ic(),VS=Ut(US),GS=Nc(),HS=Ut(GS),qS=Bc(),$S=Ut(qS),WS=Uc(),JS=Ut(WS),zS=Gc(),YS=Ut(zS);function KS(t){LS.default(t),OS.default(t),VS.default(t),HS.default(t),$S.default(t),JS.default(t),YS.default(t)}function ZS(t,e,n){t.helpers[e]&&(t.hooks[e]=t.helpers[e],n||delete t.helpers[e])}});var qc=W((Do,Hc)=>{"use strict";Do.__esModule=!0;var QS=Ee();Do.default=function(t){t.registerDecorator("inline",function(e,n,i,o){var r=e;return n.partials||(n.partials={},r=function(s,u){var f=i.partials;i.partials=QS.extend({},f,n.partials);var c=e(s,u);return i.partials=f,c}),n.partials[o.args[0]]=o.fn,r})};Hc.exports=Do.default});var $c=W($s=>{"use strict";$s.__esModule=!0;$s.registerDefaultDecorators=tw;function XS(t){return t&&t.__esModule?t:{default:t}}var jS=qc(),ew=XS(jS);function tw(t){ew.default(t)}});var Ws=W((To,Wc)=>{"use strict";To.__esModule=!0;var nw=Ee(),pn={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if(typeof e=="string"){var n=nw.indexOf(pn.methodMap,e.toLowerCase());n>=0?e=n:e=parseInt(e,10)}return e},log:function(e){if(e=pn.lookupLevel(e),typeof console!="undefined"&&pn.lookupLevel(pn.level)<=e){var n=pn.methodMap[e];console[n]||(n="log");for(var i=arguments.length,o=Array(i>1?i-1:0),r=1;r<i;r++)o[r-1]=arguments[r];console[n].apply(console,o)}}};To.default=pn;Wc.exports=To.default});var Jc=W(Js=>{"use strict";Js.__esModule=!0;Js.createNewLookupObject=ow;var iw=Ee();function ow(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return iw.extend.apply(void 0,[Object.create(null)].concat(e))}});var zs=W(ti=>{"use strict";ti.__esModule=!0;ti.createProtoAccessControl=lw;ti.resultIsAllowed=uw;ti.resetLoggedProperties=fw;function rw(t){return t&&t.__esModule?t:{default:t}}var zc=Jc(),sw=Ws(),aw=rw(sw),Eo=Object.create(null);function lw(t){var e=Object.create(null);e.constructor=!1,e.__defineGetter__=!1,e.__defineSetter__=!1,e.__lookupGetter__=!1;var n=Object.create(null);return n.__proto__=!1,{properties:{whitelist:zc.createNewLookupObject(n,t.allowedProtoProperties),defaultValue:t.allowProtoPropertiesByDefault},methods:{whitelist:zc.createNewLookupObject(e,t.allowedProtoMethods),defaultValue:t.allowProtoMethodsByDefault}}}function uw(t,e,n){return Yc(typeof t=="function"?e.methods:e.properties,n)}function Yc(t,e){return t.whitelist[e]!==void 0?t.whitelist[e]===!0:t.defaultValue!==void 0?t.defaultValue:(cw(e),!1)}function cw(t){Eo[t]!==!0&&(Eo[t]=!0,aw.default.log("error",'Handlebars: Access has been denied to resolve the property "'+t+`" because it is not an "own property" of its parent.
You can add a runtime option to disable the check or this warning:
See https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details`))}function fw(){Object.keys(Eo).forEach(function(t){delete Eo[t]})}});var wo=W(Xe=>{"use strict";Xe.__esModule=!0;Xe.HandlebarsEnvironment=Zs;function Kc(t){return t&&t.__esModule?t:{default:t}}var Vt=Ee(),dw=Ne(),Ys=Kc(dw),pw=qs(),mw=$c(),hw=Ws(),So=Kc(hw),gw=zs(),yw="4.7.8";Xe.VERSION=yw;var vw=8;Xe.COMPILER_REVISION=vw;var Cw=7;Xe.LAST_COMPATIBLE_COMPILER_REVISION=Cw;var Dw={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};Xe.REVISION_CHANGES=Dw;var Ks="[object Object]";function Zs(t,e,n){this.helpers=t||{},this.partials=e||{},this.decorators=n||{},pw.registerDefaultHelpers(this),mw.registerDefaultDecorators(this)}Zs.prototype={constructor:Zs,logger:So.default,log:So.default.log,registerHelper:function(e,n){if(Vt.toString.call(e)===Ks){if(n)throw new Ys.default("Arg not supported with multiple helpers");Vt.extend(this.helpers,e)}else this.helpers[e]=n},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,n){if(Vt.toString.call(e)===Ks)Vt.extend(this.partials,e);else{if(typeof n=="undefined")throw new Ys.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=n}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,n){if(Vt.toString.call(e)===Ks){if(n)throw new Ys.default("Arg not supported with multiple decorators");Vt.extend(this.decorators,e)}else this.decorators[e]=n},unregisterDecorator:function(e){delete this.decorators[e]},resetLoggedPropertyAccesses:function(){gw.resetLoggedProperties()}};var Tw=So.default.log;Xe.log=Tw;Xe.createFrame=Vt.createFrame;Xe.logger=So.default});var Qc=W((Mo,Zc)=>{"use strict";Mo.__esModule=!0;function Qs(t){this.string=t}Qs.prototype.toString=Qs.prototype.toHTML=function(){return""+this.string};Mo.default=Qs;Zc.exports=Mo.default});var Xc=W(Xs=>{"use strict";Xs.__esModule=!0;Xs.wrapHelper=Ew;function Ew(t,e){if(typeof t!="function")return t;var n=function(){var o=arguments[arguments.length-1];return arguments[arguments.length-1]=e(o),t.apply(this,arguments)};return n}});var of=W(St=>{"use strict";St.__esModule=!0;St.checkRevision=_w;St.template=Aw;St.wrapProgram=Fo;St.resolvePartial=Pw;St.invokePartial=Iw;St.noop=tf;function Sw(t){return t&&t.__esModule?t:{default:t}}function ww(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var Mw=Ee(),dt=ww(Mw),Fw=Ne(),pt=Sw(Fw),mt=wo(),jc=qs(),xw=Xc(),ef=zs();function _w(t){var e=t&&t[0]||1,n=mt.COMPILER_REVISION;if(!(e>=mt.LAST_COMPATIBLE_COMPILER_REVISION&&e<=mt.COMPILER_REVISION))if(e<mt.LAST_COMPATIBLE_COMPILER_REVISION){var i=mt.REVISION_CHANGES[n],o=mt.REVISION_CHANGES[e];throw new pt.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+o+").")}else throw new pt.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+t[1]+").")}function Aw(t,e){if(!e)throw new pt.default("No environment passed to template");if(!t||!t.main)throw new pt.default("Unknown template object: "+typeof t);t.main.decorator=t.main_d,e.VM.checkRevision(t.compiler);var n=t.compiler&&t.compiler[0]===7;function i(s,u,f){f.hash&&(u=dt.extend({},u,f.hash),f.ids&&(f.ids[0]=!0)),s=e.VM.resolvePartial.call(this,s,u,f);var c=dt.extend({},f,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),d=e.VM.invokePartial.call(this,s,u,c);if(d==null&&e.compile&&(f.partials[f.name]=e.compile(s,t.compilerOptions,e),d=f.partials[f.name](u,c)),d!=null){if(f.indent){for(var p=d.split(`
`),m=0,h=p.length;m<h&&!(!p[m]&&m+1===h);m++)p[m]=f.indent+p[m];d=p.join(`
`)}return d}else throw new pt.default("The partial "+f.name+" could not be compiled when running in runtime-only mode")}var o={strict:function(u,f,c){if(!u||!(f in u))throw new pt.default('"'+f+'" not defined in '+u,{loc:c});return o.lookupProperty(u,f)},lookupProperty:function(u,f){var c=u[f];if(c==null||Object.prototype.hasOwnProperty.call(u,f)||ef.resultIsAllowed(c,o.protoAccessControl,f))return c},lookup:function(u,f){for(var c=u.length,d=0;d<c;d++){var p=u[d]&&o.lookupProperty(u[d],f);if(p!=null)return u[d][f]}},lambda:function(u,f){return typeof u=="function"?u.call(f):u},escapeExpression:dt.escapeExpression,invokePartial:i,fn:function(u){var f=t[u];return f.decorator=t[u+"_d"],f},programs:[],program:function(u,f,c,d,p){var m=this.programs[u],h=this.fn(u);return f||p||d||c?m=Fo(this,u,h,f,c,d,p):m||(m=this.programs[u]=Fo(this,u,h)),m},data:function(u,f){for(;u&&f--;)u=u._parent;return u},mergeIfNeeded:function(u,f){var c=u||f;return u&&f&&u!==f&&(c=dt.extend({},f,u)),c},nullContext:Object.seal({}),noop:e.VM.noop,compilerInfo:t.compiler};function r(s){var u=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],f=u.data;r._setup(u),!u.partial&&t.useData&&(f=bw(s,f));var c=void 0,d=t.useBlockParams?[]:void 0;t.useDepths&&(u.depths?c=s!=u.depths[0]?[s].concat(u.depths):u.depths:c=[s]);function p(m){return""+t.main(o,m,o.helpers,o.partials,f,d,c)}return p=nf(t.main,p,o,u.depths||[],f,d),p(s,u)}return r.isTop=!0,r._setup=function(s){if(s.partial)o.protoAccessControl=s.protoAccessControl,o.helpers=s.helpers,o.partials=s.partials,o.decorators=s.decorators,o.hooks=s.hooks;else{var u=dt.extend({},e.helpers,s.helpers);kw(u,o),o.helpers=u,t.usePartial&&(o.partials=o.mergeIfNeeded(s.partials,e.partials)),(t.usePartial||t.useDecorators)&&(o.decorators=dt.extend({},e.decorators,s.decorators)),o.hooks={},o.protoAccessControl=ef.createProtoAccessControl(s);var f=s.allowCallsToHelperMissing||n;jc.moveHelperToHooks(o,"helperMissing",f),jc.moveHelperToHooks(o,"blockHelperMissing",f)}},r._child=function(s,u,f,c){if(t.useBlockParams&&!f)throw new pt.default("must pass block params");if(t.useDepths&&!c)throw new pt.default("must pass parent depths");return Fo(o,s,t[s],u,0,f,c)},r}function Fo(t,e,n,i,o,r,s){function u(f){var c=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],d=s;return s&&f!=s[0]&&!(f===t.nullContext&&s[0]===null)&&(d=[f].concat(s)),n(t,f,t.helpers,t.partials,c.data||i,r&&[c.blockParams].concat(r),d)}return u=nf(n,u,t,s,i,r),u.program=e,u.depth=s?s.length:0,u.blockParams=o||0,u}function Pw(t,e,n){return t?!t.call&&!n.name&&(n.name=t,t=n.partials[t]):n.name==="@partial-block"?t=n.data["partial-block"]:t=n.partials[n.name],t}function Iw(t,e,n){var i=n.data&&n.data["partial-block"];n.partial=!0,n.ids&&(n.data.contextPath=n.ids[0]||n.data.contextPath);var o=void 0;if(n.fn&&n.fn!==tf&&function(){n.data=mt.createFrame(n.data);var r=n.fn;o=n.data["partial-block"]=function(u){var f=arguments.length<=1||arguments[1]===void 0?{}:arguments[1];return f.data=mt.createFrame(f.data),f.data["partial-block"]=i,r(u,f)},r.partials&&(n.partials=dt.extend({},n.partials,r.partials))}(),t===void 0&&o&&(t=o),t===void 0)throw new pt.default("The partial "+n.name+" could not be found");if(t instanceof Function)return t(e,n)}function tf(){return""}function bw(t,e){return(!e||!("root"in e))&&(e=e?mt.createFrame(e):{},e.root=t),e}function nf(t,e,n,i,o,r){if(t.decorator){var s={};e=t.decorator(e,s,n,i&&i[0],o,r,i),dt.extend(e,s)}return e}function kw(t,e){Object.keys(t).forEach(function(n){var i=t[n];t[n]=Rw(i,e)})}function Rw(t,e){var n=e.lookupProperty;return xw.wrapHelper(t,function(i){return dt.extend({lookupProperty:n},i)})}});var js=W((xo,rf)=>{"use strict";xo.__esModule=!0;xo.default=function(t){(function(){typeof globalThis!="object"&&(Object.prototype.__defineGetter__("__magic__",function(){return this}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__)})();var e=globalThis.Handlebars;t.noConflict=function(){return globalThis.Handlebars===t&&(globalThis.Handlebars=e),t}};rf.exports=xo.default});var cf=W((_o,uf)=>{"use strict";_o.__esModule=!0;function ta(t){return t&&t.__esModule?t:{default:t}}function na(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var Nw=wo(),sf=na(Nw),Lw=Qc(),Bw=ta(Lw),Ow=Ne(),Uw=ta(Ow),Vw=Ee(),ea=na(Vw),Gw=of(),af=na(Gw),Hw=js(),qw=ta(Hw);function lf(){var t=new sf.HandlebarsEnvironment;return ea.extend(t,sf),t.SafeString=Bw.default,t.Exception=Uw.default,t.Utils=ea,t.escapeExpression=ea.escapeExpression,t.VM=af,t.template=function(e){return af.template(e,t)},t}var ni=lf();ni.create=lf;qw.default(ni);ni.default=ni;_o.default=ni;uf.exports=_o.default});var ia=W((Ao,df)=>{"use strict";Ao.__esModule=!0;var ff={helpers:{helperExpression:function(e){return e.type==="SubExpression"||(e.type==="MustacheStatement"||e.type==="BlockStatement")&&!!(e.params&&e.params.length||e.hash)},scopedId:function(e){return/^\.|this\b/.test(e.original)},simpleId:function(e){return e.parts.length===1&&!ff.helpers.scopedId(e)&&!e.depth}}};Ao.default=ff;df.exports=Ao.default});var mf=W((Po,pf)=>{"use strict";Po.__esModule=!0;var $w=function(){var t={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(o,r,s,u,f,c,d){var p=c.length-1;switch(f){case 1:return c[p-1];case 2:this.$=u.prepareProgram(c[p]);break;case 3:this.$=c[p];break;case 4:this.$=c[p];break;case 5:this.$=c[p];break;case 6:this.$=c[p];break;case 7:this.$=c[p];break;case 8:this.$=c[p];break;case 9:this.$={type:"CommentStatement",value:u.stripComment(c[p]),strip:u.stripFlags(c[p],c[p]),loc:u.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:c[p],value:c[p],loc:u.locInfo(this._$)};break;case 11:this.$=u.prepareRawBlock(c[p-2],c[p-1],c[p],this._$);break;case 12:this.$={path:c[p-3],params:c[p-2],hash:c[p-1]};break;case 13:this.$=u.prepareBlock(c[p-3],c[p-2],c[p-1],c[p],!1,this._$);break;case 14:this.$=u.prepareBlock(c[p-3],c[p-2],c[p-1],c[p],!0,this._$);break;case 15:this.$={open:c[p-5],path:c[p-4],params:c[p-3],hash:c[p-2],blockParams:c[p-1],strip:u.stripFlags(c[p-5],c[p])};break;case 16:this.$={path:c[p-4],params:c[p-3],hash:c[p-2],blockParams:c[p-1],strip:u.stripFlags(c[p-5],c[p])};break;case 17:this.$={path:c[p-4],params:c[p-3],hash:c[p-2],blockParams:c[p-1],strip:u.stripFlags(c[p-5],c[p])};break;case 18:this.$={strip:u.stripFlags(c[p-1],c[p-1]),program:c[p]};break;case 19:var m=u.prepareBlock(c[p-2],c[p-1],c[p],c[p],!1,this._$),h=u.prepareProgram([m],c[p-1].loc);h.chained=!0,this.$={strip:c[p-2].strip,program:h,chain:!0};break;case 20:this.$=c[p];break;case 21:this.$={path:c[p-1],strip:u.stripFlags(c[p-2],c[p])};break;case 22:this.$=u.prepareMustache(c[p-3],c[p-2],c[p-1],c[p-4],u.stripFlags(c[p-4],c[p]),this._$);break;case 23:this.$=u.prepareMustache(c[p-3],c[p-2],c[p-1],c[p-4],u.stripFlags(c[p-4],c[p]),this._$);break;case 24:this.$={type:"PartialStatement",name:c[p-3],params:c[p-2],hash:c[p-1],indent:"",strip:u.stripFlags(c[p-4],c[p]),loc:u.locInfo(this._$)};break;case 25:this.$=u.preparePartialBlock(c[p-2],c[p-1],c[p],this._$);break;case 26:this.$={path:c[p-3],params:c[p-2],hash:c[p-1],strip:u.stripFlags(c[p-4],c[p])};break;case 27:this.$=c[p];break;case 28:this.$=c[p];break;case 29:this.$={type:"SubExpression",path:c[p-3],params:c[p-2],hash:c[p-1],loc:u.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:c[p],loc:u.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:u.id(c[p-2]),value:c[p],loc:u.locInfo(this._$)};break;case 32:this.$=u.id(c[p-1]);break;case 33:this.$=c[p];break;case 34:this.$=c[p];break;case 35:this.$={type:"StringLiteral",value:c[p],original:c[p],loc:u.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(c[p]),original:Number(c[p]),loc:u.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:c[p]==="true",original:c[p]==="true",loc:u.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:u.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:u.locInfo(this._$)};break;case 40:this.$=c[p];break;case 41:this.$=c[p];break;case 42:this.$=u.preparePath(!0,c[p],this._$);break;case 43:this.$=u.preparePath(!1,c[p],this._$);break;case 44:c[p-2].push({part:u.id(c[p]),original:c[p],separator:c[p-1]}),this.$=c[p-2];break;case 45:this.$=[{part:u.id(c[p]),original:c[p]}];break;case 46:this.$=[];break;case 47:c[p-1].push(c[p]);break;case 48:this.$=[];break;case 49:c[p-1].push(c[p]);break;case 50:this.$=[];break;case 51:c[p-1].push(c[p]);break;case 58:this.$=[];break;case 59:c[p-1].push(c[p]);break;case 64:this.$=[];break;case 65:c[p-1].push(c[p]);break;case 70:this.$=[];break;case 71:c[p-1].push(c[p]);break;case 78:this.$=[];break;case 79:c[p-1].push(c[p]);break;case 82:this.$=[];break;case 83:c[p-1].push(c[p]);break;case 86:this.$=[];break;case 87:c[p-1].push(c[p]);break;case 90:this.$=[];break;case 91:c[p-1].push(c[p]);break;case 94:this.$=[];break;case 95:c[p-1].push(c[p]);break;case 98:this.$=[c[p]];break;case 99:c[p-1].push(c[p]);break;case 100:this.$=[c[p]];break;case 101:c[p-1].push(c[p]);break}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(o,r){throw new Error(o)},parse:function(o){var r=this,s=[0],u=[null],f=[],c=this.table,d="",p=0,m=0,h=0,y=2,v=1;this.lexer.setInput(o),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var T=this.lexer.yylloc;f.push(T);var S=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);function _(ie){s.length=s.length-2*ie,u.length=u.length-ie,f.length=f.length-ie}function x(){var ie;return ie=r.lexer.lex()||1,typeof ie!="number"&&(ie=r.symbols_[ie]||ie),ie}for(var C,w,P,M,b,k,L={},O,$,le,ue;;){if(P=s[s.length-1],this.defaultActions[P]?M=this.defaultActions[P]:((C===null||typeof C=="undefined")&&(C=x()),M=c[P]&&c[P][C]),typeof M=="undefined"||!M.length||!M[0]){var ne="";if(!h){ue=[];for(O in c[P])this.terminals_[O]&&O>2&&ue.push("'"+this.terminals_[O]+"'");this.lexer.showPosition?ne="Parse error on line "+(p+1)+`:
`+this.lexer.showPosition()+`
Expecting `+ue.join(", ")+", got '"+(this.terminals_[C]||C)+"'":ne="Parse error on line "+(p+1)+": Unexpected "+(C==1?"end of input":"'"+(this.terminals_[C]||C)+"'"),this.parseError(ne,{text:this.lexer.match,token:this.terminals_[C]||C,line:this.lexer.yylineno,loc:T,expected:ue})}}if(M[0]instanceof Array&&M.length>1)throw new Error("Parse Error: multiple actions possible at state: "+P+", token: "+C);switch(M[0]){case 1:s.push(C),u.push(this.lexer.yytext),f.push(this.lexer.yylloc),s.push(M[1]),C=null,w?(C=w,w=null):(m=this.lexer.yyleng,d=this.lexer.yytext,p=this.lexer.yylineno,T=this.lexer.yylloc,h>0&&h--);break;case 2:if($=this.productions_[M[1]][1],L.$=u[u.length-$],L._$={first_line:f[f.length-($||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-($||1)].first_column,last_column:f[f.length-1].last_column},S&&(L._$.range=[f[f.length-($||1)].range[0],f[f.length-1].range[1]]),k=this.performAction.call(L,d,m,p,this.yy,M[1],u,f),typeof k!="undefined")return k;$&&(s=s.slice(0,-1*$*2),u=u.slice(0,-1*$),f=f.slice(0,-1*$)),s.push(this.productions_[M[1]][0]),u.push(L.$),f.push(L._$),le=c[s[s.length-2]][s[s.length-1]],s.push(le);break;case 3:return!0}}return!0}},e=function(){var i={EOF:1,parseError:function(r,s){if(this.yy.parser)this.yy.parser.parseError(r,s);else throw new Error(r)},setInput:function(r){return this._input=r,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var r=this._input[0];this.yytext+=r,this.yyleng++,this.offset++,this.match+=r,this.matched+=r;var s=r.match(/(?:\r\n?|\n).*/g);return s?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),r},unput:function(r){var s=r.length,u=r.split(/(?:\r\n?|\n)/g);this._input=r+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-s-1),this.offset-=s;var f=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),u.length-1&&(this.yylineno-=u.length-1);var c=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:u?(u.length===f.length?this.yylloc.first_column:0)+f[f.length-u.length].length-u[0].length:this.yylloc.first_column-s},this.options.ranges&&(this.yylloc.range=[c[0],c[0]+this.yyleng-s]),this},more:function(){return this._more=!0,this},less:function(r){this.unput(this.match.slice(r))},pastInput:function(){var r=this.matched.substr(0,this.matched.length-this.match.length);return(r.length>20?"...":"")+r.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var r=this.match;return r.length<20&&(r+=this._input.substr(0,20-r.length)),(r.substr(0,20)+(r.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var r=this.pastInput(),s=new Array(r.length+1).join("-");return r+this.upcomingInput()+`
`+s+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var r,s,u,f,c,d;this._more||(this.yytext="",this.match="");for(var p=this._currentRules(),m=0;m<p.length&&(u=this._input.match(this.rules[p[m]]),!(u&&(!s||u[0].length>s[0].length)&&(s=u,f=m,!this.options.flex)));m++);return s?(d=s[0].match(/(?:\r\n?|\n).*/g),d&&(this.yylineno+=d.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:d?d[d.length-1].length-d[d.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+s[0].length},this.yytext+=s[0],this.match+=s[0],this.matches=s,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(s[0].length),this.matched+=s[0],r=this.performAction.call(this,this.yy,this,p[f],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),r||void 0):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var r=this.next();return typeof r!="undefined"?r:this.lex()},begin:function(r){this.conditionStack.push(r)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(r){this.begin(r)}};return i.options={},i.performAction=function(r,s,u,f){function c(p,m){return s.yytext=s.yytext.substring(p,s.yyleng-m+p)}var d=f;switch(u){case 0:if(s.yytext.slice(-2)==="\\\\"?(c(0,1),this.begin("mu")):s.yytext.slice(-1)==="\\"?(c(0,1),this.begin("emu")):this.begin("mu"),s.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;break;case 3:return this.begin("raw"),15;break;case 4:return this.popState(),this.conditionStack[this.conditionStack.length-1]==="raw"?15:(c(5,9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;break;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;break;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;break;case 16:return this.popState(),44;break;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(s.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;break;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;break;case 30:return this.popState(),33;break;case 31:return s.yytext=c(1,2).replace(/\\"/g,'"'),80;break;case 32:return s.yytext=c(1,2).replace(/\\'/g,"'"),80;break;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return s.yytext=s.yytext.replace(/\\([\\\]])/g,"$1"),72;break;case 43:return"INVALID";case 44:return 5}},i.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],i.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},i}();t.lexer=e;function n(){this.yy={}}return n.prototype=t,t.Parser=n,new n}();Po.default=$w;pf.exports=Po.default});var ra=W((ko,yf)=>{"use strict";ko.__esModule=!0;function Ww(t){return t&&t.__esModule?t:{default:t}}var Jw=Ne(),oa=Ww(Jw);function Io(){this.parents=[]}Io.prototype={constructor:Io,mutating:!1,acceptKey:function(e,n){var i=this.accept(e[n]);if(this.mutating){if(i&&!Io.prototype[i.type])throw new oa.default('Unexpected node type "'+i.type+'" found when accepting '+n+" on "+e.type);e[n]=i}},acceptRequired:function(e,n){if(this.acceptKey(e,n),!e[n])throw new oa.default(e.type+" requires "+n)},acceptArray:function(e){for(var n=0,i=e.length;n<i;n++)this.acceptKey(e,n),e[n]||(e.splice(n,1),n--,i--)},accept:function(e){if(e){if(!this[e.type])throw new oa.default("Unknown type: "+e.type,e);this.current&&this.parents.unshift(this.current),this.current=e;var n=this[e.type](e);if(this.current=this.parents.shift(),!this.mutating||n)return n;if(n!==!1)return e}},Program:function(e){this.acceptArray(e.body)},MustacheStatement:bo,Decorator:bo,BlockStatement:hf,DecoratorBlock:hf,PartialStatement:gf,PartialBlockStatement:function(e){gf.call(this,e),this.acceptKey(e,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:bo,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(e){this.acceptArray(e.pairs)},HashPair:function(e){this.acceptRequired(e,"value")}};function bo(t){this.acceptRequired(t,"path"),this.acceptArray(t.params),this.acceptKey(t,"hash")}function hf(t){bo.call(this,t),this.acceptKey(t,"program"),this.acceptKey(t,"inverse")}function gf(t){this.acceptRequired(t,"name"),this.acceptArray(t.params),this.acceptKey(t,"hash")}ko.default=Io;yf.exports=ko.default});var Cf=W((Ro,vf)=>{"use strict";Ro.__esModule=!0;function zw(t){return t&&t.__esModule?t:{default:t}}var Yw=ra(),Kw=zw(Yw);function je(){var t=arguments.length<=0||arguments[0]===void 0?{}:arguments[0];this.options=t}je.prototype=new Kw.default;je.prototype.Program=function(t){var e=!this.options.ignoreStandalone,n=!this.isRootSeen;this.isRootSeen=!0;for(var i=t.body,o=0,r=i.length;o<r;o++){var s=i[o],u=this.accept(s);if(u){var f=sa(i,o,n),c=aa(i,o,n),d=u.openStandalone&&f,p=u.closeStandalone&&c,m=u.inlineStandalone&&f&&c;u.close&&Gt(i,o,!0),u.open&&wt(i,o,!0),e&&m&&(Gt(i,o),wt(i,o)&&s.type==="PartialStatement"&&(s.indent=/([ \t]+$)/.exec(i[o-1].original)[1])),e&&d&&(Gt((s.program||s.inverse).body),wt(i,o)),e&&p&&(Gt(i,o),wt((s.inverse||s.program).body))}}return t};je.prototype.BlockStatement=je.prototype.DecoratorBlock=je.prototype.PartialBlockStatement=function(t){this.accept(t.program),this.accept(t.inverse);var e=t.program||t.inverse,n=t.program&&t.inverse,i=n,o=n;if(n&&n.chained)for(i=n.body[0].program;o.chained;)o=o.body[o.body.length-1].program;var r={open:t.openStrip.open,close:t.closeStrip.close,openStandalone:aa(e.body),closeStandalone:sa((i||e).body)};if(t.openStrip.close&&Gt(e.body,null,!0),n){var s=t.inverseStrip;s.open&&wt(e.body,null,!0),s.close&&Gt(i.body,null,!0),t.closeStrip.open&&wt(o.body,null,!0),!this.options.ignoreStandalone&&sa(e.body)&&aa(i.body)&&(wt(e.body),Gt(i.body))}else t.closeStrip.open&&wt(e.body,null,!0);return r};je.prototype.Decorator=je.prototype.MustacheStatement=function(t){return t.strip};je.prototype.PartialStatement=je.prototype.CommentStatement=function(t){var e=t.strip||{};return{inlineStandalone:!0,open:e.open,close:e.close}};function sa(t,e,n){e===void 0&&(e=t.length);var i=t[e-1],o=t[e-2];if(!i)return n;if(i.type==="ContentStatement")return(o||!n?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(i.original)}function aa(t,e,n){e===void 0&&(e=-1);var i=t[e+1],o=t[e+2];if(!i)return n;if(i.type==="ContentStatement")return(o||!n?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(i.original)}function Gt(t,e,n){var i=t[e==null?0:e+1];if(!(!i||i.type!=="ContentStatement"||!n&&i.rightStripped)){var o=i.value;i.value=i.value.replace(n?/^\s+/:/^[ \t]*\r?\n?/,""),i.rightStripped=i.value!==o}}function wt(t,e,n){var i=t[e==null?t.length-1:e-1];if(!(!i||i.type!=="ContentStatement"||!n&&i.leftStripped)){var o=i.value;return i.value=i.value.replace(n?/\s+$/:/[ \t]+$/,""),i.leftStripped=i.value!==o,i.leftStripped}}Ro.default=je;vf.exports=Ro.default});var Df=W(Le=>{"use strict";Le.__esModule=!0;Le.SourceLocation=Xw;Le.id=jw;Le.stripFlags=e0;Le.stripComment=t0;Le.preparePath=n0;Le.prepareMustache=i0;Le.prepareRawBlock=o0;Le.prepareBlock=r0;Le.prepareProgram=s0;Le.preparePartialBlock=a0;function Zw(t){return t&&t.__esModule?t:{default:t}}var Qw=Ne(),la=Zw(Qw);function ua(t,e){if(e=e.path?e.path.original:e,t.path.original!==e){var n={loc:t.path.loc};throw new la.default(t.path.original+" doesn't match "+e,n)}}function Xw(t,e){this.source=t,this.start={line:e.first_line,column:e.first_column},this.end={line:e.last_line,column:e.last_column}}function jw(t){return/^\[.*\]$/.test(t)?t.substring(1,t.length-1):t}function e0(t,e){return{open:t.charAt(2)==="~",close:e.charAt(e.length-3)==="~"}}function t0(t){return t.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function n0(t,e,n){n=this.locInfo(n);for(var i=t?"@":"",o=[],r=0,s=0,u=e.length;s<u;s++){var f=e[s].part,c=e[s].original!==f;if(i+=(e[s].separator||"")+f,!c&&(f===".."||f==="."||f==="this")){if(o.length>0)throw new la.default("Invalid path: "+i,{loc:n});f===".."&&r++}else o.push(f)}return{type:"PathExpression",data:t,depth:r,parts:o,original:i,loc:n}}function i0(t,e,n,i,o,r){var s=i.charAt(3)||i.charAt(2),u=s!=="{"&&s!=="&",f=/\*/.test(i);return{type:f?"Decorator":"MustacheStatement",path:t,params:e,hash:n,escaped:u,strip:o,loc:this.locInfo(r)}}function o0(t,e,n,i){ua(t,n),i=this.locInfo(i);var o={type:"Program",body:e,strip:{},loc:i};return{type:"BlockStatement",path:t.path,params:t.params,hash:t.hash,program:o,openStrip:{},inverseStrip:{},closeStrip:{},loc:i}}function r0(t,e,n,i,o,r){i&&i.path&&ua(t,i);var s=/\*/.test(t.open);e.blockParams=t.blockParams;var u=void 0,f=void 0;if(n){if(s)throw new la.default("Unexpected inverse block on decorator",n);n.chain&&(n.program.body[0].closeStrip=i.strip),f=n.strip,u=n.program}return o&&(o=u,u=e,e=o),{type:s?"DecoratorBlock":"BlockStatement",path:t.path,params:t.params,hash:t.hash,program:e,inverse:u,openStrip:t.strip,inverseStrip:f,closeStrip:i&&i.strip,loc:this.locInfo(r)}}function s0(t,e){if(!e&&t.length){var n=t[0].loc,i=t[t.length-1].loc;n&&i&&(e={source:n.source,start:{line:n.start.line,column:n.start.column},end:{line:i.end.line,column:i.end.column}})}return{type:"Program",body:t,strip:{},loc:e}}function a0(t,e,n,i){return ua(t,n),{type:"PartialBlockStatement",name:t.path,params:t.params,hash:t.hash,program:e,openStrip:t.strip,closeStrip:n&&n.strip,loc:this.locInfo(i)}}});var Sf=W(ii=>{"use strict";ii.__esModule=!0;ii.parseWithoutProcessing=Ef;ii.parse=h0;function l0(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function Tf(t){return t&&t.__esModule?t:{default:t}}var u0=mf(),ca=Tf(u0),c0=Cf(),f0=Tf(c0),d0=Df(),p0=l0(d0),m0=Ee();ii.parser=ca.default;var No={};m0.extend(No,p0);function Ef(t,e){if(t.type==="Program")return t;ca.default.yy=No,No.locInfo=function(i){return new No.SourceLocation(e&&e.srcName,i)};var n=ca.default.parse(t);return n}function h0(t,e){var n=Ef(t,e),i=new f0.default(e);return i.accept(n)}});var xf=W(ai=>{"use strict";ai.__esModule=!0;ai.Compiler=fa;ai.precompile=C0;ai.compile=D0;function Mf(t){return t&&t.__esModule?t:{default:t}}var g0=Ne(),ri=Mf(g0),si=Ee(),y0=ia(),oi=Mf(y0),v0=[].slice;function fa(){}fa.prototype={compiler:fa,equals:function(e){var n=this.opcodes.length;if(e.opcodes.length!==n)return!1;for(var i=0;i<n;i++){var o=this.opcodes[i],r=e.opcodes[i];if(o.opcode!==r.opcode||!Ff(o.args,r.args))return!1}n=this.children.length;for(var i=0;i<n;i++)if(!this.children[i].equals(e.children[i]))return!1;return!0},guid:0,compile:function(e,n){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=n,this.stringParams=n.stringParams,this.trackIds=n.trackIds,n.blockParams=n.blockParams||[],n.knownHelpers=si.extend(Object.create(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},n.knownHelpers),this.accept(e)},compileProgram:function(e){var n=new this.compiler,i=n.compile(e,this.options),o=this.guid++;return this.usePartial=this.usePartial||i.usePartial,this.children[o]=i,this.useDepths=this.useDepths||i.useDepths,o},accept:function(e){if(!this[e.type])throw new ri.default("Unknown type: "+e.type,e);this.sourceNode.unshift(e);var n=this[e.type](e);return this.sourceNode.shift(),n},Program:function(e){this.options.blockParams.unshift(e.blockParams);for(var n=e.body,i=n.length,o=0;o<i;o++)this.accept(n[o]);return this.options.blockParams.shift(),this.isSimple=i===1,this.blockParams=e.blockParams?e.blockParams.length:0,this},BlockStatement:function(e){wf(e);var n=e.program,i=e.inverse;n=n&&this.compileProgram(n),i=i&&this.compileProgram(i);var o=this.classifySexpr(e);o==="helper"?this.helperSexpr(e,n,i):o==="simple"?(this.simpleSexpr(e),this.opcode("pushProgram",n),this.opcode("pushProgram",i),this.opcode("emptyHash"),this.opcode("blockValue",e.path.original)):(this.ambiguousSexpr(e,n,i),this.opcode("pushProgram",n),this.opcode("pushProgram",i),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(e){var n=e.program&&this.compileProgram(e.program),i=this.setupFullMustacheParams(e,n,void 0),o=e.path;this.useDecorators=!0,this.opcode("registerDecorator",i.length,o.original)},PartialStatement:function(e){this.usePartial=!0;var n=e.program;n&&(n=this.compileProgram(e.program));var i=e.params;if(i.length>1)throw new ri.default("Unsupported number of partial arguments: "+i.length,e);i.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):i.push({type:"PathExpression",parts:[],depth:0}));var o=e.name.original,r=e.name.type==="SubExpression";r&&this.accept(e.name),this.setupFullMustacheParams(e,n,void 0,!0);var s=e.indent||"";this.options.preventIndent&&s&&(this.opcode("appendContent",s),s=""),this.opcode("invokePartial",r,o,s),this.opcode("append")},PartialBlockStatement:function(e){this.PartialStatement(e)},MustacheStatement:function(e){this.SubExpression(e),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(e){this.DecoratorBlock(e)},ContentStatement:function(e){e.value&&this.opcode("appendContent",e.value)},CommentStatement:function(){},SubExpression:function(e){wf(e);var n=this.classifySexpr(e);n==="simple"?this.simpleSexpr(e):n==="helper"?this.helperSexpr(e):this.ambiguousSexpr(e)},ambiguousSexpr:function(e,n,i){var o=e.path,r=o.parts[0],s=n!=null||i!=null;this.opcode("getContext",o.depth),this.opcode("pushProgram",n),this.opcode("pushProgram",i),o.strict=!0,this.accept(o),this.opcode("invokeAmbiguous",r,s)},simpleSexpr:function(e){var n=e.path;n.strict=!0,this.accept(n),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,n,i){var o=this.setupFullMustacheParams(e,n,i),r=e.path,s=r.parts[0];if(this.options.knownHelpers[s])this.opcode("invokeKnownHelper",o.length,s);else{if(this.options.knownHelpersOnly)throw new ri.default("You specified knownHelpersOnly, but used the unknown helper "+s,e);r.strict=!0,r.falsy=!0,this.accept(r),this.opcode("invokeHelper",o.length,r.original,oi.default.helpers.simpleId(r))}},PathExpression:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var n=e.parts[0],i=oi.default.helpers.scopedId(e),o=!e.depth&&!i&&this.blockParamIndex(n);o?this.opcode("lookupBlockParam",o,e.parts):n?e.data?(this.options.data=!0,this.opcode("lookupData",e.depth,e.parts,e.strict)):this.opcode("lookupOnContext",e.parts,e.falsy,e.strict,i):this.opcode("pushContext")},StringLiteral:function(e){this.opcode("pushString",e.value)},NumberLiteral:function(e){this.opcode("pushLiteral",e.value)},BooleanLiteral:function(e){this.opcode("pushLiteral",e.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(e){var n=e.pairs,i=0,o=n.length;for(this.opcode("pushHash");i<o;i++)this.pushParam(n[i].value);for(;i--;)this.opcode("assignToHash",n[i].key);this.opcode("popHash")},opcode:function(e){this.opcodes.push({opcode:e,args:v0.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(e){e&&(this.useDepths=!0)},classifySexpr:function(e){var n=oi.default.helpers.simpleId(e.path),i=n&&!!this.blockParamIndex(e.path.parts[0]),o=!i&&oi.default.helpers.helperExpression(e),r=!i&&(o||n);if(r&&!o){var s=e.path.parts[0],u=this.options;u.knownHelpers[s]?o=!0:u.knownHelpersOnly&&(r=!1)}return o?"helper":r?"ambiguous":"simple"},pushParams:function(e){for(var n=0,i=e.length;n<i;n++)this.pushParam(e[n])},pushParam:function(e){var n=e.value!=null?e.value:e.original||"";if(this.stringParams)n.replace&&(n=n.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",n,e.type),e.type==="SubExpression"&&this.accept(e);else{if(this.trackIds){var i=void 0;if(e.parts&&!oi.default.helpers.scopedId(e)&&!e.depth&&(i=this.blockParamIndex(e.parts[0])),i){var o=e.parts.slice(1).join(".");this.opcode("pushId","BlockParam",i,o)}else n=e.original||n,n.replace&&(n=n.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",e.type,n)}this.accept(e)}},setupFullMustacheParams:function(e,n,i,o){var r=e.params;return this.pushParams(r),this.opcode("pushProgram",n),this.opcode("pushProgram",i),e.hash?this.accept(e.hash):this.opcode("emptyHash",o),r},blockParamIndex:function(e){for(var n=0,i=this.options.blockParams.length;n<i;n++){var o=this.options.blockParams[n],r=o&&si.indexOf(o,e);if(o&&r>=0)return[n,r]}}};function C0(t,e,n){if(t==null||typeof t!="string"&&t.type!=="Program")throw new ri.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+t);e=e||{},"data"in e||(e.data=!0),e.compat&&(e.useDepths=!0);var i=n.parse(t,e),o=new n.Compiler().compile(i,e);return new n.JavaScriptCompiler().compile(o,e)}function D0(t,e,n){if(e===void 0&&(e={}),t==null||typeof t!="string"&&t.type!=="Program")throw new ri.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+t);e=si.extend({},e),"data"in e||(e.data=!0),e.compat&&(e.useDepths=!0);var i=void 0;function o(){var s=n.parse(t,e),u=new n.Compiler().compile(s,e),f=new n.JavaScriptCompiler().compile(u,e,void 0,!0);return n.template(f)}function r(s,u){return i||(i=o()),i.call(this,s,u)}return r._setup=function(s){return i||(i=o()),i._setup(s)},r._child=function(s,u,f,c){return i||(i=o()),i._child(s,u,f,c)},r}function Ff(t,e){if(t===e)return!0;if(si.isArray(t)&&si.isArray(e)&&t.length===e.length){for(var n=0;n<t.length;n++)if(!Ff(t[n],e[n]))return!1;return!0}}function wf(t){if(!t.path.parts){var e=t.path;t.path={type:"PathExpression",data:!1,depth:0,parts:[e.original+""],original:e.original+"",loc:e.loc}}}});var Af=W(da=>{var _f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");da.encode=function(t){if(0<=t&&t<_f.length)return _f[t];throw new TypeError("Must be between 0 and 63: "+t)};da.decode=function(t){var e=65,n=90,i=97,o=122,r=48,s=57,u=43,f=47,c=26,d=52;return e<=t&&t<=n?t-e:i<=t&&t<=o?t-i+c:r<=t&&t<=s?t-r+d:t==u?62:t==f?63:-1}});var ha=W(ma=>{var Pf=Af(),pa=5,If=1<<pa,bf=If-1,kf=If;function T0(t){return t<0?(-t<<1)+1:(t<<1)+0}function E0(t){var e=(t&1)===1,n=t>>1;return e?-n:n}ma.encode=function(e){var n="",i,o=T0(e);do i=o&bf,o>>>=pa,o>0&&(i|=kf),n+=Pf.encode(i);while(o>0);return n};ma.decode=function(e,n,i){var o=e.length,r=0,s=0,u,f;do{if(n>=o)throw new Error("Expected more digits in base 64 VLQ value.");if(f=Pf.decode(e.charCodeAt(n++)),f===-1)throw new Error("Invalid base64 digit: "+e.charAt(n-1));u=!!(f&kf),f&=bf,r=r+(f<<s),s+=pa}while(u);i.value=E0(r),i.rest=n}});var gn=W(Ce=>{function S0(t,e,n){if(e in t)return t[e];if(arguments.length===3)return n;throw new Error('"'+e+'" is a required argument.')}Ce.getArg=S0;var Rf=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,w0=/^data:.+\,.+$/;function li(t){var e=t.match(Rf);return e?{scheme:e[1],auth:e[2],host:e[3],port:e[4],path:e[5]}:null}Ce.urlParse=li;function mn(t){var e="";return t.scheme&&(e+=t.scheme+":"),e+="//",t.auth&&(e+=t.auth+"@"),t.host&&(e+=t.host),t.port&&(e+=":"+t.port),t.path&&(e+=t.path),e}Ce.urlGenerate=mn;function ga(t){var e=t,n=li(t);if(n){if(!n.path)return t;e=n.path}for(var i=Ce.isAbsolute(e),o=e.split(/\/+/),r,s=0,u=o.length-1;u>=0;u--)r=o[u],r==="."?o.splice(u,1):r===".."?s++:s>0&&(r===""?(o.splice(u+1,s),s=0):(o.splice(u,2),s--));return e=o.join("/"),e===""&&(e=i?"/":"."),n?(n.path=e,mn(n)):e}Ce.normalize=ga;function Nf(t,e){t===""&&(t="."),e===""&&(e=".");var n=li(e),i=li(t);if(i&&(t=i.path||"/"),n&&!n.scheme)return i&&(n.scheme=i.scheme),mn(n);if(n||e.match(w0))return e;if(i&&!i.host&&!i.path)return i.host=e,mn(i);var o=e.charAt(0)==="/"?e:ga(t.replace(/\/+$/,"")+"/"+e);return i?(i.path=o,mn(i)):o}Ce.join=Nf;Ce.isAbsolute=function(t){return t.charAt(0)==="/"||Rf.test(t)};function M0(t,e){t===""&&(t="."),t=t.replace(/\/$/,"");for(var n=0;e.indexOf(t+"/")!==0;){var i=t.lastIndexOf("/");if(i<0||(t=t.slice(0,i),t.match(/^([^\/]+:\/)?\/*$/)))return e;++n}return Array(n+1).join("../")+e.substr(t.length+1)}Ce.relative=M0;var Lf=function(){var t=Object.create(null);return!("__proto__"in t)}();function Bf(t){return t}function F0(t){return Of(t)?"$"+t:t}Ce.toSetString=Lf?Bf:F0;function x0(t){return Of(t)?t.slice(1):t}Ce.fromSetString=Lf?Bf:x0;function Of(t){if(!t)return!1;var e=t.length;if(e<9||t.charCodeAt(e-1)!==95||t.charCodeAt(e-2)!==95||t.charCodeAt(e-3)!==111||t.charCodeAt(e-4)!==116||t.charCodeAt(e-5)!==111||t.charCodeAt(e-6)!==114||t.charCodeAt(e-7)!==112||t.charCodeAt(e-8)!==95||t.charCodeAt(e-9)!==95)return!1;for(var n=e-10;n>=0;n--)if(t.charCodeAt(n)!==36)return!1;return!0}function _0(t,e,n){var i=hn(t.source,e.source);return i!==0||(i=t.originalLine-e.originalLine,i!==0)||(i=t.originalColumn-e.originalColumn,i!==0||n)||(i=t.generatedColumn-e.generatedColumn,i!==0)||(i=t.generatedLine-e.generatedLine,i!==0)?i:hn(t.name,e.name)}Ce.compareByOriginalPositions=_0;function A0(t,e,n){var i=t.generatedLine-e.generatedLine;return i!==0||(i=t.generatedColumn-e.generatedColumn,i!==0||n)||(i=hn(t.source,e.source),i!==0)||(i=t.originalLine-e.originalLine,i!==0)||(i=t.originalColumn-e.originalColumn,i!==0)?i:hn(t.name,e.name)}Ce.compareByGeneratedPositionsDeflated=A0;function hn(t,e){return t===e?0:t===null?1:e===null?-1:t>e?1:-1}function P0(t,e){var n=t.generatedLine-e.generatedLine;return n!==0||(n=t.generatedColumn-e.generatedColumn,n!==0)||(n=hn(t.source,e.source),n!==0)||(n=t.originalLine-e.originalLine,n!==0)||(n=t.originalColumn-e.originalColumn,n!==0)?n:hn(t.name,e.name)}Ce.compareByGeneratedPositionsInflated=P0;function I0(t){return JSON.parse(t.replace(/^\)]}'[^\n]*\n/,""))}Ce.parseSourceMapInput=I0;function b0(t,e,n){if(e=e||"",t&&(t[t.length-1]!=="/"&&e[0]!=="/"&&(t+="/"),e=t+e),n){var i=li(n);if(!i)throw new Error("sourceMapURL could not be parsed");if(i.path){var o=i.path.lastIndexOf("/");o>=0&&(i.path=i.path.substring(0,o+1))}e=Nf(mn(i),e)}return ga(e)}Ce.computeSourceURL=b0});var Ca=W(Uf=>{var ya=gn(),va=Object.prototype.hasOwnProperty,Ht=typeof Map!="undefined";function ht(){this._array=[],this._set=Ht?new Map:Object.create(null)}ht.fromArray=function(e,n){for(var i=new ht,o=0,r=e.length;o<r;o++)i.add(e[o],n);return i};ht.prototype.size=function(){return Ht?this._set.size:Object.getOwnPropertyNames(this._set).length};ht.prototype.add=function(e,n){var i=Ht?e:ya.toSetString(e),o=Ht?this.has(e):va.call(this._set,i),r=this._array.length;(!o||n)&&this._array.push(e),o||(Ht?this._set.set(e,r):this._set[i]=r)};ht.prototype.has=function(e){if(Ht)return this._set.has(e);var n=ya.toSetString(e);return va.call(this._set,n)};ht.prototype.indexOf=function(e){if(Ht){var n=this._set.get(e);if(n>=0)return n}else{var i=ya.toSetString(e);if(va.call(this._set,i))return this._set[i]}throw new Error('"'+e+'" is not in the set.')};ht.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)};ht.prototype.toArray=function(){return this._array.slice()};Uf.ArraySet=ht});var Hf=W(Gf=>{var Vf=gn();function k0(t,e){var n=t.generatedLine,i=e.generatedLine,o=t.generatedColumn,r=e.generatedColumn;return i>n||i==n&&r>=o||Vf.compareByGeneratedPositionsInflated(t,e)<=0}function Lo(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}Lo.prototype.unsortedForEach=function(e,n){this._array.forEach(e,n)};Lo.prototype.add=function(e){k0(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))};Lo.prototype.toArray=function(){return this._sorted||(this._array.sort(Vf.compareByGeneratedPositionsInflated),this._sorted=!0),this._array};Gf.MappingList=Lo});var Da=W(qf=>{var ui=ha(),ce=gn(),Bo=Ca().ArraySet,R0=Hf().MappingList;function Be(t){t||(t={}),this._file=ce.getArg(t,"file",null),this._sourceRoot=ce.getArg(t,"sourceRoot",null),this._skipValidation=ce.getArg(t,"skipValidation",!1),this._sources=new Bo,this._names=new Bo,this._mappings=new R0,this._sourcesContents=null}Be.prototype._version=3;Be.fromSourceMap=function(e){var n=e.sourceRoot,i=new Be({file:e.file,sourceRoot:n});return e.eachMapping(function(o){var r={generated:{line:o.generatedLine,column:o.generatedColumn}};o.source!=null&&(r.source=o.source,n!=null&&(r.source=ce.relative(n,r.source)),r.original={line:o.originalLine,column:o.originalColumn},o.name!=null&&(r.name=o.name)),i.addMapping(r)}),e.sources.forEach(function(o){var r=o;n!==null&&(r=ce.relative(n,o)),i._sources.has(r)||i._sources.add(r);var s=e.sourceContentFor(o);s!=null&&i.setSourceContent(o,s)}),i};Be.prototype.addMapping=function(e){var n=ce.getArg(e,"generated"),i=ce.getArg(e,"original",null),o=ce.getArg(e,"source",null),r=ce.getArg(e,"name",null);this._skipValidation||this._validateMapping(n,i,o,r),o!=null&&(o=String(o),this._sources.has(o)||this._sources.add(o)),r!=null&&(r=String(r),this._names.has(r)||this._names.add(r)),this._mappings.add({generatedLine:n.line,generatedColumn:n.column,originalLine:i!=null&&i.line,originalColumn:i!=null&&i.column,source:o,name:r})};Be.prototype.setSourceContent=function(e,n){var i=e;this._sourceRoot!=null&&(i=ce.relative(this._sourceRoot,i)),n!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[ce.toSetString(i)]=n):this._sourcesContents&&(delete this._sourcesContents[ce.toSetString(i)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))};Be.prototype.applySourceMap=function(e,n,i){var o=n;if(n==null){if(e.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);o=e.file}var r=this._sourceRoot;r!=null&&(o=ce.relative(r,o));var s=new Bo,u=new Bo;this._mappings.unsortedForEach(function(f){if(f.source===o&&f.originalLine!=null){var c=e.originalPositionFor({line:f.originalLine,column:f.originalColumn});c.source!=null&&(f.source=c.source,i!=null&&(f.source=ce.join(i,f.source)),r!=null&&(f.source=ce.relative(r,f.source)),f.originalLine=c.line,f.originalColumn=c.column,c.name!=null&&(f.name=c.name))}var d=f.source;d!=null&&!s.has(d)&&s.add(d);var p=f.name;p!=null&&!u.has(p)&&u.add(p)},this),this._sources=s,this._names=u,e.sources.forEach(function(f){var c=e.sourceContentFor(f);c!=null&&(i!=null&&(f=ce.join(i,f)),r!=null&&(f=ce.relative(r,f)),this.setSourceContent(f,c))},this)};Be.prototype._validateMapping=function(e,n,i,o){if(n&&typeof n.line!="number"&&typeof n.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!n&&!i&&!o)){if(e&&"line"in e&&"column"in e&&n&&"line"in n&&"column"in n&&e.line>0&&e.column>=0&&n.line>0&&n.column>=0&&i)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:i,original:n,name:o}))}};Be.prototype._serializeMappings=function(){for(var e=0,n=1,i=0,o=0,r=0,s=0,u="",f,c,d,p,m=this._mappings.toArray(),h=0,y=m.length;h<y;h++){if(c=m[h],f="",c.generatedLine!==n)for(e=0;c.generatedLine!==n;)f+=";",n++;else if(h>0){if(!ce.compareByGeneratedPositionsInflated(c,m[h-1]))continue;f+=","}f+=ui.encode(c.generatedColumn-e),e=c.generatedColumn,c.source!=null&&(p=this._sources.indexOf(c.source),f+=ui.encode(p-s),s=p,f+=ui.encode(c.originalLine-1-o),o=c.originalLine-1,f+=ui.encode(c.originalColumn-i),i=c.originalColumn,c.name!=null&&(d=this._names.indexOf(c.name),f+=ui.encode(d-r),r=d)),u+=f}return u};Be.prototype._generateSourcesContent=function(e,n){return e.map(function(i){if(!this._sourcesContents)return null;n!=null&&(i=ce.relative(n,i));var o=ce.toSetString(i);return Object.prototype.hasOwnProperty.call(this._sourcesContents,o)?this._sourcesContents[o]:null},this)};Be.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(e.file=this._file),this._sourceRoot!=null&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e};Be.prototype.toString=function(){return JSON.stringify(this.toJSON())};qf.SourceMapGenerator=Be});var $f=W(qt=>{qt.GREATEST_LOWER_BOUND=1;qt.LEAST_UPPER_BOUND=2;function Ta(t,e,n,i,o,r){var s=Math.floor((e-t)/2)+t,u=o(n,i[s],!0);return u===0?s:u>0?e-s>1?Ta(s,e,n,i,o,r):r==qt.LEAST_UPPER_BOUND?e<i.length?e:-1:s:s-t>1?Ta(t,s,n,i,o,r):r==qt.LEAST_UPPER_BOUND?s:t<0?-1:t}qt.search=function(e,n,i,o){if(n.length===0)return-1;var r=Ta(-1,n.length,e,n,i,o||qt.GREATEST_LOWER_BOUND);if(r<0)return-1;for(;r-1>=0&&i(n[r],n[r-1],!0)===0;)--r;return r}});var Jf=W(Wf=>{function Ea(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function N0(t,e){return Math.round(t+Math.random()*(e-t))}function Sa(t,e,n,i){if(n<i){var o=N0(n,i),r=n-1;Ea(t,o,i);for(var s=t[i],u=n;u<i;u++)e(t[u],s)<=0&&(r+=1,Ea(t,r,u));Ea(t,r+1,u);var f=r+1;Sa(t,e,n,f-1),Sa(t,e,f+1,i)}}Wf.quickSort=function(t,e){Sa(t,e,0,t.length-1)}});var Yf=W(Oo=>{var U=gn(),wa=$f(),yn=Ca().ArraySet,L0=ha(),ci=Jf().quickSort;function te(t,e){var n=t;return typeof t=="string"&&(n=U.parseSourceMapInput(t)),n.sections!=null?new $e(n,e):new ye(n,e)}te.fromSourceMap=function(t,e){return ye.fromSourceMap(t,e)};te.prototype._version=3;te.prototype.__generatedMappings=null;Object.defineProperty(te.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}});te.prototype.__originalMappings=null;Object.defineProperty(te.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}});te.prototype._charIsMappingSeparator=function(e,n){var i=e.charAt(n);return i===";"||i===","};te.prototype._parseMappings=function(e,n){throw new Error("Subclasses must implement _parseMappings")};te.GENERATED_ORDER=1;te.ORIGINAL_ORDER=2;te.GREATEST_LOWER_BOUND=1;te.LEAST_UPPER_BOUND=2;te.prototype.eachMapping=function(e,n,i){var o=n||null,r=i||te.GENERATED_ORDER,s;switch(r){case te.GENERATED_ORDER:s=this._generatedMappings;break;case te.ORIGINAL_ORDER:s=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var u=this.sourceRoot;s.map(function(f){var c=f.source===null?null:this._sources.at(f.source);return c=U.computeSourceURL(u,c,this._sourceMapURL),{source:c,generatedLine:f.generatedLine,generatedColumn:f.generatedColumn,originalLine:f.originalLine,originalColumn:f.originalColumn,name:f.name===null?null:this._names.at(f.name)}},this).forEach(e,o)};te.prototype.allGeneratedPositionsFor=function(e){var n=U.getArg(e,"line"),i={source:U.getArg(e,"source"),originalLine:n,originalColumn:U.getArg(e,"column",0)};if(i.source=this._findSourceIndex(i.source),i.source<0)return[];var o=[],r=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",U.compareByOriginalPositions,wa.LEAST_UPPER_BOUND);if(r>=0){var s=this._originalMappings[r];if(e.column===void 0)for(var u=s.originalLine;s&&s.originalLine===u;)o.push({line:U.getArg(s,"generatedLine",null),column:U.getArg(s,"generatedColumn",null),lastColumn:U.getArg(s,"lastGeneratedColumn",null)}),s=this._originalMappings[++r];else for(var f=s.originalColumn;s&&s.originalLine===n&&s.originalColumn==f;)o.push({line:U.getArg(s,"generatedLine",null),column:U.getArg(s,"generatedColumn",null),lastColumn:U.getArg(s,"lastGeneratedColumn",null)}),s=this._originalMappings[++r]}return o};Oo.SourceMapConsumer=te;function ye(t,e){var n=t;typeof t=="string"&&(n=U.parseSourceMapInput(t));var i=U.getArg(n,"version"),o=U.getArg(n,"sources"),r=U.getArg(n,"names",[]),s=U.getArg(n,"sourceRoot",null),u=U.getArg(n,"sourcesContent",null),f=U.getArg(n,"mappings"),c=U.getArg(n,"file",null);if(i!=this._version)throw new Error("Unsupported version: "+i);s&&(s=U.normalize(s)),o=o.map(String).map(U.normalize).map(function(d){return s&&U.isAbsolute(s)&&U.isAbsolute(d)?U.relative(s,d):d}),this._names=yn.fromArray(r.map(String),!0),this._sources=yn.fromArray(o,!0),this._absoluteSources=this._sources.toArray().map(function(d){return U.computeSourceURL(s,d,e)}),this.sourceRoot=s,this.sourcesContent=u,this._mappings=f,this._sourceMapURL=e,this.file=c}ye.prototype=Object.create(te.prototype);ye.prototype.consumer=te;ye.prototype._findSourceIndex=function(t){var e=t;if(this.sourceRoot!=null&&(e=U.relative(this.sourceRoot,e)),this._sources.has(e))return this._sources.indexOf(e);var n;for(n=0;n<this._absoluteSources.length;++n)if(this._absoluteSources[n]==t)return n;return-1};ye.fromSourceMap=function(e,n){var i=Object.create(ye.prototype),o=i._names=yn.fromArray(e._names.toArray(),!0),r=i._sources=yn.fromArray(e._sources.toArray(),!0);i.sourceRoot=e._sourceRoot,i.sourcesContent=e._generateSourcesContent(i._sources.toArray(),i.sourceRoot),i.file=e._file,i._sourceMapURL=n,i._absoluteSources=i._sources.toArray().map(function(h){return U.computeSourceURL(i.sourceRoot,h,n)});for(var s=e._mappings.toArray().slice(),u=i.__generatedMappings=[],f=i.__originalMappings=[],c=0,d=s.length;c<d;c++){var p=s[c],m=new zf;m.generatedLine=p.generatedLine,m.generatedColumn=p.generatedColumn,p.source&&(m.source=r.indexOf(p.source),m.originalLine=p.originalLine,m.originalColumn=p.originalColumn,p.name&&(m.name=o.indexOf(p.name)),f.push(m)),u.push(m)}return ci(i.__originalMappings,U.compareByOriginalPositions),i};ye.prototype._version=3;Object.defineProperty(ye.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function zf(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}ye.prototype._parseMappings=function(e,n){for(var i=1,o=0,r=0,s=0,u=0,f=0,c=e.length,d=0,p={},m={},h=[],y=[],v,T,S,_,x;d<c;)if(e.charAt(d)===";")i++,d++,o=0;else if(e.charAt(d)===",")d++;else{for(v=new zf,v.generatedLine=i,_=d;_<c&&!this._charIsMappingSeparator(e,_);_++);if(T=e.slice(d,_),S=p[T],S)d+=T.length;else{for(S=[];d<_;)L0.decode(e,d,m),x=m.value,d=m.rest,S.push(x);if(S.length===2)throw new Error("Found a source, but no line and column");if(S.length===3)throw new Error("Found a source and line, but no column");p[T]=S}v.generatedColumn=o+S[0],o=v.generatedColumn,S.length>1&&(v.source=u+S[1],u+=S[1],v.originalLine=r+S[2],r=v.originalLine,v.originalLine+=1,v.originalColumn=s+S[3],s=v.originalColumn,S.length>4&&(v.name=f+S[4],f+=S[4])),y.push(v),typeof v.originalLine=="number"&&h.push(v)}ci(y,U.compareByGeneratedPositionsDeflated),this.__generatedMappings=y,ci(h,U.compareByOriginalPositions),this.__originalMappings=h};ye.prototype._findMapping=function(e,n,i,o,r,s){if(e[i]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[i]);if(e[o]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[o]);return wa.search(e,n,r,s)};ye.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var n=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var i=this._generatedMappings[e+1];if(n.generatedLine===i.generatedLine){n.lastGeneratedColumn=i.generatedColumn-1;continue}}n.lastGeneratedColumn=1/0}};ye.prototype.originalPositionFor=function(e){var n={generatedLine:U.getArg(e,"line"),generatedColumn:U.getArg(e,"column")},i=this._findMapping(n,this._generatedMappings,"generatedLine","generatedColumn",U.compareByGeneratedPositionsDeflated,U.getArg(e,"bias",te.GREATEST_LOWER_BOUND));if(i>=0){var o=this._generatedMappings[i];if(o.generatedLine===n.generatedLine){var r=U.getArg(o,"source",null);r!==null&&(r=this._sources.at(r),r=U.computeSourceURL(this.sourceRoot,r,this._sourceMapURL));var s=U.getArg(o,"name",null);return s!==null&&(s=this._names.at(s)),{source:r,line:U.getArg(o,"originalLine",null),column:U.getArg(o,"originalColumn",null),name:s}}}return{source:null,line:null,column:null,name:null}};ye.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return e==null}):!1};ye.prototype.sourceContentFor=function(e,n){if(!this.sourcesContent)return null;var i=this._findSourceIndex(e);if(i>=0)return this.sourcesContent[i];var o=e;this.sourceRoot!=null&&(o=U.relative(this.sourceRoot,o));var r;if(this.sourceRoot!=null&&(r=U.urlParse(this.sourceRoot))){var s=o.replace(/^file:\/\//,"");if(r.scheme=="file"&&this._sources.has(s))return this.sourcesContent[this._sources.indexOf(s)];if((!r.path||r.path=="/")&&this._sources.has("/"+o))return this.sourcesContent[this._sources.indexOf("/"+o)]}if(n)return null;throw new Error('"'+o+'" is not in the SourceMap.')};ye.prototype.generatedPositionFor=function(e){var n=U.getArg(e,"source");if(n=this._findSourceIndex(n),n<0)return{line:null,column:null,lastColumn:null};var i={source:n,originalLine:U.getArg(e,"line"),originalColumn:U.getArg(e,"column")},o=this._findMapping(i,this._originalMappings,"originalLine","originalColumn",U.compareByOriginalPositions,U.getArg(e,"bias",te.GREATEST_LOWER_BOUND));if(o>=0){var r=this._originalMappings[o];if(r.source===i.source)return{line:U.getArg(r,"generatedLine",null),column:U.getArg(r,"generatedColumn",null),lastColumn:U.getArg(r,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}};Oo.BasicSourceMapConsumer=ye;function $e(t,e){var n=t;typeof t=="string"&&(n=U.parseSourceMapInput(t));var i=U.getArg(n,"version"),o=U.getArg(n,"sections");if(i!=this._version)throw new Error("Unsupported version: "+i);this._sources=new yn,this._names=new yn;var r={line:-1,column:0};this._sections=o.map(function(s){if(s.url)throw new Error("Support for url field in sections not implemented.");var u=U.getArg(s,"offset"),f=U.getArg(u,"line"),c=U.getArg(u,"column");if(f<r.line||f===r.line&&c<r.column)throw new Error("Section offsets must be ordered and non-overlapping.");return r=u,{generatedOffset:{generatedLine:f+1,generatedColumn:c+1},consumer:new te(U.getArg(s,"map"),e)}})}$e.prototype=Object.create(te.prototype);$e.prototype.constructor=te;$e.prototype._version=3;Object.defineProperty($e.prototype,"sources",{get:function(){for(var t=[],e=0;e<this._sections.length;e++)for(var n=0;n<this._sections[e].consumer.sources.length;n++)t.push(this._sections[e].consumer.sources[n]);return t}});$e.prototype.originalPositionFor=function(e){var n={generatedLine:U.getArg(e,"line"),generatedColumn:U.getArg(e,"column")},i=wa.search(n,this._sections,function(r,s){var u=r.generatedLine-s.generatedOffset.generatedLine;return u||r.generatedColumn-s.generatedOffset.generatedColumn}),o=this._sections[i];return o?o.consumer.originalPositionFor({line:n.generatedLine-(o.generatedOffset.generatedLine-1),column:n.generatedColumn-(o.generatedOffset.generatedLine===n.generatedLine?o.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}};$e.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})};$e.prototype.sourceContentFor=function(e,n){for(var i=0;i<this._sections.length;i++){var o=this._sections[i],r=o.consumer.sourceContentFor(e,!0);if(r)return r}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')};$e.prototype.generatedPositionFor=function(e){for(var n=0;n<this._sections.length;n++){var i=this._sections[n];if(i.consumer._findSourceIndex(U.getArg(e,"source"))!==-1){var o=i.consumer.generatedPositionFor(e);if(o){var r={line:o.line+(i.generatedOffset.generatedLine-1),column:o.column+(i.generatedOffset.generatedLine===o.line?i.generatedOffset.generatedColumn-1:0)};return r}}}return{line:null,column:null}};$e.prototype._parseMappings=function(e,n){this.__generatedMappings=[],this.__originalMappings=[];for(var i=0;i<this._sections.length;i++)for(var o=this._sections[i],r=o.consumer._generatedMappings,s=0;s<r.length;s++){var u=r[s],f=o.consumer._sources.at(u.source);f=U.computeSourceURL(o.consumer.sourceRoot,f,this._sourceMapURL),this._sources.add(f),f=this._sources.indexOf(f);var c=null;u.name&&(c=o.consumer._names.at(u.name),this._names.add(c),c=this._names.indexOf(c));var d={source:f,generatedLine:u.generatedLine+(o.generatedOffset.generatedLine-1),generatedColumn:u.generatedColumn+(o.generatedOffset.generatedLine===u.generatedLine?o.generatedOffset.generatedColumn-1:0),originalLine:u.originalLine,originalColumn:u.originalColumn,name:c};this.__generatedMappings.push(d),typeof d.originalLine=="number"&&this.__originalMappings.push(d)}ci(this.__generatedMappings,U.compareByGeneratedPositionsDeflated),ci(this.__originalMappings,U.compareByOriginalPositions)};Oo.IndexedSourceMapConsumer=$e});var Zf=W(Kf=>{var B0=Da().SourceMapGenerator,Uo=gn(),O0=/(\r?\n)/,U0=10,vn="$$$isSourceNode$$$";function _e(t,e,n,i,o){this.children=[],this.sourceContents={},this.line=t==null?null:t,this.column=e==null?null:e,this.source=n==null?null:n,this.name=o==null?null:o,this[vn]=!0,i!=null&&this.add(i)}_e.fromStringWithSourceMap=function(e,n,i){var o=new _e,r=e.split(O0),s=0,u=function(){var m=y(),h=y()||"";return m+h;function y(){return s<r.length?r[s++]:void 0}},f=1,c=0,d=null;return n.eachMapping(function(m){if(d!==null)if(f<m.generatedLine)p(d,u()),f++,c=0;else{var h=r[s]||"",y=h.substr(0,m.generatedColumn-c);r[s]=h.substr(m.generatedColumn-c),c=m.generatedColumn,p(d,y),d=m;return}for(;f<m.generatedLine;)o.add(u()),f++;if(c<m.generatedColumn){var h=r[s]||"";o.add(h.substr(0,m.generatedColumn)),r[s]=h.substr(m.generatedColumn),c=m.generatedColumn}d=m},this),s<r.length&&(d&&p(d,u()),o.add(r.splice(s).join(""))),n.sources.forEach(function(m){var h=n.sourceContentFor(m);h!=null&&(i!=null&&(m=Uo.join(i,m)),o.setSourceContent(m,h))}),o;function p(m,h){if(m===null||m.source===void 0)o.add(h);else{var y=i?Uo.join(i,m.source):m.source;o.add(new _e(m.originalLine,m.originalColumn,y,h,m.name))}}};_e.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(n){this.add(n)},this);else if(e[vn]||typeof e=="string")e&&this.children.push(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this};_e.prototype.prepend=function(e){if(Array.isArray(e))for(var n=e.length-1;n>=0;n--)this.prepend(e[n]);else if(e[vn]||typeof e=="string")this.children.unshift(e);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);return this};_e.prototype.walk=function(e){for(var n,i=0,o=this.children.length;i<o;i++)n=this.children[i],n[vn]?n.walk(e):n!==""&&e(n,{source:this.source,line:this.line,column:this.column,name:this.name})};_e.prototype.join=function(e){var n,i,o=this.children.length;if(o>0){for(n=[],i=0;i<o-1;i++)n.push(this.children[i]),n.push(e);n.push(this.children[i]),this.children=n}return this};_e.prototype.replaceRight=function(e,n){var i=this.children[this.children.length-1];return i[vn]?i.replaceRight(e,n):typeof i=="string"?this.children[this.children.length-1]=i.replace(e,n):this.children.push("".replace(e,n)),this};_e.prototype.setSourceContent=function(e,n){this.sourceContents[Uo.toSetString(e)]=n};_e.prototype.walkSourceContents=function(e){for(var n=0,i=this.children.length;n<i;n++)this.children[n][vn]&&this.children[n].walkSourceContents(e);for(var o=Object.keys(this.sourceContents),n=0,i=o.length;n<i;n++)e(Uo.fromSetString(o[n]),this.sourceContents[o[n]])};_e.prototype.toString=function(){var e="";return this.walk(function(n){e+=n}),e};_e.prototype.toStringWithSourceMap=function(e){var n={code:"",line:1,column:0},i=new B0(e),o=!1,r=null,s=null,u=null,f=null;return this.walk(function(c,d){n.code+=c,d.source!==null&&d.line!==null&&d.column!==null?((r!==d.source||s!==d.line||u!==d.column||f!==d.name)&&i.addMapping({source:d.source,original:{line:d.line,column:d.column},generated:{line:n.line,column:n.column},name:d.name}),r=d.source,s=d.line,u=d.column,f=d.name,o=!0):o&&(i.addMapping({generated:{line:n.line,column:n.column}}),r=null,o=!1);for(var p=0,m=c.length;p<m;p++)c.charCodeAt(p)===U0?(n.line++,n.column=0,p+1===m?(r=null,o=!1):o&&i.addMapping({source:d.source,original:{line:d.line,column:d.column},generated:{line:n.line,column:n.column},name:d.name})):n.column++}),this.walkSourceContents(function(c,d){i.setSourceContent(c,d)}),{code:n.code,map:i}};Kf.SourceNode=_e});var Qf=W(Vo=>{Vo.SourceMapGenerator=Da().SourceMapGenerator;Vo.SourceMapConsumer=Yf().SourceMapConsumer;Vo.SourceNode=Zf().SourceNode});var td=W((Go,ed)=>{"use strict";Go.__esModule=!0;var Fa=Ee(),$t=void 0;try{(typeof define!="function"||!define.amd)&&(Xf=Qf(),$t=Xf.SourceNode)}catch(t){}var Xf;$t||($t=function(t,e,n,i){this.src="",i&&this.add(i)},$t.prototype={add:function(e){Fa.isArray(e)&&(e=e.join("")),this.src+=e},prepend:function(e){Fa.isArray(e)&&(e=e.join("")),this.src=e+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}});function Ma(t,e,n){if(Fa.isArray(t)){for(var i=[],o=0,r=t.length;o<r;o++)i.push(e.wrap(t[o],n));return i}else if(typeof t=="boolean"||typeof t=="number")return t+"";return t}function jf(t){this.srcFile=t,this.source=[]}jf.prototype={isEmpty:function(){return!this.source.length},prepend:function(e,n){this.source.unshift(this.wrap(e,n))},push:function(e,n){this.source.push(this.wrap(e,n))},merge:function(){var e=this.empty();return this.each(function(n){e.add(["  ",n,`
`])}),e},each:function(e){for(var n=0,i=this.source.length;n<i;n++)e(this.source[n])},empty:function(){var e=this.currentLocation||{start:{}};return new $t(e.start.line,e.start.column,this.srcFile)},wrap:function(e){var n=arguments.length<=1||arguments[1]===void 0?this.currentLocation||{start:{}}:arguments[1];return e instanceof $t?e:(e=Ma(e,this,n),new $t(n.start.line,n.start.column,this.srcFile,e))},functionCall:function(e,n,i){return i=this.generateList(i),this.wrap([e,n?"."+n+"(":"(",i,")"])},quotedString:function(e){return'"'+(e+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(e){var n=this,i=[];Object.keys(e).forEach(function(r){var s=Ma(e[r],n);s!=="undefined"&&i.push([n.quotedString(r),":",s])});var o=this.generateList(i);return o.prepend("{"),o.add("}"),o},generateList:function(e){for(var n=this.empty(),i=0,o=e.length;i<o;i++)i&&n.add(","),n.add(Ma(e[i],this));return n},generateArray:function(e){var n=this.generateList(e);return n.prepend("["),n.add("]"),n}};Go.default=jf;ed.exports=Go.default});var sd=W((Ho,rd)=>{"use strict";Ho.__esModule=!0;function od(t){return t&&t.__esModule?t:{default:t}}var nd=wo(),V0=Ne(),xa=od(V0),G0=Ee(),H0=td(),id=od(H0);function Cn(t){this.value=t}function Dn(){}Dn.prototype={nameLookup:function(e,n){return this.internalNameLookup(e,n)},depthedLookup:function(e){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(e),")"]},compilerInfo:function(){var e=nd.COMPILER_REVISION,n=nd.REVISION_CHANGES[e];return[e,n]},appendToBuffer:function(e,n,i){return G0.isArray(e)||(e=[e]),e=this.source.wrap(e,n),this.environment.isSimple?["return ",e,";"]:i?["buffer += ",e,";"]:(e.appendToBuffer=!0,e)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(e,n){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",e,",",JSON.stringify(n),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(e,n,i,o){this.environment=e,this.options=n,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!o,this.name=this.environment.name,this.isChild=!!i,this.context=i||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(e,n),this.useDepths=this.useDepths||e.useDepths||e.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||e.useBlockParams;var r=e.opcodes,s=void 0,u=void 0,f=void 0,c=void 0;for(f=0,c=r.length;f<c;f++)s=r[f],this.source.currentLocation=s.loc,u=u||s.loc,this[s.opcode].apply(this,s.args);if(this.source.currentLocation=u,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new xa.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),`;
`]),this.decorators.push("return fn;"),o?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend(`function(fn, props, container, depth0, data, blockParams, depths) {
`),this.decorators.push(`}
`),this.decorators=this.decorators.merge()));var d=this.createFunctionContext(o);if(this.isChild)return d;var p={compiler:this.compilerInfo(),main:d};this.decorators&&(p.main_d=this.decorators,p.useDecorators=!0);var m=this.context,h=m.programs,y=m.decorators;for(f=0,c=h.length;f<c;f++)h[f]&&(p[f]=h[f],y[f]&&(p[f+"_d"]=y[f],p.useDecorators=!0));return this.environment.usePartial&&(p.usePartial=!0),this.options.data&&(p.useData=!0),this.useDepths&&(p.useDepths=!0),this.useBlockParams&&(p.useBlockParams=!0),this.options.compat&&(p.compat=!0),o?p.compilerOptions=this.options:(p.compiler=JSON.stringify(p.compiler),this.source.currentLocation={start:{line:1,column:0}},p=this.objectLiteral(p),n.srcName?(p=p.toStringWithSourceMap({file:n.destName}),p.map=p.map&&p.map.toString()):p=p.toString()),p},preamble:function(){this.lastContext=0,this.source=new id.default(this.options.srcName),this.decorators=new id.default(this.options.srcName)},createFunctionContext:function(e){var n=this,i="",o=this.stackVars.concat(this.registers.list);o.length>0&&(i+=", "+o.join(", "));var r=0;Object.keys(this.aliases).forEach(function(f){var c=n.aliases[f];c.children&&c.referenceCount>1&&(i+=", alias"+ ++r+"="+f,c.children[0]="alias"+r)}),this.lookupPropertyFunctionIsUsed&&(i+=", "+this.lookupPropertyFunctionVarDeclaration());var s=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&s.push("blockParams"),this.useDepths&&s.push("depths");var u=this.mergeSource(i);return e?(s.push(u),Function.apply(this,s)):this.source.wrap(["function(",s.join(","),`) {
  `,u,"}"])},mergeSource:function(e){var n=this.environment.isSimple,i=!this.forceBuffer,o=void 0,r=void 0,s=void 0,u=void 0;return this.source.each(function(f){f.appendToBuffer?(s?f.prepend("  + "):s=f,u=f):(s&&(r?s.prepend("buffer += "):o=!0,u.add(";"),s=u=void 0),r=!0,n||(i=!1))}),i?s?(s.prepend("return "),u.add(";")):r||this.source.push('return "";'):(e+=", buffer = "+(o?"":this.initializeBuffer()),s?(s.prepend("return buffer + "),u.add(";")):this.source.push("return buffer;")),e&&this.source.prepend("var "+e.substring(2)+(o?"":`;
`)),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return`
      lookupProperty = container.lookupProperty || function(parent, propertyName) {
        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {
          return parent[propertyName];
        }
        return undefined
    }
    `.trim()},blockValue:function(e){var n=this.aliasable("container.hooks.blockHelperMissing"),i=[this.contextName(0)];this.setupHelperArgs(e,0,i);var o=this.popStack();i.splice(1,0,o),this.push(this.source.functionCall(n,"call",i))},ambiguousBlockValue:function(){var e=this.aliasable("container.hooks.blockHelperMissing"),n=[this.contextName(0)];this.setupHelperArgs("",0,n,!0),this.flushInline();var i=this.topStack();n.splice(1,0,i),this.pushSource(["if (!",this.lastHelper,") { ",i," = ",this.source.functionCall(e,"call",n),"}"])},appendContent:function(e){this.pendingContent?e=this.pendingContent+e:this.pendingLocation=this.source.currentLocation,this.pendingContent=e},append:function(){if(this.isInline())this.replaceStack(function(n){return[" != null ? ",n,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var e=this.popStack();this.pushSource(["if (",e," != null) { ",this.appendToBuffer(e,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(e){this.lastContext=e},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(e,n,i,o){var r=0;!o&&this.options.compat&&!this.lastContext?this.push(this.depthedLookup(e[r++])):this.pushContext(),this.resolvePath("context",e,r,n,i)},lookupBlockParam:function(e,n){this.useBlockParams=!0,this.push(["blockParams[",e[0],"][",e[1],"]"]),this.resolvePath("context",n,1)},lookupData:function(e,n,i){e?this.pushStackLiteral("container.data(data, "+e+")"):this.pushStackLiteral("data"),this.resolvePath("data",n,0,!0,i)},resolvePath:function(e,n,i,o,r){var s=this;if(this.options.strict||this.options.assumeObjects){this.push(q0(this.options.strict&&r,this,n,i,e));return}for(var u=n.length;i<u;i++)this.replaceStack(function(f){var c=s.nameLookup(f,n[i],e);return o?[" && ",c]:[" != null ? ",c," : ",f]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(e,n){this.pushContext(),this.pushString(n),n!=="SubExpression"&&(typeof e=="string"?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(e){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(e?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(e.ids)),this.stringParams&&(this.push(this.objectLiteral(e.contexts)),this.push(this.objectLiteral(e.types))),this.push(this.objectLiteral(e.values))},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){e!=null?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},registerDecorator:function(e,n){var i=this.nameLookup("decorators",n,"decorator"),o=this.setupHelperArgs(n,e);this.decorators.push(["fn = ",this.decorators.functionCall(i,"",["fn","props","container",o])," || fn;"])},invokeHelper:function(e,n,i){var o=this.popStack(),r=this.setupHelper(e,n),s=[];i&&s.push(r.name),s.push(o),this.options.strict||s.push(this.aliasable("container.hooks.helperMissing"));var u=["(",this.itemsSeparatedBy(s,"||"),")"],f=this.source.functionCall(u,"call",r.callParams);this.push(f)},itemsSeparatedBy:function(e,n){var i=[];i.push(e[0]);for(var o=1;o<e.length;o++)i.push(n,e[o]);return i},invokeKnownHelper:function(e,n){var i=this.setupHelper(e,n);this.push(this.source.functionCall(i.name,"call",i.callParams))},invokeAmbiguous:function(e,n){this.useRegister("helper");var i=this.popStack();this.emptyHash();var o=this.setupHelper(0,e,n),r=this.lastHelper=this.nameLookup("helpers",e,"helper"),s=["(","(helper = ",r," || ",i,")"];this.options.strict||(s[0]="(helper = ",s.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",s,o.paramsInit?["),(",o.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",o.callParams)," : helper))"])},invokePartial:function(e,n,i){var o=[],r=this.setupParams(n,1,o);e&&(n=this.popStack(),delete r.name),i&&(r.indent=JSON.stringify(i)),r.helpers="helpers",r.partials="partials",r.decorators="container.decorators",e?o.unshift(n):o.unshift(this.nameLookup("partials",n,"partial")),this.options.compat&&(r.depths="depths"),r=this.objectLiteral(r),o.push(r),this.push(this.source.functionCall("container.invokePartial","",o))},assignToHash:function(e){var n=this.popStack(),i=void 0,o=void 0,r=void 0;this.trackIds&&(r=this.popStack()),this.stringParams&&(o=this.popStack(),i=this.popStack());var s=this.hash;i&&(s.contexts[e]=i),o&&(s.types[e]=o),r&&(s.ids[e]=r),s.values[e]=n},pushId:function(e,n,i){e==="BlockParam"?this.pushStackLiteral("blockParams["+n[0]+"].path["+n[1]+"]"+(i?" + "+JSON.stringify("."+i):"")):e==="PathExpression"?this.pushString(n):e==="SubExpression"?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:Dn,compileChildren:function(e,n){for(var i=e.children,o=void 0,r=void 0,s=0,u=i.length;s<u;s++){o=i[s],r=new this.compiler;var f=this.matchExistingProgram(o);if(f==null){this.context.programs.push("");var c=this.context.programs.length;o.index=c,o.name="program"+c,this.context.programs[c]=r.compile(o,n,this.context,!this.precompile),this.context.decorators[c]=r.decorators,this.context.environments[c]=o,this.useDepths=this.useDepths||r.useDepths,this.useBlockParams=this.useBlockParams||r.useBlockParams,o.useDepths=this.useDepths,o.useBlockParams=this.useBlockParams}else o.index=f.index,o.name="program"+f.index,this.useDepths=this.useDepths||f.useDepths,this.useBlockParams=this.useBlockParams||f.useBlockParams}},matchExistingProgram:function(e){for(var n=0,i=this.context.environments.length;n<i;n++){var o=this.context.environments[n];if(o&&o.equals(e))return o}},programExpression:function(e){var n=this.environment.children[e],i=[n.index,"data",n.blockParams];return(this.useBlockParams||this.useDepths)&&i.push("blockParams"),this.useDepths&&i.push("depths"),"container.program("+i.join(", ")+")"},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},push:function(e){return e instanceof Cn||(e=this.source.wrap(e)),this.inlineStack.push(e),e},pushStackLiteral:function(e){this.push(new Cn(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),e&&this.source.push(e)},replaceStack:function(e){var n=["("],i=void 0,o=void 0,r=void 0;if(!this.isInline())throw new xa.default("replaceStack on non-inline");var s=this.popStack(!0);if(s instanceof Cn)i=[s.value],n=["(",i],r=!0;else{o=!0;var u=this.incrStack();n=["((",this.push(u)," = ",s,")"],i=this.topStack()}var f=e.call(this,i);r||this.popStack(),o&&this.stackSlot--,this.push(n.concat(f,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;this.inlineStack=[];for(var n=0,i=e.length;n<i;n++){var o=e[n];if(o instanceof Cn)this.compileStack.push(o);else{var r=this.incrStack();this.pushSource([r," = ",o,";"]),this.compileStack.push(r)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var n=this.isInline(),i=(n?this.inlineStack:this.compileStack).pop();if(!e&&i instanceof Cn)return i.value;if(!n){if(!this.stackSlot)throw new xa.default("Invalid stack pop");this.stackSlot--}return i},topStack:function(){var e=this.isInline()?this.inlineStack:this.compileStack,n=e[e.length-1];return n instanceof Cn?n.value:n},contextName:function(e){return this.useDepths&&e?"depths["+e+"]":"depth"+e},quotedString:function(e){return this.source.quotedString(e)},objectLiteral:function(e){return this.source.objectLiteral(e)},aliasable:function(e){var n=this.aliases[e];return n?(n.referenceCount++,n):(n=this.aliases[e]=this.source.wrap(e),n.aliasable=!0,n.referenceCount=1,n)},setupHelper:function(e,n,i){var o=[],r=this.setupHelperArgs(n,e,o,i),s=this.nameLookup("helpers",n,"helper"),u=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})");return{params:o,paramsInit:r,name:s,callParams:[u].concat(o)}},setupParams:function(e,n,i){var o={},r=[],s=[],u=[],f=!i,c=void 0;f&&(i=[]),o.name=this.quotedString(e),o.hash=this.popStack(),this.trackIds&&(o.hashIds=this.popStack()),this.stringParams&&(o.hashTypes=this.popStack(),o.hashContexts=this.popStack());var d=this.popStack(),p=this.popStack();(p||d)&&(o.fn=p||"container.noop",o.inverse=d||"container.noop");for(var m=n;m--;)c=this.popStack(),i[m]=c,this.trackIds&&(u[m]=this.popStack()),this.stringParams&&(s[m]=this.popStack(),r[m]=this.popStack());return f&&(o.args=this.source.generateArray(i)),this.trackIds&&(o.ids=this.source.generateArray(u)),this.stringParams&&(o.types=this.source.generateArray(s),o.contexts=this.source.generateArray(r)),this.options.data&&(o.data="data"),this.useBlockParams&&(o.blockParams="blockParams"),o},setupHelperArgs:function(e,n,i,o){var r=this.setupParams(e,n,i);return r.loc=JSON.stringify(this.source.currentLocation),r=this.objectLiteral(r),o?(this.useRegister("options"),i.push("options"),["options=",r]):i?(i.push(r),""):r}};(function(){for(var t="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),e=Dn.RESERVED_WORDS={},n=0,i=t.length;n<i;n++)e[t[n]]=!0})();Dn.isValidJavaScriptVariableName=function(t){return!Dn.RESERVED_WORDS[t]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(t)};function q0(t,e,n,i,o){var r=e.popStack(),s=n.length;for(t&&s--;i<s;i++)r=e.nameLookup(r,n[i],o);return t?[e.aliasable("container.strict"),"(",r,", ",e.quotedString(n[i]),", ",JSON.stringify(e.source.currentLocation)," )"]:r}Ho.default=Dn;rd.exports=Ho.default});var di=W((qo,ld)=>{"use strict";qo.__esModule=!0;function fi(t){return t&&t.__esModule?t:{default:t}}var $0=cf(),W0=fi($0),J0=ia(),z0=fi(J0),_a=Sf(),Aa=xf(),Y0=sd(),K0=fi(Y0),Z0=ra(),Q0=fi(Z0),X0=js(),j0=fi(X0),eM=W0.default.create;function ad(){var t=eM();return t.compile=function(e,n){return Aa.compile(e,n,t)},t.precompile=function(e,n){return Aa.precompile(e,n,t)},t.AST=z0.default,t.Compiler=Aa.Compiler,t.JavaScriptCompiler=K0.default,t.Parser=_a.parser,t.parse=_a.parse,t.parseWithoutProcessing=_a.parseWithoutProcessing,t}var Tn=ad();Tn.create=ad;j0.default(Tn);Tn.Visitor=Q0.default;Tn.default=Tn;qo.default=Tn;ld.exports=qo.default});var yi,Mt=Rt(()=>{yi={NOTE_CHAT:{contextFiles:[],contextDepth:2,enabledTools:["read_only"],requireConfirmation:[],maxContextChars:5e4,maxCharsPerFile:1e4},AGENT_SESSION:{contextFiles:[],contextDepth:3,enabledTools:["read_only","vault_ops"],requireConfirmation:["modify_files","create_files","delete_files"],maxContextChars:1e5,maxCharsPerFile:15e3}}});var Zp=W(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});require("obsidian");var vt=class extends Error{},Oa=class extends vt{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}},Ua=class extends vt{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}},Va=class extends vt{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}},Yt=class extends vt{},dr=class extends vt{constructor(e){super(`Invalid unit ${e}`)}},we=class extends vt{},tt=class extends vt{constructor(){super("Zone is an abstract class")}},B="numeric",Ze="short",be="long",pr={year:B,month:B,day:B},Zd={year:B,month:Ze,day:B},lM={year:B,month:Ze,day:B,weekday:Ze},Qd={year:B,month:be,day:B},Xd={year:B,month:be,day:B,weekday:be},jd={hour:B,minute:B},ep={hour:B,minute:B,second:B},tp={hour:B,minute:B,second:B,timeZoneName:Ze},np={hour:B,minute:B,second:B,timeZoneName:be},ip={hour:B,minute:B,hourCycle:"h23"},op={hour:B,minute:B,second:B,hourCycle:"h23"},rp={hour:B,minute:B,second:B,hourCycle:"h23",timeZoneName:Ze},sp={hour:B,minute:B,second:B,hourCycle:"h23",timeZoneName:be},ap={year:B,month:B,day:B,hour:B,minute:B},lp={year:B,month:B,day:B,hour:B,minute:B,second:B},up={year:B,month:Ze,day:B,hour:B,minute:B},cp={year:B,month:Ze,day:B,hour:B,minute:B,second:B},uM={year:B,month:Ze,day:B,weekday:Ze,hour:B,minute:B},fp={year:B,month:be,day:B,hour:B,minute:B,timeZoneName:Ze},dp={year:B,month:be,day:B,hour:B,minute:B,second:B,timeZoneName:Ze},pp={year:B,month:be,day:B,weekday:be,hour:B,minute:B,timeZoneName:be},mp={year:B,month:be,day:B,weekday:be,hour:B,minute:B,second:B,timeZoneName:be},Qt=class{get type(){throw new tt}get name(){throw new tt}get ianaName(){return this.name}get isUniversal(){throw new tt}offsetName(e,n){throw new tt}formatOffset(e,n){throw new tt}offset(e){throw new tt}equals(e){throw new tt}get isValid(){throw new tt}},Pa=null,mr=class t extends Qt{static get instance(){return Pa===null&&(Pa=new t),Pa}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:n,locale:i}){return gp(e,n,i)}formatOffset(e,n){return wi(this.offset(e),n)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}},cr={};function cM(t){return cr[t]||(cr[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),cr[t]}var fM={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function dM(t,e){let n=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(n),[,o,r,s,u,f,c,d]=i;return[s,o,r,u,f,c,d]}function pM(t,e){let n=t.formatToParts(e),i=[];for(let o=0;o<n.length;o++){let{type:r,value:s}=n[o],u=fM[r];r==="era"?i[u]=s:K(u)||(i[u]=parseInt(s,10))}return i}var or={},At=class t extends Qt{static create(e){return or[e]||(or[e]=new t(e)),or[e]}static resetCache(){or={},cr={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(n){return!1}}constructor(e){super(),this.zoneName=e,this.valid=t.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:n,locale:i}){return gp(e,n,i,this.name)}formatOffset(e,n){return wi(this.offset(e),n)}offset(e){let n=new Date(e);if(isNaN(n))return NaN;let i=cM(this.name),[o,r,s,u,f,c,d]=i.formatToParts?pM(i,n):dM(i,n);u==="BC"&&(o=-Math.abs(o)+1);let m=Sr({year:o,month:r,day:s,hour:f===24?0:f,minute:c,second:d,millisecond:0}),h=+n,y=h%1e3;return h-=y>=0?y:1e3+y,(m-h)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}},Cd={};function mM(t,e={}){let n=JSON.stringify([t,e]),i=Cd[n];return i||(i=new Intl.ListFormat(t,e),Cd[n]=i),i}var Ga={};function Ha(t,e={}){let n=JSON.stringify([t,e]),i=Ga[n];return i||(i=new Intl.DateTimeFormat(t,e),Ga[n]=i),i}var qa={};function hM(t,e={}){let n=JSON.stringify([t,e]),i=qa[n];return i||(i=new Intl.NumberFormat(t,e),qa[n]=i),i}var $a={};function gM(t,e={}){let{base:n,...i}=e,o=JSON.stringify([t,i]),r=$a[o];return r||(r=new Intl.RelativeTimeFormat(t,e),$a[o]=r),r}var Ei=null;function yM(){return Ei||(Ei=new Intl.DateTimeFormat().resolvedOptions().locale,Ei)}function vM(t){let e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));let n=t.indexOf("-u-");if(n===-1)return[t];{let i,o;try{i=Ha(t).resolvedOptions(),o=t}catch(u){let f=t.substring(0,n);i=Ha(f).resolvedOptions(),o=f}let{numberingSystem:r,calendar:s}=i;return[o,r,s]}}function CM(t,e,n){return(n||e)&&(t.includes("-u-")||(t+="-u"),n&&(t+=`-ca-${n}`),e&&(t+=`-nu-${e}`)),t}function DM(t){let e=[];for(let n=1;n<=12;n++){let i=z.utc(2009,n,1);e.push(t(i))}return e}function TM(t){let e=[];for(let n=1;n<=7;n++){let i=z.utc(2016,11,13+n);e.push(t(i))}return e}function rr(t,e,n,i){let o=t.listingMode();return o==="error"?null:o==="en"?n(e):i(e)}function EM(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}var Wa=class{constructor(e,n,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;let{padTo:o,floor:r,...s}=i;if(!n||Object.keys(s).length>0){let u={useGrouping:!1,...i};i.padTo>0&&(u.minimumIntegerDigits=i.padTo),this.inf=hM(e,u)}}format(e){if(this.inf){let n=this.floor?Math.floor(e):e;return this.inf.format(n)}else{let n=this.floor?Math.floor(e):rl(e,3);return pe(n,this.padTo)}}},Ja=class{constructor(e,n,i){this.opts=i,this.originalZone=void 0;let o;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){let s=-1*(e.offset/60),u=s>=0?`Etc/GMT+${s}`:`Etc/GMT${s}`;e.offset!==0&&At.create(u).valid?(o=u,this.dt=e):(o="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,o=e.zone.name):(o="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);let r={...this.opts};r.timeZone=r.timeZone||o,this.dtf=Ha(n,r)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){let e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(n=>{if(n.type==="timeZoneName"){let i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...n,value:i}}else return n}):e}resolvedOptions(){return this.dtf.resolvedOptions()}},za=class{constructor(e,n,i){this.opts={style:"long",...i},!n&&hp()&&(this.rtf=gM(e,i))}format(e,n){return this.rtf?this.rtf.format(e,n):OM(n,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,n){return this.rtf?this.rtf.formatToParts(e,n):[]}},ae=class t{static fromOpts(e){return t.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,n,i,o=!1){let r=e||se.defaultLocale,s=r||(o?"en-US":yM()),u=n||se.defaultNumberingSystem,f=i||se.defaultOutputCalendar;return new t(s,u,f,r)}static resetCache(){Ei=null,Ga={},qa={},$a={}}static fromObject({locale:e,numberingSystem:n,outputCalendar:i}={}){return t.create(e,n,i)}constructor(e,n,i,o){let[r,s,u]=vM(e);this.locale=r,this.numberingSystem=n||s||null,this.outputCalendar=i||u||null,this.intl=CM(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=o,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=EM(this)),this.fastNumbersCached}listingMode(){let e=this.isEnglish(),n=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&n?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:t.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,n=!1){return rr(this,e,Cp,()=>{let i=n?{month:e,day:"numeric"}:{month:e},o=n?"format":"standalone";return this.monthsCache[o][e]||(this.monthsCache[o][e]=DM(r=>this.extract(r,i,"month"))),this.monthsCache[o][e]})}weekdays(e,n=!1){return rr(this,e,Ep,()=>{let i=n?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},o=n?"format":"standalone";return this.weekdaysCache[o][e]||(this.weekdaysCache[o][e]=TM(r=>this.extract(r,i,"weekday"))),this.weekdaysCache[o][e]})}meridiems(){return rr(this,void 0,()=>Sp,()=>{if(!this.meridiemCache){let e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[z.utc(2016,11,13,9),z.utc(2016,11,13,19)].map(n=>this.extract(n,e,"dayperiod"))}return this.meridiemCache})}eras(e){return rr(this,e,wp,()=>{let n={era:e};return this.eraCache[e]||(this.eraCache[e]=[z.utc(-40,1,1),z.utc(2017,1,1)].map(i=>this.extract(i,n,"era"))),this.eraCache[e]})}extract(e,n,i){let o=this.dtFormatter(e,n),r=o.formatToParts(),s=r.find(u=>u.type.toLowerCase()===i);return s?s.value:null}numberFormatter(e={}){return new Wa(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,n={}){return new Ja(e,this.intl,n)}relFormatter(e={}){return new za(this.intl,this.isEnglish(),e)}listFormatter(e={}){return mM(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}},Ia=null,Ge=class t extends Qt{static get utcInstance(){return Ia===null&&(Ia=new t(0)),Ia}static instance(e){return e===0?t.utcInstance:new t(e)}static parseSpecifier(e){if(e){let n=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(n)return new t(wr(n[1],n[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${wi(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${wi(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,n){return wi(this.fixed,n)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}},Ya=class extends Qt{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}};function _t(t,e){if(K(t)||t===null)return e;if(t instanceof Qt)return t;if(SM(t)){let n=t.toLowerCase();return n==="default"?e:n==="local"||n==="system"?mr.instance:n==="utc"||n==="gmt"?Ge.utcInstance:Ge.parseSpecifier(n)||At.create(t)}else return Zt(t)?Ge.instance(t):typeof t=="object"&&"offset"in t&&typeof t.offset=="function"?t:new Ya(t)}var Dd=()=>Date.now(),Td="system",Ed=null,Sd=null,wd=null,Md=60,Fd,se=class{static get now(){return Dd}static set now(e){Dd=e}static set defaultZone(e){Td=e}static get defaultZone(){return _t(Td,mr.instance)}static get defaultLocale(){return Ed}static set defaultLocale(e){Ed=e}static get defaultNumberingSystem(){return Sd}static set defaultNumberingSystem(e){Sd=e}static get defaultOutputCalendar(){return wd}static set defaultOutputCalendar(e){wd=e}static get twoDigitCutoffYear(){return Md}static set twoDigitCutoffYear(e){Md=e%100}static get throwOnInvalid(){return Fd}static set throwOnInvalid(e){Fd=e}static resetCaches(){ae.resetCache(),At.resetCache()}};function K(t){return typeof t=="undefined"}function Zt(t){return typeof t=="number"}function Er(t){return typeof t=="number"&&t%1===0}function SM(t){return typeof t=="string"}function wM(t){return Object.prototype.toString.call(t)==="[object Date]"}function hp(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch(t){return!1}}function MM(t){return Array.isArray(t)?t:[t]}function xd(t,e,n){if(t.length!==0)return t.reduce((i,o)=>{let r=[e(o),o];return i&&n(i[0],r[0])===i[0]?i:r},null)[1]}function FM(t,e){return e.reduce((n,i)=>(n[i]=t[i],n),{})}function kn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function yt(t,e,n){return Er(t)&&t>=e&&t<=n}function xM(t,e){return t-e*Math.floor(t/e)}function pe(t,e=2){let n=t<0,i;return n?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function xt(t){if(!(K(t)||t===null||t===""))return parseInt(t,10)}function Jt(t){if(!(K(t)||t===null||t===""))return parseFloat(t)}function ol(t){if(!(K(t)||t===null||t==="")){let e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function rl(t,e,n=!1){let i=10**e;return(n?Math.trunc:Math.round)(t*i)/i}function xi(t){return t%4===0&&(t%100!==0||t%400===0)}function Si(t){return xi(t)?366:365}function hr(t,e){let n=xM(e-1,12)+1,i=t+(e-n)/12;return n===2?xi(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][n-1]}function Sr(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function gr(t){let e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,n=t-1,i=(n+Math.floor(n/4)-Math.floor(n/100)+Math.floor(n/400))%7;return e===4||i===3?53:52}function Ka(t){return t>99?t:t>se.twoDigitCutoffYear?1900+t:2e3+t}function gp(t,e,n,i=null){let o=new Date(t),r={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(r.timeZone=i);let s={timeZoneName:e,...r},u=new Intl.DateTimeFormat(n,s).formatToParts(o).find(f=>f.type.toLowerCase()==="timezonename");return u?u.value:null}function wr(t,e){let n=parseInt(t,10);Number.isNaN(n)&&(n=0);let i=parseInt(e,10)||0,o=n<0||Object.is(n,-0)?-i:i;return n*60+o}function yp(t){let e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new we(`Invalid unit value ${t}`);return e}function yr(t,e){let n={};for(let i in t)if(kn(t,i)){let o=t[i];if(o==null)continue;n[e(i)]=yp(o)}return n}function wi(t,e){let n=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),o=t>=0?"+":"-";switch(e){case"short":return`${o}${pe(n,2)}:${pe(i,2)}`;case"narrow":return`${o}${n}${i>0?`:${i}`:""}`;case"techie":return`${o}${pe(n,2)}${pe(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function Mr(t){return FM(t,["hour","minute","second","millisecond"])}var _M=["January","February","March","April","May","June","July","August","September","October","November","December"],vp=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],AM=["J","F","M","A","M","J","J","A","S","O","N","D"];function Cp(t){switch(t){case"narrow":return[...AM];case"short":return[...vp];case"long":return[..._M];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}var Dp=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Tp=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],PM=["M","T","W","T","F","S","S"];function Ep(t){switch(t){case"narrow":return[...PM];case"short":return[...Tp];case"long":return[...Dp];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}var Sp=["AM","PM"],IM=["Before Christ","Anno Domini"],bM=["BC","AD"],kM=["B","A"];function wp(t){switch(t){case"narrow":return[...kM];case"short":return[...bM];case"long":return[...IM];default:return null}}function RM(t){return Sp[t.hour<12?0:1]}function NM(t,e){return Ep(e)[t.weekday-1]}function LM(t,e){return Cp(e)[t.month-1]}function BM(t,e){return wp(e)[t.year<0?0:1]}function OM(t,e,n="always",i=!1){let o={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},r=["hours","minutes","seconds"].indexOf(t)===-1;if(n==="auto"&&r){let p=t==="days";switch(e){case 1:return p?"tomorrow":`next ${o[t][0]}`;case-1:return p?"yesterday":`last ${o[t][0]}`;case 0:return p?"today":`this ${o[t][0]}`}}let s=Object.is(e,-0)||e<0,u=Math.abs(e),f=u===1,c=o[t],d=i?f?c[1]:c[2]||c[1]:f?o[t][0]:t;return s?`${u} ${d} ago`:`in ${u} ${d}`}function _d(t,e){let n="";for(let i of t)i.literal?n+=i.val:n+=e(i.val);return n}var UM={D:pr,DD:Zd,DDD:Qd,DDDD:Xd,t:jd,tt:ep,ttt:tp,tttt:np,T:ip,TT:op,TTT:rp,TTTT:sp,f:ap,ff:up,fff:fp,ffff:pp,F:lp,FF:cp,FFF:dp,FFFF:mp},Pe=class t{static create(e,n={}){return new t(e,n)}static parseFormat(e){let n=null,i="",o=!1,r=[];for(let s=0;s<e.length;s++){let u=e.charAt(s);u==="'"?(i.length>0&&r.push({literal:o||/^\s+$/.test(i),val:i}),n=null,i="",o=!o):o||u===n?i+=u:(i.length>0&&r.push({literal:/^\s+$/.test(i),val:i}),i=u,n=u)}return i.length>0&&r.push({literal:o||/^\s+$/.test(i),val:i}),r}static macroTokenToFormatOpts(e){return UM[e]}constructor(e,n){this.opts=n,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,n){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...n}).format()}dtFormatter(e,n={}){return this.loc.dtFormatter(e,{...this.opts,...n})}formatDateTime(e,n){return this.dtFormatter(e,n).format()}formatDateTimeParts(e,n){return this.dtFormatter(e,n).formatToParts()}formatInterval(e,n){return this.dtFormatter(e.start,n).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,n){return this.dtFormatter(e,n).resolvedOptions()}num(e,n=0){if(this.opts.forceSimple)return pe(e,n);let i={...this.opts};return n>0&&(i.padTo=n),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,n){let i=this.loc.listingMode()==="en",o=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",r=(h,y)=>this.loc.extract(e,h,y),s=h=>e.isOffsetFixed&&e.offset===0&&h.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,h.format):"",u=()=>i?RM(e):r({hour:"numeric",hourCycle:"h12"},"dayperiod"),f=(h,y)=>i?LM(e,h):r(y?{month:h}:{month:h,day:"numeric"},"month"),c=(h,y)=>i?NM(e,h):r(y?{weekday:h}:{weekday:h,month:"long",day:"numeric"},"weekday"),d=h=>{let y=t.macroTokenToFormatOpts(h);return y?this.formatWithSystemDefault(e,y):h},p=h=>i?BM(e,h):r({era:h},"era"),m=h=>{switch(h){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return s({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return s({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return s({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return u();case"d":return o?r({day:"numeric"},"day"):this.num(e.day);case"dd":return o?r({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return o?r({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return o?r({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return f("short",!0);case"LLLL":return f("long",!0);case"LLLLL":return f("narrow",!0);case"M":return o?r({month:"numeric"},"month"):this.num(e.month);case"MM":return o?r({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return f("short",!1);case"MMMM":return f("long",!1);case"MMMMM":return f("narrow",!1);case"y":return o?r({year:"numeric"},"year"):this.num(e.year);case"yy":return o?r({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return o?r({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return o?r({year:"numeric"},"year"):this.num(e.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return d(h)}};return _d(t.parseFormat(n),m)}formatDurationFromString(e,n){let i=f=>{switch(f[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},o=f=>c=>{let d=i(c);return d?this.num(f.get(d),c.length):c},r=t.parseFormat(n),s=r.reduce((f,{literal:c,val:d})=>c?f:f.concat(d),[]),u=e.shiftTo(...s.map(i).filter(f=>f));return _d(r,o(u))}},Ie=class{constructor(e,n){this.reason=e,this.explanation=n}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}},Mp=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function Rn(...t){let e=t.reduce((n,i)=>n+i.source,"");return RegExp(`^${e}$`)}function Nn(...t){return e=>t.reduce(([n,i,o],r)=>{let[s,u,f]=r(e,o);return[{...n,...s},u||i,f]},[{},null,1]).slice(0,2)}function Ln(t,...e){if(t==null)return[null,null];for(let[n,i]of e){let o=n.exec(t);if(o)return i(o)}return[null,null]}function Fp(...t){return(e,n)=>{let i={},o;for(o=0;o<t.length;o++)i[t[o]]=xt(e[n+o]);return[i,null,n+o]}}var xp=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,VM=`(?:${xp.source}?(?:\\[(${Mp.source})\\])?)?`,sl=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,_p=RegExp(`${sl.source}${VM}`),al=RegExp(`(?:T${_p.source})?`),GM=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,HM=/(\d{4})-?W(\d\d)(?:-?(\d))?/,qM=/(\d{4})-?(\d{3})/,$M=Fp("weekYear","weekNumber","weekDay"),WM=Fp("year","ordinal"),JM=/(\d{4})-(\d\d)-(\d\d)/,Ap=RegExp(`${sl.source} ?(?:${xp.source}|(${Mp.source}))?`),zM=RegExp(`(?: ${Ap.source})?`);function In(t,e,n){let i=t[e];return K(i)?n:xt(i)}function YM(t,e){return[{year:In(t,e),month:In(t,e+1,1),day:In(t,e+2,1)},null,e+3]}function Bn(t,e){return[{hours:In(t,e,0),minutes:In(t,e+1,0),seconds:In(t,e+2,0),milliseconds:ol(t[e+3])},null,e+4]}function _i(t,e){let n=!t[e]&&!t[e+1],i=wr(t[e+1],t[e+2]),o=n?null:Ge.instance(i);return[{},o,e+3]}function Ai(t,e){let n=t[e]?At.create(t[e]):null;return[{},n,e+1]}var KM=RegExp(`^T?${sl.source}$`),ZM=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function QM(t){let[e,n,i,o,r,s,u,f,c]=t,d=e[0]==="-",p=f&&f[0]==="-",m=(h,y=!1)=>h!==void 0&&(y||h&&d)?-h:h;return[{years:m(Jt(n)),months:m(Jt(i)),weeks:m(Jt(o)),days:m(Jt(r)),hours:m(Jt(s)),minutes:m(Jt(u)),seconds:m(Jt(f),f==="-0"),milliseconds:m(ol(c),p)}]}var XM={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function ll(t,e,n,i,o,r,s){let u={year:e.length===2?Ka(xt(e)):xt(e),month:vp.indexOf(n)+1,day:xt(i),hour:xt(o),minute:xt(r)};return s&&(u.second=xt(s)),t&&(u.weekday=t.length>3?Dp.indexOf(t)+1:Tp.indexOf(t)+1),u}var jM=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function eF(t){let[,e,n,i,o,r,s,u,f,c,d,p]=t,m=ll(e,o,i,n,r,s,u),h;return f?h=XM[f]:c?h=0:h=wr(d,p),[m,new Ge(h)]}function tF(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}var nF=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,iF=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,oF=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Ad(t){let[,e,n,i,o,r,s,u]=t;return[ll(e,o,i,n,r,s,u),Ge.utcInstance]}function rF(t){let[,e,n,i,o,r,s,u]=t;return[ll(e,u,n,i,o,r,s),Ge.utcInstance]}var sF=Rn(GM,al),aF=Rn(HM,al),lF=Rn(qM,al),uF=Rn(_p),Pp=Nn(YM,Bn,_i,Ai),cF=Nn($M,Bn,_i,Ai),fF=Nn(WM,Bn,_i,Ai),dF=Nn(Bn,_i,Ai);function pF(t){return Ln(t,[sF,Pp],[aF,cF],[lF,fF],[uF,dF])}function mF(t){return Ln(tF(t),[jM,eF])}function hF(t){return Ln(t,[nF,Ad],[iF,Ad],[oF,rF])}function gF(t){return Ln(t,[ZM,QM])}var yF=Nn(Bn);function vF(t){return Ln(t,[KM,yF])}var CF=Rn(JM,zM),DF=Rn(Ap),TF=Nn(Bn,_i,Ai);function EF(t){return Ln(t,[CF,Pp],[DF,TF])}var Pd="Invalid Duration",Ip={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},SF={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...Ip},Ue=146097/400,_n=146097/4800,wF={years:{quarters:4,months:12,weeks:Ue/7,days:Ue,hours:Ue*24,minutes:Ue*24*60,seconds:Ue*24*60*60,milliseconds:Ue*24*60*60*1e3},quarters:{months:3,weeks:Ue/28,days:Ue/4,hours:Ue*24/4,minutes:Ue*24*60/4,seconds:Ue*24*60*60/4,milliseconds:Ue*24*60*60*1e3/4},months:{weeks:_n/7,days:_n,hours:_n*24,minutes:_n*24*60,seconds:_n*24*60*60,milliseconds:_n*24*60*60*1e3},...Ip},Kt=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],MF=Kt.slice(0).reverse();function Ft(t,e,n=!1){let i={values:n?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new G(i)}function bp(t,e){var i;let n=(i=e.milliseconds)!=null?i:0;for(let o of MF.slice(1))e[o]&&(n+=e[o]*t[o].milliseconds);return n}function Id(t,e){let n=bp(t,e)<0?-1:1;Kt.reduceRight((i,o)=>{if(K(e[o]))return i;if(i){let r=e[i]*n,s=t[o][i],u=Math.floor(r/s);e[o]+=u*n,e[i]-=u*s*n}return o},null),Kt.reduce((i,o)=>{if(K(e[o]))return i;if(i){let r=e[i]%1;e[i]-=r,e[o]+=r*t[i][o]}return o},null)}function FF(t){let e={};for(let[n,i]of Object.entries(t))i!==0&&(e[n]=i);return e}var G=class t{constructor(e){let n=e.conversionAccuracy==="longterm"||!1,i=n?wF:SF;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||ae.create(),this.conversionAccuracy=n?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,n){return t.fromObject({milliseconds:e},n)}static fromObject(e,n={}){if(e==null||typeof e!="object")throw new we(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new t({values:yr(e,t.normalizeUnit),loc:ae.fromObject(n),conversionAccuracy:n.conversionAccuracy,matrix:n.matrix})}static fromDurationLike(e){if(Zt(e))return t.fromMillis(e);if(t.isDuration(e))return e;if(typeof e=="object")return t.fromObject(e);throw new we(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,n){let[i]=gF(e);return i?t.fromObject(i,n):t.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,n){let[i]=vF(e);return i?t.fromObject(i,n):t.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,n=null){if(!e)throw new we("need to specify a reason the Duration is invalid");let i=e instanceof Ie?e:new Ie(e,n);if(se.throwOnInvalid)throw new Va(i);return new t({invalid:i})}static normalizeUnit(e){let n={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!n)throw new dr(e);return n}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,n={}){let i={...n,floor:n.round!==!1&&n.floor!==!1};return this.isValid?Pe.create(this.loc,i).formatDurationFromString(this,e):Pd}toHuman(e={}){if(!this.isValid)return Pd;let n=Kt.map(i=>{let o=this.values[i];return K(o)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(o)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(n)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=rl(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;let n=this.toMillis();return n<0||n>=864e5?null:(e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1},z.fromMillis(n,{zone:"UTC"}).toISOTime(e))}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.isValid?bp(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;let n=t.fromDurationLike(e),i={};for(let o of Kt)(kn(n.values,o)||kn(this.values,o))&&(i[o]=n.get(o)+this.get(o));return Ft(this,{values:i},!0)}minus(e){if(!this.isValid)return this;let n=t.fromDurationLike(e);return this.plus(n.negate())}mapUnits(e){if(!this.isValid)return this;let n={};for(let i of Object.keys(this.values))n[i]=yp(e(this.values[i],i));return Ft(this,{values:n},!0)}get(e){return this[t.normalizeUnit(e)]}set(e){if(!this.isValid)return this;let n={...this.values,...yr(e,t.normalizeUnit)};return Ft(this,{values:n})}reconfigure({locale:e,numberingSystem:n,conversionAccuracy:i,matrix:o}={}){let s={loc:this.loc.clone({locale:e,numberingSystem:n}),matrix:o,conversionAccuracy:i};return Ft(this,s)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;let e=this.toObject();return Id(this.matrix,e),Ft(this,{values:e},!0)}rescale(){if(!this.isValid)return this;let e=FF(this.normalize().shiftToAll().toObject());return Ft(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(s=>t.normalizeUnit(s));let n={},i={},o=this.toObject(),r;for(let s of Kt)if(e.indexOf(s)>=0){r=s;let u=0;for(let c in i)u+=this.matrix[c][s]*i[c],i[c]=0;Zt(o[s])&&(u+=o[s]);let f=Math.trunc(u);n[s]=f,i[s]=(u*1e3-f*1e3)/1e3}else Zt(o[s])&&(i[s]=o[s]);for(let s in i)i[s]!==0&&(n[r]+=s===r?i[s]:i[s]/this.matrix[r][s]);return Id(this.matrix,n),Ft(this,{values:n},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;let e={};for(let n of Object.keys(this.values))e[n]=this.values[n]===0?0:-this.values[n];return Ft(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function n(i,o){return i===void 0||i===0?o===void 0||o===0:i===o}for(let i of Kt)if(!n(this.values[i],e.values[i]))return!1;return!0}},An="Invalid Interval";function xF(t,e){return!t||!t.isValid?bn.invalid("missing or invalid start"):!e||!e.isValid?bn.invalid("missing or invalid end"):e<t?bn.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}var bn=class t{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,n=null){if(!e)throw new we("need to specify a reason the Interval is invalid");let i=e instanceof Ie?e:new Ie(e,n);if(se.throwOnInvalid)throw new Ua(i);return new t({invalid:i})}static fromDateTimes(e,n){let i=Di(e),o=Di(n),r=xF(i,o);return r==null?new t({start:i,end:o}):r}static after(e,n){let i=G.fromDurationLike(n),o=Di(e);return t.fromDateTimes(o,o.plus(i))}static before(e,n){let i=G.fromDurationLike(n),o=Di(e);return t.fromDateTimes(o.minus(i),o)}static fromISO(e,n){let[i,o]=(e||"").split("/",2);if(i&&o){let r,s;try{r=z.fromISO(i,n),s=r.isValid}catch(c){s=!1}let u,f;try{u=z.fromISO(o,n),f=u.isValid}catch(c){f=!1}if(s&&f)return t.fromDateTimes(r,u);if(s){let c=G.fromISO(o,n);if(c.isValid)return t.after(r,c)}else if(f){let c=G.fromISO(i,n);if(c.isValid)return t.before(u,c)}}return t.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;let n=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(n,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:n}={}){return this.isValid?t.fromDateTimes(e||this.s,n||this.e):this}splitAt(...e){if(!this.isValid)return[];let n=e.map(Di).filter(s=>this.contains(s)).sort(),i=[],{s:o}=this,r=0;for(;o<this.e;){let s=n[r]||this.e,u=+s>+this.e?this.e:s;i.push(t.fromDateTimes(o,u)),o=u,r+=1}return i}splitBy(e){let n=G.fromDurationLike(e);if(!this.isValid||!n.isValid||n.as("milliseconds")===0)return[];let{s:i}=this,o=1,r,s=[];for(;i<this.e;){let u=this.start.plus(n.mapUnits(f=>f*o));r=+u>+this.e?this.e:u,s.push(t.fromDateTimes(i,r)),i=r,o+=1}return s}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;let n=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return n>=i?null:t.fromDateTimes(n,i)}union(e){if(!this.isValid)return this;let n=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return t.fromDateTimes(n,i)}static merge(e){let[n,i]=e.sort((o,r)=>o.s-r.s).reduce(([o,r],s)=>r?r.overlaps(s)||r.abutsStart(s)?[o,r.union(s)]:[o.concat([r]),s]:[o,s],[[],null]);return i&&n.push(i),n}static xor(e){let n=null,i=0,o=[],r=e.map(f=>[{time:f.s,type:"s"},{time:f.e,type:"e"}]),s=Array.prototype.concat(...r),u=s.sort((f,c)=>f.time-c.time);for(let f of u)i+=f.type==="s"?1:-1,i===1?n=f.time:(n&&+n!=+f.time&&o.push(t.fromDateTimes(n,f.time)),n=null);return t.merge(o)}difference(...e){return t.xor([this].concat(e)).map(n=>this.intersection(n)).filter(n=>n&&!n.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:An}toLocaleString(e=pr,n={}){return this.isValid?Pe.create(this.s.loc.clone(n),e).formatInterval(this):An}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:An}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:An}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:An}toFormat(e,{separator:n=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(e)}${n}${this.e.toFormat(e)}`:An}toDuration(e,n){return this.isValid?this.e.diff(this.s,e,n):G.invalid(this.invalidReason)}mapEndpoints(e){return t.fromDateTimes(e(this.s),e(this.e))}},Pn=class{static hasDST(e=se.defaultZone){let n=z.now().setZone(e).set({month:12});return!e.isUniversal&&n.offset!==n.set({month:6}).offset}static isValidIANAZone(e){return At.isValidZone(e)}static normalizeZone(e){return _t(e,se.defaultZone)}static months(e="long",{locale:n=null,numberingSystem:i=null,locObj:o=null,outputCalendar:r="gregory"}={}){return(o||ae.create(n,i,r)).months(e)}static monthsFormat(e="long",{locale:n=null,numberingSystem:i=null,locObj:o=null,outputCalendar:r="gregory"}={}){return(o||ae.create(n,i,r)).months(e,!0)}static weekdays(e="long",{locale:n=null,numberingSystem:i=null,locObj:o=null}={}){return(o||ae.create(n,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:n=null,numberingSystem:i=null,locObj:o=null}={}){return(o||ae.create(n,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return ae.create(e).meridiems()}static eras(e="short",{locale:n=null}={}){return ae.create(n,null,"gregory").eras(e)}static features(){return{relative:hp()}}};function bd(t,e){let n=o=>o.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=n(e)-n(t);return Math.floor(G.fromMillis(i).as("days"))}function _F(t,e,n){let i=[["years",(f,c)=>c.year-f.year],["quarters",(f,c)=>c.quarter-f.quarter+(c.year-f.year)*4],["months",(f,c)=>c.month-f.month+(c.year-f.year)*12],["weeks",(f,c)=>{let d=bd(f,c);return(d-d%7)/7}],["days",bd]],o={},r=t,s,u;for(let[f,c]of i)n.indexOf(f)>=0&&(s=f,o[f]=c(t,e),u=r.plus(o),u>e?(o[f]--,t=r.plus(o),t>e&&(u=t,o[f]--,t=r.plus(o))):t=u);return[t,o,u,s]}function AF(t,e,n,i){let[o,r,s,u]=_F(t,e,n),f=e-o,c=n.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(s<e&&(s=o.plus({[u]:1})),s!==o&&(r[u]=(r[u]||0)+f/(s-o)));let d=G.fromObject(r,i);return c.length>0?G.fromMillis(f,i).shiftTo(...c).plus(d):d}var ul={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},kd={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},PF=ul.hanidec.replace(/[\[|\]]/g,"").split("");function IF(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);if(t[n].search(ul.hanidec)!==-1)e+=PF.indexOf(t[n]);else for(let o in kd){let[r,s]=kd[o];i>=r&&i<=s&&(e+=i-r)}}return parseInt(e,10)}else return e}function ze({numberingSystem:t},e=""){return new RegExp(`${ul[t||"latn"]}${e}`)}var bF="missing Intl.DateTimeFormat.formatToParts support";function Z(t,e=n=>n){return{regex:t,deser:([n])=>e(IF(n))}}var kF="\xA0",kp=`[ ${kF}]`,Rp=new RegExp(kp,"g");function RF(t){return t.replace(/\./g,"\\.?").replace(Rp,kp)}function Rd(t){return t.replace(/\./g,"").replace(Rp," ").toLowerCase()}function Ye(t,e){return t===null?null:{regex:RegExp(t.map(RF).join("|")),deser:([n])=>t.findIndex(i=>Rd(n)===Rd(i))+e}}function Nd(t,e){return{regex:t,deser:([,n,i])=>wr(n,i),groups:e}}function sr(t){return{regex:t,deser:([e])=>e}}function NF(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function LF(t,e){let n=ze(e),i=ze(e,"{2}"),o=ze(e,"{3}"),r=ze(e,"{4}"),s=ze(e,"{6}"),u=ze(e,"{1,2}"),f=ze(e,"{1,3}"),c=ze(e,"{1,6}"),d=ze(e,"{1,9}"),p=ze(e,"{2,4}"),m=ze(e,"{4,6}"),h=T=>({regex:RegExp(NF(T.val)),deser:([S])=>S,literal:!0}),v=(T=>{if(t.literal)return h(T);switch(T.val){case"G":return Ye(e.eras("short"),0);case"GG":return Ye(e.eras("long"),0);case"y":return Z(c);case"yy":return Z(p,Ka);case"yyyy":return Z(r);case"yyyyy":return Z(m);case"yyyyyy":return Z(s);case"M":return Z(u);case"MM":return Z(i);case"MMM":return Ye(e.months("short",!0),1);case"MMMM":return Ye(e.months("long",!0),1);case"L":return Z(u);case"LL":return Z(i);case"LLL":return Ye(e.months("short",!1),1);case"LLLL":return Ye(e.months("long",!1),1);case"d":return Z(u);case"dd":return Z(i);case"o":return Z(f);case"ooo":return Z(o);case"HH":return Z(i);case"H":return Z(u);case"hh":return Z(i);case"h":return Z(u);case"mm":return Z(i);case"m":return Z(u);case"q":return Z(u);case"qq":return Z(i);case"s":return Z(u);case"ss":return Z(i);case"S":return Z(f);case"SSS":return Z(o);case"u":return sr(d);case"uu":return sr(u);case"uuu":return Z(n);case"a":return Ye(e.meridiems(),0);case"kkkk":return Z(r);case"kk":return Z(p,Ka);case"W":return Z(u);case"WW":return Z(i);case"E":case"c":return Z(n);case"EEE":return Ye(e.weekdays("short",!1),1);case"EEEE":return Ye(e.weekdays("long",!1),1);case"ccc":return Ye(e.weekdays("short",!0),1);case"cccc":return Ye(e.weekdays("long",!0),1);case"Z":case"ZZ":return Nd(new RegExp(`([+-]${u.source})(?::(${i.source}))?`),2);case"ZZZ":return Nd(new RegExp(`([+-]${u.source})(${i.source})?`),2);case"z":return sr(/[a-z_+-/]{1,256}?/i);case" ":return sr(/[^\S\n\r]/);default:return h(T)}})(t)||{invalidReason:bF};return v.token=t,v}var BF={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function OF(t,e,n){let{type:i,value:o}=t;if(i==="literal"){let f=/^\s+$/.test(o);return{literal:!f,val:f?" ":o}}let r=e[i],s=i;i==="hour"&&(e.hour12!=null?s=e.hour12?"hour12":"hour24":e.hourCycle!=null?e.hourCycle==="h11"||e.hourCycle==="h12"?s="hour12":s="hour24":s=n.hour12?"hour12":"hour24");let u=BF[s];if(typeof u=="object"&&(u=u[r]),u)return{literal:!1,val:u}}function UF(t){return[`^${t.map(n=>n.regex).reduce((n,i)=>`${n}(${i.source})`,"")}$`,t]}function VF(t,e,n){let i=t.match(e);if(i){let o={},r=1;for(let s in n)if(kn(n,s)){let u=n[s],f=u.groups?u.groups+1:1;!u.literal&&u.token&&(o[u.token.val[0]]=u.deser(i.slice(r,r+f))),r+=f}return[i,o]}else return[i,{}]}function GF(t){let e=r=>{switch(r){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}},n=null,i;return K(t.z)||(n=At.create(t.z)),K(t.Z)||(n||(n=new Ge(t.Z)),i=t.Z),K(t.q)||(t.M=(t.q-1)*3+1),K(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),K(t.u)||(t.S=ol(t.u)),[Object.keys(t).reduce((r,s)=>{let u=e(s);return u&&(r[u]=t[s]),r},{}),n,i]}var ba=null;function HF(){return ba||(ba=z.fromMillis(1555555555555)),ba}function qF(t,e){if(t.literal)return t;let n=Pe.macroTokenToFormatOpts(t.val),i=Bp(n,e);return i==null||i.includes(void 0)?t:i}function Np(t,e){return Array.prototype.concat(...t.map(n=>qF(n,e)))}function Lp(t,e,n){let i=Np(Pe.parseFormat(n),t),o=i.map(s=>LF(s,t)),r=o.find(s=>s.invalidReason);if(r)return{input:e,tokens:i,invalidReason:r.invalidReason};{let[s,u]=UF(o),f=RegExp(s,"i"),[c,d]=VF(e,f,u),[p,m,h]=d?GF(d):[null,null,void 0];if(kn(d,"a")&&kn(d,"H"))throw new Yt("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:f,rawMatches:c,matches:d,result:p,zone:m,specificOffset:h}}}function $F(t,e,n){let{result:i,zone:o,specificOffset:r,invalidReason:s}=Lp(t,e,n);return[i,o,r,s]}function Bp(t,e){if(!t)return null;let i=Pe.create(e,t).dtFormatter(HF()),o=i.formatToParts(),r=i.resolvedOptions();return o.map(s=>OF(s,t,r))}var Op=[0,31,59,90,120,151,181,212,243,273,304,334],Up=[0,31,60,91,121,152,182,213,244,274,305,335];function Ve(t,e){return new Ie("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function Vp(t,e,n){let i=new Date(Date.UTC(t,e-1,n));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);let o=i.getUTCDay();return o===0?7:o}function Gp(t,e,n){return n+(xi(t)?Up:Op)[e-1]}function Hp(t,e){let n=xi(t)?Up:Op,i=n.findIndex(r=>r<e),o=e-n[i];return{month:i+1,day:o}}function Za(t){let{year:e,month:n,day:i}=t,o=Gp(e,n,i),r=Vp(e,n,i),s=Math.floor((o-r+10)/7),u;return s<1?(u=e-1,s=gr(u)):s>gr(e)?(u=e+1,s=1):u=e,{weekYear:u,weekNumber:s,weekday:r,...Mr(t)}}function Ld(t){let{weekYear:e,weekNumber:n,weekday:i}=t,o=Vp(e,1,4),r=Si(e),s=n*7+i-o-3,u;s<1?(u=e-1,s+=Si(u)):s>r?(u=e+1,s-=Si(e)):u=e;let{month:f,day:c}=Hp(u,s);return{year:u,month:f,day:c,...Mr(t)}}function ka(t){let{year:e,month:n,day:i}=t,o=Gp(e,n,i);return{year:e,ordinal:o,...Mr(t)}}function Bd(t){let{year:e,ordinal:n}=t,{month:i,day:o}=Hp(e,n);return{year:e,month:i,day:o,...Mr(t)}}function WF(t){let e=Er(t.weekYear),n=yt(t.weekNumber,1,gr(t.weekYear)),i=yt(t.weekday,1,7);return e?n?i?!1:Ve("weekday",t.weekday):Ve("week",t.week):Ve("weekYear",t.weekYear)}function JF(t){let e=Er(t.year),n=yt(t.ordinal,1,Si(t.year));return e?n?!1:Ve("ordinal",t.ordinal):Ve("year",t.year)}function qp(t){let e=Er(t.year),n=yt(t.month,1,12),i=yt(t.day,1,hr(t.year,t.month));return e?n?i?!1:Ve("day",t.day):Ve("month",t.month):Ve("year",t.year)}function $p(t){let{hour:e,minute:n,second:i,millisecond:o}=t,r=yt(e,0,23)||e===24&&n===0&&i===0&&o===0,s=yt(n,0,59),u=yt(i,0,59),f=yt(o,0,999);return r?s?u?f?!1:Ve("millisecond",o):Ve("second",i):Ve("minute",n):Ve("hour",e)}var Ra="Invalid DateTime",Od=864e13;function ar(t){return new Ie("unsupported zone",`the zone "${t.name}" is not supported`)}function Na(t){return t.weekData===null&&(t.weekData=Za(t.c)),t.weekData}function zt(t,e){let n={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new z({...n,...e,old:n})}function Wp(t,e,n){let i=t-e*60*1e3,o=n.offset(i);if(e===o)return[i,e];i-=(o-e)*60*1e3;let r=n.offset(i);return o===r?[i,o]:[t-Math.min(o,r)*60*1e3,Math.max(o,r)]}function lr(t,e){t+=e*60*1e3;let n=new Date(t);return{year:n.getUTCFullYear(),month:n.getUTCMonth()+1,day:n.getUTCDate(),hour:n.getUTCHours(),minute:n.getUTCMinutes(),second:n.getUTCSeconds(),millisecond:n.getUTCMilliseconds()}}function fr(t,e,n){return Wp(Sr(t),e,n)}function Ud(t,e){let n=t.o,i=t.c.year+Math.trunc(e.years),o=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,r={...t.c,year:i,month:o,day:Math.min(t.c.day,hr(i,o))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},s=G.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),u=Sr(r),[f,c]=Wp(u,n,t.zone);return s!==0&&(f+=s,c=t.zone.offset(f)),{ts:f,o:c}}function Ci(t,e,n,i,o,r){let{setZone:s,zone:u}=n;if(t&&Object.keys(t).length!==0||e){let f=e||u,c=z.fromObject(t,{...n,zone:f,specificOffset:r});return s?c:c.setZone(u)}else return z.invalid(new Ie("unparsable",`the input "${o}" can't be parsed as ${i}`))}function ur(t,e,n=!0){return t.isValid?Pe.create(ae.create("en-US"),{allowZ:n,forceSimple:!0}).formatDateTimeFromString(t,e):null}function La(t,e){let n=t.c.year>9999||t.c.year<0,i="";return n&&t.c.year>=0&&(i+="+"),i+=pe(t.c.year,n?6:4),e?(i+="-",i+=pe(t.c.month),i+="-",i+=pe(t.c.day)):(i+=pe(t.c.month),i+=pe(t.c.day)),i}function Vd(t,e,n,i,o,r){let s=pe(t.c.hour);return e?(s+=":",s+=pe(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!n)&&(s+=":")):s+=pe(t.c.minute),(t.c.millisecond!==0||t.c.second!==0||!n)&&(s+=pe(t.c.second),(t.c.millisecond!==0||!i)&&(s+=".",s+=pe(t.c.millisecond,3))),o&&(t.isOffsetFixed&&t.offset===0&&!r?s+="Z":t.o<0?(s+="-",s+=pe(Math.trunc(-t.o/60)),s+=":",s+=pe(Math.trunc(-t.o%60))):(s+="+",s+=pe(Math.trunc(t.o/60)),s+=":",s+=pe(Math.trunc(t.o%60)))),r&&(s+="["+t.zone.ianaName+"]"),s}var Jp={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},zF={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},YF={ordinal:1,hour:0,minute:0,second:0,millisecond:0},zp=["year","month","day","hour","minute","second","millisecond"],KF=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],ZF=["year","ordinal","hour","minute","second","millisecond"];function Gd(t){let e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new dr(t);return e}function Hd(t,e){let n=_t(e.zone,se.defaultZone),i=ae.fromObject(e),o=se.now(),r,s;if(K(t.year))r=o;else{for(let c of zp)K(t[c])&&(t[c]=Jp[c]);let u=qp(t)||$p(t);if(u)return z.invalid(u);let f=n.offset(o);[r,s]=fr(t,f,n)}return new z({ts:r,zone:n,loc:i,o:s})}function qd(t,e,n){let i=K(n.round)?!0:n.round,o=(s,u)=>(s=rl(s,i||n.calendary?0:2,!0),e.loc.clone(n).relFormatter(n).format(s,u)),r=s=>n.calendary?e.hasSame(t,s)?0:e.startOf(s).diff(t.startOf(s),s).get(s):e.diff(t,s).get(s);if(n.unit)return o(r(n.unit),n.unit);for(let s of n.units){let u=r(s);if(Math.abs(u)>=1)return o(u,s)}return o(t>e?-0:0,n.units[n.units.length-1])}function $d(t){let e={},n;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],n=Array.from(t).slice(0,t.length-1)):n=Array.from(t),[e,n]}var z=class t{constructor(e){let n=e.zone||se.defaultZone,i=e.invalid||(Number.isNaN(e.ts)?new Ie("invalid input"):null)||(n.isValid?null:ar(n));this.ts=K(e.ts)?se.now():e.ts;let o=null,r=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(n))[o,r]=[e.old.c,e.old.o];else{let u=n.offset(this.ts);o=lr(this.ts,u),i=Number.isNaN(o.year)?new Ie("invalid input"):null,o=i?null:o,r=i?null:u}this._zone=n,this.loc=e.loc||ae.create(),this.invalid=i,this.weekData=null,this.c=o,this.o=r,this.isLuxonDateTime=!0}static now(){return new t({})}static local(){let[e,n]=$d(arguments),[i,o,r,s,u,f,c]=n;return Hd({year:i,month:o,day:r,hour:s,minute:u,second:f,millisecond:c},e)}static utc(){let[e,n]=$d(arguments),[i,o,r,s,u,f,c]=n;return e.zone=Ge.utcInstance,Hd({year:i,month:o,day:r,hour:s,minute:u,second:f,millisecond:c},e)}static fromJSDate(e,n={}){let i=wM(e)?e.valueOf():NaN;if(Number.isNaN(i))return t.invalid("invalid input");let o=_t(n.zone,se.defaultZone);return o.isValid?new t({ts:i,zone:o,loc:ae.fromObject(n)}):t.invalid(ar(o))}static fromMillis(e,n={}){if(Zt(e))return e<-Od||e>Od?t.invalid("Timestamp out of range"):new t({ts:e,zone:_t(n.zone,se.defaultZone),loc:ae.fromObject(n)});throw new we(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,n={}){if(Zt(e))return new t({ts:e*1e3,zone:_t(n.zone,se.defaultZone),loc:ae.fromObject(n)});throw new we("fromSeconds requires a numerical input")}static fromObject(e,n={}){e=e||{};let i=_t(n.zone,se.defaultZone);if(!i.isValid)return t.invalid(ar(i));let o=se.now(),r=K(n.specificOffset)?i.offset(o):n.specificOffset,s=yr(e,Gd),u=!K(s.ordinal),f=!K(s.year),c=!K(s.month)||!K(s.day),d=f||c,p=s.weekYear||s.weekNumber,m=ae.fromObject(n);if((d||u)&&p)throw new Yt("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&u)throw new Yt("Can't mix ordinal dates with month/day");let h=p||s.weekday&&!d,y,v,T=lr(o,r);h?(y=KF,v=zF,T=Za(T)):u?(y=ZF,v=YF,T=ka(T)):(y=zp,v=Jp);let S=!1;for(let b of y){let k=s[b];K(k)?S?s[b]=v[b]:s[b]=T[b]:S=!0}let _=h?WF(s):u?JF(s):qp(s),x=_||$p(s);if(x)return t.invalid(x);let C=h?Ld(s):u?Bd(s):s,[w,P]=fr(C,r,i),M=new t({ts:w,zone:i,o:P,loc:m});return s.weekday&&d&&e.weekday!==M.weekday?t.invalid("mismatched weekday",`you can't specify both a weekday of ${s.weekday} and a date of ${M.toISO()}`):M}static fromISO(e,n={}){let[i,o]=pF(e);return Ci(i,o,n,"ISO 8601",e)}static fromRFC2822(e,n={}){let[i,o]=mF(e);return Ci(i,o,n,"RFC 2822",e)}static fromHTTP(e,n={}){let[i,o]=hF(e);return Ci(i,o,n,"HTTP",n)}static fromFormat(e,n,i={}){if(K(e)||K(n))throw new we("fromFormat requires an input string and a format");let{locale:o=null,numberingSystem:r=null}=i,s=ae.fromOpts({locale:o,numberingSystem:r,defaultToEN:!0}),[u,f,c,d]=$F(s,e,n);return d?t.invalid(d):Ci(u,f,i,`format ${n}`,e,c)}static fromString(e,n,i={}){return t.fromFormat(e,n,i)}static fromSQL(e,n={}){let[i,o]=EF(e);return Ci(i,o,n,"SQL",e)}static invalid(e,n=null){if(!e)throw new we("need to specify a reason the DateTime is invalid");let i=e instanceof Ie?e:new Ie(e,n);if(se.throwOnInvalid)throw new Oa(i);return new t({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,n={}){let i=Bp(e,ae.fromObject(n));return i?i.map(o=>o?o.val:null).join(""):null}static expandFormat(e,n={}){return Np(Pe.parseFormat(e),ae.fromObject(n)).map(o=>o.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Na(this).weekYear:NaN}get weekNumber(){return this.isValid?Na(this).weekNumber:NaN}get weekday(){return this.isValid?Na(this).weekday:NaN}get ordinal(){return this.isValid?ka(this.c).ordinal:NaN}get monthShort(){return this.isValid?Pn.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Pn.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Pn.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?Pn.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];let e=864e5,n=6e4,i=Sr(this.c),o=this.zone.offset(i-e),r=this.zone.offset(i+e),s=this.zone.offset(i-o*n),u=this.zone.offset(i-r*n);if(s===u)return[this];let f=i-s*n,c=i-u*n,d=lr(f,s),p=lr(c,u);return d.hour===p.hour&&d.minute===p.minute&&d.second===p.second&&d.millisecond===p.millisecond?[zt(this,{ts:f}),zt(this,{ts:c})]:[this]}get isInLeapYear(){return xi(this.year)}get daysInMonth(){return hr(this.year,this.month)}get daysInYear(){return this.isValid?Si(this.year):NaN}get weeksInWeekYear(){return this.isValid?gr(this.weekYear):NaN}resolvedLocaleOptions(e={}){let{locale:n,numberingSystem:i,calendar:o}=Pe.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:n,numberingSystem:i,outputCalendar:o}}toUTC(e=0,n={}){return this.setZone(Ge.instance(e),n)}toLocal(){return this.setZone(se.defaultZone)}setZone(e,{keepLocalTime:n=!1,keepCalendarTime:i=!1}={}){if(e=_t(e,se.defaultZone),e.equals(this.zone))return this;if(e.isValid){let o=this.ts;if(n||i){let r=e.offset(this.ts),s=this.toObject();[o]=fr(s,r,e)}return zt(this,{ts:o,zone:e})}else return t.invalid(ar(e))}reconfigure({locale:e,numberingSystem:n,outputCalendar:i}={}){let o=this.loc.clone({locale:e,numberingSystem:n,outputCalendar:i});return zt(this,{loc:o})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;let n=yr(e,Gd),i=!K(n.weekYear)||!K(n.weekNumber)||!K(n.weekday),o=!K(n.ordinal),r=!K(n.year),s=!K(n.month)||!K(n.day),u=r||s,f=n.weekYear||n.weekNumber;if((u||o)&&f)throw new Yt("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(s&&o)throw new Yt("Can't mix ordinal dates with month/day");let c;i?c=Ld({...Za(this.c),...n}):K(n.ordinal)?(c={...this.toObject(),...n},K(n.day)&&(c.day=Math.min(hr(c.year,c.month),c.day))):c=Bd({...ka(this.c),...n});let[d,p]=fr(c,this.o,this.zone);return zt(this,{ts:d,o:p})}plus(e){if(!this.isValid)return this;let n=G.fromDurationLike(e);return zt(this,Ud(this,n))}minus(e){if(!this.isValid)return this;let n=G.fromDurationLike(e).negate();return zt(this,Ud(this,n))}startOf(e){if(!this.isValid)return this;let n={},i=G.normalizeUnit(e);switch(i){case"years":n.month=1;case"quarters":case"months":n.day=1;case"weeks":case"days":n.hour=0;case"hours":n.minute=0;case"minutes":n.second=0;case"seconds":n.millisecond=0;break}if(i==="weeks"&&(n.weekday=1),i==="quarters"){let o=Math.ceil(this.month/3);n.month=(o-1)*3+1}return this.set(n)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,n={}){return this.isValid?Pe.create(this.loc.redefaultToEN(n)).formatDateTimeFromString(this,e):Ra}toLocaleString(e=pr,n={}){return this.isValid?Pe.create(this.loc.clone(n),e).formatDateTime(this):Ra}toLocaleParts(e={}){return this.isValid?Pe.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:n=!1,suppressMilliseconds:i=!1,includeOffset:o=!0,extendedZone:r=!1}={}){if(!this.isValid)return null;let s=e==="extended",u=La(this,s);return u+="T",u+=Vd(this,s,n,i,o,r),u}toISODate({format:e="extended"}={}){return this.isValid?La(this,e==="extended"):null}toISOWeekDate(){return ur(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:n=!1,includeOffset:i=!0,includePrefix:o=!1,extendedZone:r=!1,format:s="extended"}={}){return this.isValid?(o?"T":"")+Vd(this,s==="extended",n,e,i,r):null}toRFC2822(){return ur(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return ur(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?La(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:n=!1,includeOffsetSpace:i=!0}={}){let o="HH:mm:ss.SSS";return(n||e)&&(i&&(o+=" "),n?o+="z":e&&(o+="ZZ")),ur(this,o,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():Ra}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};let n={...this.c};return e.includeConfig&&(n.outputCalendar=this.outputCalendar,n.numberingSystem=this.loc.numberingSystem,n.locale=this.loc.locale),n}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,n="milliseconds",i={}){if(!this.isValid||!e.isValid)return G.invalid("created by diffing an invalid DateTime");let o={locale:this.locale,numberingSystem:this.numberingSystem,...i},r=MM(n).map(G.normalizeUnit),s=e.valueOf()>this.valueOf(),u=s?this:e,f=s?e:this,c=AF(u,f,r,o);return s?c.negate():c}diffNow(e="milliseconds",n={}){return this.diff(t.now(),e,n)}until(e){return this.isValid?bn.fromDateTimes(this,e):this}hasSame(e,n){if(!this.isValid)return!1;let i=e.valueOf(),o=this.setZone(e.zone,{keepLocalTime:!0});return o.startOf(n)<=i&&i<=o.endOf(n)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;let n=e.base||t.fromObject({},{zone:this.zone}),i=e.padding?this<n?-e.padding:e.padding:0,o=["years","months","days","hours","minutes","seconds"],r=e.unit;return Array.isArray(e.unit)&&(o=e.unit,r=void 0),qd(n,this.plus(i),{...e,numeric:"always",units:o,unit:r})}toRelativeCalendar(e={}){return this.isValid?qd(e.base||t.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(t.isDateTime))throw new we("min requires all arguments be DateTimes");return xd(e,n=>n.valueOf(),Math.min)}static max(...e){if(!e.every(t.isDateTime))throw new we("max requires all arguments be DateTimes");return xd(e,n=>n.valueOf(),Math.max)}static fromFormatExplain(e,n,i={}){let{locale:o=null,numberingSystem:r=null}=i,s=ae.fromOpts({locale:o,numberingSystem:r,defaultToEN:!0});return Lp(s,e,n)}static fromStringExplain(e,n,i={}){return t.fromFormatExplain(e,n,i)}static get DATE_SHORT(){return pr}static get DATE_MED(){return Zd}static get DATE_MED_WITH_WEEKDAY(){return lM}static get DATE_FULL(){return Qd}static get DATE_HUGE(){return Xd}static get TIME_SIMPLE(){return jd}static get TIME_WITH_SECONDS(){return ep}static get TIME_WITH_SHORT_OFFSET(){return tp}static get TIME_WITH_LONG_OFFSET(){return np}static get TIME_24_SIMPLE(){return ip}static get TIME_24_WITH_SECONDS(){return op}static get TIME_24_WITH_SHORT_OFFSET(){return rp}static get TIME_24_WITH_LONG_OFFSET(){return sp}static get DATETIME_SHORT(){return ap}static get DATETIME_SHORT_WITH_SECONDS(){return lp}static get DATETIME_MED(){return up}static get DATETIME_MED_WITH_SECONDS(){return cp}static get DATETIME_MED_WITH_WEEKDAY(){return uM}static get DATETIME_FULL(){return fp}static get DATETIME_FULL_WITH_SECONDS(){return dp}static get DATETIME_HUGE(){return pp}static get DATETIME_HUGE_WITH_SECONDS(){return mp}};function Di(t){if(z.isDateTime(t))return t;if(t&&t.valueOf&&Zt(t.valueOf()))return z.fromJSDate(t);if(t&&typeof t=="object")return z.fromObject(t);throw new we(`Unknown datetime argument: ${t}, of type ${typeof t}`)}var cl={renderNullAs:"\\-",taskCompletionTracking:!1,taskCompletionUseEmojiShorthand:!1,taskCompletionText:"completion",taskCompletionDateFormat:"yyyy-MM-dd",recursiveSubTaskCompletion:!1,warnOnEmptyResult:!0,refreshEnabled:!0,refreshInterval:2500,defaultDateFormat:"MMMM dd, yyyy",defaultDateTimeFormat:"h:mm a - MMMM dd, yyyy",maxRecursiveRenderDepth:4,tableIdColumnName:"File",tableGroupColumnName:"Group",showResultCount:!0},QF={allowHtml:!0};({...cl,...QF});var Qa=class t{constructor(e){Te(this,"value");Te(this,"successful");this.value=e,this.successful=!0}map(e){return new t(e(this.value))}flatMap(e){return e(this.value)}mapErr(e){return this}bimap(e,n){return this.map(e)}orElse(e){return this.value}cast(){return this}orElseThrow(e){return this.value}},Xa=class t{constructor(e){Te(this,"error");Te(this,"successful");this.error=e,this.successful=!1}map(e){return this}flatMap(e){return this}mapErr(e){return new t(e(this.error))}bimap(e,n){return this.mapErr(n)}orElse(e){return e}cast(){return this}orElseThrow(e){throw e?new Error(e(this.error)):new Error(""+this.error)}},vr;(function(t){function e(r){return new Qa(r)}t.success=e;function n(r){return new Xa(r)}t.failure=n;function i(r,s,u){return r.successful?s.successful?u(r.value,s.value):n(s.error):n(r.error)}t.flatMap2=i;function o(r,s,u){return i(r,s,(f,c)=>e(u(f,c)))}t.map2=o})(vr||(vr={}));var XF=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Cr={exports:{}};Cr.exports;(function(t,e){(function(n,i){t.exports=i()})(typeof self!="undefined"?self:XF,function(){return function(n){var i={};function o(r){if(i[r])return i[r].exports;var s=i[r]={i:r,l:!1,exports:{}};return n[r].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=n,o.c=i,o.d=function(r,s,u){o.o(r,s)||Object.defineProperty(r,s,{configurable:!1,enumerable:!0,get:u})},o.r=function(r){Object.defineProperty(r,"__esModule",{value:!0})},o.n=function(r){var s=r&&r.__esModule?function(){return r.default}:function(){return r};return o.d(s,"a",s),s},o.o=function(r,s){return Object.prototype.hasOwnProperty.call(r,s)},o.p="",o(o.s=0)}([function(n,i,o){function r(g){if(!(this instanceof r))return new r(g);this._=g}var s=r.prototype;function u(g,E){for(var F=0;F<g;F++)E(F)}function f(g,E,F){return function(A,I){u(I.length,function(R){A(I[R],R,I)})}(function(A,I,R){E=g(E,A,I,R)},F),E}function c(g,E){return f(function(F,A,I,R){return F.concat([g(A,I,R)])},[],E)}function d(g,E){var F={v:0,buf:E};return u(g,function(){var A;F={v:F.v<<1|(A=F.buf,A[0]>>7),buf:function(I){var R=f(function(N,q,j,De){return N.concat(j===De.length-1?Buffer.from([q,0]).readUInt16BE(0):De.readUInt16BE(j))},[],I);return Buffer.from(c(function(N){return(N<<1&65535)>>8},R))}(F.buf)}}),F}function p(){return typeof Buffer!="undefined"}function m(){if(!p())throw new Error("Buffer global does not exist; please use webpack if you need to parse Buffers in the browser.")}function h(g){m();var E=f(function(R,N){return R+N},0,g);if(E%8!=0)throw new Error("The bits ["+g.join(", ")+"] add up to "+E+" which is not an even number of bytes; the total should be divisible by 8");var F,A=E/8,I=(F=function(R){return R>48},f(function(R,N){return R||(F(N)?N:R)},null,g));if(I)throw new Error(I+" bit range requested exceeds 48 bit (6 byte) Number max.");return new r(function(R,N){var q=A+N;return q>R.length?b(N,A.toString()+" bytes"):M(q,f(function(j,De){var ge=d(De,j.buf);return{coll:j.coll.concat(ge.v),buf:ge.buf}},{coll:[],buf:R.slice(N,q)},g).coll)})}function y(g,E){return new r(function(F,A){return m(),A+E>F.length?b(A,E+" bytes for "+g):M(A+E,F.slice(A,A+E))})}function v(g,E){if(typeof(F=E)!="number"||Math.floor(F)!==F||E<0||E>6)throw new Error(g+" requires integer length in range [0, 6].");var F}function T(g){return v("uintBE",g),y("uintBE("+g+")",g).map(function(E){return E.readUIntBE(0,g)})}function S(g){return v("uintLE",g),y("uintLE("+g+")",g).map(function(E){return E.readUIntLE(0,g)})}function _(g){return v("intBE",g),y("intBE("+g+")",g).map(function(E){return E.readIntBE(0,g)})}function x(g){return v("intLE",g),y("intLE("+g+")",g).map(function(E){return E.readIntLE(0,g)})}function C(g){return g instanceof r}function w(g){return{}.toString.call(g)==="[object Array]"}function P(g){return p()&&Buffer.isBuffer(g)}function M(g,E){return{status:!0,index:g,value:E,furthest:-1,expected:[]}}function b(g,E){return w(E)||(E=[E]),{status:!1,index:-1,value:null,furthest:g,expected:E}}function k(g,E){if(!E||g.furthest>E.furthest)return g;var F=g.furthest===E.furthest?function(A,I){if(function(){if(r._supportsSet!==void 0)return r._supportsSet;var lt=typeof Set!="undefined";return r._supportsSet=lt,lt}()&&Array.from){for(var R=new Set(A),N=0;N<I.length;N++)R.add(I[N]);var q=Array.from(R);return q.sort(),q}for(var j={},De=0;De<A.length;De++)j[A[De]]=!0;for(var ge=0;ge<I.length;ge++)j[I[ge]]=!0;var at=[];for(var Me in j)({}).hasOwnProperty.call(j,Me)&&at.push(Me);return at.sort(),at}(g.expected,E.expected):E.expected;return{status:g.status,index:g.index,value:g.value,furthest:E.furthest,expected:F}}var L={};function O(g,E){if(P(g))return{offset:E,line:-1,column:-1};g in L||(L[g]={});for(var F=L[g],A=0,I=0,R=0,N=E;N>=0;){if(N in F){A=F[N].line,R===0&&(R=F[N].lineStart);break}(g.charAt(N)===`
`||g.charAt(N)==="\r"&&g.charAt(N+1)!==`
`)&&(I++,R===0&&(R=N+1)),N--}var q=A+I,j=E-R;return F[E]={line:q,lineStart:R},{offset:E,line:q+1,column:j+1}}function $(g){if(!C(g))throw new Error("not a parser: "+g)}function le(g,E){return typeof g=="string"?g.charAt(E):g[E]}function ue(g){if(typeof g!="number")throw new Error("not a number: "+g)}function ne(g){if(typeof g!="function")throw new Error("not a function: "+g)}function ie(g){if(typeof g!="string")throw new Error("not a string: "+g)}var qn=2,Ri=3,qe=8,$n=5*qe,Ni=4*qe,Wn="  ";function Se(g,E){return new Array(E+1).join(g)}function Qe(g,E,F){var A=E-g.length;return A<=0?g:Se(F,A)+g}function xl(g,E,F,A){return{from:g-E>0?g-E:0,to:g+F>A?A:g+F}}function mm(g,E){var F,A,I,R,N,q=E.index,j=q.offset,De=1;if(j===g.length)return"Got the end of the input";if(P(g)){var ge=j-j%qe,at=j-ge,Me=xl(ge,$n,Ni+qe,g.length),lt=c(function(me){return c(function(en){return Qe(en.toString(16),2,"0")},me)},function(me,en){var tn=me.length,kt=[],nn=0;if(tn<=en)return[me.slice()];for(var on=0;on<tn;on++)kt[nn]||kt.push([]),kt[nn].push(me[on]),(on+1)%en==0&&nn++;return kt}(g.slice(Me.from,Me.to).toJSON().data,qe));R=function(me){return me.from===0&&me.to===1?{from:me.from,to:me.to}:{from:me.from/qe,to:Math.floor(me.to/qe)}}(Me),A=ge/qe,F=3*at,at>=4&&(F+=1),De=2,I=c(function(me){return me.length<=4?me.join(" "):me.slice(0,4).join(" ")+"  "+me.slice(4).join(" ")},lt),(N=(8*(R.to>0?R.to-1:R.to)).toString(16).length)<2&&(N=2)}else{var jt=g.split(/\r\n|[\n\r\u2028\u2029]/);F=q.column-1,A=q.line-1,R=xl(A,qn,Ri,jt.length),I=jt.slice(R.from,R.to),N=R.to.toString().length}var wm=A-R.from;return P(g)&&(N=(8*(R.to>0?R.to-1:R.to)).toString(16).length)<2&&(N=2),f(function(me,en,tn){var kt,nn=tn===wm,on=nn?"> ":Wn;return kt=P(g)?Qe((8*(R.from+tn)).toString(16),N,"0"):Qe((R.from+tn+1).toString(),N," "),[].concat(me,[on+kt+" | "+en],nn?[Wn+Se(" ",N)+" | "+Qe("",F," ")+Se("^",De)]:[])},[],I).join(`
`)}function _l(g,E){return[`
`,"-- PARSING FAILED "+Se("-",50),`

`,mm(g,E),`

`,(F=E.expected,F.length===1?`Expected:

`+F[0]:`Expected one of the following: 

`+F.join(", ")),`
`].join("");var F}function Al(g){return g.flags!==void 0?g.flags:[g.global?"g":"",g.ignoreCase?"i":"",g.multiline?"m":"",g.unicode?"u":"",g.sticky?"y":""].join("")}function Li(){for(var g=[].slice.call(arguments),E=g.length,F=0;F<E;F+=1)$(g[F]);return r(function(A,I){for(var R,N=new Array(E),q=0;q<E;q+=1){if(!(R=k(g[q]._(A,I),R)).status)return R;N[q]=R.value,I=R.index}return k(M(I,N),R)})}function It(){var g=[].slice.call(arguments);if(g.length===0)throw new Error("seqMap needs at least one argument");var E=g.pop();return ne(E),Li.apply(null,g).map(function(F){return E.apply(null,F)})}function Bi(){var g=[].slice.call(arguments),E=g.length;if(E===0)return Oi("zero alternates");for(var F=0;F<E;F+=1)$(g[F]);return r(function(A,I){for(var R,N=0;N<g.length;N+=1)if((R=k(g[N]._(A,I),R)).status)return R;return R})}function Pl(g,E){return Gr(g,E).or(bt([]))}function Gr(g,E){return $(g),$(E),It(g,E.then(g).many(),function(F,A){return[F].concat(A)})}function Jn(g){ie(g);var E="'"+g+"'";return r(function(F,A){var I=A+g.length,R=F.slice(A,I);return R===g?M(I,R):b(A,E)})}function st(g,E){(function(I){if(!(I instanceof RegExp))throw new Error("not a regexp: "+I);for(var R=Al(I),N=0;N<R.length;N++){var q=R.charAt(N);if(q!=="i"&&q!=="m"&&q!=="u"&&q!=="s")throw new Error('unsupported regexp flag "'+q+'": '+I)}})(g),arguments.length>=2?ue(E):E=0;var F=function(I){return RegExp("^(?:"+I.source+")",Al(I))}(g),A=""+g;return r(function(I,R){var N=F.exec(I.slice(R));if(N){if(0<=E&&E<=N.length){var q=N[0],j=N[E];return M(R+q.length,j)}return b(R,"valid match group (0 to "+N.length+") in "+A)}return b(R,A)})}function bt(g){return r(function(E,F){return M(F,g)})}function Oi(g){return r(function(E,F){return b(F,g)})}function Ui(g){if(C(g))return r(function(E,F){var A=g._(E,F);return A.index=F,A.value="",A});if(typeof g=="string")return Ui(Jn(g));if(g instanceof RegExp)return Ui(st(g));throw new Error("not a string, regexp, or parser: "+g)}function Il(g){return $(g),r(function(E,F){var A=g._(E,F),I=E.slice(F,A.index);return A.status?b(F,'not "'+I+'"'):M(F,null)})}function Vi(g){return ne(g),r(function(E,F){var A=le(E,F);return F<E.length&&g(A)?M(F+1,A):b(F,"a character/byte matching "+g)})}function bl(g,E){arguments.length<2&&(E=g,g=void 0);var F=r(function(A,I){return F._=E()._,F._(A,I)});return g?F.desc(g):F}function Hr(){return Oi("fantasy-land/empty")}s.parse=function(g){if(typeof g!="string"&&!P(g))throw new Error(".parse must be called with a string or Buffer as its argument");var E,F=this.skip(qr)._(g,0);return E=F.status?{status:!0,value:F.value}:{status:!1,index:O(g,F.furthest),expected:F.expected},delete L[g],E},s.tryParse=function(g){var E=this.parse(g);if(E.status)return E.value;var F=_l(g,E),A=new Error(F);throw A.type="ParsimmonError",A.result=E,A},s.assert=function(g,E){return this.chain(function(F){return g(F)?bt(F):Oi(E)})},s.or=function(g){return Bi(this,g)},s.trim=function(g){return this.wrap(g,g)},s.wrap=function(g,E){return It(g,this,E,function(F,A){return A})},s.thru=function(g){return g(this)},s.then=function(g){return $(g),Li(this,g).map(function(E){return E[1]})},s.many=function(){var g=this;return r(function(E,F){for(var A=[],I=void 0;;){if(!(I=k(g._(E,F),I)).status)return k(M(F,A),I);if(F===I.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");F=I.index,A.push(I.value)}})},s.tieWith=function(g){return ie(g),this.map(function(E){if(function(I){if(!w(I))throw new Error("not an array: "+I)}(E),E.length){ie(E[0]);for(var F=E[0],A=1;A<E.length;A++)ie(E[A]),F+=g+E[A];return F}return""})},s.tie=function(){return this.tieWith("")},s.times=function(g,E){var F=this;return arguments.length<2&&(E=g),ue(g),ue(E),r(function(A,I){for(var R=[],N=void 0,q=void 0,j=0;j<g;j+=1){if(q=k(N=F._(A,I),q),!N.status)return q;I=N.index,R.push(N.value)}for(;j<E&&(q=k(N=F._(A,I),q),N.status);j+=1)I=N.index,R.push(N.value);return k(M(I,R),q)})},s.result=function(g){return this.map(function(){return g})},s.atMost=function(g){return this.times(0,g)},s.atLeast=function(g){return It(this.times(g),this.many(),function(E,F){return E.concat(F)})},s.map=function(g){ne(g);var E=this;return r(function(F,A){var I=E._(F,A);return I.status?k(M(I.index,g(I.value)),I):I})},s.contramap=function(g){ne(g);var E=this;return r(function(F,A){var I=E.parse(g(F.slice(A)));return I.status?M(A+F.length,I.value):I})},s.promap=function(g,E){return ne(g),ne(E),this.contramap(g).map(E)},s.skip=function(g){return Li(this,g).map(function(E){return E[0]})},s.mark=function(){return It(zn,this,zn,function(g,E,F){return{start:g,value:E,end:F}})},s.node=function(g){return It(zn,this,zn,function(E,F,A){return{name:g,value:F,start:E,end:A}})},s.sepBy=function(g){return Pl(this,g)},s.sepBy1=function(g){return Gr(this,g)},s.lookahead=function(g){return this.skip(Ui(g))},s.notFollowedBy=function(g){return this.skip(Il(g))},s.desc=function(g){w(g)||(g=[g]);var E=this;return r(function(F,A){var I=E._(F,A);return I.status||(I.expected=g),I})},s.fallback=function(g){return this.or(bt(g))},s.ap=function(g){return It(g,this,function(E,F){return E(F)})},s.chain=function(g){var E=this;return r(function(F,A){var I=E._(F,A);return I.status?k(g(I.value)._(F,I.index),I):I})},s.concat=s.or,s.empty=Hr,s.of=bt,s["fantasy-land/ap"]=s.ap,s["fantasy-land/chain"]=s.chain,s["fantasy-land/concat"]=s.concat,s["fantasy-land/empty"]=s.empty,s["fantasy-land/of"]=s.of,s["fantasy-land/map"]=s.map;var zn=r(function(g,E){return M(E,O(g,E))}),hm=r(function(g,E){return E>=g.length?b(E,"any character/byte"):M(E+1,le(g,E))}),gm=r(function(g,E){return M(g.length,g.slice(E))}),qr=r(function(g,E){return E<g.length?b(E,"EOF"):M(E,null)}),ym=st(/[0-9]/).desc("a digit"),vm=st(/[0-9]*/).desc("optional digits"),Cm=st(/[a-z]/i).desc("a letter"),Dm=st(/[a-z]*/i).desc("optional letters"),Tm=st(/\s*/).desc("optional whitespace"),Em=st(/\s+/).desc("whitespace"),kl=Jn("\r"),Rl=Jn(`
`),Nl=Jn(`\r
`),Ll=Bi(Nl,Rl,kl).desc("newline"),Sm=Bi(Ll,qr);r.all=gm,r.alt=Bi,r.any=hm,r.cr=kl,r.createLanguage=function(g){var E={};for(var F in g)({}).hasOwnProperty.call(g,F)&&function(A){E[A]=bl(function(){return g[A](E)})}(F);return E},r.crlf=Nl,r.custom=function(g){return r(g(M,b))},r.digit=ym,r.digits=vm,r.empty=Hr,r.end=Sm,r.eof=qr,r.fail=Oi,r.formatError=_l,r.index=zn,r.isParser=C,r.lazy=bl,r.letter=Cm,r.letters=Dm,r.lf=Rl,r.lookahead=Ui,r.makeFailure=b,r.makeSuccess=M,r.newline=Ll,r.noneOf=function(g){return Vi(function(E){return g.indexOf(E)<0}).desc("none of '"+g+"'")},r.notFollowedBy=Il,r.of=bt,r.oneOf=function(g){for(var E=g.split(""),F=0;F<E.length;F++)E[F]="'"+E[F]+"'";return Vi(function(A){return g.indexOf(A)>=0}).desc(E)},r.optWhitespace=Tm,r.Parser=r,r.range=function(g,E){return Vi(function(F){return g<=F&&F<=E}).desc(g+"-"+E)},r.regex=st,r.regexp=st,r.sepBy=Pl,r.sepBy1=Gr,r.seq=Li,r.seqMap=It,r.seqObj=function(){for(var g,E={},F=0,A=(g=arguments,Array.prototype.slice.call(g)),I=A.length,R=0;R<I;R+=1){var N=A[R];if(!C(N)){if(w(N)&&N.length===2&&typeof N[0]=="string"&&C(N[1])){var q=N[0];if(Object.prototype.hasOwnProperty.call(E,q))throw new Error("seqObj: duplicate key "+q);E[q]=!0,F++;continue}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(F===0)throw new Error("seqObj expects at least one named parser, found zero");return r(function(j,De){for(var ge,at={},Me=0;Me<I;Me+=1){var lt,jt;if(w(A[Me])?(lt=A[Me][0],jt=A[Me][1]):(lt=null,jt=A[Me]),!(ge=k(jt._(j,De),ge)).status)return ge;lt&&(at[lt]=ge.value),De=ge.index}return k(M(De,at),ge)})},r.string=Jn,r.succeed=bt,r.takeWhile=function(g){return ne(g),r(function(E,F){for(var A=F;A<E.length&&g(le(E,A));)A++;return M(A,E.slice(F,A))})},r.test=Vi,r.whitespace=Em,r["fantasy-land/empty"]=Hr,r["fantasy-land/of"]=bt,r.Binary={bitSeq:h,bitSeqObj:function(g){m();var E={},F=0,A=c(function(R){if(w(R)){var N=R;if(N.length!==2)throw new Error("["+N.join(", ")+"] should be length 2, got length "+N.length);if(ie(N[0]),ue(N[1]),Object.prototype.hasOwnProperty.call(E,N[0]))throw new Error("duplicate key in bitSeqObj: "+N[0]);return E[N[0]]=!0,F++,N}return ue(R),[null,R]},g);if(F<1)throw new Error("bitSeqObj expects at least one named pair, got ["+g.join(", ")+"]");var I=c(function(R){return R[0]},A);return h(c(function(R){return R[1]},A)).map(function(R){return f(function(N,q){return q[0]!==null&&(N[q[0]]=q[1]),N},{},c(function(N,q){return[N,R[q]]},I))})},byte:function(g){if(m(),ue(g),g>255)throw new Error("Value specified to byte constructor ("+g+"=0x"+g.toString(16)+") is larger in value than a single byte.");var E=(g>15?"0x":"0x0")+g.toString(16);return r(function(F,A){var I=le(F,A);return I===g?M(A+1,I):b(A,E)})},buffer:function(g){return y("buffer",g).map(function(E){return Buffer.from(E)})},encodedString:function(g,E){return y("string",E).map(function(F){return F.toString(g)})},uintBE:T,uint8BE:T(1),uint16BE:T(2),uint32BE:T(4),uintLE:S,uint8LE:S(1),uint16LE:S(2),uint32LE:S(4),intBE:_,int8BE:_(1),int16BE:_(2),int32BE:_(4),intLE:x,int8LE:x(1),int16LE:x(2),int32LE:x(4),floatBE:y("floatBE",4).map(function(g){return g.readFloatBE(0)}),floatLE:y("floatLE",4).map(function(g){return g.readFloatLE(0)}),doubleBE:y("doubleBE",8).map(function(g){return g.readDoubleBE(0)}),doubleLE:y("doubleLE",8).map(function(g){return g.readDoubleLE(0)})},n.exports=r}])})})(Cr,Cr.exports);var D=Cr.exports,fl=()=>/[#*0-9]\uFE0F?\u20E3|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26AA\u26B0\u26B1\u26BD\u26BE\u26C4\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0-\u26F5\u26F7\u26F8\u26FA\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B55\u3030\u303D\u3297\u3299]\uFE0F?|[\u261D\u270C\u270D](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\u270A\u270B](?:\uD83C[\uDFFB-\uDFFF])?|[\u23E9-\u23EC\u23F0\u23F3\u25FD\u2693\u26A1\u26AB\u26C5\u26CE\u26D4\u26EA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2795-\u2797\u27B0\u27BF\u2B50]|\u26F9(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\u2764\uFE0F?(?:\u200D(?:\uD83D\uDD25|\uD83E\uDE79))?|\uD83C(?:[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37\uDF21\uDF24-\uDF2C\uDF36\uDF7D\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFCD\uDFCE\uDFD4-\uDFDF\uDFF5\uDFF7]\uFE0F?|[\uDF85\uDFC2\uDFC7](?:\uD83C[\uDFFB-\uDFFF])?|[\uDFC3\uDFC4\uDFCA](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDFCB\uDFCC](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDCCF\uDD8E\uDD91-\uDD9A\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF84\uDF86-\uDF93\uDFA0-\uDFC1\uDFC5\uDFC6\uDFC8\uDFC9\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF8-\uDFFF]|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|\uDFF3\uFE0F?(?:\u200D(?:\u26A7\uFE0F?|\uD83C\uDF08))?|\uDFF4(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDC73\uDB40\uDC63\uDB40\uDC74|\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F)?)|\uD83D(?:[\uDC08\uDC26](?:\u200D\u2B1B)?|[\uDC3F\uDCFD\uDD49\uDD4A\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3]\uFE0F?|[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD74\uDD90](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\uDC00-\uDC07\uDC09-\uDC14\uDC16-\uDC25\uDC27-\uDC3A\uDC3C-\uDC3E\uDC40\uDC44\uDC45\uDC51-\uDC65\uDC6A\uDC79-\uDC7B\uDC7D-\uDC80\uDC84\uDC88-\uDC8E\uDC90\uDC92-\uDCA9\uDCAB-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDDA4\uDDFB-\uDE2D\uDE2F-\uDE34\uDE37-\uDE44\uDE48-\uDE4A\uDE80-\uDEA2\uDEA4-\uDEB3\uDEB7-\uDEBF\uDEC1-\uDEC5\uDED0-\uDED2\uDED5-\uDED7\uDEDC-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uDC15(?:\u200D\uD83E\uDDBA)?|\uDC3B(?:\u200D\u2744\uFE0F?)?|\uDC41\uFE0F?(?:\u200D\uD83D\uDDE8\uFE0F?)?|\uDC68(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDC68\uDC69]\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE])))?))?|\uDC69(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?[\uDC68\uDC69]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?))|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFE])))?))?|\uDC6F(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDD75(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDE2E(?:\u200D\uD83D\uDCA8)?|\uDE35(?:\u200D\uD83D\uDCAB)?|\uDE36(?:\u200D\uD83C\uDF2B\uFE0F?)?)|\uD83E(?:[\uDD0C\uDD0F\uDD18-\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2\uDDD3\uDDD5\uDEC3-\uDEC5\uDEF0\uDEF2-\uDEF8](?:\uD83C[\uDFFB-\uDFFF])?|[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD4\uDDD6-\uDDDD](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDDDE\uDDDF](?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD0D\uDD0E\uDD10-\uDD17\uDD20-\uDD25\uDD27-\uDD2F\uDD3A\uDD3F-\uDD45\uDD47-\uDD76\uDD78-\uDDB4\uDDB7\uDDBA\uDDBC-\uDDCC\uDDD0\uDDE0-\uDDFF\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC2\uDECE-\uDEDB\uDEE0-\uDEE8]|\uDD3C(?:\u200D[\u2640\u2642]\uFE0F?|\uD83C[\uDFFB-\uDFFF])?|\uDDD1(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFC-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFD-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFD\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFE]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?))?|\uDEF1(?:\uD83C(?:\uDFFB(?:\u200D\uD83E\uDEF2\uD83C[\uDFFC-\uDFFF])?|\uDFFC(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFD-\uDFFF])?|\uDFFD(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])?|\uDFFE(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFD\uDFFF])?|\uDFFF(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFE])?))?)/g;function Yp(t){return t==null?t:t.shiftToAll().normalize()}function Wd(t){return t.includes("/")&&(t=t.substring(t.lastIndexOf("/")+1)),t.endsWith(".md")&&(t=t.substring(0,t.length-3)),t}D.alt(D.regex(new RegExp(fl(),"")),D.regex(/[0-9\p{Letter}_-]+/u).map(t=>t.toLocaleLowerCase()),D.whitespace.map(t=>"-"),D.any.map(t=>"")).many().map(t=>t.join(""));var jF=D.alt(D.regex(new RegExp(fl(),"")),D.regex(/[0-9\p{Letter}_-]+/u),D.whitespace.map(t=>" "),D.any.map(t=>" ")).many().map(t=>t.join("").split(/\s+/).join(" ").trim());function ex(t){return jF.tryParse(t)}function tx(t){return t=Yp(t),t=G.fromObject(Object.fromEntries(Object.entries(t.toObject()).filter(([,e])=>e!=0))),t.toHuman()}var Mi;(function(t){function e(C,w=cl,P=!1){let M=n(C);if(!M)return w.renderNullAs;switch(M.type){case"null":return w.renderNullAs;case"string":return M.value;case"number":case"boolean":return""+M.value;case"html":return M.value.outerHTML;case"widget":return M.value.markdown();case"link":return M.value.markdown();case"function":return"<function>";case"array":let b="";return P&&(b+="["),b+=M.value.map(k=>e(k,w,!0)).join(", "),P&&(b+="]"),b;case"object":return"{ "+Object.entries(M.value).map(k=>k[0]+": "+e(k[1],w,!0)).join(", ")+" }";case"date":return M.value.second==0&&M.value.hour==0&&M.value.minute==0?M.value.toFormat(w.defaultDateFormat):M.value.toFormat(w.defaultDateTimeFormat);case"duration":return tx(M.value)}}t.toString=e;function n(C){return m(C)?{type:"null",value:C}:c(C)?{type:"number",value:C}:f(C)?{type:"string",value:C}:y(C)?{type:"boolean",value:C}:p(C)?{type:"duration",value:C}:d(C)?{type:"date",value:C}:T(C)?{type:"widget",value:C}:h(C)?{type:"array",value:C}:v(C)?{type:"link",value:C}:x(C)?{type:"function",value:C}:S(C)?{type:"html",value:C}:_(C)?{type:"object",value:C}:void 0}t.wrapValue=n;function i(C,w){if(_(C)){let P={};for(let[M,b]of Object.entries(C))P[M]=i(b,w);return P}else if(h(C)){let P=[];for(let M of C)P.push(i(M,w));return P}else return w(C)}t.mapLeaves=i;function o(C,w,P){var k,L;if(C===void 0&&(C=null),w===void 0&&(w=null),C===null&&w===null)return 0;if(C===null)return-1;if(w===null)return 1;let M=n(C),b=n(w);if(M===void 0&&b===void 0)return 0;if(M===void 0)return-1;if(b===void 0)return 1;if(M.type!=b.type)return M.type.localeCompare(b.type);if(M.value===b.value)return 0;switch(M.type){case"string":return M.value.localeCompare(b.value);case"number":return M.value<b.value?-1:M.value==b.value?0:1;case"null":return 0;case"boolean":return M.value==b.value?0:M.value?1:-1;case"link":let O=M.value,$=b.value,le=P!=null?P:Se=>Se,ue=le(O.path).localeCompare(le($.path));if(ue!=0)return ue;let ne=O.type.localeCompare($.type);return ne!=0?ne:O.subpath&&!$.subpath?1:!O.subpath&&$.subpath?-1:!O.subpath&&!$.subpath?0:((k=O.subpath)!=null?k:"").localeCompare((L=$.subpath)!=null?L:"");case"date":return M.value<b.value?-1:M.value.equals(b.value)?0:1;case"duration":return M.value<b.value?-1:M.value.equals(b.value)?0:1;case"array":let ie=M.value,qn=b.value;for(let Se=0;Se<Math.min(ie.length,qn.length);Se++){let Qe=o(ie[Se],qn[Se]);if(Qe!=0)return Qe}return ie.length-qn.length;case"object":let Ri=M.value,qe=b.value,$n=Array.from(Object.keys(Ri)),Ni=Array.from(Object.keys(qe));$n.sort(),Ni.sort();let Wn=o($n,Ni);if(Wn!=0)return Wn;for(let Se of $n){let Qe=o(Ri[Se],qe[Se]);if(Qe!=0)return Qe}return 0;case"widget":case"html":case"function":return 0}}t.compareValue=o;function r(C){var w;return(w=n(C))==null?void 0:w.type}t.typeOf=r;function s(C){let w=n(C);if(!w)return!1;switch(w.type){case"number":return w.value!=0;case"string":return w.value.length>0;case"boolean":return w.value;case"link":return!!w.value.path;case"date":return w.value.toMillis()!=0;case"duration":return w.value.as("seconds")!=0;case"object":return Object.keys(w.value).length>0;case"array":return w.value.length>0;case"null":return!1;case"html":case"widget":case"function":return!0}}t.isTruthy=s;function u(C){if(C==null)return C;if(t.isArray(C))return[].concat(C.map(w=>u(w)));if(t.isObject(C)){let w={};for(let[P,M]of Object.entries(C))w[P]=u(M);return w}else return C}t.deepCopy=u;function f(C){return typeof C=="string"}t.isString=f;function c(C){return typeof C=="number"}t.isNumber=c;function d(C){return C instanceof z}t.isDate=d;function p(C){return C instanceof G}t.isDuration=p;function m(C){return C==null}t.isNull=m;function h(C){return Array.isArray(C)}t.isArray=h;function y(C){return typeof C=="boolean"}t.isBoolean=y;function v(C){return C instanceof Dr}t.isLink=v;function T(C){return C instanceof Fi}t.isWidget=T;function S(C){return typeof HTMLElement!="undefined"?C instanceof HTMLElement:!1}t.isHtml=S;function _(C){return typeof C=="object"&&!S(C)&&!T(C)&&!h(C)&&!p(C)&&!d(C)&&!v(C)&&C!==void 0&&!m(C)}t.isObject=_;function x(C){return typeof C=="function"}t.isFunction=x})(Mi||(Mi={}));var Jd;(function(t){function e(o){return Mi.isObject(o)&&Object.keys(o).length==2&&"key"in o&&"rows"in o}t.isElementGroup=e;function n(o){for(let r of o)if(!e(r))return!1;return!0}t.isGrouping=n;function i(o){if(n(o)){let r=0;for(let s of o)r+=i(s.rows);return r}else return o.length}t.count=i})(Jd||(Jd={}));var Dr=class t{constructor(e){Te(this,"path");Te(this,"display");Te(this,"subpath");Te(this,"embed");Te(this,"type");Object.assign(this,e)}static file(e,n=!1,i){return new t({path:e,embed:n,display:i,subpath:void 0,type:"file"})}static infer(e,n=!1,i){if(e.includes("#^")){let o=e.split("#^");return t.block(o[0],o[1],n,i)}else if(e.includes("#")){let o=e.split("#");return t.header(o[0],o[1],n,i)}else return t.file(e,n,i)}static header(e,n,i,o){return new t({path:e,embed:i,display:o,subpath:ex(n),type:"header"})}static block(e,n,i,o){return new t({path:e,embed:i,display:o,subpath:n,type:"block"})}static fromObject(e){return new t(e)}equals(e){return e==null||e==null?!1:this.path==e.path&&this.type==e.type&&this.subpath==e.subpath}toString(){return this.markdown()}toObject(){return{path:this.path,type:this.type,subpath:this.subpath,display:this.display,embed:this.embed}}withPath(e){return new t(Object.assign({},this,{path:e}))}withDisplay(e){return new t(Object.assign({},this,{display:e}))}withHeader(e){return t.header(this.path,e,this.embed,this.display)}toFile(){return t.file(this.path,this.embed,this.display)}toEmbed(){if(this.embed)return this;{let e=new t(this);return e.embed=!0,e}}fromEmbed(){if(this.embed){let e=new t(this);return e.embed=!1,e}else return this}markdown(){let e=(this.embed?"!":"")+"[["+this.obsidianLink();return this.display?e+="|"+this.display:(e+="|"+Wd(this.path),(this.type=="header"||this.type=="block")&&(e+=" > "+this.subpath)),e+="]]",e}obsidianLink(){var n,i;let e=this.path.replaceAll("|","\\|");return this.type=="header"?e+"#"+((n=this.subpath)==null?void 0:n.replaceAll("|","\\|")):this.type=="block"?e+"#^"+((i=this.subpath)==null?void 0:i.replaceAll("|","\\|")):e}fileName(){return Wd(this.path).replace(".md","")}},Fi=class{constructor(e){Te(this,"$widget");this.$widget=e}},ja=class extends Fi{constructor(n,i){super("dataview:list-pair");Te(this,"key");Te(this,"value");this.key=n,this.value=i}markdown(){return`${Mi.toString(this.key)}: ${Mi.toString(this.value)}`}},el=class extends Fi{constructor(n,i){super("dataview:external-link");Te(this,"url");Te(this,"display");this.url=n,this.display=i}markdown(){var n;return`[${(n=this.display)!=null?n:this.url}](${this.url})`}},zd;(function(t){function e(s,u){return new ja(s,u)}t.listPair=e;function n(s,u){return new el(s,u)}t.externalLink=n;function i(s){return s.$widget==="dataview:list-pair"}t.isListPair=i;function o(s){return s.$widget==="dataview:external-link"}t.isExternalLink=o;function r(s){return i(s)||o(s)}t.isBuiltin=r})(zd||(zd={}));var re;(function(t){function e(m){return{type:"variable",name:m}}t.variable=e;function n(m){return{type:"literal",value:m}}t.literal=n;function i(m,h,y){return{type:"binaryop",left:m,op:h,right:y}}t.binaryOp=i;function o(m,h){return{type:"index",object:m,index:h}}t.index=o;function r(m){let h=m.split("."),y=t.variable(h[0]);for(let v=1;v<h.length;v++)y=t.index(y,t.literal(h[v]));return y}t.indexVariable=r;function s(m,h){return{type:"lambda",arguments:m,value:h}}t.lambda=s;function u(m,h){return{type:"function",func:m,arguments:h}}t.func=u;function f(m){return{type:"list",values:m}}t.list=f;function c(m){return{type:"object",values:m}}t.object=c;function d(m){return{type:"negated",child:m}}t.negate=d;function p(m){return m=="<="||m=="<"||m==">"||m==">="||m=="!="||m=="="}t.isCompareOp=p,t.NULL=t.literal(null)})(re||(re={}));var nt;(function(t){function e(d){return{type:"tag",tag:d}}t.tag=e;function n(d){return{type:"csv",path:d}}t.csv=n;function i(d){return{type:"folder",folder:d}}t.folder=i;function o(d,p){return{type:"link",file:d,direction:p?"incoming":"outgoing"}}t.link=o;function r(d,p,m){return{type:"binaryop",left:d,op:p,right:m}}t.binaryOp=r;function s(d,p){return{type:"binaryop",left:d,op:"&",right:p}}t.and=s;function u(d,p){return{type:"binaryop",left:d,op:"|",right:p}}t.or=u;function f(d){return{type:"negate",child:d}}t.negate=f;function c(){return{type:"empty"}}t.empty=c})(nt||(nt={}));var Yd=new RegExp(fl(),""),tl={year:G.fromObject({years:1}),years:G.fromObject({years:1}),yr:G.fromObject({years:1}),yrs:G.fromObject({years:1}),month:G.fromObject({months:1}),months:G.fromObject({months:1}),mo:G.fromObject({months:1}),mos:G.fromObject({months:1}),week:G.fromObject({weeks:1}),weeks:G.fromObject({weeks:1}),wk:G.fromObject({weeks:1}),wks:G.fromObject({weeks:1}),w:G.fromObject({weeks:1}),day:G.fromObject({days:1}),days:G.fromObject({days:1}),d:G.fromObject({days:1}),hour:G.fromObject({hours:1}),hours:G.fromObject({hours:1}),hr:G.fromObject({hours:1}),hrs:G.fromObject({hours:1}),h:G.fromObject({hours:1}),minute:G.fromObject({minutes:1}),minutes:G.fromObject({minutes:1}),min:G.fromObject({minutes:1}),mins:G.fromObject({minutes:1}),m:G.fromObject({minutes:1}),second:G.fromObject({seconds:1}),seconds:G.fromObject({seconds:1}),sec:G.fromObject({seconds:1}),secs:G.fromObject({seconds:1}),s:G.fromObject({seconds:1})},nl={now:()=>z.local(),today:()=>z.local().startOf("day"),yesterday:()=>z.local().startOf("day").minus(G.fromObject({days:1})),tomorrow:()=>z.local().startOf("day").plus(G.fromObject({days:1})),sow:()=>z.local().startOf("week"),"start-of-week":()=>z.local().startOf("week"),eow:()=>z.local().endOf("week"),"end-of-week":()=>z.local().endOf("week"),soy:()=>z.local().startOf("year"),"start-of-year":()=>z.local().startOf("year"),eoy:()=>z.local().endOf("year"),"end-of-year":()=>z.local().endOf("year"),som:()=>z.local().startOf("month"),"start-of-month":()=>z.local().startOf("month"),eom:()=>z.local().endOf("month"),"end-of-month":()=>z.local().endOf("month")},il=["FROM","WHERE","LIMIT","GROUP","FLATTEN"];function nx(t){let e=-1;for(;(e=t.indexOf("|",e+1))>=0;)if(!(e>0&&t[e-1]=="\\"))return[t.substring(0,e).replace(/\\\|/g,"|"),t.substring(e+1)];return[t.replace(/\\\|/g,"|"),void 0]}function ix(t){let[e,n]=nx(t);return Dr.infer(e,!1,n)}function Ti(t,e,n){return D.seqMap(t,D.seq(D.optWhitespace,e,D.optWhitespace,t).many(),(i,o)=>{if(o.length==0)return i;let r=n(i,o[0][1],o[0][3]);for(let s=1;s<o.length;s++)r=n(r,o[s][1],o[s][3]);return r})}function ox(t,...e){return D.custom((n,i)=>(o,r)=>{let s=t._(o,r);if(!s.status)return s;for(let u of e){let f=u(s.value)._(o,s.index);if(!f.status)return s;s=f}return s})}var Ke=D.createLanguage({number:t=>D.regexp(/-?[0-9]+(\.[0-9]+)?/).map(e=>Number.parseFloat(e)).desc("number"),string:t=>D.string('"').then(D.alt(t.escapeCharacter,D.noneOf('"\\')).atLeast(0).map(e=>e.join(""))).skip(D.string('"')).desc("string"),escapeCharacter:t=>D.string("\\").then(D.any).map(e=>e==='"'?'"':e==="\\"?"\\":"\\"+e),bool:t=>D.regexp(/true|false|True|False/).map(e=>e.toLowerCase()=="true").desc("boolean ('true' or 'false')"),tag:t=>D.seqMap(D.string("#"),D.alt(D.regexp(/[^\u2000-\u206F\u2E00-\u2E7F'!"#$%&()*+,.:;<=>?@^`{|}~\[\]\\\s]/).desc("text")).many(),(e,n)=>e+n.join("")).desc("tag ('#hello/stuff')"),identifier:t=>D.seqMap(D.alt(D.regexp(/\p{Letter}/u),D.regexp(Yd).desc("text")),D.alt(D.regexp(/[0-9\p{Letter}_-]/u),D.regexp(Yd).desc("text")).many(),(e,n)=>e+n.join("")).desc("variable identifier"),link:t=>D.regexp(/\[\[([^\[\]]*?)\]\]/u,1).map(e=>ix(e)).desc("file link"),embedLink:t=>D.seqMap(D.string("!").atMost(1),t.link,(e,n)=>(e.length>0&&(n.embed=!0),n)).desc("file link"),binaryPlusMinus:t=>D.regexp(/\+|-/).map(e=>e).desc("'+' or '-'"),binaryMulDiv:t=>D.regexp(/\*|\/|%/).map(e=>e).desc("'*' or '/' or '%'"),binaryCompareOp:t=>D.regexp(/>=|<=|!=|>|<|=/).map(e=>e).desc("'>=' or '<=' or '!=' or '=' or '>' or '<'"),binaryBooleanOp:t=>D.regexp(/and|or|&|\|/i).map(e=>e.toLowerCase()=="and"?"&":e.toLowerCase()=="or"?"|":e).desc("'and' or 'or'"),rootDate:t=>D.seqMap(D.regexp(/\d{4}/),D.string("-"),D.regexp(/\d{2}/),(e,n,i)=>z.fromObject({year:Number.parseInt(e),month:Number.parseInt(i)})).desc("date in format YYYY-MM[-DDTHH-MM-SS.MS]"),dateShorthand:t=>D.alt(...Object.keys(nl).sort((e,n)=>n.length-e.length).map(D.string)),date:t=>ox(t.rootDate,e=>D.seqMap(D.string("-"),D.regexp(/\d{2}/),(n,i)=>e.set({day:Number.parseInt(i)})),e=>D.seqMap(D.string("T"),D.regexp(/\d{2}/),(n,i)=>e.set({hour:Number.parseInt(i)})),e=>D.seqMap(D.string(":"),D.regexp(/\d{2}/),(n,i)=>e.set({minute:Number.parseInt(i)})),e=>D.seqMap(D.string(":"),D.regexp(/\d{2}/),(n,i)=>e.set({second:Number.parseInt(i)})),e=>D.alt(D.seqMap(D.string("."),D.regexp(/\d{3}/),(n,i)=>e.set({millisecond:Number.parseInt(i)})),D.succeed(e)),e=>D.alt(D.seqMap(D.string("+").or(D.string("-")),D.regexp(/\d{1,2}(:\d{2})?/),(n,i)=>e.setZone("UTC"+n+i,{keepLocalTime:!0})),D.seqMap(D.string("Z"),()=>e.setZone("utc",{keepLocalTime:!0})),D.seqMap(D.string("["),D.regexp(/[0-9A-Za-z+-\/]+/u),D.string("]"),(n,i,o)=>e.setZone(i,{keepLocalTime:!0})))).assert(e=>e.isValid,"valid date").desc("date in format YYYY-MM[-DDTHH-MM-SS.MS]"),datePlus:t=>D.alt(t.dateShorthand.map(e=>nl[e]()),t.date).desc("date in format YYYY-MM[-DDTHH-MM-SS.MS] or in shorthand"),durationType:t=>D.alt(...Object.keys(tl).sort((e,n)=>n.length-e.length).map(D.string)),duration:t=>D.seqMap(t.number,D.optWhitespace,t.durationType,(e,n,i)=>tl[i].mapUnits(o=>o*e)).sepBy1(D.string(",").trim(D.optWhitespace).or(D.optWhitespace)).map(e=>e.reduce((n,i)=>n.plus(i))).desc("duration like 4hr2min"),rawNull:t=>D.string("null"),tagSource:t=>t.tag.map(e=>nt.tag(e)),csvSource:t=>D.seqMap(D.string("csv(").skip(D.optWhitespace),t.string,D.string(")"),(e,n,i)=>nt.csv(n)),linkIncomingSource:t=>t.link.map(e=>nt.link(e.path,!0)),linkOutgoingSource:t=>D.seqMap(D.string("outgoing(").skip(D.optWhitespace),t.link,D.string(")"),(e,n,i)=>nt.link(n.path,!1)),folderSource:t=>t.string.map(e=>nt.folder(e)),parensSource:t=>D.seqMap(D.string("("),D.optWhitespace,t.source,D.optWhitespace,D.string(")"),(e,n,i,o,r)=>i),negateSource:t=>D.seqMap(D.alt(D.string("-"),D.string("!")),t.atomSource,(e,n)=>nt.negate(n)),atomSource:t=>D.alt(t.parensSource,t.negateSource,t.linkOutgoingSource,t.linkIncomingSource,t.folderSource,t.tagSource,t.csvSource),binaryOpSource:t=>Ti(t.atomSource,t.binaryBooleanOp.map(e=>e),nt.binaryOp),source:t=>t.binaryOpSource,variableField:t=>t.identifier.chain(e=>il.includes(e.toUpperCase())?D.fail("Variable fields cannot be a keyword ("+il.join(" or ")+")"):D.succeed(re.variable(e))).desc("variable"),numberField:t=>t.number.map(e=>re.literal(e)).desc("number"),stringField:t=>t.string.map(e=>re.literal(e)).desc("string"),boolField:t=>t.bool.map(e=>re.literal(e)).desc("boolean"),dateField:t=>D.seqMap(D.string("date("),D.optWhitespace,t.datePlus,D.optWhitespace,D.string(")"),(e,n,i,o,r)=>re.literal(i)).desc("date"),durationField:t=>D.seqMap(D.string("dur("),D.optWhitespace,t.duration,D.optWhitespace,D.string(")"),(e,n,i,o,r)=>re.literal(i)).desc("duration"),nullField:t=>t.rawNull.map(e=>re.NULL),linkField:t=>t.link.map(e=>re.literal(e)),listField:t=>t.field.sepBy(D.string(",").trim(D.optWhitespace)).wrap(D.string("[").skip(D.optWhitespace),D.optWhitespace.then(D.string("]"))).map(e=>re.list(e)).desc("list ('[1, 2, 3]')"),objectField:t=>D.seqMap(t.identifier.or(t.string),D.string(":").trim(D.optWhitespace),t.field,(e,n,i)=>({name:e,value:i})).sepBy(D.string(",").trim(D.optWhitespace)).wrap(D.string("{").skip(D.optWhitespace),D.optWhitespace.then(D.string("}"))).map(e=>{let n={};for(let i of e)n[i.name]=i.value;return re.object(n)}).desc("object ('{ a: 1, b: 2 }')"),atomInlineField:t=>D.alt(t.date,t.duration.map(e=>Yp(e)),t.string,t.tag,t.embedLink,t.bool,t.number,t.rawNull),inlineFieldList:t=>t.atomInlineField.sepBy(D.string(",").trim(D.optWhitespace).lookahead(t.atomInlineField)),inlineField:t=>D.alt(D.seqMap(t.atomInlineField,D.string(",").trim(D.optWhitespace),t.inlineFieldList,(e,n,i)=>[e].concat(i)),t.atomInlineField),atomField:t=>D.alt(t.embedLink.map(e=>re.literal(e)),t.negatedField,t.linkField,t.listField,t.objectField,t.lambdaField,t.parensField,t.boolField,t.numberField,t.stringField,t.dateField,t.durationField,t.nullField,t.variableField),indexField:t=>D.seqMap(t.atomField,D.alt(t.dotPostfix,t.indexPostfix,t.functionPostfix).many(),(e,n)=>{let i=e;for(let o of n)switch(o.type){case"dot":i=re.index(i,re.literal(o.field));break;case"index":i=re.index(i,o.field);break;case"function":i=re.func(i,o.fields);break}return i}),negatedField:t=>D.seqMap(D.string("!"),t.indexField,(e,n)=>re.negate(n)).desc("negated field"),parensField:t=>D.seqMap(D.string("("),D.optWhitespace,t.field,D.optWhitespace,D.string(")"),(e,n,i,o,r)=>i),lambdaField:t=>D.seqMap(t.identifier.sepBy(D.string(",").trim(D.optWhitespace)).wrap(D.string("(").trim(D.optWhitespace),D.string(")").trim(D.optWhitespace)),D.string("=>").trim(D.optWhitespace),t.field,(e,n,i)=>({type:"lambda",arguments:e,value:i})),dotPostfix:t=>D.seqMap(D.string("."),t.identifier,(e,n)=>({type:"dot",field:n})),indexPostfix:t=>D.seqMap(D.string("["),D.optWhitespace,t.field,D.optWhitespace,D.string("]"),(e,n,i,o,r)=>({type:"index",field:i})),functionPostfix:t=>D.seqMap(D.string("("),D.optWhitespace,t.field.sepBy(D.string(",").trim(D.optWhitespace)),D.optWhitespace,D.string(")"),(e,n,i,o,r)=>({type:"function",fields:i})),binaryMulDivField:t=>Ti(t.indexField,t.binaryMulDiv,re.binaryOp),binaryPlusMinusField:t=>Ti(t.binaryMulDivField,t.binaryPlusMinus,re.binaryOp),binaryCompareField:t=>Ti(t.binaryPlusMinusField,t.binaryCompareOp,re.binaryOp),binaryBooleanField:t=>Ti(t.binaryCompareField,t.binaryBooleanOp,re.binaryOp),binaryOpField:t=>t.binaryBooleanField,field:t=>t.binaryOpField});function rx(t){try{return vr.success(Ke.field.tryParse(t))}catch(e){return vr.failure(""+e)}}var Tr;(function(t){function e(i,o){return{name:i,field:o}}t.named=e;function n(i,o){return{field:i,direction:o}}t.sortBy=n})(Tr||(Tr={}));function sx(t){return D.custom((e,n)=>(i,o)=>{let r=t._(i,o);return r.status?Object.assign({},r,{value:[r.value,i.substring(o,r.index)]}):r})}function ax(t){return t.split(/[\r\n]+/).map(e=>e.trim()).join("")}function Kd(t,e){return D.eof.map(t).or(D.whitespace.then(e))}var Kp=D.createLanguage({queryType:t=>D.alt(D.regexp(/TABLE|LIST|TASK|CALENDAR/i)).map(e=>e.toLowerCase()).desc("query type ('TABLE', 'LIST', 'TASK', or 'CALENDAR')"),explicitNamedField:t=>D.seqMap(Ke.field.skip(D.whitespace),D.regexp(/AS/i).skip(D.whitespace),Ke.identifier.or(Ke.string),(e,n,i)=>Tr.named(i,e)),comment:()=>D.Parser((t,e)=>{let n=t.substring(e);if(!n.startsWith("//"))return D.makeFailure(e,"Not a comment");n=n.split(`
`)[0];let i=n.substring(2).trim();return D.makeSuccess(e+n.length,i)}),namedField:t=>D.alt(t.explicitNamedField,sx(Ke.field).map(([e,n])=>Tr.named(ax(n),e))),sortField:t=>D.seqMap(Ke.field.skip(D.optWhitespace),D.regexp(/ASCENDING|DESCENDING|ASC|DESC/i).atMost(1),(e,n)=>{let i=n.length==0?"ascending":n[0].toLowerCase();return i=="desc"&&(i="descending"),i=="asc"&&(i="ascending"),{field:e,direction:i}}),headerClause:t=>t.queryType.chain(e=>{switch(e){case"table":return Kd(()=>({type:e,fields:[],showId:!0}),D.seqMap(D.regexp(/WITHOUT\s+ID/i).skip(D.optWhitespace).atMost(1),D.sepBy(t.namedField,D.string(",").trim(D.optWhitespace)),(n,i)=>({type:e,fields:i,showId:n.length==0})));case"list":return Kd(()=>({type:e,format:void 0,showId:!0}),D.seqMap(D.regexp(/WITHOUT\s+ID/i).skip(D.optWhitespace).atMost(1),Ke.field.atMost(1),(n,i)=>({type:e,format:i.length==1?i[0]:void 0,showId:n.length==0})));case"task":return D.succeed({type:e});case"calendar":return D.whitespace.then(D.seqMap(t.namedField,n=>({type:e,showId:!0,field:n})));default:return D.fail(`Unrecognized query type '${e}'`)}}).desc("TABLE or LIST or TASK or CALENDAR"),fromClause:t=>D.seqMap(D.regexp(/FROM/i),D.whitespace,Ke.source,(e,n,i)=>i),whereClause:t=>D.seqMap(D.regexp(/WHERE/i),D.whitespace,Ke.field,(e,n,i)=>({type:"where",clause:i})).desc("WHERE <expression>"),sortByClause:t=>D.seqMap(D.regexp(/SORT/i),D.whitespace,t.sortField.sepBy1(D.string(",").trim(D.optWhitespace)),(e,n,i)=>({type:"sort",fields:i})).desc("SORT field [ASC/DESC]"),limitClause:t=>D.seqMap(D.regexp(/LIMIT/i),D.whitespace,Ke.field,(e,n,i)=>({type:"limit",amount:i})).desc("LIMIT <value>"),flattenClause:t=>D.seqMap(D.regexp(/FLATTEN/i).skip(D.whitespace),t.namedField,(e,n)=>({type:"flatten",field:n})).desc("FLATTEN <value> [AS <name>]"),groupByClause:t=>D.seqMap(D.regexp(/GROUP BY/i).skip(D.whitespace),t.namedField,(e,n)=>({type:"group",field:n})).desc("GROUP BY <value> [AS <name>]"),clause:t=>D.alt(t.fromClause,t.whereClause,t.sortByClause,t.limitClause,t.groupByClause,t.flattenClause),query:t=>D.seqMap(t.headerClause.trim(Ba),t.fromClause.trim(Ba).atMost(1),t.clause.trim(Ba).many(),(e,n,i)=>({header:e,source:n.length==0?nt.folder(""):n[0],operations:i,settings:cl}))}),Ba=D.alt(D.whitespace,Kp.comment).many().map(t=>t.join("")),lx=t=>{var e;return t?(e=t.plugins.plugins.dataview)==null?void 0:e.api:window.DataviewAPI},ux=t=>t.plugins.enabledPlugins.has("dataview");it.DATE_SHORTHANDS=nl;it.DURATION_TYPES=tl;it.EXPRESSION=Ke;it.KEYWORDS=il;it.QUERY_LANGUAGE=Kp;it.getAPI=lx;it.isPluginEnabled=ux;it.parseField=rx});var Br,rm=Rt(()=>{Mt();dn();Br=class{constructor(){this.name="google_search";this.displayName="Google Search";this.category="read_only";this.description="Search Google for current information from the web";this.parameters={type:"object",properties:{query:{type:"string",description:"The search query to send to Google"}},required:["query"]}}async execute(e,n){var o,r,s,u,f,c,d;let i=n.plugin;try{if(!i.settings.apiKey)return{success:!1,error:"Google API key not configured"};let p=new Fe({apiKey:i.settings.apiKey}),m=i.settings.chatModelName||"gemini-1.5-flash-002",h={temperature:i.settings.temperature,maxOutputTokens:8192,tools:[{googleSearch:{}}]},y=`Please search for the following and provide a comprehensive answer based on current web results: ${e.query}`,v=await p.models.generateContent({model:m,config:h,contents:y}),T="";if((s=(r=(o=v.candidates)==null?void 0:o[0])==null?void 0:r.content)!=null&&s.parts)for(let C of v.candidates[0].content.parts)C.text&&(T+=C.text);else if(v.text)try{T=v.text}catch(C){console.warn("Failed to get text from result:",C)}let S=(f=(u=v.candidates)==null?void 0:u[0])==null?void 0:f.groundingMetadata,_=[],x=T;if(S!=null&&S.groundingChunks){let C=S.groundingChunks;if(_=C.filter(w=>{var P;return(P=w.web)==null?void 0:P.uri}).map((w,P)=>({url:w.web.uri,title:w.web.title||w.web.uri,snippet:w.web.snippet||""})),S.groundingSupports){let P=[...S.groundingSupports].sort((M,b)=>{var k,L,O,$;return((L=(k=b.segment)==null?void 0:k.endIndex)!=null?L:0)-(($=(O=M.segment)==null?void 0:O.endIndex)!=null?$:0)});for(let M of P){let b=(c=M.segment)==null?void 0:c.endIndex;if(b===void 0||!((d=M.groundingChunkIndices)!=null&&d.length))continue;let k=M.groundingChunkIndices.map(L=>{var $,le;let O=(le=($=C[L])==null?void 0:$.web)==null?void 0:le.uri;return O?`[${L+1}](${O})`:null}).filter(Boolean);if(k.length>0){let L=` ${k.join(", ")}`;x=x.slice(0,b)+L+x.slice(b)}}}}return{success:!0,data:{query:e.query,answer:x,originalAnswer:T,citations:_,searchGrounding:S||void 0}}}catch(p){return{success:!1,error:`Google search failed: ${p instanceof Error?p.message:"Unknown error"}`}}}}});var sm,Or,am=Rt(()=>{Mt();dn();sm=require("obsidian"),Or=class{constructor(){this.name="web_fetch";this.displayName="Web Fetch";this.category="read_only";this.description="Fetch and analyze content from a URL using AI";this.parameters={type:"object",properties:{url:{type:"string",description:"The URL to fetch and analyze"},query:{type:"string",description:"What information to extract or questions to answer about the content"}},required:["url","query"]}}async execute(e,n){var o,r,s,u,f,c,d;let i=n.plugin;if(!i.settings.apiKey)return{success:!1,error:"API key not configured"};try{let p=new URL(e.url);if(!["http:","https:"].includes(p.protocol))return{success:!1,error:"Only HTTP and HTTPS URLs are supported"};let m=new Fe({apiKey:i.settings.apiKey}),h=i.settings.chatModelName||"gemini-2.5-flash",y=`${e.query} for ${e.url}`;console.log("Web fetch - sending prompt:",y);let v=await m.models.generateContent({model:h,contents:y,config:{temperature:i.settings.temperature||.7,tools:[{urlContext:{}}]}});console.log("Web fetch - received result:",v);let T="";if((s=(r=(o=v.candidates)==null?void 0:o[0])==null?void 0:r.content)!=null&&s.parts)for(let x of v.candidates[0].content.parts)x.text&&(T+=x.text);if(!T)return{success:!1,error:"No response generated from URL content"};let S=(f=(u=v.candidates)==null?void 0:u[0])==null?void 0:f.urlContextMetadata;return S!=null&&S.urlMetadata&&(console.log("URL Context Metadata:",S.urlMetadata),S.urlMetadata.length>0&&console.log("First metadata entry:",JSON.stringify(S.urlMetadata[0],null,2))),((c=S==null?void 0:S.urlMetadata)==null?void 0:c.some(x=>{let C=x.urlRetrievalStatus;return console.log("Checking URL status:",C),C==="URL_RETRIEVAL_STATUS_ERROR"||C==="URL_RETRIEVAL_STATUS_ACCESS_DENIED"||C==="URL_RETRIEVAL_STATUS_NOT_FOUND"}))?(console.log("URL retrieval failed, attempting fallback fetch..."),await this.fallbackFetch(e,i)):{success:!0,data:{url:e.url,query:e.query,content:T,urlsRetrieved:((d=S==null?void 0:S.urlMetadata)==null?void 0:d.map(x=>({url:x.retrievedUrl,status:x.urlRetrievalStatus})))||[],fetchedAt:new Date().toISOString()}}}catch(p){if(console.error("Web fetch error:",p),p instanceof TypeError&&p.message.includes("Failed to construct"))return{success:!1,error:`Invalid URL format: ${e.url}`};if(p instanceof Error){if(p.message.includes("404"))return{success:!1,error:"URL not found (404)"};if(p.message.includes("403"))return{success:!1,error:"Access forbidden to this URL (403)"};if(p.message.includes("quota"))return{success:!1,error:"API quota exceeded"}}console.log("Primary web fetch failed, attempting fallback...");try{return await this.fallbackFetch(e,i)}catch(m){return{success:!1,error:`Failed to fetch URL with both methods: ${p instanceof Error?p.message:"Unknown error"}`}}}}async fallbackFetch(e,n){var i,o,r;try{let s=await(0,sm.requestUrl)({url:e.url,method:"GET",headers:{"User-Agent":"Mozilla/5.0 (compatible; ObsidianGemini/1.0)"}});if(s.status!==200)return{success:!1,error:`HTTP ${s.status}: ${s.text||"Failed to fetch URL"}`};let u=s.text;u=u.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,""),u=u.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"");let f=u.match(/<title[^>]*>([^<]+)<\/title>/i),c=f?f[1].trim():e.url;u=u.replace(/&nbsp;/g," "),u=u.replace(/&amp;/g,"&"),u=u.replace(/&lt;/g,"<"),u=u.replace(/&gt;/g,">"),u=u.replace(/&quot;/g,'"'),u=u.replace(/&#39;/g,"'"),u=u.replace(/<[^>]+>/g," "),u=u.replace(/\s+/g," ").trim(),u.length>1e4&&(u=u.substring(0,1e4)+`

[Content truncated...]`);let d=new Fe({apiKey:n.settings.apiKey}),p=n.settings.chatModelName||"gemini-2.5-flash",m=`Based on the following web page content from ${e.url}, ${e.query}

Web Page Title: ${c}

Content:
${u}`,h=await d.models.generateContent({model:p,contents:m,config:{temperature:n.settings.temperature||.7}}),y="";if((r=(o=(i=h.candidates)==null?void 0:i[0])==null?void 0:o.content)!=null&&r.parts)for(let v of h.candidates[0].content.parts)v.text&&(y+=v.text);return y?{success:!0,data:{url:e.url,query:e.query,content:y,title:c,fallbackMethod:!0,fetchedAt:new Date().toISOString()}}:{success:!1,error:"No analysis generated from page content"}}catch(s){return console.error("Fallback fetch error:",s),{success:!1,error:`Fallback fetch failed: ${s instanceof Error?s.message:"Unknown error"}`}}}}});var lm,Ur,um=Rt(()=>{Mt();dn();lm=require("obsidian"),Ur=class{constructor(){this.name="deep_research";this.displayName="Deep Research";this.category="read_only";this.description="Conduct comprehensive research on a topic with multiple searches and generate a cited report";this.requiresConfirmation=!0;this.parameters={type:"object",properties:{topic:{type:"string",description:"The research topic or question"},depth:{type:"number",description:"Number of search iterations (1-5, default: 3)"},outputFile:{type:"string",description:"Path for the output report file (optional)"}},required:["topic"]};this.confirmationMessage=e=>`Conduct deep research on: "${e.topic}" with ${e.depth||3} search iterations`}async execute(e,n){let i=n.plugin,o=Math.min(Math.max(e.depth||3,1),5);try{if(!i.settings.apiKey)return{success:!1,error:"Google API key not configured"};let r={topic:e.topic,searches:[],sources:new Map,sections:[]},s=new Fe({apiKey:i.settings.apiKey}),u=i.settings.chatModelName||"gemini-2.5-flash",f=await this.generateSearchQueries(s,u,e.topic,[]);for(let p of f.slice(0,2)){let m=await this.performSearch(s,u,p);m&&(r.searches.push(m),this.extractSources(m,r.sources))}for(let p=1;p<o;p++){let m=await this.generateFollowUpQueries(s,u,e.topic,r.searches);for(let h of m.slice(0,2)){let y=await this.performSearch(s,u,h);y&&(r.searches.push(y),this.extractSources(y,r.sources))}}let c=await this.generateOutline(s,u,e.topic,r.searches);for(let p of c){let m=await this.generateSection(s,u,e.topic,p,r.searches,r.sources);r.sections.push(m)}let d=this.compileReport(r);if(e.outputFile){let p=await this.saveReport(i,e.outputFile,d);n.session&&p&&n.session.context.contextFiles.push(p)}return{success:!0,data:{topic:e.topic,report:d,searches:r.searches.length,sources:r.sources.size,sections:r.sections.length,outputFile:e.outputFile}}}catch(r){return{success:!1,error:`Deep research failed: ${r instanceof Error?r.message:"Unknown error"}`}}}async generateSearchQueries(e,n,i,o){let r=`Generate 3-5 specific search queries to research the topic: "${i}"
${o.length>0?`
Previous searches: ${o.map(f=>f.query).join(", ")}`:""}
Generate diverse queries that cover different aspects of the topic.
Return only the queries, one per line.`,s=await e.models.generateContent({model:n,contents:r,config:{temperature:.7}});return this.extractText(s).split(`
`).filter(f=>f.trim().length>0)}async generateFollowUpQueries(e,n,i,o){let r=o.map(c=>`- ${c.query}: ${c.summary}`).join(`
`),s=`Based on the following research on "${i}", identify gaps and generate 2-3 follow-up search queries:

Previous research:
${r}

What aspects need more investigation? Generate specific search queries.
Return only the queries, one per line.`,u=await e.models.generateContent({model:n,contents:s,config:{temperature:.7}});return this.extractText(u).split(`
`).filter(c=>c.trim().length>0)}async performSearch(e,n,i){var o,r;try{let s=await e.models.generateContent({model:n,config:{temperature:.7,tools:[{googleSearch:{}}]},contents:`Search for: ${i}`}),u=this.extractText(s),f=(r=(o=s.candidates)==null?void 0:o[0])==null?void 0:r.groundingMetadata,c=[];return f!=null&&f.groundingChunks&&f.groundingChunks.forEach((d,p)=>{var m;(m=d.web)!=null&&m.uri&&c.push({id:`${i}-${p}`,url:d.web.uri,title:d.web.title||d.web.uri,snippet:d.web.snippet||""})}),{query:i,content:u,summary:u.substring(0,200)+"...",citations:c}}catch(s){return console.error(`Search failed for query "${i}":`,s),null}}extractSources(e,n){for(let i of e.citations)n.has(i.url)||n.set(i.url,{url:i.url,title:i.title,citations:[]}),n.get(i.url).citations.push(i)}async generateOutline(e,n,i,o){let r=o.map(c=>c.summary).join(`
`),s=`Based on the following research on "${i}", create an outline for a comprehensive report:

Research summaries:
${r}

Generate 3-5 main section titles for the report.
Return only the section titles, one per line.`,u=await e.models.generateContent({model:n,contents:s,config:{temperature:.7}});return this.extractText(u).split(`
`).filter(c=>c.trim().length>0)}async generateSection(e,n,i,o,r,s){let u=r.map(y=>`Query: ${y.query}
Content: ${y.content}
`).join(`
---
`),f=`Write a section titled "${o}" for a report on "${i}".

Use the following research content:
${u}

Include inline citations using [1], [2], etc. format.
Write 2-3 paragraphs with specific details and citations.`,c=await e.models.generateContent({model:n,contents:f,config:{temperature:.7}}),d=this.extractText(c),p=new Set,m=/\[(\d+)\]/g,h;for(;(h=m.exec(d))!==null;)p.add(h[1]);return{title:o,content:d,citations:Array.from(p)}}compileReport(e){let n=`# ${e.topic}

`;n+=`*Generated on ${new Date().toLocaleDateString()}*

`,n+=`---

`;for(let r of e.sections)n+=`## ${r.title}

`,n+=`${r.content}

`;n+=`---

## Sources

`;let i=1,o=new Map;for(let[r,s]of e.sources)o.set(r,i),n+=`[${i}] ${s.title}
`,n+=`    ${r}

`,i++;for(let[r,s]of o)n=n.replace(new RegExp(`\\[${r}\\]`,"g"),`[${s}]`);return n}async saveReport(e,n,i){try{n.endsWith(".md")||(n+=".md");let o=e.app.vault.getAbstractFileByPath(n);return o instanceof lm.TFile?(await e.app.vault.modify(o,i),o):await e.app.vault.create(n,i)}catch(o){return console.error("Failed to save report:",o),null}}extractText(e){var i,o,r;let n="";if((r=(o=(i=e.candidates)==null?void 0:i[0])==null?void 0:o.content)!=null&&r.parts)for(let s of e.candidates[0].content.parts)s.text&&(n+=s.text);return n}}});var cm={};$r(cm,{getWebTools:()=>gx});function gx(){return[new Br,new Or,new Ur]}var fm=Rt(()=>{rm();am();um()});var vx={};$r(vx,{default:()=>Vr});module.exports=Wr(vx);var dm=require("obsidian");var J=require("obsidian");var Ol=require("obsidian");Nt();async function Gi(t,e,n,i,o){var u;let r=(u=e.settings.modelDiscovery)!=null&&u.enabled&&e.getModelManager?await e.getModelManager().getAvailableModels():ke,s=new Ol.Setting(t).setName(i).setDesc(o).addDropdown(f=>(r.forEach(c=>{f.addOption(c.value,c.label)}),f.setValue(String(e.settings[n])).onChange(async c=>{e.settings[n]=c,await e.saveSettings()}),f))}var qi=require("obsidian"),Hi=class extends qi.AbstractInputSuggest{constructor(e,n,i){super(e,n),this.inputEl=n,this.folderSelectCallback=i}getSuggestions(e){return this.app.vault.getAllLoadedFiles().filter(i=>i instanceof qi.TFolder).filter(i=>i.path.toLowerCase().contains(e.toLowerCase()))}renderSuggestion(e,n){n.setText(e.path)}selectSuggestion(e,n){this.inputEl.value=e.path,this.inputEl.trigger("input"),this.close(),this.folderSelectCallback(e.path)}};dn();function uo(t,e=!0){if(!t||typeof t!="object")return t;if("path"in t&&"content"in t&&"wikilink"in t&&"links"in t){let n={...t,content:e?t.content:`[Linked file: ${t.wikilink||t.path}]`,links:{}},i=t.links instanceof Map?Object.fromEntries(t.links):t.links;for(let o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n.links[o]=uo(i[o],!1));return n}if(Array.isArray(t))return t.map(n=>uo(n,e));{let n={};for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=uo(t[i],e));return n}}function Bs(t){if(t&&typeof t=="object"&&"path"in t&&"content"in t&&"wikilink"in t&&"links"in t)return uo(t,!0);if(Array.isArray(t))return t.map(Bs);if(t&&typeof t=="object"){let e={};for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=Bs(t[n]));return e}return t}function cS(t){let e=/(=+\nFile Label: [^\n]+\nFile Name: [^\n]+\nWikiLink: [^\n]+\n=+\n\n)/g,n=t.split(e);if(n.length<=2)return t;let i="",o=0;for(let r=0;r<n.length;r++)if(r%2===0)i+=n[r];else if(i+=n[r],o++,o===1){let s=n[r+2]!==void 0?r+2:n.length;i+=n[r+1]||"",r++}else{let s=n[r].match(/WikiLink: \[\[(.*?)\]\]/),u=s?s[1]:"Unknown";i+=`[Linked file: [[${u}]]]

`,r++}return i}function Ec(t){return!!(t&&typeof t=="object"&&typeof t.prompt=="string")}function fS(t){return Ec(t)&&Array.isArray(t.conversationHistory)&&typeof t.userMessage=="string"}function dS(t){var e;return[`Model: ${(e=t.model)!=null?e:"[default]"}
`,`Prompt: ${JSON.stringify(t.prompt,null,2)}
`].join("")}function pS(t){var e;return[`Model: ${(e=t.model)!=null?e:"[default]"}
`,`Prompt: ${JSON.stringify(t.prompt,null,2)}
`,`User Message: ${JSON.stringify(t.userMessage,null,2)}
`,"Conversation History:",JSON.stringify(t.conversationHistory,null,2),t.renderContent!==void 0?`
Render Content: ${t.renderContent}`:""].join(`
`)}function oe(t,e,n){if(!t)return;if(fS(n)){console.log(`[GeminiAPI Debug] ${e} (ExtendedModelRequest):
${pS(n)}`);return}if(Ec(n)){console.log(`[GeminiAPI Debug] ${e} (BaseModelRequest):
${dS(n)}`);return}let i;typeof n=="string"&&n.includes("File Label:")?(i=cS(n),console.log(`[GeminiAPI Debug] ${e}:
${i}`)):(i=Bs(n),console.log(`[GeminiAPI Debug] ${e}:`,JSON.stringify(i,null,2)))}var Wt=Kn(di());var ud=`You are a note-taking and writing assistant embedded in my Obsidian note vault.
Your primary goal is to help me stay organized by surfacing information from my 
notes and any linked notes, and to assist me in drafting and refining my 
writing based on this context. 

Today's date is: {{date}}
The current time is: {{time}}

Assume that I am the author of all content unless specified otherwise, and you
can refer to me as {{userName}}.

Unless otherwise specified please respond to me in the same language I use with 
you. My user interface is set to the language code: {{language}}. Use that
language if you are uncertain about the language to use.


You should always respond with plain text. **Do not use HTML-escaped entities**  
like \`&quot;\`, \`&#x27;\`, or \`&amp;\`. Instead, always render characters as their unescaped  
equivalents (e.g., \`"\` for quotes, \`'\` for apostrophes, \`&\` for ampersands).  
Use Markdown formatting if necessary for clarity and style.

If a question cannot be answered from my notes, supplement your response with
external information as needed.`;var cd=`You are a markdown text completion assistant designed to help users write more effectively by generating contextually relevant, high-quality prose.

Your task is to produce the next **complete sentence or multi-word phrase** that fits naturally after the cursor position. Prioritize longer, flowing completions that build upon the surrounding context with clarity and originality.

Your completions should match the tone, voice, and purpose of the user's existing content. Avoid repeating exact phrases, but feel free to expand on or complement existing ideas. Emphasize vivid language, subtle details, and fresh perspectives when appropriate.

Do **not** respond with just a single word unless absolutely necessary. Always attempt a full sentence first, then a phrase, only falling back to a word as a last resort.

Use the entire file to understand context, but generate a continuation only at the cursor.

Do not include explanations, punctuation at the start, extra whitespace, or newlines in your output. Just output the completion text.

Here is the file content and the location of the cursor:
<file>
{{contentBeforeCursor}}<cursor>{{contentAfterCursor}}
</file>
`;var fd=`You are assisting me in exploring, clarifying, and discussing the content
within a file labeled \u2018Current File\u2019 and any linked files. Prioritize
information from these files when answering questions, providing explanations,
or engaging in brainstorming.

If additional context beyond the current and linked files is needed to answer a 
question, clearly indicate when you are drawing on general knowledge or external
information.

When referring to files, use [[WikiLink]] syntax. If it's provided in the context
use the Wikilink that is provided, otherwise use the file path but drop the .md 
extension.
`;var dd=`Using the context provided, create a single-sentence summary based on the
content of the file. Exclude any mention of dates, attendees, or my name, and
assume the notes are taken from my perspective unless specified otherwise. 

Respond with plain text only, do not use any markdown.

Please summarize the following content:
<file><content>{{content}}</content></file>`;var pd=`==============================
File Label: {{file_label}}
File Name: {{file_name}}
WikiLink: {{wikilink}}
==============================

{{file_contents}}

`;var md=`You are helping to rewrite a specific portion of a document.

USER INSTRUCTIONS:
{{instructions}}

DOCUMENT WITH SELECTION MARKED:
{{documentWithMarkers}}

FOCUS: The text between [SELECTION_START] and [SELECTION_END] is what needs to be rewritten.

IMPORTANT GUIDELINES:
- Only rewrite the text between the selection markers
- Use the surrounding context to maintain consistency in style, tone, and flow
- Ensure the rewritten text flows naturally with the text before and after it
- Consider the document's overall structure and the selection's role within it
- Return ONLY the rewritten text, without the markers
- Do not add explanations or comments
- Ignore any duplicate document content that may appear elsewhere`;var fe=class{constructor(e){this.plugin=e;this.completionsPromptTemplate=Wt.compile(cd),this.systemPromptTemplate=Wt.compile(ud),this.generalPromptTemplate=Wt.compile(fd),this.summaryPromptTemplate=Wt.compile(dd),this.contextPromptTemplate=Wt.compile(pd),this.selectionRewritePromptTemplate=Wt.compile(md)}completionsPrompt(e){return this.completionsPromptTemplate(e)}systemPrompt(e){return this.systemPromptTemplate(e)}generalPrompt(e){return this.generalPromptTemplate(e)}summaryPrompt(e){return this.summaryPromptTemplate(e)}contextPrompt(e){return this.contextPromptTemplate(e)}selectionRewritePrompt(e){return this.selectionRewritePromptTemplate(e)}getLanguageCode(){return window.localStorage.getItem("language")||"en"}async getSystemPromptWithCustom(e){var i;let n=this.systemPrompt({userName:((i=this.plugin)==null?void 0:i.settings.userName)||"User",language:this.getLanguageCode(),date:new Date().toLocaleDateString(),time:new Date().toLocaleTimeString()});return e?e.overrideSystemPrompt?(console.warn("System prompt override enabled. Base functionality may be affected."),e.content):`${n}

## Additional Instructions

${e.content}`:n}getSystemPromptWithTools(e){var o,r;let n=this.systemPrompt({userName:((o=this.plugin)==null?void 0:o.settings.userName)||"User",language:this.getLanguageCode(),date:new Date().toLocaleDateString(),time:new Date().toLocaleTimeString()});if(!e||e.length===0)return n;let i=`

## Available Tools

`;i+=`You have access to the following tools that you can use to help answer questions:

`;for(let s of e){if(i+=`### ${s.name}
`,i+=`${s.description}
`,s.parameters&&s.parameters.properties){i+=`Parameters:
`;for(let[u,f]of Object.entries(s.parameters.properties)){let c=(r=s.parameters.required)!=null&&r.includes(u)?" (required)":"";i+=`- ${u}: ${f.type}${c} - ${f.description||""}
`}}i+=`
`}return i+=`To use a tool, you MUST make a function call. The system will execute the tool and provide the results.

`,i+=`**IMPORTANT**: When the user asks you to:
`,i+=`- Create, write, or save content \u2192 USE the write_file tool
`,i+=`- List files \u2192 USE the list_files tool
`,i+=`- Read files \u2192 USE the read_file tool
`,i+=`- Search files \u2192 USE the search_files tool

`,i+=`DO NOT just describe what you would do. ALWAYS use the appropriate tool to complete the task.
`,i+=`Example: If asked to "create a file", you must call write_file with the path and content.

`,i+=`**CONTEXT FILES**: Files may be included in the context or mentioned by the user with @ symbols.
`,i+=`When asked to modify or add data to these files:
`,i+=`1. First READ the file with read_file to understand its current content
`,i+=`2. Then WRITE the updated content with write_file, preserving existing data
`,i+=`3. DO NOT create new files unless explicitly asked - modify existing ones

`,i+=`**IMPORTANT TOOL ORDERING**: When combining operations on the same files:
`,i+=`- ALWAYS read files BEFORE deleting them
`,i+=`- ALWAYS read files BEFORE moving/renaming them
`,i+=`- If you need to combine files and delete originals, read ALL files first, then write combined, then delete
`,n+i}};var $o=class{constructor(e){this.plugin=e,this.ai=new Fe({apiKey:this.plugin.settings.apiKey}),this.prompts=new fe(e)}generateStreamingResponse(e,n){let i=!1;return{complete:(async()=>{var m,h,y,v,T,S,_,x;console.log("DEBUG: generateStreamingResponse called with request:",e),oe(this.plugin.settings.debugMode,"Generating streaming response for request",e);let r="customPrompt"in e?e.customPrompt:void 0,s="availableTools"in e&&e.availableTools&&e.availableTools.length>0,u;s?(u=this.prompts.getSystemPromptWithTools(e.availableTools),r&&(r.overrideSystemPrompt?u=r.content:u+=`

## Additional Instructions

${r.content}`)):u=await this.prompts.getSystemPromptWithCustom(r);let f=(m=e.model)!=null?m:this.plugin.settings.chatModelName,c="",d="",p=[];try{if("conversationHistory"in e){let C=[],w=e.availableTools&&e.availableTools.length>0;if(this.plugin.settings.searchGrounding&&!w&&C.push({googleSearch:{}}),w){console.log("DEBUG: Available tools from request:",e.availableTools),console.log("DEBUG: Google Search disabled due to custom tools"),oe(this.plugin.settings.debugMode,"Available tools from request",e.availableTools);let L=e.availableTools.map(O=>({name:O.name,description:O.description,parameters:{type:"object",properties:O.parameters.properties||{},required:O.parameters.required||[]}}));console.log("DEBUG: Function declarations:",JSON.stringify(L,null,2)),L.length>0&&(C.push({functionDeclarations:L}),console.log("DEBUG: Tools array after adding functionDeclarations:",JSON.stringify(C,null,2)),oe(this.plugin.settings.debugMode,"Function declarations added to tools",L))}else console.log("DEBUG: No available tools in request"),oe(this.plugin.settings.debugMode,"No available tools in request",e.availableTools);let P=await this.buildGeminiChatContents(e),M={systemInstruction:u,temperature:(h=e.temperature)!=null?h:this.plugin.settings.temperature,topP:(y=e.topP)!=null?y:this.plugin.settings.topP};C.length>0&&(M.tools=C,console.log("DEBUG: Final tools array before API call:",JSON.stringify(C,null,2)),oe(this.plugin.settings.debugMode,"Final tools array before API call",C)),console.log("DEBUG: About to call generateContentStream with config:",JSON.stringify(M,null,2));let b=await this.ai.models.generateContentStream({model:f,config:M,contents:P});console.log("DEBUG: generateContentStream called");let k;for await(let L of b){if(i)break;if(k=L,L.text){let O=this._decodeHtmlEntities(L.text);c+=O,n(O)}if((S=(T=(v=L.candidates)==null?void 0:v[0])==null?void 0:T.content)!=null&&S.parts)for(let O of L.candidates[0].content.parts)O.functionCall&&O.functionCall.name&&p.push({name:O.functionCall.name,arguments:O.functionCall.args||{}})}oe(this.plugin.settings.debugMode,"Streaming response complete",{text:c,toolCalls:p,finalResponse:k})}else{let C=await this.ai.models.generateContentStream({model:f,contents:e.prompt,config:{temperature:(_=e.temperature)!=null?_:this.plugin.settings.temperature,topP:(x=e.topP)!=null?x:this.plugin.settings.topP}});for await(let w of C){if(i)break;let P=w.text;if(P){let M=this._decodeHtmlEntities(P);c+=M,n(M)}}}}catch(C){throw console.error("Error during streaming:",C),C}return{markdown:c,rendered:d,toolCalls:p.length>0?p:void 0}})(),cancel:()=>{i=!0}}}async generateModelResponse(e){var u,f,c,d,p;oe(this.plugin.settings.debugMode,"Generating model response for request",e);let n="customPrompt"in e?e.customPrompt:void 0,i="availableTools"in e&&e.availableTools&&e.availableTools.length>0,o;i?(o=this.prompts.getSystemPromptWithTools(e.availableTools),n&&(n.overrideSystemPrompt?o=n.content:o+=`

## Additional Instructions

${n.content}`)):o=await this.prompts.getSystemPromptWithCustom(n);let r=(u=e.model)!=null?u:this.plugin.settings.chatModelName;console.log("DEBUG: generateModelResponse called with request:",e);let s={markdown:"",rendered:""};if("conversationHistory"in e){let m=[],h=e.availableTools&&e.availableTools.length>0;if(this.plugin.settings.searchGrounding&&!h&&m.push({googleSearch:{}}),h){let S=e.availableTools.map(_=>({name:_.name,description:_.description,parameters:{type:"object",properties:_.parameters.properties||{},required:_.parameters.required||[]}}));S.length>0&&(m.push({functionDeclarations:S}),oe(this.plugin.settings.debugMode,"Tools being sent to Gemini (non-streaming)",m))}let y=await this.buildGeminiChatContents(e),v={systemInstruction:o,temperature:(f=e.temperature)!=null?f:this.plugin.settings.temperature,topP:(c=e.topP)!=null?c:this.plugin.settings.topP};m.length>0&&(v.tools=m),console.log("DEBUG: About to call generateContent with config:",JSON.stringify(v,null,2));let T=await this.ai.models.generateContent({model:r,config:v,contents:y});console.log("DEBUG: generateContent called"),console.log("DEBUG: Full model result:",JSON.stringify(T,null,2)),oe(this.plugin.settings.debugMode,"Model response",T),s=this.parseModelResult(T),console.log("DEBUG: Parsed response:",JSON.stringify(s,null,2))}else{let m=await this.ai.models.generateContent({model:r,contents:e.prompt,config:{temperature:(d=e.temperature)!=null?d:this.plugin.settings.temperature,topP:(p=e.topP)!=null?p:this.plugin.settings.topP}});s=this.parseModelResult(m)}return s}async buildGeminiChatContents(e){var u,f;let n=[];e.prompt!=null&&n.push(e.prompt);let i=this.plugin.settings.maxContextDepth,o=(u=e.renderContent)!=null?u:!0,r=await this.plugin.gfile.getCurrentFileContent(i,o);return r!=null&&n.push(r),((f=e.conversationHistory)!=null?f:[]).forEach(c=>{n.push(c.message)}),n.push(e.userMessage),oe(this.plugin.settings.debugMode,"Chat contents",n),n}parseModelResult(e){var o,r,s,u,f,c,d,p,m,h,y,v,T,S,_;let n={markdown:"",rendered:""},i=[];try{if((s=(r=(o=e.candidates)==null?void 0:o[0])==null?void 0:r.content)!=null&&s.parts)for(let x of e.candidates[0].content.parts)x.text&&(n.markdown+=this._decodeHtmlEntities(x.text)),x.functionCall&&i.push({name:x.functionCall.name,arguments:x.functionCall.args||{}});else{let x="";if(e.text&&typeof e.text=="string")x=e.text;else if(typeof e.text=="function"){let C=e.text();typeof C=="string"&&(x=C)}else(c=(f=(u=e.candidates)==null?void 0:u[0])==null?void 0:f.content)!=null&&c.text&&(x=e.candidates[0].content.text);x?n.markdown=this._decodeHtmlEntities(x):n.markdown=""}(m=(p=(d=e.candidates)==null?void 0:d[0])==null?void 0:p.groundingMetadata)!=null&&m.searchEntryPoint?n.rendered=(h=e.candidates[0].groundingMetadata.searchEntryPoint.renderedContent)!=null?h:"":(S=(T=(v=(y=e.response)==null?void 0:y.candidates)==null?void 0:v[0])==null?void 0:T.groundingMetadata)!=null&&S.searchEntryPoint&&(n.rendered=(_=e.response.candidates[0].groundingMetadata.searchEntryPoint.renderedContent)!=null?_:""),i.length>0&&(n.toolCalls=i)}catch(x){console.error("Error parsing model result:",x),console.log("Result:",JSON.stringify(e))}return n}_decodeHtmlEntities(e){if(typeof document!="undefined"){let n=document.createElement("textarea");return n.innerHTML=e,n.value}return console.warn("HTML entity decoding attempted in an environment without `document`. Returning original string."),e}};dn();var Wo=class{constructor(e,n={searchGrounding:!1,streamingEnabled:!0},i){this.config=e,this.features=n,this.prompts=i||new fe,this.ai=new Fe({apiKey:e.apiKey})}buildRequestConfig(e){var s,u,f,c;let n=(s=e.temperature)!=null?s:this.config.temperature,i=(u=e.topP)!=null?u:this.config.topP,o=this.config.maxOutputTokens,r={model:this.config.model,contents:this.buildContents(e),config:{temperature:n,topP:i,...o&&{maxOutputTokens:o}}};if(this.features.searchGrounding&&!((f=e.availableTools)!=null&&f.length)&&(r.tools=[{googleSearch:{}}]),(c=e.availableTools)!=null&&c.length){let d=e.availableTools.map(p=>({name:p.name,description:p.description,parameters:{type:"object",properties:p.parameters.properties||{},required:p.parameters.required||[]}}));d.length>0&&(r.tools=r.tools||[],r.tools.push({functionDeclarations:d}))}return r}generateStreamingResponse(e,n){if(!this.features.streamingEnabled)throw new Error("Streaming is not enabled");let i=!1;return{complete:(async()=>{var r,s,u;try{let f=this.buildRequestConfig(e),c=await this.ai.models.generateContentStream(f),d="",p=[];for await(let m of c){if(i)break;if(m.text&&(d+=m.text,n(m.text)),(u=(s=(r=m.candidates)==null?void 0:r[0])==null?void 0:s.content)!=null&&u.parts)for(let h of m.candidates[0].content.parts)h.functionCall&&p.push({name:h.functionCall.name||"",arguments:h.functionCall.args||{}})}return{markdown:d,rendered:d,toolCalls:p.length>0?p:void 0}}catch(f){throw console.error("Error during streaming:",f),f}})(),cancel:()=>{i=!0}}}async generateModelResponse(e){var n,i,o,r,s,u;try{let f=this.buildRequestConfig(e),c=await this.ai.models.generateContent(f),d="";if((o=(i=(n=c.candidates)==null?void 0:n[0])==null?void 0:i.content)!=null&&o.parts)for(let m of c.candidates[0].content.parts)m.text&&(d+=m.text);let p=[];if((u=(s=(r=c.candidates)==null?void 0:r[0])==null?void 0:s.content)!=null&&u.parts)for(let m of c.candidates[0].content.parts)m.functionCall&&p.push({name:m.functionCall.name||"",arguments:m.functionCall.args||{}});return{markdown:d,rendered:d,toolCalls:p.length>0?p:void 0}}catch(f){throw console.error("Error generating response:",f),f}}buildContents(e){let n=[];return e.conversationHistory&&n.push(...e.conversationHistory),n.push({role:"user",parts:[{text:e.prompt}]}),n}};var hd=require("obsidian"),pi=class{constructor(e){this.plugin=e}async generateModelResponse(e){return new hd.Notice("Ollama API not yet implemented"),{markdown:"Ollama API not yet implemented. Please check back later.",rendered:""}}};var En=require("obsidian"),Jo=class{constructor(e,n){this.decoratedApi=e,this.plugin=n}async generateModelResponse(e){var r,s;let n=0,i=(r=this.plugin.settings.maxRetries)!=null?r:3,o=(s=this.plugin.settings.initialBackoffDelay)!=null?s:1e3;for(;n<i;)try{if(n>0){let f=o*2**(n-1);new En.Notice(`Model request failed. Retrying in ${f/1e3}s... (Attempt ${n+1}/${i})`),await new Promise(c=>setTimeout(c,f))}return await this.decoratedApi.generateModelResponse(e)}catch(u){if(n++,n>=i)throw new En.Notice(`Model request failed after ${i} attempts. Please try again later.`),u}throw new Error("Retry loop finished without success or definitive error.")}generateStreamingResponse(e,n){var f,c;if(!this.decoratedApi.generateStreamingResponse)return{complete:this.generateModelResponse(e).then(p=>(n(p.markdown),p)),cancel:()=>{}};let i=0,o=null,r=(f=this.plugin.settings.maxRetries)!=null?f:3,s=(c=this.plugin.settings.initialBackoffDelay)!=null?c:1e3,u=()=>{i++;let d="",p=y=>{d+=y,n(y)},m=this.decoratedApi.generateStreamingResponse(e,p);return{complete:m.complete.catch(async y=>{if(i<r){let v=s*2**(i-1);return new En.Notice(`Streaming request failed. Retrying in ${v/1e3}s... (Attempt ${i+1}/${r})`),await new Promise(T=>setTimeout(T,v)),d&&new En.Notice("Restarting stream from beginning due to partial failure"),o=u(),o.complete}else throw new En.Notice(`Streaming request failed after ${r} attempts. Please try again later.`),y}),cancel:()=>{m.cancel()}}};return o=u(),o}};var zo=class{constructor(e,n){this.wrappedApi=e,this.config=n}sleep(e){return new Promise(n=>setTimeout(n,e))}async executeWithRetry(e,n){let i;for(let o=0;o<=this.config.maxRetries;o++)try{return await e()}catch(r){if(i=r,o===this.config.maxRetries)throw console.error(`${n} failed after ${this.config.maxRetries+1} attempts:`,r),r;let s=this.config.initialBackoffDelay*Math.pow(2,o);console.warn(`${n} failed (attempt ${o+1}/${this.config.maxRetries+1}). Retrying in ${s}ms...`,r),await this.sleep(s)}throw i||new Error(`${n} failed after all retry attempts`)}generateStreamingResponse(e,n){if(!this.wrappedApi.generateStreamingResponse)throw new Error("Wrapped API does not support streaming");return this.wrappedApi.generateStreamingResponse(e,n)}async generateModelResponse(e){return this.executeWithRetry(()=>this.wrappedApi.generateModelResponse(e),"generateModelResponse")}};var gt=class{static createApi(e,n){let i=this.createConfigFromPlugin(e,n?{provider:n}:void 0);return this.createApiWithConfig(i,e)}static createApiWithConfig(e,n){let i;switch(e.provider){case"ollama":if(n)i=new pi(n);else throw new Error("OllamaApi currently requires plugin instance");break;case"gemini":default:if(n)i=new $o(n);else{let o=n?new fe(n):void 0;i=new Wo(e.modelConfig,e.features,o)}break}return e.retryConfig&&(n?i=new Jo(i,n):i=new zo(i,e.retryConfig)),i}static createConfigFromPlugin(e,n){var r,s,u,f,c;let i=(n==null?void 0:n.provider)||e.settings.apiProvider||"gemini",o=e.settings.chatModelName;return{provider:i,modelConfig:{apiKey:e.settings.apiKey,model:((r=n==null?void 0:n.modelConfig)==null?void 0:r.model)||o,temperature:(u=(s=n==null?void 0:n.modelConfig)==null?void 0:s.temperature)!=null?u:e.settings.temperature,topP:(c=(f=n==null?void 0:n.modelConfig)==null?void 0:f.topP)!=null?c:e.settings.topP},retryConfig:{maxRetries:e.settings.maxRetries,initialBackoffDelay:e.settings.initialBackoffDelay},features:{searchGrounding:e.settings.searchGrounding,streamingEnabled:e.settings.streamingEnabled},...n}}};var mi=class extends J.PluginSettingTab{constructor(n,i){super(n,i);this.showDeveloperSettings=!1;this.temperatureDebounceTimer=null;this.topPDebounceTimer=null;this.plugin=i}async updateDiscoveryStatus(n){try{let i=await this.plugin.getModelManager().getDiscoveryStatus();if(!i.enabled){n.setDesc("Model discovery is disabled");return}if(i.working){let o=i.lastUpdate?new Date(i.lastUpdate).toLocaleString():"Never";n.setDesc(`\u2713 Working - Last update: ${o}`)}else n.setDesc(`\u2717 Not working - ${i.error||"Unknown error"}`)}catch(i){n.setDesc(`Error checking status: ${i instanceof Error?i.message:"Unknown"}`)}}async checkMigrationStatus(n){try{let i=`${this.plugin.settings.historyFolder}/.migration-completed`;if(await this.app.vault.adapter.exists(i)){let r=await this.app.vault.adapter.read(i);n.setDesc(`\u2713 Migration completed. ${r.split(`
`)[1]||""}`)}else{let r=this.plugin.settings.historyFolder;if(await this.app.vault.adapter.exists(r)){let f=(await this.app.vault.adapter.list(r)).files.filter(c=>c.endsWith(".md")&&!c.includes("/History/"));f.length>0?n.setDesc(`\u26A0\uFE0F Found ${f.length} history files that will be migrated to the new folder structure on next restart.`):n.setDesc("\u2713 No migration needed - using new folder structure.")}else n.setDesc("\u2713 No migration needed - no existing history files found.")}}catch(i){n.setDesc(`Error checking migration status: ${i instanceof Error?i.message:"Unknown"}`)}}async createTemperatureSetting(n){let i=this.plugin.getModelManager(),o=await i.getParameterRanges(),r=await i.getParameterDisplayInfo(),s=r.hasModelData?`Controls randomness. Lower values are more deterministic. ${r.temperature}`:"Controls randomness. Lower values are more deterministic. (Default: 0.7)";new J.Setting(n).setName("Temperature").setDesc(s).addSlider(u=>u.setLimits(o.temperature.min,o.temperature.max,o.temperature.step).setValue(this.plugin.settings.temperature).setDynamicTooltip().onChange(async f=>{this.temperatureDebounceTimer&&clearTimeout(this.temperatureDebounceTimer),this.plugin.settings.temperature=f,this.temperatureDebounceTimer=setTimeout(async()=>{let c=await i.validateParameters(f,this.plugin.settings.topP);!c.temperature.isValid&&c.temperature.adjustedValue!==void 0&&(u.setValue(c.temperature.adjustedValue),this.plugin.settings.temperature=c.temperature.adjustedValue,c.temperature.warning&&new J.Notice(c.temperature.warning)),await this.plugin.saveSettings()},300)}))}async createTopPSetting(n){let i=this.plugin.getModelManager(),o=await i.getParameterRanges(),r=await i.getParameterDisplayInfo(),s=r.hasModelData?`Controls diversity. Lower values are more focused. ${r.topP}`:"Controls diversity. Lower values are more focused. (Default: 1)";new J.Setting(n).setName("Top P").setDesc(s).addSlider(u=>u.setLimits(o.topP.min,o.topP.max,o.topP.step).setValue(this.plugin.settings.topP).setDynamicTooltip().onChange(async f=>{this.topPDebounceTimer&&clearTimeout(this.topPDebounceTimer),this.plugin.settings.topP=f,this.topPDebounceTimer=setTimeout(async()=>{let c=await i.validateParameters(this.plugin.settings.temperature,f);!c.topP.isValid&&c.topP.adjustedValue!==void 0&&(u.setValue(c.topP.adjustedValue),this.plugin.settings.topP=c.topP.adjustedValue,c.topP.warning&&new J.Notice(c.topP.warning)),await this.plugin.saveSettings()},300)}))}async display(){let{containerEl:n}=this;if(n.empty(),new J.Setting(n).setName("Documentation").setDesc("View the complete plugin documentation and guides").addButton(i=>i.setButtonText("View Documentation").onClick(()=>{window.open("https://github.com/allenhutchison/obsidian-gemini/tree/master/docs","_blank")})),new J.Setting(n).setName("API Key").setDesc("Gemini API Key").addText(i=>{i.setPlaceholder("Enter your API Key").setValue(this.plugin.settings.apiKey).onChange(async o=>{this.plugin.settings.apiKey=o,await this.plugin.saveSettings()}),i.inputEl.style.width="40ch"}),new J.Setting(n).setName("Model Versions").setDesc("\u2139\uFE0F Only Gemini 2.5+ models are shown. Older model versions have been deprecated by Google and are no longer supported.").addButton(i=>i.setButtonText("Learn More").onClick(()=>{window.open("https://ai.google.dev/gemini-api/docs/models/gemini")})),await Gi(n,this.plugin,"chatModelName","Chat Model","The Gemini Model used in the chat interface."),await Gi(n,this.plugin,"summaryModelName","Summary Model","The Gemini Model used for summarization."),await Gi(n,this.plugin,"completionsModelName","Completion Model","The Gemini Model used for completions."),new J.Setting(n).setName("Context Depth").setDesc("Set to true to send the context of the current file to the model, and adjust the depth of links followed for the context.").addDropdown(i=>i.addOption("0","0").addOption("1","1").addOption("2","2").addOption("3","3").addOption("4","4").setValue(this.plugin.settings.maxContextDepth.toString()).onChange(async o=>{this.plugin.settings.maxContextDepth=parseInt(o),await this.plugin.saveSettings()})).addToggle(i=>i.setValue(this.plugin.settings.sendContext).onChange(async o=>{this.plugin.settings.sendContext=o,await this.plugin.saveSettings()})),new J.Setting(n).setName("Search Grounding").setDesc("Enable the model to use Google search results in its responses.").addToggle(i=>i.setValue(this.plugin.settings.searchGrounding).onChange(async o=>{this.plugin.settings.searchGrounding=o,await this.plugin.saveSettings()})),new J.Setting(n).setName("Summary Frontmatter Key").setDesc("Key to use for frontmatter summarization.").addText(i=>i.setPlaceholder("Enter your key").setValue(this.plugin.settings.summaryFrontmatterKey).onChange(async o=>{this.plugin.settings.summaryFrontmatterKey=o,await this.plugin.saveSettings()})),new J.Setting(n).setName("Your name.").setDesc("This will be used in the system instructions for the model.").addText(i=>i.setPlaceholder("Enter your name").setValue(this.plugin.settings.userName).onChange(async o=>{this.plugin.settings.userName=o,await this.plugin.saveSettings()})),new J.Setting(n).setName("Plugin State Folder").setDesc("The folder where chat history and custom prompts will be stored. History files go in a History subfolder, prompts in a Prompts subfolder.").addText(i=>{let o=new Hi(this.app,i.inputEl,async r=>{this.plugin.settings.historyFolder=r,await this.plugin.saveSettings()});i.setValue(this.plugin.settings.historyFolder)}),new J.Setting(n).setName("Chat History").setHeading(),new J.Setting(n).setName("Enable Chat History").setDesc("Store chat history as markdown files in your vault. History files are automatically organized in the History subfolder.").addToggle(i=>i.setValue(this.plugin.settings.chatHistory).onChange(async o=>{this.plugin.settings.chatHistory=o,await this.plugin.saveSettings()})),this.plugin.settings.chatHistory){let i=new J.Setting(n).setName("Migration Status").setDesc("Checking migration status...");this.checkMigrationStatus(i)}if(new J.Setting(n).setName("Custom Prompts").setHeading(),new J.Setting(n).setName("Enable custom prompts").setDesc("Allow notes to specify custom AI instructions via frontmatter").addToggle(i=>{var o;return i.setValue((o=this.plugin.settings.enableCustomPrompts)!=null?o:!1).onChange(async r=>{this.plugin.settings.enableCustomPrompts=r,await this.plugin.saveSettings(),r&&(await this.plugin.promptManager.ensurePromptsDirectory(),await this.plugin.promptManager.createDefaultPrompts(),this.plugin.promptManager.setupPromptCommands())})}),new J.Setting(n).setName("Allow system prompt override").setDesc("WARNING: Allows custom prompts to completely replace the system prompt. This may break expected functionality.").addToggle(i=>{var o;return i.setValue((o=this.plugin.settings.allowSystemPromptOverride)!=null?o:!1).onChange(async r=>{this.plugin.settings.allowSystemPromptOverride=r,await this.plugin.saveSettings()})}),new J.Setting(n).setName("UI Settings").setHeading(),new J.Setting(n).setName("Show Model Picker").setDesc("Show the model picker in the chat interface.").addToggle(i=>i.setValue(this.plugin.settings.showModelPicker).onChange(async o=>{this.plugin.settings.showModelPicker=o,await this.plugin.saveSettings()})),new J.Setting(n).setName("Enable Streaming").setDesc("Enable streaming responses in the chat interface for a more interactive experience.").addToggle(i=>i.setValue(this.plugin.settings.streamingEnabled).onChange(async o=>{this.plugin.settings.streamingEnabled=o,await this.plugin.saveSettings()})),new J.Setting(n).setName("Developer Settings").setHeading(),new J.Setting(n).setName("Debug Mode").setDesc("Enable debug logging to the console. Useful for troubleshooting.").addToggle(i=>i.setValue(this.plugin.settings.debugMode).onChange(async o=>{this.plugin.settings.debugMode=o,await this.plugin.saveSettings()})),new J.Setting(n).setName("Show Developer Settings").setDesc("Reveal advanced settings for developers and power users.").addButton(i=>i.setButtonText(this.showDeveloperSettings?"Hide Advanced Settings":"Show Advanced Settings").setClass(this.showDeveloperSettings?"mod-warning":"mod-cta").onClick(()=>{this.showDeveloperSettings=!this.showDeveloperSettings,this.display()})),this.showDeveloperSettings){if(new J.Setting(n).setName("API Provider").setDesc("Select which AI provider to use").addDropdown(i=>i.addOption("gemini","Google Gemini (New SDK)").setValue(this.plugin.settings.apiProvider).onChange(async o=>{this.plugin.settings.apiProvider=o,await this.plugin.saveSettings()})),new J.Setting(n).setName("Maximum Retries").setDesc("Maximum number of retries when a model request fails.").addText(i=>i.setPlaceholder("e.g., 3").setValue(this.plugin.settings.maxRetries.toString()).onChange(async o=>{this.plugin.settings.maxRetries=parseInt(o),await this.plugin.saveSettings()})),new J.Setting(n).setName("Initial Backoff Delay (ms)").setDesc("Initial delay in milliseconds before the first retry. Subsequent retries will use exponential backoff.").addText(i=>i.setPlaceholder("e.g., 1000").setValue(this.plugin.settings.initialBackoffDelay.toString()).onChange(async o=>{this.plugin.settings.initialBackoffDelay=parseInt(o),await this.plugin.saveSettings()})),await this.createTemperatureSetting(n),await this.createTopPSetting(n),new J.Setting(n).setName("Model Discovery").setHeading(),new J.Setting(n).setName("Enable dynamic model discovery").setDesc("Automatically discover and update available Gemini models from Google's API").addToggle(i=>i.setValue(this.plugin.settings.modelDiscovery.enabled).onChange(async o=>{this.plugin.settings.modelDiscovery.enabled=o,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.modelDiscovery.enabled){new J.Setting(n).setName("Auto-update interval (hours)").setDesc("How often to check for new models (0 to disable auto-update)").addSlider(o=>o.setLimits(0,168,1).setValue(this.plugin.settings.modelDiscovery.autoUpdateInterval).setDynamicTooltip().onChange(async r=>{this.plugin.settings.modelDiscovery.autoUpdateInterval=r,await this.plugin.saveSettings()})),new J.Setting(n).setName("Fallback to static models").setDesc("Use built-in model list when API discovery fails").addToggle(o=>o.setValue(this.plugin.settings.modelDiscovery.fallbackToStatic).onChange(async r=>{this.plugin.settings.modelDiscovery.fallbackToStatic=r,await this.plugin.saveSettings()}));let i=new J.Setting(n).setName("Discovery status").setDesc("Current status of model discovery");i.addButton(o=>o.setButtonText("Refresh models").setTooltip("Manually refresh the model list from Google API").onClick(async()=>{o.setButtonText("Refreshing..."),o.setDisabled(!0);try{let r=await this.plugin.getModelManager().refreshModels();if(r.success){o.setButtonText("\u2713 Refreshed");let s=`Found ${r.modelsFound} models${r.changes?" (changes detected)":""}`;i.setDesc(`Last refresh: ${new Date().toLocaleTimeString()} - ${s}`)}else o.setButtonText("\u2717 Failed"),i.setDesc(`Refresh failed: ${r.error||"Unknown error"}`)}catch(r){o.setButtonText("\u2717 Error"),i.setDesc(`Error: ${r instanceof Error?r.message:"Unknown error"}`)}setTimeout(()=>{o.setButtonText("Refresh models"),o.setDisabled(!1)},2e3)})),this.updateDiscoveryStatus(i)}new J.Setting(n).setName("Tool Loop Detection").setHeading(),new J.Setting(n).setName("Enable loop detection").setDesc("Prevent the AI from repeatedly calling the same tool with identical parameters").addToggle(i=>i.setValue(this.plugin.settings.loopDetectionEnabled).onChange(async o=>{this.plugin.settings.loopDetectionEnabled=o,await this.plugin.saveSettings(),this.display()})),this.plugin.settings.loopDetectionEnabled&&(new J.Setting(n).setName("Loop threshold").setDesc("Number of identical tool calls before considering it a loop (default: 3)").addSlider(i=>i.setLimits(2,10,1).setValue(this.plugin.settings.loopDetectionThreshold).setDynamicTooltip().onChange(async o=>{this.plugin.settings.loopDetectionThreshold=o,await this.plugin.saveSettings()})),new J.Setting(n).setName("Time window (seconds)").setDesc("Time window to check for repeated calls (default: 30 seconds)").addSlider(i=>i.setLimits(10,120,5).setValue(this.plugin.settings.loopDetectionTimeWindowSeconds).setDynamicTooltip().onChange(async o=>{this.plugin.settings.loopDetectionTimeWindowSeconds=o,await this.plugin.saveSettings()})))}}};var de=require("obsidian");Nt();var Oe=class{static createModel(e,n,i){var s,u;let o=this.getModelNameForType(e,n),r=gt.createConfigFromPlugin(e,{modelConfig:{apiKey:e.settings.apiKey,model:(i==null?void 0:i.model)||o,temperature:(s=i==null?void 0:i.temperature)!=null?s:e.settings.temperature,topP:(u=i==null?void 0:i.topP)!=null?u:e.settings.topP}});return gt.createApiWithConfig(r,e)}static createChatModel(e,n){return this.createModel(e,"chat",n)}static createSummaryModel(e){return this.createModel(e,"summary")}static createCompletionsModel(e){return this.createModel(e,"completions")}static createRewriteModel(e){return this.createModel(e,"summary")}static getModelNameForType(e,n){switch(n){case"chat":return e.settings.chatModelName;case"summary":case"rewrite":return e.settings.summaryModelName;case"completions":return e.settings.completionsModelName;default:return e.settings.chatModelName}}static createCustomModel(e){return gt.createApiWithConfig(e)}};var hi="gemini-view",Yo=class extends de.ItemView{constructor(n,i){super(n);this.timerInterval=null;this.startTime=null;this.settingsUnsubscribe=null;this.currentStreamingResponse=null;this.scrollTimeout=null;this.plugin=i,this.prompts=new fe(i),this.registerLinkClickHandler(),this.registerSettingsListener(),this.fileOpenHandler=this.handleFileOpen.bind(this)}registerSettingsListener(){let n=this.plugin.saveSettings.bind(this.plugin);this.plugin.saveSettings=async()=>{await n(),await this._rebuildUIDueToSettingsChange()},this.settingsUnsubscribe=()=>{this.plugin.saveSettings=n}}async _rebuildUIDueToSettingsChange(){if(!this.contentEl){oe(this.plugin.settings.debugMode,"GeminiView: contentEl not available for UI rebuild on settings change.",null);return}oe(this.plugin.settings.debugMode,"GeminiView: Rebuilding UI due to settings change.",null),this._buildViewDOM(this.contentEl);let n=this.plugin.gfile.getActiveFile();n?await this.handleFileOpen(n):this.chatbox&&this.clearChat()}_buildViewDOM(n){n.empty(),n.createEl("h2",{text:"Gemini Chat"}),this.promptIndicator=n.createDiv({cls:"gemini-scribe-prompt-indicator"}),this.promptIndicator.style.display="none",this.chatbox=n.createDiv({cls:"gemini-scribe-chatbox"});let i=n.createDiv({cls:"gemini-scribe-input-area"}),o=i.createEl("textarea",{cls:"gemini-scribe-chat-input",attr:{placeholder:"Type your message here..."}}),r=i.createDiv({cls:"gemini-scribe-send-container"}),s=r.createEl("button",{text:"Send",cls:"gemini-scribe-send-button"});if((0,de.setIcon)(s,"send-horizontal"),this.timerDisplay=r.createDiv({cls:"gemini-scribe-timer"}),this.plugin.settings.showModelPicker){let u=n.createDiv({cls:"gemini-scribe-model-picker-area"});this.modelPicker=u.createEl("select",{cls:"gemini-scribe-model-picker"}),ke.forEach(f=>{this.modelPicker.createEl("option",{value:f.value,text:f.label})}),this.modelPicker.value=this.plugin.settings.chatModelName,this.modelPicker.addEventListener("change",async()=>{this.plugin.settings.chatModelName=this.modelPicker.value,await this.plugin.saveSettings()})}else this.modelPicker=null;o.addEventListener("keydown",async u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),s.click())}),s.addEventListener("click",async()=>{let u=o.value;if(u.trim()!==""){this.displayMessage(u,"user"),o.value="",this.startTimer();try{await this.sendMessage(u)}catch(f){console.error("Error during sendMessage call from button click:",f),new de.Notice("An unexpected error occurred while sending the message.")}finally{this.stopTimer()}}}),this.observer&&this.observer.disconnect(),this.observer=new MutationObserver(u=>{for(let f of u)f.type==="childList"&&this.scrollToBottom()}),this.observer.observe(this.chatbox,{childList:!0,subtree:!0})}registerLinkClickHandler(){this.containerEl.addEventListener("click",n=>{let i=n.target;if(i.tagName==="A"&&i.classList.contains("internal-link")){n.preventDefault();let o=i.getAttribute("href");o&&this.app.workspace.openLinkText(o,"",!0)}})}getViewType(){return hi}getDisplayText(){return"Gemini Scribe"}getIcon(){return"sparkles"}async onOpen(){this._buildViewDOM(this.contentEl),this.registerEvent(this.app.workspace.on("file-open",this.fileOpenHandler));let n=this.plugin.gfile.getActiveFile();n&&await this.handleFileOpen(n)}async onClose(){this.app.workspace.off("file-open",this.fileOpenHandler),this.observer&&(this.observer.disconnect(),this.observer=null),this.settingsUnsubscribe&&(this.settingsUnsubscribe(),this.settingsUnsubscribe=null),this.scrollTimeout&&(clearTimeout(this.scrollTimeout),this.scrollTimeout=null)}async updatePromptIndicator(){if(!this.currentFile||!this.plugin.settings.enableCustomPrompts){this.promptIndicator.style.display="none";return}let n=await this.plugin.promptManager.getPromptFromNote(this.currentFile);n?(this.promptIndicator.setText(`Using prompt: ${n.name}`),this.promptIndicator.style.display="block"):this.promptIndicator.style.display="none"}async refreshPromptIndicator(){await this.updatePromptIndicator()}async forceRefreshPromptIndicator(){if(!this.currentFile||!this.plugin.settings.enableCustomPrompts){this.promptIndicator.style.display="none";return}let n=i=>{i===this.currentFile&&(this.app.metadataCache.off("changed",n),this.updatePromptIndicator())};this.app.metadataCache.on("changed",n),setTimeout(async()=>{this.app.metadataCache.off("changed",n),await this.updatePromptIndicator()},200)}async displayMessage(n,i,o,r=!0){var f,c;let s,u;if(o)s=o,u=s.querySelector(".gemini-scribe-message");else{s=this.chatbox.createDiv({cls:`gemini-scribe-message-container ${i}`});let d=s.createDiv({cls:"gemini-scribe-sender-indicator"});switch(u=s.createDiv({cls:`gemini-scribe-message ${i}`}),i){case"user":(0,de.setIcon)(d,"square-user");break;case"model":(0,de.setIcon)(d,"bot-message-square");break;case"grounding":(0,de.setIcon)(d,"search");break;case"system":(0,de.setIcon)(d,"info");break}}if(i==="grounding")u.innerHTML=n;else{let d=(c=(f=this.plugin.gfile.getActiveFile())==null?void 0:f.path)!=null?c:"";await de.MarkdownRenderer.render(this.app,n,u,d,this)}if(i==="model"&&!o){let d=u.createEl("button",{cls:"gemini-scribe-copy-button"});(0,de.setIcon)(d,"copy"),d.addEventListener("click",()=>{let p=u.innerText||n;navigator.clipboard.writeText(p).then(()=>{new de.Notice("Message copied to clipboard.")}).catch(m=>{new de.Notice("Could not copy message to clipboard. Try selecting and copying manually.")})})}return r&&this.scrollToBottom(),s}async updateStreamingMessage(n,i){let o=n.querySelector(".gemini-scribe-message");if(o){let r=document.createTextNode(i);o.appendChild(r)}}async finalizeStreamingMessage(n,i){var r,s;let o=n.querySelector(".gemini-scribe-message");if(o){o.empty();let u=(s=(r=this.plugin.gfile.getActiveFile())==null?void 0:r.path)!=null?s:"";await de.MarkdownRenderer.render(this.app,i,o,u,this);let f=o.createEl("button",{cls:"gemini-scribe-copy-button"});(0,de.setIcon)(f,"copy"),f.addEventListener("click",()=>{let c=o.innerText||i;navigator.clipboard.writeText(c).then(()=>{new de.Notice("Message copied to clipboard.")}).catch(d=>{new de.Notice("Could not copy message to clipboard. Try selecting and copying manually.")})})}}async handleFileOpen(n){if(!n){this.currentFile=null,this.clearChat();return}let i=await this.plugin.app.vault.read(n);this.currentFile=n,await this.updatePromptIndicator();let o=await this.plugin.history.getHistoryForFile(n);this.updateChat(o)}async updateChat(n){var i;this.clearChat();for(let o of n)o.role==="model"&&((i=o.metadata)!=null&&i.rendered)?(this.displayMessage(o.message,"model"),this.displayMessage(o.metadata.rendered,"grounding")):this.displayMessage(o.message,o.role)}clearChat(){this.chatbox&&this.chatbox.empty()}async sendMessage(n){var i;if(n.trim()!=="")try{let o=(i=await this.plugin.history.getHistoryForFile(this.currentFile))!=null?i:[],r=this.prompts.generalPrompt({userMessage:n}),s;this.plugin.settings.enableCustomPrompts&&this.currentFile&&(s=await this.plugin.promptManager.getPromptFromNote(this.currentFile)||void 0);let u={userMessage:n,conversationHistory:o,model:this.plugin.settings.chatModelName,prompt:r,renderContent:!0,customPrompt:s};oe(this.plugin.settings.debugMode,"Sending message",u);let f=Oe.createChatModel(this.plugin);if(f.generateStreamingResponse&&this.plugin.settings.streamingEnabled!==!1){let c=null,d="",p=f.generateStreamingResponse(u,m=>{d+=m,c?(this.updateStreamingMessage(c,m),this.debouncedScrollToBottom()):this.displayMessage("","model").then(h=>{c=h,this.updateStreamingMessage(h,m)})});this.currentStreamingResponse=p;try{let m=await p.complete;this.currentStreamingResponse=null,c&&await this.finalizeStreamingMessage(c,m.markdown),this.plugin.settings.chatHistory&&this.currentFile&&(await this.plugin.history.appendHistoryForFile(this.currentFile,{role:"user",message:n}),await this.plugin.history.appendHistoryForFile(this.currentFile,{role:"model",message:m.markdown})),m.rendered&&await this.displayMessage(m.rendered,"grounding"),this.scrollToBottom()}catch(m){throw this.currentStreamingResponse=null,m}}else{let c=await f.generateModelResponse(u);this.plugin.settings.chatHistory&&this.currentFile?(await this.plugin.history.appendHistoryForFile(this.currentFile,{role:"user",message:n}),await this.plugin.history.appendHistoryForFile(this.currentFile,{role:"model",message:c.markdown}),this.clearChat(),await this.updateChat(await this.plugin.history.getHistoryForFile(this.currentFile)),c.rendered&&this.displayMessage(c.rendered,"grounding")):(this.displayMessage(c.markdown,"model"),c.rendered&&this.displayMessage(c.rendered,"grounding"))}}catch(o){console.error("Error in sendMessage:",o),new de.Notice("Error getting bot response.")}}scrollToBottom(){let n=()=>{let i=this.containerEl.querySelector(".gemini-scribe-input-area");i&&i.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})};n(),setTimeout(n,50),setTimeout(n,150)}debouncedScrollToBottom(){this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{this.scrollToBottom(),this.scrollTimeout=null},50)}startTimer(){this.timerDisplay.style.display="block",this.startTime=Date.now(),this.timerDisplay.textContent="0.0s",this.timerInterval=setInterval(()=>{if(this.startTime){let n=(Date.now()-this.startTime)/1e3;this.timerDisplay.textContent=`${n.toFixed(1)}s`}},100)}stopTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),setTimeout(()=>{this.timerDisplay&&(this.timerDisplay.style.display="none")},2e3)}};var H=require("obsidian");var yd=require("obsidian"),Ko=class extends yd.Modal{constructor(n,i){super(n);this.selectedFiles=new Set;this.onSelect=i}onOpen(){let{contentEl:n}=this;n.empty(),n.createEl("h2",{text:"Add Context Files"});let i=this.app.vault.getMarkdownFiles(),o=n.createDiv({cls:"gemini-file-picker-list"});i.forEach(f=>{let c=o.createDiv({cls:"gemini-file-picker-item"}),d=c.createEl("input",{type:"checkbox",value:f.path});c.createEl("label",{text:f.path,cls:"gemini-file-picker-label"}).addEventListener("click",()=>{d.checked=!d.checked,this.updateSelection(f,d.checked)}),d.addEventListener("change",()=>{this.updateSelection(f,d.checked)})});let r=n.createDiv({cls:"gemini-file-picker-buttons"});r.createEl("button",{text:"Add Selected Files",cls:"mod-cta"}).addEventListener("click",()=>{this.onSelect(Array.from(this.selectedFiles)),this.close()}),r.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()})}updateSelection(n,i){i?this.selectedFiles.add(n):this.selectedFiles.delete(n)}onClose(){let{contentEl:n}=this;n.empty()}};var Ae=require("obsidian"),Zo=class extends Ae.Modal{constructor(n,i,o,r=null){super(n);this.sessions=[];this.plugin=i,this.callbacks=o,this.currentSessionId=r}async onOpen(){let{contentEl:n}=this;n.empty(),n.addClass("gemini-session-modal"),n.createEl("h2",{text:"Agent Sessions"}),await this.loadSessions();let i=n.createDiv({cls:"gemini-session-list"});this.sessions.length===0?i.createEl("p",{text:"No agent sessions found",cls:"gemini-agent-empty-state"}):this.renderSessionList(i),n.createDiv({cls:"modal-button-container"}).createEl("button",{text:"New Session",cls:"mod-cta"}).addEventListener("click",async()=>{if(this.close(),this.callbacks.onSelect){let s=await this.plugin.sessionManager.createAgentSession();this.callbacks.onSelect(s)}})}async loadSessions(){try{let n=`${this.plugin.settings.historyFolder}/Agent-Sessions`,i=this.app.vault.getAbstractFileByPath(n),o=this.app.vault.getMarkdownFiles().filter(r=>r.path.startsWith(n+"/"));for(let r of o)try{let s=await this.plugin.sessionManager.loadSession(r.path);s&&this.sessions.push(s)}catch(s){console.error(`Failed to load session from ${r.path}:`,s)}this.sessions.sort((r,s)=>{let u=this.app.vault.getAbstractFileByPath(r.historyPath),f=this.app.vault.getAbstractFileByPath(s.historyPath);return u&&f&&u instanceof Ae.TFile&&f instanceof Ae.TFile?f.stat.mtime-u.stat.mtime:0})}catch(n){console.error("Failed to load sessions:",n),new Ae.Notice("Failed to load agent sessions")}}renderSessionList(n){for(let i of this.sessions){let o=n.createDiv({cls:`gemini-session-item ${i.id===this.currentSessionId?"gemini-session-item-active":""}`}),r=o.createDiv({cls:"gemini-session-info"});r.createDiv({text:i.title,cls:"gemini-session-title"});let s=r.createDiv({cls:"gemini-session-meta"}),u=i.context.contextFiles.length,f=u===1?"1 file":`${u} files`,c=this.app.vault.getAbstractFileByPath(i.historyPath);if(c&&c instanceof Ae.TFile){let m=new Date(c.stat.mtime),h=m.toLocaleDateString(),y=m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});s.createSpan({text:`${f} \u2022 ${h} ${y}`})}else s.createSpan({text:f});let d=o.createDiv({cls:"gemini-session-actions"}),p=d.createEl("button",{cls:"gemini-session-action-btn",title:"Open session"});if((0,Ae.setIcon)(p,"arrow-right"),this.callbacks.onDelete){let m=d.createEl("button",{cls:"gemini-session-action-btn delete",title:"Delete session"});(0,Ae.setIcon)(m,"trash-2"),m.addEventListener("click",async h=>{h.stopPropagation(),confirm(`Delete session "${i.title}"?`)&&await this.deleteSession(i)})}o.addEventListener("click",()=>{this.callbacks.onSelect(i),this.close()})}}async deleteSession(n){try{let i=this.app.vault.getAbstractFileByPath(n.historyPath);if(i){await this.app.vault.delete(i),new Ae.Notice(`Session "${n.title}" deleted`);let{contentEl:o}=this,r=o.querySelector(".gemini-session-list");r&&(r.empty(),await this.loadSessions(),this.renderSessionList(r)),this.callbacks.onDelete&&this.callbacks.onDelete(n)}}catch(i){console.error("Failed to delete session:",i),new Ae.Notice("Failed to delete session")}}onClose(){let{contentEl:n}=this;n.empty()}};var gi=require("obsidian"),Qo=class extends gi.FuzzySuggestModal{constructor(e,n){super(e),this.onSelect=n,this.setPlaceholder("Select a file or folder to mention...")}getItems(){let e=[];e.push(...this.app.vault.getMarkdownFiles());let n=i=>{if(!(i.path===".obsidian"||i.path.startsWith(".obsidian/"))&&!(i.path==="gemini-scribe"||i.path.startsWith("gemini-scribe/"))){i.path&&e.push(i);for(let o of i.children)o instanceof gi.TFolder&&n(o)}};return n(this.app.vault.getRoot()),e}getItemText(e){return e instanceof gi.TFolder?`\u{1F4C1} ${e.path}/`:e.path}onChooseItem(e,n){this.onSelect(e)}};var We=require("obsidian"),Xo=class extends We.Modal{constructor(n,i,o,r){super(n);this.tempSlider=null;this.topPSlider=null;this.plugin=i,this.session=o,this.onSave=r,this.modelConfig={...o.modelConfig}}async onOpen(){var d,p;let{contentEl:n}=this;n.empty(),n.createEl("h2",{text:"Session Settings"});let i=await this.plugin.getModelManager().getAvailableModels(),o=new We.Setting(n).setName("Model").setDesc("Select the AI model for this session"),r;o.addDropdown(m=>{r=m,m.addOption("__default__","Use default"),i.forEach(h=>{m.addOption(h.value,h.label)}),m.setValue(this.modelConfig.model||"__default__"),m.onChange(async h=>{h==="__default__"?delete this.modelConfig.model:this.modelConfig.model=h,await this.saveConfig()})}).addExtraButton(m=>{m.setIcon("reset").setTooltip("Reset to default").onClick(async()=>{if(r){r.setValue("__default__");let h=new Event("change",{bubbles:!0});r.selectEl.dispatchEvent(h)}})}),new We.Setting(n).setName("Temperature").setDesc("Controls randomness (0 = deterministic, 2 = very creative)").addSlider(m=>{var v;this.tempSlider=m;let h=this.plugin.settings.temperature,y=(v=this.modelConfig.temperature)!=null?v:h;m.setLimits(0,2,.1).setValue(y).setDynamicTooltip().onChange(async T=>{T!==h?this.modelConfig.temperature=T:delete this.modelConfig.temperature,await this.saveConfig()}),m.sliderEl.addEventListener("input",()=>{let T=n.querySelector(".temperature-value");T&&(T.textContent=m.getValue().toFixed(1))})}).addExtraButton(m=>{m.setIcon("reset").setTooltip("Reset to default").onClick(async()=>{this.tempSlider&&this.tempSlider.setValue(this.plugin.settings.temperature)})});let s=n.createDiv({cls:"temperature-value"});s.textContent=((d=this.modelConfig.temperature)!=null?d:this.plugin.settings.temperature).toFixed(1),new We.Setting(n).setName("Top-P").setDesc("Nucleus sampling threshold (0 = only top token, 1 = all tokens)").addSlider(m=>{var v;this.topPSlider=m;let h=this.plugin.settings.topP,y=(v=this.modelConfig.topP)!=null?v:h;m.setLimits(0,1,.05).setValue(y).setDynamicTooltip().onChange(async T=>{T!==h?this.modelConfig.topP=T:delete this.modelConfig.topP,await this.saveConfig()}),m.sliderEl.addEventListener("input",()=>{let T=n.querySelector(".top-p-value");T&&(T.textContent=m.getValue().toFixed(2))})}).addExtraButton(m=>{m.setIcon("reset").setTooltip("Reset to default").onClick(async()=>{this.topPSlider&&this.topPSlider.setValue(this.plugin.settings.topP)})});let u=n.createDiv({cls:"top-p-value"});u.textContent=((p=this.modelConfig.topP)!=null?p:this.plugin.settings.topP).toFixed(2);let f=new We.Setting(n).setName("Prompt Template").setDesc("Select a custom prompt template for this session"),c;f.addDropdown(m=>{c=m,m.addOption("__default__","Use default prompt");let h=`${this.plugin.settings.historyFolder}/Prompts`,y=this.plugin.app.vault.getAbstractFileByPath(h);y&&y instanceof We.TFolder&&y.children.filter(T=>T instanceof We.TFile&&T.extension==="md").map(T=>T.path).forEach(T=>{var _;let S=((_=T.split("/").pop())==null?void 0:_.replace(".md",""))||T;m.addOption(T,S)}),m.setValue(this.modelConfig.promptTemplate||"__default__"),m.onChange(async v=>{v==="__default__"?delete this.modelConfig.promptTemplate:this.modelConfig.promptTemplate=v,await this.saveConfig()})}).addExtraButton(m=>{m.setIcon("reset").setTooltip("Reset to default").onClick(async()=>{if(c){c.setValue("__default__");let h=new Event("change",{bubbles:!0});c.selectEl.dispatchEvent(h)}})}),n.createDiv({text:"These settings override the global defaults for this session only. Changes are saved automatically.",cls:"setting-item-description"})}onClose(){let{contentEl:n}=this;n.empty()}async saveConfig(){let n={};this.modelConfig.model!==void 0&&(n.model=this.modelConfig.model),this.modelConfig.temperature!==void 0&&(n.temperature=this.modelConfig.temperature),this.modelConfig.topP!==void 0&&(n.topP=this.modelConfig.topP),this.modelConfig.promptTemplate!==void 0&&(n.promptTemplate=this.modelConfig.promptTemplate),await this.onSave(n)}};var nr=require("obsidian"),vd=Kn(di());var et=require("obsidian");Mt();var Sn=class{constructor(e){this.activeSessions=new Map;this.HISTORY_FOLDER="History";this.AGENT_SESSIONS_FOLDER="Agent-Sessions";this.plugin=e}async createNoteChatSession(e){let n={...yi.NOTE_CHAT,contextFiles:[e]},i=this.sanitizeFileName(`${e.basename} Chat`),o={id:this.generateSessionId(),type:"note-chat",title:i,context:n,created:new Date,lastActive:new Date,historyPath:`${this.getHistoryFolderPath()}/${i}.md`,sourceNotePath:e.path};return this.activeSessions.set(o.id,o),o}async createAgentSession(e,n){let i={...yi.AGENT_SESSION,...n},o=e||`Agent Session ${new Date().toLocaleDateString()}`,r=this.sanitizeFileName(o),s={id:this.generateSessionId(),type:"agent-session",title:r,context:i,created:new Date,lastActive:new Date,historyPath:`${this.getAgentSessionsFolderPath()}/${r}.md`};return this.activeSessions.set(s.id,s),s}async getNoteChatSession(e){let n=Array.from(this.activeSessions.values()).find(s=>s.type==="note-chat"&&s.sourceNotePath===e.path);if(n)return n.lastActive=new Date,n;let i=this.sanitizeFileName(`${e.basename} Chat`),o=`${this.getHistoryFolderPath()}/${i}.md`,r=this.plugin.app.vault.getAbstractFileByPath(o);return r instanceof et.TFile?this.loadSessionFromFile(r):this.createNoteChatSession(e)}async getRecentAgentSessions(e=10){let i=(await this.getOrCreateAgentSessionsFolder()).children.filter(r=>r instanceof et.TFile&&r.extension==="md").sort((r,s)=>s.stat.mtime-r.stat.mtime).slice(0,e),o=[];for(let r of i)try{let s=await this.loadSessionFromFile(r);o.push(s)}catch(s){console.warn(`Failed to load agent session from ${r.path}:`,s)}return o}async updateSessionContext(e,n){let i=this.activeSessions.get(e);i&&(i.context={...i.context,...n},i.lastActive=new Date,i.type==="agent-session"&&await this.plugin.history.updateSessionMetadata(i))}async updateSessionModelConfig(e,n){let i=this.activeSessions.get(e);i&&(Object.keys(n).length===0?i.modelConfig=void 0:i.modelConfig=n,i.lastActive=new Date,i.type==="agent-session"&&await this.plugin.history.updateSessionMetadata(i))}async addContextFiles(e,n){let i=this.activeSessions.get(e);if(i){let o=i.context.contextFiles.map(s=>s.path),r=n.filter(s=>!o.includes(s.path));i.context.contextFiles.push(...r),i.lastActive=new Date,i.type==="agent-session"&&await this.plugin.history.updateSessionMetadata(i)}}async removeContextFiles(e,n){let i=this.activeSessions.get(e);i&&(i.context.contextFiles=i.context.contextFiles.filter(o=>!n.includes(o.path)),i.lastActive=new Date,i.type==="agent-session"&&await this.plugin.history.updateSessionMetadata(i))}async promoteToAgentSession(e,n){let i=this.activeSessions.get(e);if(!i||i.type!=="note-chat")throw new Error("Session not found or not a note chat");return await this.createAgentSession(n||`${i.title} (Agent)`,{contextFiles:i.context.contextFiles,contextDepth:Math.max(i.context.contextDepth,3)})}getSession(e){return this.activeSessions.get(e)}async loadSession(e){let n=this.plugin.app.vault.getAbstractFileByPath(e);return n instanceof et.TFile?this.loadSessionFromFile(n):null}async loadSessionFromFile(e){var s;let n=await this.plugin.app.vault.read(e),i=(s=this.plugin.app.metadataCache.getFileCache(e))==null?void 0:s.frontmatter,o=e.path.startsWith(this.getAgentSessionsFolderPath()),r={id:(i==null?void 0:i.session_id)||this.generateSessionId(),type:o?"agent-session":"note-chat",title:(i==null?void 0:i.title)||e.basename,context:this.parseContextFromFrontmatter(i),modelConfig:this.parseModelConfigFromFrontmatter(i),created:i!=null&&i.created?new Date(i.created):new Date(e.stat.ctime),lastActive:new Date(e.stat.mtime),historyPath:e.path,sourceNotePath:i==null?void 0:i.source_note_path};return this.activeSessions.set(r.id,r),r}parseContextFromFrontmatter(e){if(!e)return yi.NOTE_CHAT;let n=[];if(e.context_files)for(let i of e.context_files){let o=null;if(typeof i=="string")if(i.startsWith("[[")&&i.endsWith("]]")){let r=i.slice(2,-2),s=this.plugin.app.metadataCache.getFirstLinkpathDest(r,"");o=s instanceof et.TFile?s:null}else{let r=this.plugin.app.vault.getAbstractFileByPath(i);o=r instanceof et.TFile?r:null}o instanceof et.TFile&&n.push(o)}return{contextFiles:n,contextDepth:e.context_depth||2,enabledTools:e.enabled_tools||yi.NOTE_CHAT.enabledTools,requireConfirmation:e.require_confirmation||[],maxContextChars:e.max_context_chars,maxCharsPerFile:e.max_chars_per_file}}parseModelConfigFromFrontmatter(e){if(!e)return;let n={},i=!1;return e.model&&(n.model=e.model,i=!0),e.temperature!==void 0&&(n.temperature=Number(e.temperature),i=!0),e.top_p!==void 0&&(n.topP=Number(e.top_p),i=!0),e.prompt_template&&(n.promptTemplate=e.prompt_template,i=!0),i?n:void 0}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getHistoryFolderPath(){return`${this.plugin.settings.historyFolder}/${this.HISTORY_FOLDER}`}getAgentSessionsFolderPath(){return`${this.plugin.settings.historyFolder}/${this.AGENT_SESSIONS_FOLDER}`}async getOrCreateAgentSessionsFolder(){let e=this.getAgentSessionsFolderPath(),n=this.plugin.app.vault.getAbstractFileByPath(e);if(!(n instanceof et.TFolder)&&(await this.plugin.app.vault.createFolder(e),n=this.plugin.app.vault.getAbstractFileByPath(e),!(n instanceof et.TFolder)))throw new Error(`Failed to create or access folder: ${e}`);return n}sanitizeFileName(e){return e.replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").trim().slice(0,100)}};var Je=require("obsidian"),jo=class extends Je.Modal{constructor(e,n,i,o){super(e),this.tool=n,this.parameters=i,this.onConfirm=o}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("gemini-tool-confirmation-modal");let n=e.createDiv({cls:"gemini-tool-modal-header"}),i=n.createDiv({cls:"gemini-tool-modal-icon"});this.setToolIcon(i);let o=n.createDiv({cls:"gemini-tool-modal-header-text"});o.createEl("h2",{text:"Tool Confirmation Required"}),o.createEl("p",{text:"The AI assistant wants to execute the following action:",cls:"gemini-tool-modal-subtitle"});let r=e.createDiv({cls:"gemini-tool-card"}),s=r.createDiv({cls:"gemini-tool-card-header"}),u=s.createDiv({cls:"gemini-tool-name-badge"}),f=this.tool.displayName||this.tool.name;u.createSpan({text:f,cls:"gemini-tool-name-text"});let c=s.createDiv({cls:"gemini-tool-category-badge"});if(c.textContent=this.getCategoryLabel(),r.createDiv({cls:"gemini-tool-description"}).createEl("p",{text:this.tool.description}),this.parameters&&Object.keys(this.parameters).length>0){let x=e.createDiv({cls:"gemini-tool-params-section"}),C=x.createDiv({cls:"gemini-tool-params-header"}),w=C.createSpan({cls:"gemini-tool-params-icon"});(0,Je.setIcon)(w,"settings-2"),C.createSpan({text:"Parameters",cls:"gemini-tool-params-title"});let P=x.createDiv({cls:"gemini-tool-params-container"});for(let[M,b]of Object.entries(this.parameters)){let k=P.createDiv({cls:"gemini-tool-param-row"});k.createDiv({cls:"gemini-tool-param-key"}).createSpan({text:M});let O=k.createDiv({cls:"gemini-tool-param-value"});if(typeof b=="string"&&b.length>100){let $=O.createDiv({cls:"gemini-tool-param-content gemini-tool-param-collapsed"});$.createEl("code",{text:b});let le=O.createEl("button",{cls:"gemini-tool-expand-btn"});(0,Je.setIcon)(le,"chevron-down");let ue=!1;le.addEventListener("click",()=>{ue=!ue,ue?($.removeClass("gemini-tool-param-collapsed"),(0,Je.setIcon)(le,"chevron-up")):($.addClass("gemini-tool-param-collapsed"),(0,Je.setIcon)(le,"chevron-down"))})}else O.createEl("code",{text:JSON.stringify(b,null,2),cls:"gemini-tool-param-code"})}}if(this.tool.confirmationMessage){let x=e.createDiv({cls:"gemini-tool-custom-message"}),C=x.createDiv({cls:"gemini-tool-message-icon"});(0,Je.setIcon)(C,"info");let w=x.createDiv({cls:"gemini-tool-message-content"}),P=this.tool.confirmationMessage(this.parameters);w.createEl("p",{text:P})}let m=e.createDiv({cls:"gemini-tool-allow-container"}).createEl("label",{cls:"gemini-tool-allow-label"}),h=m.createEl("input",{type:"checkbox",cls:"gemini-tool-allow-checkbox"});m.createSpan({text:"Allow this action in the future without confirmation (this session only)",cls:"gemini-tool-allow-text"});let y=e.createDiv({cls:"gemini-tool-buttons"}),v=y.createEl("button",{cls:"gemini-tool-cancel-btn"}),T=v.createSpan({cls:"gemini-tool-btn-icon"});(0,Je.setIcon)(T,"x"),v.createSpan({text:"Cancel"});let S=y.createEl("button",{cls:"gemini-tool-confirm-btn mod-cta"}),_=S.createSpan({cls:"gemini-tool-btn-icon"});(0,Je.setIcon)(_,"check"),S.createSpan({text:"Execute Tool"}),v.addEventListener("click",()=>{this.close(),this.onConfirm(!1,!1)}),S.addEventListener("click",()=>{this.close(),this.onConfirm(!0,h.checked)}),this.scope.register([],"Escape",()=>{this.close(),this.onConfirm(!1,!1)})}onClose(){let{contentEl:e}=this;e.empty()}setToolIcon(e){let i={read_file:"file-text",write_file:"file-edit",list_files:"folder-open",create_folder:"folder-plus",delete_file:"trash-2",move_file:"file-symlink",search_files:"search",google_search:"globe",web_fetch:"download"}[this.tool.name]||"tool";(0,Je.setIcon)(e,i)}getCategoryLabel(){return{read_file:"Read Only",list_files:"Read Only",search_files:"Read Only",write_file:"Vault Operation",create_folder:"Vault Operation",delete_file:"Vault Operation",move_file:"Vault Operation",google_search:"External",web_fetch:"External"}[this.tool.name]||"Tool"}};var er=class{constructor(e=3,n=30){this.executionHistory=new Map;this.maxHistorySize=100;this.loopThreshold=e,this.timeWindowMs=n*1e3}updateConfig(e,n){this.loopThreshold=e,this.timeWindowMs=n*1e3}recordExecution(e,n){let i=this.getToolCallKey(n),o=Date.now();this.executionHistory.has(e)||this.executionHistory.set(e,[]);let r=this.executionHistory.get(e);r.push({key:i,timestamp:o,toolCall:n}),r.length>this.maxHistorySize&&r.shift(),this.cleanupOldEntries(e)}isLoopDetected(e,n){let i=this.getToolCallKey(n),o=this.executionHistory.get(e)||[],r=Date.now();return o.filter(u=>u.key===i&&r-u.timestamp<this.timeWindowMs).length>=this.loopThreshold}getLoopInfo(e,n){var f;let i=this.getToolCallKey(n),o=this.executionHistory.get(e)||[],r=Date.now(),s=o.filter(c=>c.key===i&&r-c.timestamp<this.timeWindowMs),u=this.countConsecutiveCalls(o,i);return{isLoop:s.length>=this.loopThreshold,identicalCallCount:s.length,consecutiveCallCount:u,timeWindowMs:this.timeWindowMs,lastCallTimestamp:(f=s[s.length-1])==null?void 0:f.timestamp}}clearSession(e){this.executionHistory.delete(e)}getToolCallKey(e){let n=JSON.stringify(this.sortObject(e.arguments));return`${e.name}:${n}`}sortObject(e){return e===null||typeof e!="object"?e:Array.isArray(e)?e.map(n=>this.sortObject(n)):Object.keys(e).sort().reduce((n,i)=>(n[i]=this.sortObject(e[i]),n),{})}countConsecutiveCalls(e,n){let i=0;for(let o=e.length-1;o>=0&&e[o].key===n;o--)i++;return i}cleanupOldEntries(e){let n=this.executionHistory.get(e);if(!n)return;let i=Date.now(),o=n.filter(r=>i-r.timestamp<this.timeWindowMs*2);this.executionHistory.set(e,o)}};var wn=class{constructor(e,n){this.executionHistory=new Map;this.plugin=e,this.registry=n,this.loopDetector=new er(e.settings.loopDetectionThreshold,e.settings.loopDetectionTimeWindowSeconds)}async executeTool(e,n,i){var c,d;let o=this.registry.getTool(e.name);if(!o)return{success:!1,error:`Tool ${e.name} not found`};let r=this.registry.validateParameters(e.name,e.arguments);if(!r.valid)return{success:!1,error:`Invalid parameters: ${(c=r.errors)==null?void 0:c.join(", ")}`};if(this.plugin.settings.loopDetectionEnabled){this.loopDetector.updateConfig(this.plugin.settings.loopDetectionThreshold,this.plugin.settings.loopDetectionTimeWindowSeconds);let p=this.loopDetector.getLoopInfo(n.session.id,e);if(p.isLoop)return console.warn(`Loop detected for tool ${e.name}:`,p),{success:!1,error:`Execution loop detected: ${e.name} has been called ${p.identicalCallCount} times with the same parameters in the last ${p.timeWindowMs/1e3} seconds. Please try a different approach.`}}if(!this.registry.getEnabledTools(n).includes(o))return{success:!1,error:`Tool ${o.name} is not enabled for this session`};let u=this.registry.requiresConfirmation(e.name,n);if(u&&!(((d=i==null?void 0:i.isToolAllowedWithoutConfirmation)==null?void 0:d.call(i,e.name))||!1)){let m=await this.requestUserConfirmation(o,e.arguments);if(!m.confirmed)return{success:!1,error:"User declined tool execution"};m.allowWithoutConfirmation&&i&&i.allowToolWithoutConfirmation(e.name)}let f={hide:()=>{}};try{this.loopDetector.recordExecution(n.session.id,e);let p=await o.execute(e.arguments,n),m={toolName:o.name,parameters:e.arguments,result:p,timestamp:new Date,confirmed:u};return this.addToHistory(n.session.id,m),f.hide(),p}catch(p){return f.hide(),{success:!1,error:p instanceof Error?p.message:"Unknown error"}}}async executeToolCalls(e,n,i){let o=[];for(let r of e){let s=await this.executeTool(r,n,i);if(o.push(s),!s.success&&this.plugin.settings.stopOnToolError!==!1)break}return o}async requestUserConfirmation(e,n){return new Promise(i=>{new jo(this.plugin.app,e,n,(r,s)=>{i({confirmed:r,allowWithoutConfirmation:s||!1})}).open()})}addToHistory(e,n){let i=this.executionHistory.get(e)||[];i.push(n),this.executionHistory.set(e,i)}getExecutionHistory(e){return this.executionHistory.get(e)||[]}clearExecutionHistory(e){this.executionHistory.delete(e),this.loopDetector.clearSession(e)}formatToolResult(e){let n=e.result.success?"\u2713":"\u2717",i=e.result.success?"Success":"Failed",o=`### Tool Execution: ${e.toolName}

`;return o+=`**Status:** ${n} ${i}

`,e.result.data&&(o+=`**Result:**
\`\`\`json
${JSON.stringify(e.result.data,null,2)}
\`\`\`
`),e.result.error&&(o+=`**Error:** ${e.result.error}
`),o}getAvailableToolsDescription(e){var o;let n=this.registry.getEnabledTools(e);if(n.length===0)return"No tools are currently available.";let i=`## Available Tools

`;for(let r of n)if(i+=`### ${r.name}
`,i+=`${r.description}

`,r.parameters.properties&&Object.keys(r.parameters.properties).length>0){i+=`**Parameters:**
`;for(let[s,u]of Object.entries(r.parameters.properties)){let f=(o=r.parameters.required)!=null&&o.includes(s)?" (required)":"";i+=`- \`${s}\` (${u.type})${f}: ${u.description}
`}i+=`
`}return i}};Mt();var Mn=class{constructor(e){this.tools=new Map;this.plugin=e}registerTool(e){this.tools.has(e.name)&&console.warn(`Tool ${e.name} is already registered, overwriting...`),this.tools.set(e.name,e)}unregisterTool(e){return this.tools.delete(e)}getTool(e){return this.tools.get(e)}getAllTools(){return Array.from(this.tools.values())}getToolsByCategory(e){return this.getAllTools().filter(n=>n.category===e)}getEnabledTools(e){let n=e.session.context.enabledTools;return this.getAllTools().filter(i=>n.includes(i.category))}requiresConfirmation(e,n){let i=this.getTool(e);if(!i)return!1;if(i.requiresConfirmation)return!0;let o=n.session.context.requireConfirmation,s={vault_ops:"modify_files",external_mcp:"external_calls"}[i.category];return s?o.includes(s):!1}getToolDescriptions(e){return this.getEnabledTools(e).map(i=>({type:"function",function:{name:i.name,description:i.description,parameters:i.parameters}}))}validateParameters(e,n){let i=this.getTool(e);if(!i)return{valid:!1,errors:[`Tool ${e} not found`]};let o=[],r=i.parameters;if(r.required)for(let s of r.required)s in n||o.push(`Missing required parameter: ${s}`);for(let[s,u]of Object.entries(n)){let f=r.properties[s];if(!f){o.push(`Unknown parameter: ${s}`);continue}let c=Array.isArray(u)?"array":typeof u;c!==f.type&&o.push(`Parameter ${s} should be ${f.type} but got ${c}`),f.enum&&!f.enum.includes(u)&&o.push(`Parameter ${s} must be one of: ${f.enum.join(", ")}`)}return{valid:o.length===0,errors:o.length>0?o:void 0}}};var Fn=class{static createAgent(e,n){let i=new Sn(e),o=new Mn(e),r=new wn(e,o);return{sessionManager:i,toolRegistry:o,executionEngine:r}}static createAgentView(e,n,i,o){return new xn(e,n)}static createAgentModel(e,n){return Oe.createChatModel(e,n.modelConfig)}static createAgentTaskModel(e,n,i){return this.createAgentModel(e,n.session)}static async initializeAgent(e){let{sessionManager:n,toolRegistry:i,executionEngine:o}=this.createAgent(e,e.app);e.sessionManager=n,e.toolRegistry=i,e.executionEngine=o}};var vi="gemini-agent-view",xn=class extends H.ItemView{constructor(n,i){super(n);this.currentSession=null;this.currentStreamingResponse=null;this.mentionedFiles=[];this.allowedWithoutConfirmation=new Set;this.scrollTimeout=null;this.plugin=i}getViewType(){return vi}getDisplayText(){return"Agent Mode"}getIcon(){return"bot"}async onOpen(){let n=this.containerEl.children[1];n.empty(),n.addClass("gemini-agent-container"),this.createAgentInterface(n),this.registerLinkClickHandler(),await this.createNewSession()}createAgentInterface(n){n.addClass("gemini-agent-container"),this.sessionHeader=n.createDiv({cls:"gemini-agent-header gemini-agent-header-compact"}),this.createCompactHeader(),this.contextPanel=n.createDiv({cls:"gemini-agent-context-panel gemini-agent-context-panel-collapsed"}),this.createContextPanel(),this.chatContainer=n.createDiv({cls:"gemini-agent-chat"}),this.showEmptyState();let i=n.createDiv({cls:"gemini-agent-input-area"});this.createInputArea(i)}createCompactHeader(){var d,p,m,h;this.sessionHeader.empty();let n=this.sessionHeader.createDiv({cls:"gemini-agent-header-left"}),i=n.createEl("button",{cls:"gemini-agent-toggle-btn",title:"Toggle context panel"});(0,H.setIcon)(i,"chevron-down"),i.addEventListener("click",()=>{this.contextPanel.hasClass("gemini-agent-context-panel-collapsed")?(this.contextPanel.removeClass("gemini-agent-context-panel-collapsed"),(0,H.setIcon)(i,"chevron-up")):(this.contextPanel.addClass("gemini-agent-context-panel-collapsed"),(0,H.setIcon)(i,"chevron-down"))});let o=n.createDiv({cls:"gemini-agent-title-container"}),r=o.createEl("span",{text:((d=this.currentSession)==null?void 0:d.title)||"New Agent Session",cls:"gemini-agent-title-compact"});if(r.addEventListener("dblclick",()=>{if(!this.currentSession)return;let y=o.createEl("input",{type:"text",value:this.currentSession.title,cls:"gemini-agent-title-input-compact"});r.style.display="none",y.focus(),y.select();let v=async()=>{let T=y.value.trim();if(T&&T!==this.currentSession.title){let S=this.currentSession.historyPath,_=this.plugin.sessionManager.sanitizeFileName(T),x=S.substring(0,S.lastIndexOf("/")+1)+_+".md",C=this.plugin.app.vault.getAbstractFileByPath(S);C&&(await this.plugin.app.fileManager.renameFile(C,x),this.currentSession.historyPath=x),this.currentSession.title=T,await this.updateSessionMetadata()}r.textContent=this.currentSession.title,r.style.display="",y.remove()};y.addEventListener("blur",v),y.addEventListener("keydown",T=>{T.key==="Enter"?(T.preventDefault(),v()):T.key==="Escape"&&(r.style.display="",y.remove())})}),this.currentSession){let y=n.createEl("span",{cls:"gemini-agent-context-badge",text:`${this.currentSession.context.contextFiles.length} files \u2022 Depth ${this.currentSession.context.contextDepth}`})}if((p=this.currentSession)!=null&&p.modelConfig&&(this.currentSession.modelConfig.model||this.currentSession.modelConfig.temperature!==void 0||this.currentSession.modelConfig.topP!==void 0||this.currentSession.modelConfig.promptTemplate)){let v=[];if(this.currentSession.modelConfig.model&&v.push(`Model: ${this.currentSession.modelConfig.model}`),this.currentSession.modelConfig.temperature!==void 0&&v.push(`Temperature: ${this.currentSession.modelConfig.temperature}`),this.currentSession.modelConfig.topP!==void 0&&v.push(`Top-P: ${this.currentSession.modelConfig.topP}`),this.currentSession.modelConfig.promptTemplate){let T=((m=this.currentSession.modelConfig.promptTemplate.split("/").pop())==null?void 0:m.replace(".md",""))||"custom";v.push(`Prompt: ${T}`)}if(this.currentSession.modelConfig.promptTemplate){let T=((h=this.currentSession.modelConfig.promptTemplate.split("/").pop())==null?void 0:h.replace(".md",""))||"Custom";n.createEl("span",{cls:"gemini-agent-prompt-badge",text:T,attr:{title:v.join(`
`)}})}else{let T=n.createEl("span",{cls:"gemini-agent-settings-indicator",attr:{title:v.join(`
`)}});(0,H.setIcon)(T,"sliders-horizontal")}}let s=this.sessionHeader.createDiv({cls:"gemini-agent-header-right"}),u=s.createEl("button",{cls:"gemini-agent-btn gemini-agent-btn-icon",title:"Session Settings"});(0,H.setIcon)(u,"settings"),u.addEventListener("click",()=>this.showSessionSettings());let f=s.createEl("button",{cls:"gemini-agent-btn gemini-agent-btn-icon",title:"New Session"});(0,H.setIcon)(f,"plus"),f.addEventListener("click",()=>this.createNewSession());let c=s.createEl("button",{cls:"gemini-agent-btn gemini-agent-btn-icon",title:"Browse Sessions"});(0,H.setIcon)(c,"list"),c.addEventListener("click",()=>this.showSessionList())}createSessionHeader(){this.createCompactHeader()}createContextPanel(){var u;this.contextPanel.empty();let n=this.contextPanel.createDiv({cls:"gemini-agent-context-controls"}),i=n.createEl("button",{cls:"gemini-agent-btn gemini-agent-btn-sm",title:"Add context files"});(0,H.setIcon)(i,"plus"),i.createSpan({text:" Add Files"}),i.addEventListener("click",()=>this.showFilePicker());let o=n.createDiv({cls:"gemini-agent-depth-control-inline"});o.createSpan({text:"Depth:",cls:"gemini-agent-depth-label"});let r=o.createEl("input",{type:"number",cls:"gemini-agent-depth-input-sm",value:((u=this.currentSession)==null?void 0:u.context.contextDepth.toString())||"2"});r.min="0",r.max="10",r.addEventListener("change",()=>{let f=parseInt(r.value);this.currentSession&&(this.currentSession.context.contextDepth=f,this.updateSessionMetadata(),this.createCompactHeader())});let s=this.contextPanel.createDiv({cls:"gemini-agent-files-list gemini-agent-files-list-compact"});this.updateContextFilesList(s)}createInputArea(n){this.userInput=n.createDiv({cls:"gemini-agent-input gemini-agent-input-rich",attr:{contenteditable:"true","data-placeholder":"Message the agent... (@ to mention files)"}}),this.sendButton=n.createEl("button",{text:"Send",cls:"gemini-agent-btn gemini-agent-btn-primary gemini-agent-send-btn"}),this.userInput.addEventListener("keydown",i=>{i.key==="Enter"&&!i.shiftKey?(i.preventDefault(),this.sendMessage()):i.key==="@"&&(i.preventDefault(),this.showFileMention())}),this.userInput.addEventListener("paste",i=>{var r;i.preventDefault();let o=((r=i.clipboardData)==null?void 0:r.getData("text/plain"))||"";document.execCommand("insertText",!1,o)}),this.sendButton.addEventListener("click",()=>this.sendMessage())}updateContextFilesList(n){if(n.empty(),!this.currentSession||this.currentSession.context.contextFiles.length===0){n.createEl("p",{text:"No context files selected",cls:"gemini-agent-empty-state"});return}this.currentSession.context.contextFiles.forEach(i=>{let o=n.createDiv({cls:"gemini-agent-file-item"}),r=o.createEl("span",{cls:"gemini-agent-file-icon"});(0,H.setIcon)(r,"file-text");let s=o.createEl("span",{text:i.basename,cls:"gemini-agent-file-name",title:i.path});o.createEl("button",{text:"\xD7",cls:"gemini-agent-remove-btn",title:"Remove file"}).addEventListener("click",()=>{this.removeContextFile(i)})})}async showFilePicker(){if(!this.currentSession)return;new Ko(this.app,i=>{i.forEach(o=>{this.currentSession.context.contextFiles.includes(o)||this.currentSession.context.contextFiles.push(o)}),this.updateContextFilesList(this.contextPanel.querySelector(".gemini-agent-files-list")),this.updateSessionHeader(),this.updateSessionMetadata()}).open()}removeContextFile(n){if(!this.currentSession)return;let i=this.currentSession.context.contextFiles.indexOf(n);i>-1&&(this.currentSession.context.contextFiles.splice(i,1),this.updateContextFilesList(this.contextPanel.querySelector(".gemini-agent-files-list")),this.updateSessionHeader(),this.updateSessionMetadata())}async createNewSession(){try{this.currentSession=null,this.chatContainer.empty(),this.mentionedFiles=[],this.allowedWithoutConfirmation.clear(),this.userInput&&(this.userInput.innerHTML=""),this.currentSession=await this.plugin.sessionManager.createAgentSession(),this.createSessionHeader(),this.createContextPanel(),this.showEmptyState(),this.userInput.focus()}catch(n){console.error("Failed to create agent session:",n),new H.Notice("Failed to create agent session")}}async loadSessionHistory(){if(this.currentSession)try{let n=await this.plugin.sessionHistory.getHistoryForSession(this.currentSession);this.chatContainer.empty();for(let i of n)await this.displayMessage(i)}catch(n){console.error("Failed to load session history:",n)}}async displayMessage(n){var d,p,m;let i=this.chatContainer.querySelector(".gemini-agent-empty-chat");i&&i.remove();let o=this.chatContainer.createDiv({cls:`gemini-agent-message gemini-agent-message-${n.role}`}),r=o.createDiv({cls:"gemini-agent-message-header"});r.createEl("span",{text:n.role==="user"?"You":n.role==="system"?"System":"Agent",cls:"gemini-agent-message-role"}),r.createEl("span",{text:n.created_at.toLocaleTimeString(),cls:"gemini-agent-message-time"});let s=o.createDiv({cls:"gemini-agent-message-content"}),u=((d=n.metadata)==null?void 0:d.toolName)||n.message.includes("Tool Execution Results:"),f=n.message;if(n.role==="model"){let h=n.message.split(`
`),y=[],v=!1,T=!0;for(let S=0;S<h.length;S++){let _=h[S],x=h[S+1],C=_.trim(),w=_.split("\\|").join("").includes("|"),P=/^\s*\|?\s*[:?\-]+\s*\|/.test(_);(w&&!P&&C!=="|"||P)&&!v&&(v=!0,!T&&y.length>0&&y.push("")),y.push(_),v&&!w&&C!==""?(v=!1,y.push("")):v&&C===""&&(v=!1),!v&&!w&&C!==""&&x&&x.trim()!==""&&!x.includes("|")&&y.push(""),T=C===""}f=y.join(`
`),this.plugin.settings.debugMode&&f.includes("|")&&(console.log("Table formatting debug:"),console.log("Original message:",n.message),console.log("Formatted message:",f))}let c=((p=this.currentSession)==null?void 0:p.historyPath)||"";if(u&&n.message.includes("Tool Execution Results:")){let h=f.split(/### ([^\n]+)/);if(h.length>1){let y=h[0].trim();if(y){let v=s.createDiv();await H.MarkdownRenderer.render(this.app,y,v,c,this)}for(let v=1;v<h.length;v+=2){let T=h[v],S=((m=h[v+1])==null?void 0:m.trim())||"";if(T&&S){let _=s.createDiv({cls:"gemini-agent-tool-execution"}),x=_.createDiv({cls:"gemini-agent-tool-header"}),C=x.createEl("span",{cls:"gemini-agent-tool-icon"});(0,H.setIcon)(C,"chevron-right"),x.createEl("span",{text:`Tool: ${T}`,cls:"gemini-agent-tool-name"}),S.includes("\u2705")?x.createEl("span",{text:"Success",cls:"gemini-agent-tool-status gemini-agent-tool-status-success"}):S.includes("\u274C")&&x.createEl("span",{text:"Failed",cls:"gemini-agent-tool-status gemini-agent-tool-status-error"});let w=_.createDiv({cls:"gemini-agent-tool-content gemini-agent-tool-content-collapsed"});await H.MarkdownRenderer.render(this.app,S,w,c,this),x.addEventListener("click",()=>{w.hasClass("gemini-agent-tool-content-collapsed")?(w.removeClass("gemini-agent-tool-content-collapsed"),(0,H.setIcon)(C,"chevron-down")):(w.addClass("gemini-agent-tool-content-collapsed"),(0,H.setIcon)(C,"chevron-right"))})}}}else await H.MarkdownRenderer.render(this.app,f,s,c,this)}else await H.MarkdownRenderer.render(this.app,f,s,c,this);if(this.scrollToBottom(),n.role==="model"||n.role==="user"){let h=s.createEl("button",{cls:"gemini-agent-copy-button"});(0,H.setIcon)(h,"copy"),h.addEventListener("click",()=>{navigator.clipboard.writeText(n.message).then(()=>{new H.Notice("Message copied to clipboard.")}).catch(y=>{new H.Notice("Could not copy message to clipboard. Try selecting and copying manually."),console.error(y)})})}this.chatContainer.scrollTop=this.chatContainer.scrollHeight}async showFileMention(){new Qo(this.app,i=>{i instanceof nr.TFolder?this.insertFolderChip(i):i instanceof H.TFile&&this.insertFileChip(i)}).open()}insertFolderChip(n){let i=this.getFilesFromFolder(n);for(let r of i)this.mentionedFiles.includes(r)||this.mentionedFiles.push(r),this.currentSession&&!this.currentSession.context.contextFiles.includes(r)&&this.currentSession.context.contextFiles.push(r);this.currentSession&&(this.updateContextFilesList(this.contextPanel.querySelector(".gemini-agent-files-list")),this.updateSessionHeader(),this.updateSessionMetadata());let o=this.createFolderChip(n,i.length);this.insertChipAtCursor(o)}getFilesFromFolder(n){let i=[],o=r=>{for(let s of r.children)s instanceof H.TFile&&s.extension==="md"?i.push(s):s instanceof nr.TFolder&&o(s)};return o(n),i}insertFileChip(n){this.mentionedFiles.includes(n)||this.mentionedFiles.push(n),this.currentSession&&!this.currentSession.context.contextFiles.includes(n)&&(this.currentSession.context.contextFiles.push(n),this.updateContextFilesList(this.contextPanel.querySelector(".gemini-agent-files-list")),this.updateSessionHeader(),this.updateSessionMetadata());let i=this.createFileChip(n);this.insertChipAtCursor(i)}insertChipAtCursor(n){let i=window.getSelection();if(i&&i.rangeCount>0){let s=i.getRangeAt(0);s.insertNode(n),s.setStartAfter(n),s.collapse(!0),i.removeAllRanges(),i.addRange(s)}else this.userInput.appendChild(n);let o=document.createTextNode("\xA0");n.after(o);let r=window.getSelection();if(r){let s=document.createRange();s.setStartAfter(o),s.collapse(!0),r.removeAllRanges(),r.addRange(s)}this.userInput.focus()}createFileChip(n){let i=document.createElement("span");i.className="gemini-agent-file-chip",i.contentEditable="false",i.setAttribute("data-file-path",n.path);let o=i.createSpan({cls:"gemini-agent-file-chip-icon"});return(0,H.setIcon)(o,"file-text"),i.createSpan({text:n.basename,cls:"gemini-agent-file-chip-name"}),i.createSpan({text:"\xD7",cls:"gemini-agent-file-chip-remove"}).addEventListener("click",s=>{s.stopPropagation(),i.remove();let u=this.mentionedFiles.indexOf(n);if(u>-1&&this.mentionedFiles.splice(u,1),this.currentSession){let f=this.currentSession.context.contextFiles.indexOf(n);f>-1&&(this.currentSession.context.contextFiles.splice(f,1),this.updateContextFilesList(this.contextPanel.querySelector(".gemini-agent-files-list")),this.updateSessionHeader(),this.updateSessionMetadata())}}),i}createFolderChip(n,i){let o=document.createElement("span");o.className="gemini-agent-folder-chip",o.contentEditable="false",o.setAttribute("data-folder-path",n.path),o.setAttribute("data-file-count",i.toString());let r=o.createSpan({cls:"gemini-agent-folder-chip-icon"});return(0,H.setIcon)(r,"folder"),o.createSpan({text:`${n.name}/ (${i} files)`,cls:"gemini-agent-folder-chip-name"}),o.createSpan({text:"\xD7",cls:"gemini-agent-folder-chip-remove"}).addEventListener("click",u=>{u.stopPropagation(),o.remove();let f=this.getFilesFromFolder(n);for(let c of f){let d=this.mentionedFiles.indexOf(c);if(d>-1&&this.mentionedFiles.splice(d,1),this.currentSession){let p=this.currentSession.context.contextFiles.indexOf(c);p>-1&&this.currentSession.context.contextFiles.splice(p,1)}}this.currentSession&&(this.updateContextFilesList(this.contextPanel.querySelector(".gemini-agent-files-list")),this.updateSessionHeader(),this.updateSessionMetadata())}),o}extractMessageContent(){var d,p;let n=this.userInput.cloneNode(!0);n.querySelectorAll(".gemini-agent-file-chip").forEach(m=>{let h=m.getAttribute("data-file-path");if(h){let y=this.app.vault.getAbstractFileByPath(h);if(y instanceof H.TFile){let v=document.createTextNode(`[[${y.basename}]]`);m.replaceWith(v)}}}),n.querySelectorAll(".gemini-agent-folder-chip").forEach(m=>{let h=m.getAttribute("data-folder-path"),y=m.getAttribute("data-file-count");if(h){let v=document.createTextNode(`\u{1F4C1} ${h}/ (${y} files)`);m.replaceWith(v)}});let r=((d=n.textContent)==null?void 0:d.trim())||"",s=this.userInput.cloneNode(!0);return s.querySelectorAll(".gemini-agent-file-chip").forEach(m=>{let h=m.getAttribute("data-file-path");if(h){let y=this.app.vault.getAbstractFileByPath(h);if(y instanceof H.TFile){let v=document.createTextNode(y.basename);m.replaceWith(v)}}}),s.querySelectorAll(".gemini-agent-folder-chip").forEach(m=>{let h=m.getAttribute("data-folder-path");if(h){let y=this.app.vault.getAbstractFileByPath(h);if(y instanceof nr.TFolder){let v=document.createTextNode(y.name);m.replaceWith(v)}}}),{text:((p=s.textContent)==null?void 0:p.trim())||"",files:[...this.mentionedFiles],formattedMessage:r}}async sendMessage(){var f,c,d,p,m;if(!this.currentSession){new H.Notice("No active session");return}let{text:n,files:i,formattedMessage:o}=this.extractMessageContent();if(!n&&i.length===0)return;this.userInput.innerHTML="",this.mentionedFiles=[],this.sendButton.disabled=!0;let r=this.chatContainer.createDiv({cls:"gemini-agent-message gemini-agent-message-model gemini-agent-thinking"}),s=r.createDiv({cls:"gemini-agent-message-content"});s.createSpan({text:"Thinking",cls:"gemini-agent-thinking-text"});for(let h=0;h<3;h++)s.createSpan({text:".",cls:`gemini-agent-thinking-dot gemini-agent-thinking-dot-${h+1}`});this.chatContainer.scrollTop=this.chatContainer.scrollHeight;let u={role:"user",message:o,notePath:"",created_at:new Date};await this.displayMessage(u);try{let h=[...this.currentSession.context.contextFiles];i.forEach(C=>{h.includes(C)||h.push(C)});let y=await this.plugin.sessionHistory.getHistoryForSession(this.currentSession),v=await this.plugin.gfile.buildFileContext(h,this.currentSession.context.contextDepth,!0),T;if((c=(f=this.currentSession)==null?void 0:f.modelConfig)!=null&&c.promptTemplate)try{let C=this.app.vault.getAbstractFileByPath(this.currentSession.modelConfig.promptTemplate);if(C instanceof H.TFile&&C.extension==="md"){let w=await this.app.vault.read(C);T=vd.compile(w)({userMessage:n})}else console.warn("Custom prompt file not found:",this.currentSession.modelConfig.promptTemplate),T=this.plugin.prompts.generalPrompt({userMessage:n})}catch(C){console.error("Error loading custom prompt:",C),T=this.plugin.prompts.generalPrompt({userMessage:n})}else T=this.plugin.prompts.generalPrompt({userMessage:n});if(i.length>0){let C=i.map(w=>w.basename).join(", ");T=`${T}

IMPORTANT: The user has specifically referenced the following files using @ mentions: ${C}
These files are included in the context below. When the user asks you to write data to or modify these files, you should:
1. First use the read_file tool to examine their current contents
2. Then use the write_file tool to update them with the new or modified content
3. If adding new data, integrate it appropriately with the existing content rather than creating a new file`}v?T=`${T}

${v}

User: ${n}`:T=`${T}

User: ${n}`;let S={plugin:this.plugin,session:this.currentSession},_=this.plugin.toolRegistry.getEnabledTools(S);console.log("Available tools from registry:",_),console.log("Number of tools:",_.length),console.log("Tool names:",_.map(C=>C.name));let x=this.plugin.settings.sendContext;this.plugin.settings.sendContext=!1;try{let C=((d=this.currentSession)==null?void 0:d.modelConfig)||{},w={userMessage:n,conversationHistory:y,model:C.model||this.plugin.settings.chatModelName,temperature:(p=C.temperature)!=null?p:this.plugin.settings.temperature,topP:(m=C.topP)!=null?m:this.plugin.settings.topP,prompt:T,renderContent:!1,availableTools:_},P=Fn.createAgentModel(this.plugin,this.currentSession);if(P.generateStreamingResponse&&this.plugin.settings.streamingEnabled!==!1){let M=null,b="";r.remove();let k=P.generateStreamingResponse(w,L=>{b+=L,M?(this.updateStreamingMessage(M,L),this.debouncedScrollToBottom()):(M=this.createStreamingMessageContainer("model"),this.updateStreamingMessage(M,L))});this.currentStreamingResponse=k;try{let L=await k.complete;if(this.currentStreamingResponse=null,this.plugin.settings.sendContext=x,L.toolCalls&&L.toolCalls.length>0){if(this.plugin.settings.chatHistory&&await this.plugin.sessionHistory.addEntryToSession(this.currentSession,u),M&&b.trim()){let O={role:"model",message:b,notePath:"",created_at:new Date};await this.finalizeStreamingMessage(M,b,O),this.plugin.settings.chatHistory&&await this.plugin.sessionHistory.addEntryToSession(this.currentSession,O)}await this.handleToolCalls(L.toolCalls,n,y,u)}else if(L.markdown&&L.markdown.trim()){let O={role:"model",message:L.markdown,notePath:"",created_at:new Date};M&&await this.finalizeStreamingMessage(M,L.markdown,O),this.plugin.settings.chatHistory&&(await this.plugin.sessionHistory.addEntryToSession(this.currentSession,u),await this.plugin.sessionHistory.addEntryToSession(this.currentSession,O),await this.autoLabelSessionIfNeeded()),this.scrollToBottom()}else console.warn("Model returned empty response"),new H.Notice("Model returned an empty response. This might happen with thinking models. Try rephrasing your question."),this.plugin.settings.chatHistory&&await this.plugin.sessionHistory.addEntryToSession(this.currentSession,u)}catch(L){throw this.currentStreamingResponse=null,this.plugin.settings.sendContext=x,L}}else{console.log("Agent view using non-streaming API");let M=await P.generateModelResponse(w);if(this.plugin.settings.sendContext=x,r.remove(),M.toolCalls&&M.toolCalls.length>0)await this.handleToolCalls(M.toolCalls,n,y,u);else if(M.markdown&&M.markdown.trim()){let b={role:"model",message:M.markdown,notePath:"",created_at:new Date};await this.displayMessage(b),this.plugin.settings.chatHistory&&(await this.plugin.sessionHistory.addEntryToSession(this.currentSession,u),await this.plugin.sessionHistory.addEntryToSession(this.currentSession,b),await this.autoLabelSessionIfNeeded())}else console.warn("Model returned empty response"),new H.Notice("Model returned an empty response. This might happen with thinking models. Try rephrasing your question."),this.plugin.settings.chatHistory&&await this.plugin.sessionHistory.addEntryToSession(this.currentSession,u)}}catch(C){throw this.plugin.settings.sendContext=x,r.remove(),C}}catch(h){console.error("Failed to send message:",h),new H.Notice("Failed to send message")}finally{this.sendButton.disabled=!1}}async updateSessionMetadata(){if(this.currentSession)try{await this.plugin.sessionHistory.updateSessionMetadata(this.currentSession)}catch(n){console.error("Failed to update session metadata:",n)}}updateSessionHeader(){this.createSessionHeader()}async showSessionList(){var i;new Zo(this.app,this.plugin,{onSelect:async o=>{await this.loadSession(o)},onDelete:o=>{this.currentSession&&this.currentSession.id===o.id&&this.createNewSession()}},((i=this.currentSession)==null?void 0:i.id)||null).open()}async loadSession(n){try{this.currentSession=n,this.allowedWithoutConfirmation.clear(),this.chatContainer.empty(),await this.loadSessionHistory(),this.createSessionHeader(),this.createContextPanel()}catch(i){console.error("Failed to load session:",i),new H.Notice("Failed to load session")}}getCurrentSessionForToolExecution(){return this.currentSession}registerLinkClickHandler(){this.containerEl.addEventListener("click",n=>{let i=n.target;if(i.tagName==="A"&&i.classList.contains("internal-link")){n.preventDefault();let o=i.getAttribute("href");o&&this.app.workspace.openLinkText(o,"",!0)}})}async onClose(){this.currentStreamingResponse&&this.currentStreamingResponse.cancel()}async autoLabelSessionIfNeeded(){if(!this.currentSession||!this.currentSession.title.startsWith("Agent Session")&&!this.currentSession.title.startsWith("New Agent Session"))return;let n=await this.plugin.sessionHistory.getHistoryForSession(this.currentSession);if(n.length===2)try{let i=`Based on this conversation, suggest a concise title (max 50 characters) that captures the main topic or purpose. Return only the title text, no quotes or explanation.

Context Files: ${this.currentSession.context.contextFiles.map(r=>r.basename).join(", ")}

User: ${n[0].message}`,o=this.plugin.settings.sendContext;this.plugin.settings.sendContext=!1;try{let r=await this.plugin.geminiApi.generateModelResponse({userMessage:i,conversationHistory:[],model:this.plugin.settings.chatModelName,prompt:i,renderContent:!1});this.plugin.settings.sendContext=o;let s=r.markdown.trim().replace(/^["']+|["']+$/g,"").substring(0,50);if(s&&s.length>0){this.currentSession.title=s;let u=this.currentSession.historyPath,f=this.plugin.sessionManager.sanitizeFileName(s),c=u.substring(0,u.lastIndexOf("/")+1)+f+".md",d=this.plugin.app.vault.getAbstractFileByPath(u);d&&(await this.plugin.app.fileManager.renameFile(d,c),this.currentSession.historyPath=c),await this.updateSessionMetadata(),this.updateSessionHeader(),console.log(`Auto-labeled session: ${s}`)}}catch(r){this.plugin.settings.sendContext=o,console.error("Failed to auto-label session:",r)}}catch(i){console.error("Error in auto-labeling:",i)}}async showSessionSettings(){if(!this.currentSession)return;new Xo(this.app,this.plugin,this.currentSession,async i=>{await this.plugin.sessionManager.updateSessionModelConfig(this.currentSession.id,i),this.createCompactHeader()}).open()}sortToolCallsByPriority(n){let i={read_file:1,list_files:2,search_files:3,google_search:4,web_fetch:5,write_file:6,create_folder:7,move_file:8,delete_file:9};return[...n].sort((o,r)=>{let s=i[o.name]||10,u=i[r.name]||10;return s-u})}async handleToolCalls(n,i,o,r){var p,m,h,y,v;if(!this.currentSession)return;let s=[],u={plugin:this.plugin,session:this.currentSession},f=this.sortToolCallsByPriority(n);for(let T of f)try{let S=`${T.name}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;await this.showToolExecution(T.name,T.arguments,S);let _=await this.plugin.toolExecutionEngine.executeTool(T,u,this);await this.showToolResult(T.name,_,S),s.push({toolName:T.name,result:_})}catch(S){console.error(`Tool execution error for ${T.name}:`,S),s.push({toolName:T.name,result:{success:!1,error:S instanceof Error?S.message:"Unknown error"}})}this.plugin.settings.chatHistory&&await this.plugin.sessionHistory.addEntryToSession(this.currentSession,r);let c=this.formatToolResultsForModel(s),d=[...o,{role:"user",message:i},{role:"system",message:c}];try{let T={plugin:this.plugin,session:this.currentSession},S=this.plugin.toolRegistry.getEnabledTools(T),_=((p=this.currentSession)==null?void 0:p.modelConfig)||{},x={userMessage:"Based on the tool execution results above, please provide a response to the user's request. If the tool results include citations from Google Search, make sure to incorporate them into your response using inline citation numbers and include a Sources section.",conversationHistory:d,model:_.model||this.plugin.settings.chatModelName,temperature:(m=_.temperature)!=null?m:this.plugin.settings.temperature,topP:(h=_.topP)!=null?h:this.plugin.settings.topP,prompt:this.plugin.prompts.generalPrompt({userMessage:"Continue with tool results"}),renderContent:!1,availableTools:S},w=await Fn.createAgentModel(this.plugin,this.currentSession).generateModelResponse(x);if(w.toolCalls&&w.toolCalls.length>0)await this.handleToolCalls(w.toolCalls,"Based on the tool execution results above, please provide a response to the user's request. If the tool results include citations from Google Search, make sure to incorporate them into your response using inline citation numbers and include a Sources section.",d,{role:"system",message:"Continuing with additional tool calls...",notePath:"",created_at:new Date});else if(w.markdown&&w.markdown.trim()){let P={role:"model",message:w.markdown,notePath:"",created_at:new Date};await this.displayMessage(P),this.plugin.settings.chatHistory&&(await this.plugin.sessionHistory.addEntryToSession(this.currentSession,P),await this.autoLabelSessionIfNeeded())}else{console.warn("Model returned empty response after tool execution");let P={userMessage:"Please summarize what you just did with the tools.",conversationHistory:d,model:_.model||this.plugin.settings.chatModelName,temperature:(y=_.temperature)!=null?y:this.plugin.settings.temperature,topP:(v=_.topP)!=null?v:this.plugin.settings.topP,prompt:"Please summarize what you just did with the tools.",renderContent:!1},b=await Fn.createAgentModel(this.plugin,this.currentSession).generateModelResponse(P);if(b.markdown&&b.markdown.trim()){let k={role:"model",message:b.markdown,notePath:"",created_at:new Date};await this.displayMessage(k),this.plugin.settings.chatHistory&&(await this.plugin.sessionHistory.addEntryToSession(this.currentSession,k),await this.autoLabelSessionIfNeeded())}}}catch(T){console.error("Failed to process tool results:",T),new H.Notice("Failed to process tool results")}}formatToolResultsForModel(n){let i=`Tool Execution Results:

`;for(let o of n)i+=`### ${o.toolName}
`,o.result.success?(i+=`\u2705 Success
`,o.result.data&&(o.toolName==="google_search"&&o.result.data.answer&&o.result.data.citations?(i+=`**Search Query:** ${o.result.data.query}

`,i+=`**Answer with citations:**
${o.result.data.answer}

`,o.result.data.citations.length>0&&(i+=`**Sources:**
`,o.result.data.citations.forEach((r,s)=>{i+=`${s+1}. [${r.title||r.url}](${r.url})`,r.snippet&&(i+=` - ${r.snippet}`),i+=`
`}),i+=`
`),i+=`**IMPORTANT:** Please incorporate these citations into your response to the user. Use the inline citation numbers [1], [2], etc. when referencing information from these sources, and include a "Sources" section at the end of your response with the full citation links.
`):i+=`\`\`\`json
${JSON.stringify(o.result.data,null,2)}
\`\`\`
`)):(i+=`\u274C Failed
`,i+=`Error: ${o.result.error}
`),i+=`
`;return i}async showToolExecution(n,i,o){let r=this.chatContainer.querySelector(".gemini-agent-empty-chat");r&&r.remove();let s=this.chatContainer.createDiv({cls:"gemini-agent-message gemini-agent-message-tool"}),u=s.createDiv({cls:"gemini-agent-tool-message"}),f=u.createDiv({cls:"gemini-agent-tool-header"}),c=f.createEl("button",{cls:"gemini-agent-tool-toggle"});(0,H.setIcon)(c,"chevron-right");let d=f.createSpan({cls:"gemini-agent-tool-icon"});(0,H.setIcon)(d,{read_file:"file-text",write_file:"file-edit",list_files:"folder-open",create_folder:"folder-plus",delete_file:"trash-2",move_file:"file-symlink",search_files:"search",google_search:"globe"}[n]||"wrench");let m=this.plugin.toolRegistry.getTool(n),h=(m==null?void 0:m.displayName)||n;f.createSpan({text:`Executing: ${h}`,cls:"gemini-agent-tool-title"});let y=f.createSpan({text:"Running...",cls:"gemini-agent-tool-status gemini-agent-tool-status-running"}),v=u.createDiv({cls:"gemini-agent-tool-details"});if(v.style.display="none",i&&Object.keys(i).length>0){let _=v.createDiv({cls:"gemini-agent-tool-section"});_.createEl("h4",{text:"Parameters"});let x=_.createDiv({cls:"gemini-agent-tool-params-list"});for(let[C,w]of Object.entries(i)){let P=x.createDiv({cls:"gemini-agent-tool-param-item"});P.createSpan({text:C,cls:"gemini-agent-tool-param-key"});let M=typeof w=="string"?w:JSON.stringify(w,null,2),b=P.createEl("code",{text:M,cls:"gemini-agent-tool-param-value"});M.length>100&&(b.textContent=M.substring(0,100)+"...",b.title=M)}}let T=!1,S=()=>{T=!T,v.style.display=T?"block":"none",(0,H.setIcon)(c,T?"chevron-down":"chevron-right"),u.toggleClass("gemini-agent-tool-expanded",T)};c.addEventListener("click",_=>{_.stopPropagation(),S()}),f.addEventListener("click",S),s.dataset.toolName=n,o&&(s.dataset.executionId=o),this.chatContainer.scrollTop=this.chatContainer.scrollHeight}async showToolResult(n,i,o){let r=this.chatContainer.querySelectorAll(".gemini-agent-message-tool"),s=null;if(o){for(let d of Array.from(r))if(d.dataset.executionId===o){s=d;break}}else for(let d of Array.from(r))if(d.dataset.toolName===n){s=d;break}if(!s){console.warn(`Tool message not found for ${n}`);return}let u=s.querySelector(".gemini-agent-tool-status");u&&(u.textContent=i.success?"Completed":"Failed",u.classList.remove("gemini-agent-tool-status-running"),u.classList.add(i.success?"gemini-agent-tool-status-success":"gemini-agent-tool-status-error"),s.classList.add("gemini-agent-tool-completed"),setTimeout(()=>{s&&s.classList.remove("gemini-agent-tool-completed")},500));let f=s.querySelector(".gemini-agent-tool-icon");f&&(0,H.setIcon)(f,i.success?"check-circle":"x-circle");let c=s.querySelector(".gemini-agent-tool-details");if(c){let d=c.createDiv({cls:"gemini-agent-tool-section"});if(d.createEl("h4",{text:"Result"}),i.success&&i.data){let p=d.createDiv({cls:"gemini-agent-tool-result-content"});if(typeof i.data=="string")if(i.data.length>500){let h=p.createEl("pre",{cls:"gemini-agent-tool-code-result"}).createEl("code");h.textContent=i.data.substring(0,500)+`

... (truncated)`;let y=p.createEl("button",{text:"Show full content",cls:"gemini-agent-tool-expand-content"});y.addEventListener("click",()=>{h.textContent=i.data,y.remove()})}else p.createEl("pre",{cls:"gemini-agent-tool-code-result"}).createEl("code",{text:i.data});else if(Array.isArray(i.data))if(i.data.length===0)p.createEl("p",{text:"No results found",cls:"gemini-agent-tool-empty-result"});else{let m=p.createEl("ul",{cls:"gemini-agent-tool-result-list"});i.data.slice(0,10).forEach(h=>{m.createEl("li",{text:String(h)})}),i.data.length>10&&p.createEl("p",{text:`... and ${i.data.length-10} more`,cls:"gemini-agent-tool-more-items"})}else if(typeof i.data=="object")if(console.log("Tool result is object for:",n),console.log("Result data keys:",Object.keys(i.data)),i.data.answer&&i.data.citations&&n==="google_search"){console.log("Handling google_search result with citations");let m=p.createDiv({cls:"gemini-agent-tool-search-answer"});m.createEl("h5",{text:"Answer:"});let h=m.createEl("p"),y=/\[([^\]]+)\]\(([^)]+)\)/g,v=0,T;for(;(T=y.exec(i.data.answer))!==null;)T.index>v&&h.appendText(i.data.answer.substring(v,T.index)),h.createEl("a",{text:T[1],href:T[2]}).setAttribute("target","_blank"),v=y.lastIndex;if(v<i.data.answer.length&&h.appendText(i.data.answer.substring(v)),i.data.citations.length>0){let S=p.createDiv({cls:"gemini-agent-tool-citations"});S.createEl("h5",{text:"Sources:"});let _=S.createEl("ul",{cls:"gemini-agent-tool-citations-list"});for(let x of i.data.citations){let C=_.createEl("li");C.createEl("a",{text:x.title||x.url,href:x.url,cls:"gemini-agent-tool-citation-link"}).setAttribute("target","_blank"),x.snippet&&C.createEl("p",{text:x.snippet,cls:"gemini-agent-tool-citation-snippet"})}}}else if(i.data.content&&i.data.path){let m=p.createDiv({cls:"gemini-agent-tool-file-info"});m.createEl("strong",{text:"File: "}),m.createSpan({text:i.data.path}),i.data.size&&m.createSpan({text:` (${this.formatFileSize(i.data.size)})`,cls:"gemini-agent-tool-file-size"});let h=i.data.content;if(h.length>500){let v=p.createEl("pre",{cls:"gemini-agent-tool-code-result"}).createEl("code");v.textContent=h.substring(0,500)+`

... (truncated)`;let T=p.createEl("button",{text:"Show full content",cls:"gemini-agent-tool-expand-content"});T.addEventListener("click",()=>{v.textContent=h,T.remove()})}else p.createEl("pre",{cls:"gemini-agent-tool-code-result"}).createEl("code",{text:h})}else{let m=p.createDiv({cls:"gemini-agent-tool-result-object"});for(let[h,y]of Object.entries(i.data)){if(h==="content"&&typeof y=="string"&&y.length>100)continue;let v=m.createDiv({cls:"gemini-agent-tool-result-item"});v.createSpan({text:h+":",cls:"gemini-agent-tool-result-key"});let T=typeof y=="string"?y:JSON.stringify(y);v.createSpan({text:T.length>100?T.substring(0,100)+"...":T,cls:"gemini-agent-tool-result-value"})}}}else i.error&&d.createDiv({cls:"gemini-agent-tool-error-content"}).createEl("p",{text:i.error,cls:"gemini-agent-tool-error-message"})}if(!i.success){let d=s.querySelector(".gemini-agent-tool-toggle"),p=s.querySelector(".gemini-agent-tool-message");d&&c&&p&&((0,H.setIcon)(d,"chevron-down"),c.style.display="block",p.classList.add("gemini-agent-tool-expanded"))}}showEmptyState(){if(this.chatContainer.children.length===0){let n=this.chatContainer.createDiv({cls:"gemini-agent-empty-chat"}),i=n.createDiv({cls:"gemini-agent-empty-icon"});(0,H.setIcon)(i,"bot"),n.createEl("h3",{text:"Start a conversation",cls:"gemini-agent-empty-title"}),n.createEl("p",{text:"Ask questions, get help with your notes, or use tools to manage your vault.",cls:"gemini-agent-empty-desc"});let o=n.createDiv({cls:"gemini-agent-suggestions"});["What files are in my vault?",'Search for notes about "project"',"Create a summary of my recent notes"].forEach(s=>{o.createDiv({text:s,cls:"gemini-agent-suggestion"}).addEventListener("click",()=>{this.userInput.textContent=s,this.userInput.focus()})})}}formatFileSize(n){if(n===0)return"0 Bytes";let i=1024,o=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(n)/Math.log(i));return parseFloat((n/Math.pow(i,r)).toFixed(2))+" "+o[r]}isToolAllowedWithoutConfirmation(n){return this.allowedWithoutConfirmation.has(n)}allowToolWithoutConfirmation(n){this.allowedWithoutConfirmation.add(n)}scrollToBottom(){this.chatContainer.scrollTop=this.chatContainer.scrollHeight}debouncedScrollToBottom(){this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(()=>{this.scrollToBottom(),this.scrollTimeout=null},50)}createStreamingMessageContainer(n="model"){let i=this.chatContainer.querySelector(".gemini-agent-empty-chat");i&&i.remove();let o=this.chatContainer.createDiv({cls:`gemini-agent-message gemini-agent-message-${n}`}),r=o.createDiv({cls:"gemini-agent-message-header"});r.createEl("span",{text:n==="user"?"You":n==="system"?"System":"Agent",cls:"gemini-agent-message-role"}),r.createEl("span",{text:new Date().toLocaleTimeString(),cls:"gemini-agent-message-time"});let s=o.createDiv({cls:"gemini-agent-message-content"});return o}async updateStreamingMessage(n,i){let o=n.querySelector(".gemini-agent-message-content");if(o){let r=document.createTextNode(i);o.appendChild(r)}}async finalizeStreamingMessage(n,i,o){var s;let r=n.querySelector(".gemini-agent-message-content");if(r){r.empty();let u=i;if(o.role==="model"){let c=i.split(`
`),d=[],p=!1,m=!0;for(let h=0;h<c.length;h++){let y=c[h],v=y.trim(),T=/(?<!\\)\|/.test(y),S=c[h+1];T&&!p&&(p=!0,m||d.push("")),d.push(y),p&&!T&&v!==""?(p=!1,d.push("")):p&&v===""&&(p=!1),!p&&!T&&v!==""&&S&&S.trim()!==""&&!S.includes("|")&&d.push(""),m=v===""}u=d.join(`
`)}let f=((s=this.currentSession)==null?void 0:s.historyPath)||"";if(await H.MarkdownRenderer.render(this.app,u,r,f,this),o.role==="model"){let c=r.createEl("button",{cls:"gemini-agent-copy-button"});(0,H.setIcon)(c,"copy"),c.addEventListener("click",()=>{navigator.clipboard.writeText(o.message).then(()=>{new H.Notice("Message copied to clipboard.")}).catch(d=>{new H.Notice("Could not copy message to clipboard. Try selecting and copying manually."),console.error("Failed to copy to clipboard",d)})})}}}};var ir=class{constructor(e){this.plugin=e,this.prompts=new fe(e)}async summarizeActiveFile(){let e=await this.plugin.gfile.getCurrentFileContent(0,!0);if(e){let n=Oe.createSummaryModel(this.plugin),i={prompt:this.prompts.summaryPrompt({content:e})},o=await n.generateModelResponse(i);this.plugin.gfile.addToFrontMatter(this.plugin.settings.summaryFrontmatterKey,o.markdown)}else console.error("Failed to get file content for summary.")}async setupSummarizaitonCommand(){this.plugin.addCommand({id:"gemini-scribe-summarize-active-file",name:"Summarize Active File",callback:()=>this.summarizeActiveFile()})}};var Xp=require("obsidian");var Qp=Kn(Zp()),Fr=class{constructor(e,n){this.scribeFile=e,this.dataViewAPI=this.getDataViewAPI(),this.plugin=n}getDataViewAPI(){let e=(0,Qp.getAPI)();return e||null}async getBacklinks(e){return await this.evaluateDataviewQuery("list where contains(file.outlinks, this.file.link)",e)}async getLinksFromDataviewBlocks(e){let n=new Set,i=[];return await this.iterateCodeblocksInFile(e,r=>{r.language==="dataview"&&i.push(this.evaluateDataviewQuery(r.text,e))}),(await Promise.all(i)).forEach(r=>{r.forEach(s=>n.add(s))}),n}async evaluateDataviewQuery(e,n){let i=new Set;try{let o=await this.dataViewAPI.query(e,n.path);if(!(o!=null&&o.value))return console.warn(`Invalid query result for "${e}" in file "${n.path}"`),i;let r=s=>{if(this.isFileLink(s)){let u=this.scribeFile.normalizePath(s.path,n);u?i.add(u):console.warn(`Link "${s}" in file "${n.path}" could not be normalized.`)}};if(o.value.type==="list")for(let s of o.value.values)r(s);else if(o.value.type==="table")for(let s of o.value.values)for(let u of s)r(u)}catch(o){console.error(`Error evaluating dataview query "${e}" in file "${n.path}":`,o)}return i}isFileLink(e){return e&&typeof e=="object"&&typeof e.path=="string"?!(e.subpath||e.path.includes("#")||e.path.includes("^")):!1}async iterateCodeblocksInFile(e,n){let o=(await this.plugin.app.vault.read(e)).split(`
`),r=null;for(let s=0;s<o.length;s++){let u=o[s];if(u.startsWith("```"))if(r)n(r),r=null;else{let f=u.substring(3).trim();r={start:s,end:-1,text:"",language:f}}else r&&(r.text+=u+`
`)}r&&(r.end=o.length-1,n(r))}};var Pi=class{constructor(e,n){this.root=null;this.visited=new Set;this.MAX_TOTAL_CHARS=5e5;this.plugin=e,this.plugin.settings.sendContext?this.maxDepth=n!=null?n:this.plugin.settings.maxContextDepth:this.maxDepth=0,this.fileHelper=new On(e),this.dataViewHelper=new Fr(this.fileHelper,this.plugin),this.prompts=new fe(e)}async buildStructure(e,n=0,i,o,r){if(!e||n>this.maxDepth||o.has(e.path)||e.path.startsWith(this.plugin.settings.historyFolder+"/"))return null;o.add(e.path);let s=this.fileHelper.getLinkText(e,r.path),u={path:e.path,content:await this.getFileContent(e,i),wikilink:s,links:new Map},f=this.fileHelper.getUniqueLinks(e),c=await this.dataViewHelper.getBacklinks(e)||new Set,d=await this.dataViewHelper.getLinksFromDataviewBlocks(e)||new Set,p=f;c.forEach(m=>p.add(m)),d.forEach(m=>p.add(m));for(let m of p){let h=await this.buildStructure(m,n+1,i,o,r);h&&u.links.set(m.path,h)}return u}async initialize(e,n){this.visited.clear(),this.root=await this.buildStructure(e,0,n,this.visited,e)}toString(e=5e4){return this.root?this.nodeToString(this.root,0,e,0).text:"No file structure built"}nodeToString(e,n,i,o){let r=e.content.length>i?e.content.substring(0,i)+`
[Remaining content truncated...]`:e.content,s=n==0?`This is the content of the current file and the files that it links to:
`:"",u=n==0?"Current File":"Linked File";s+=this.prompts.contextPrompt({file_label:u,file_name:e.path,wikilink:e.wikilink,file_contents:r});let f=o+s.length;if(e.links.size>0&&f<this.MAX_TOTAL_CHARS)for(let[c,d]of e.links){if(f>=this.MAX_TOTAL_CHARS){s+=`[Additional links truncated...]
`;break}let p=this.nodeToString(d,n+1,i,f);s+=p.text,f=p.total}return{text:s,total:f}}async getFileContent(e,n){let i=await this.plugin.app.vault.read(e)||"";if(n){let o=document.createElement("div");return await Xp.MarkdownRenderer.render(this.plugin.app,i,o,e.path,this.plugin),o.innerHTML}else return i}};var jp=require("obsidian");var On=class{constructor(e){this.plugin=e}async getCurrentFileContent(e=this.plugin.settings.maxContextDepth,n=!1){if(!this.plugin.settings.sendContext)return null;let i=this.getActiveFile();if(i){let o=new Pi(this.plugin,e);return await o.initialize(i,n),o.toString()}else return null}async buildFileContext(e,n=this.plugin.settings.maxContextDepth,i=!1){if(!this.plugin.settings.sendContext||e.length===0)return null;let o=[];for(let r of e){let s=new Pi(this.plugin,n);await s.initialize(r,i);let u=s.toString();u&&o.push(u)}return o.join(`

---

`)}async addToFrontMatter(e,n){let i=this.getActiveFile();i&&this.plugin.app.fileManager.processFrontMatter(i,o=>{o[e]=n})}async replaceTextInActiveFile(e){let n=this.getActiveFile(),i=this.plugin.app.vault;n&&i.modify(n,e)}getActiveFile(){let e=this.plugin.app.workspace.getActiveFile();return this.isFile(e)?e:(oe(this.plugin.settings.debugMode,"File System","No active file found."),null)}isFile(e){return!!(e&&e instanceof jp.TFile)}isMarkdownFile(e){return!!(e&&this.isFile(e)&&e.extension==="md")}getLinkText(e,n){return`[[${this.plugin.app.metadataCache.fileToLinktext(e,n,!0)}]]`}normalizePath(e,n){let i=this.plugin.app.metadataCache.getFirstLinkpathDest(e,n.path);return this.isMarkdownFile(i)?i:null}normalizeLinkPathsFromMetadata(e){let n=this.plugin.app.metadataCache.getFileCache(e),i=[],o=[],r=[];if(n){if(n.links)for(let s of n.links){let u=this.normalizePath(s.link,e);u?i.push(u):oe(this.plugin.settings.debugMode,"Link Normalization Warning",`Link "${s.link}" in file "${e.path}" could not be normalized.`)}if(n.embeds)for(let s of n.embeds){let u=this.normalizePath(s.link,e);u?o.push(u):oe(this.plugin.settings.debugMode,"Link Normalization Warning",`Embed "${s.link}" in file "${e.path}" could not be normalized.`)}if(n.frontmatterLinks)for(let s of n.frontmatterLinks){let u=this.normalizePath(s.link,e);u?r.push(u):oe(this.plugin.settings.debugMode,"Link Normalization Warning",`Frontmatter link "${s.link}" in file "${e.path}" could not be normalized.`)}if(n.frontmatter&&n.frontmatter.links){if(Array.isArray(n.frontmatter.links))n.frontmatter.links.forEach(s=>{let u=this.normalizePath.call(this,s);u?r.push(u):oe(this.plugin.settings.debugMode,"Link Normalization Warning",`Frontmatter link "${s}" in file "${e.path}" could not be normalized.`)});else if(typeof n.frontmatter.links=="string"){let s=this.normalizePath.call(this,n.frontmatter.links);s?r.push(s):oe(this.plugin.settings.debugMode,"Link Normalization Warning",`Frontmatter link "${n.frontmatter.links}" in file "${e.path}" could not be normalized.`)}}}return{links:i,embeds:o,frontmatterLinks:r}}getUniqueLinks(e){let{links:n,embeds:i,frontmatterLinks:o}=this.normalizeLinkPathsFromMetadata(e);return new Set([...n,...i,...o])}};var ot=require("obsidian");var X=require("obsidian"),Ii=Kn(di());var xr=`{{#if isFirstEntry}}
# Chat History
*Started: {{timestamp}}*
*Plugin Version: {{pluginVersion}}*

---

{{/if}}
## {{role}}

> [!metadata]- Message Info
> | Property | Value |
> | -------- | ----- |
> | Time | {{timestamp}} |
> | File Version | {{fileVersion}} |
{{#if model}}
> | Model | {{model}} |
{{#if (isDefined temperature)}}
> | Temperature | {{temperature}} |
{{/if}}
{{#if (isDefined topP)}}
> | Top P | {{topP}} |
{{/if}}
{{/if}}
{{#if customPrompt}}
> | Custom Prompt | {{customPrompt}} |
{{/if}}
{{#if context}}
> | Context | {{context}} |
{{/if}}

{{#if (eq role "User")}}
> [!user]+
{{else}}
> [!assistant]+
{{/if}}
{{#each messageLines}}
> {{this}}
{{/each}}

--- `;var _r=class{constructor(e){this.plugin=e,Ii.registerHelper("eq",function(n,i){return n===i}),Ii.registerHelper("isDefined",function(n){return n!==void 0}),this.entryTemplate=Ii.compile(xr)}async migrateAllLegacyFiles(){if(!this.plugin.settings.chatHistory)return;let e=this.plugin.settings.historyFolder,n=(0,X.normalizePath)(`${e}/History`);try{let i=(0,X.normalizePath)(`${e}/.migration-completed`);if(await this.plugin.app.vault.adapter.exists(i))return;await this.plugin.app.vault.createFolder(e).catch(()=>{}),await this.plugin.app.vault.createFolder(n).catch(()=>{});let s=(await this.plugin.app.vault.adapter.list(e)).files.filter(f=>f.endsWith(".md")&&!f.includes("/History/")&&!f.endsWith("/.migration-completed")),u=0;for(let f of s){let c=this.plugin.app.vault.getAbstractFileByPath(f);if(c instanceof X.TFile)try{let d=c.name,p=(0,X.normalizePath)(`${n}/${d}`);await this.plugin.app.vault.adapter.exists(p)?await this.plugin.app.vault.delete(c):(await this.plugin.app.vault.rename(c,p),u++)}catch(d){console.error(`Failed to migrate history file ${f}:`,d)}}await this.plugin.app.vault.adapter.write(i,`Migration completed at ${new Date().toISOString()}
Migrated ${u} files`),u>0&&console.log(`Migrated ${u} chat history files to new folder structure`)}catch(i){console.error("Error during history migration:",i)}}getHistoryFilePath(e){let n=this.plugin.settings.historyFolder,i=e.replace(/\.md$/,""),o=!i.includes("/")&&!i.includes("\\"),r=i.replace(/[\\/]/g,"_");return o&&(r=`root_${r}`),(0,X.normalizePath)(`${n}/History/${r}.md`)}async appendHistoryForFile(e,n){if(!this.plugin.gfile.isFile(e)||!this.plugin.settings.chatHistory)return;let i=this.getHistoryFilePath(e.path),o={notePath:e.path,created_at:new Date,role:n.role,message:n.message,model:n.model,metadata:n.metadata};try{await this.plugin.app.vault.createFolder(this.plugin.settings.historyFolder).catch(()=>{}),await this.plugin.app.vault.createFolder((0,X.normalizePath)(`${this.plugin.settings.historyFolder}/History`)).catch(()=>{});let r=this.plugin.app.vault.getAbstractFileByPath(i);if(r&&r instanceof X.TFile){let s=await this.plugin.app.vault.read(r);s=s.replace(/\n---\s*$/,""),await this.plugin.app.vault.modify(r,s+`

`+this.formatEntryAsMarkdown(o))}else{let s="";if(n.role==="model"&&n.userMessage){let f={notePath:e.path,created_at:new Date(o.created_at.getTime()-1e3),role:"user",message:n.userMessage};s=this.formatEntryAsMarkdown(f,!0)+`

`+this.formatEntryAsMarkdown(o)}else s=this.formatEntryAsMarkdown(o,!0);let u=await this.plugin.app.vault.create(i,s);await this.plugin.app.fileManager.processFrontMatter(u,f=>{f.source_file=this.plugin.gfile.getLinkText(e,e.path)})}}catch(r){console.error("Failed to append history",r),new X.Notice("Failed to save chat history")}}async getHistoryForFile(e){if(!this.plugin.gfile.isFile(e))return[];if(!this.plugin.settings.chatHistory)return[];let n=this.getHistoryFilePath(e.path),i=n,o=null,r=null;try{let s=this.plugin.app.vault.getAbstractFileByPath(n);if(s instanceof X.TFile)o=await this.plugin.app.vault.read(s);else if(r=await this.findLegacyHistoryFile(e),r){console.log(`Found legacy history file for ${e.path}: ${r.path}`),i=r.path,o=await this.plugin.app.vault.read(r);try{await this.migrateLegacyHistoryFile(r,e)}catch(u){console.error(`[History] Failed to migrate legacy history file ${r==null?void 0:r.path} during load:`,u),new X.Notice(`Error updating history file format for ${e.basename}. History may load from old format.`)}}return o!==null?this.parseHistoryFile(o,e.path):[]}catch(s){return console.error(`Failed to read history for ${e.path} (checked path: ${i}):`,s),[]}}async clearHistoryForFile(e){if(!this.plugin.gfile.isFile(e))return;let n=this.getHistoryFilePath(e.path);try{let i=this.plugin.app.vault.getAbstractFileByPath(n);if(i instanceof X.TFile)return await this.plugin.app.vault.delete(i),1;let o=await this.findLegacyHistoryFile(e);return o?(await this.plugin.app.vault.delete(o),console.log(`Cleared legacy history file: ${o.path}`),1):0}catch(i){if(i.message.includes("does not exist")){try{let o=await this.findLegacyHistoryFile(e);if(o)return await this.plugin.app.vault.delete(o),console.log(`Cleared legacy history file after initial miss: ${o.path}`),1}catch(o){console.error("Error checking/deleting legacy history during clear error handling:",o)}return 0}console.error("Failed to clear history for file:",n,i),new X.Notice(`Failed to clear history for ${e.basename}`);return}}async findLegacyHistoryFile(e){let n=this.plugin.settings.historyFolder;try{let o=(await this.plugin.app.vault.adapter.list(n)).files.filter(r=>r.endsWith(".md")&&(0,X.normalizePath)(r)!==this.getHistoryFilePath(e.path));for(let r of o){let s=this.plugin.app.vault.getAbstractFileByPath(r);if(s instanceof X.TFile){let u=this.plugin.app.metadataCache.getFileCache(s),f=u==null?void 0:u.frontmatter;if(f&&f.source_file){let d=f.source_file.match(/\[\[([^|#\]]+)/),p=d?d[1].trim().replace(/\.md$/,""):null,m=e.basename.replace(/\.md$/,"");if(p&&p===m)return s}}}}catch(i){i.message.includes("no such file or directory")||console.error(`Error searching for legacy history files in ${n}:`,i)}return null}async migrateLegacyHistoryFile(e,n){let i=this.getHistoryFilePath(n.path);console.log(`Attempting migration for legacy file ${e.path} to ${i}`);try{if(await this.plugin.app.vault.createFolder(this.plugin.settings.historyFolder).catch(()=>{}),await this.plugin.app.vault.createFolder((0,X.normalizePath)(`${this.plugin.settings.historyFolder}/History`)).catch(()=>{}),await this.plugin.app.vault.adapter.exists(i)){console.warn(`Migration target ${i} already exists. Deleting original legacy file ${e.path}.`),await this.plugin.app.vault.delete(e).catch(s=>{console.error(`Failed to delete original legacy file ${e.path} when target existed:`,s)});return}await this.plugin.app.vault.rename(e,i),console.log(`Successfully renamed ${e.path} to ${i}`);let r=this.plugin.app.vault.getAbstractFileByPath(i);if(!(r instanceof X.TFile)){console.error(`Failed to get TFile for newly renamed history file: ${i}. Cannot update frontmatter.`);return}await this.plugin.app.fileManager.processFrontMatter(r,s=>{s.source_file=this.plugin.gfile.getLinkText(n,n.path)}),console.log(`Successfully updated frontmatter for ${i}`)}catch(o){if(o.message.includes("already exists"))console.warn(`Rename failed, target ${i} already exists (race condition?). Attempting to delete original legacy file ${e.path}.`),await this.plugin.app.vault.delete(e).catch(r=>{console.error(`Failed to delete original legacy file ${e.path} after rename error:`,r)});else if(o.message.includes("does not exist"))console.warn(`Cannot migrate legacy history file, source no longer exists: ${e.path}`);else throw console.error(`Error during migration of ${e.path} to ${i}:`,o),o}}async clearHistory(){if(!this.plugin.settings.chatHistory)return;let e=this.plugin.settings.historyFolder,n=(0,X.normalizePath)(`${e}/History`);try{await this.plugin.app.vault.adapter.exists(n)&&await this.plugin.app.vault.adapter.rmdir(n,!0),await this.plugin.app.vault.createFolder(e).catch(()=>{}),await this.plugin.app.vault.createFolder(n).catch(()=>{}),new X.Notice("Chat history cleared.")}catch(i){console.error("Failed to clear all history",i),new X.Notice("Failed to clear chat history")}}formatEntryAsMarkdown(e,n=!1){var f,c,d,p;let i=e.created_at.toISOString(),o=e.role.charAt(0).toUpperCase()+e.role.slice(1),r=e.message.split(`
`),s=this.plugin.app.vault.getAbstractFileByPath(e.notePath),u="unknown";return s instanceof X.TFile?u=s.stat.mtime.toString(16).slice(0,8):console.warn(`Could not find TFile for path ${e.notePath} when formatting history entry.`),this.entryTemplate({isFirstEntry:n,role:o,timestamp:i,model:e.model,messageLines:r,pluginVersion:this.plugin.manifest.version,fileVersion:u,temperature:(f=e.metadata)==null?void 0:f.temperature,topP:(c=e.metadata)==null?void 0:c.topP,customPrompt:(d=e.metadata)==null?void 0:d.customPrompt,context:(p=e.metadata)==null?void 0:p.context})}async parseHistoryFile(e,n){var c;let i=[],o=this.getHistoryFilePath(n),r=this.plugin.app.vault.getAbstractFileByPath(o),s=n;if(r instanceof X.TFile){let d=(c=this.plugin.app.metadataCache.getFileCache(r))==null?void 0:c.frontmatter;if(d&&d.source_file){let p=this.plugin.app.metadataCache.getFirstLinkpathDest(d.source_file,r.path);p instanceof X.TFile&&(s=p.path)}}else console.warn(`Could not find history file TFile object for path: ${o}`);let f=e.replace(/^---\n[\s\S]*?\n---\n/,"").trim().split(/\n\n(?=## )/);for(let d of f){if(!d.trim())continue;let p=d.match(/^## (User|Model)/m);if(p){let m=p[1].toLowerCase(),h=d.match(/\|\s*Time\s*\|\s*(.*?)\s*\|/m),y=d.match(/\|\s*Model\s*\|\s*(.*?)\s*\|/m),v=d.match(/\|\s*Temperature\s*\|\s*(.*?)\s*\|/m),T=d.match(/\|\s*Top P\s*\|\s*(.*?)\s*\|/m),S=d.match(/\|\s*Custom Prompt\s*\|\s*(.*?)\s*\|/m),_=h?new Date(h[1].trim()):new Date,x=d.match(/>\s*\[!(user|assistant)\]\+\n([\s\S]*?)(?=\n\s*---|\n\s*$)/m);if(x){let C=x[2].split(`
`).map(w=>w.startsWith("> ")?w.slice(2):w).join(`
`).trim();if(C){let w={};S&&(w.customPrompt=S[1].trim()),v&&(w.temperature=parseFloat(v[1].trim())),T&&(w.topP=parseFloat(T[1].trim())),i.push({notePath:s,created_at:_,role:m,message:C,model:y?y[1].trim():void 0,metadata:Object.keys(w).length>0?w:void 0})}}}}return i}async renameHistoryFile(e,n){let i=this.getHistoryFilePath(n),o=this.getHistoryFilePath(e.path);try{let r=this.plugin.app.vault.getAbstractFileByPath(i);r instanceof X.TFile?(await this.plugin.app.fileManager.processFrontMatter(r,s=>{s.source_file=this.plugin.gfile.getLinkText(e,e.path)}),await this.plugin.app.vault.rename(r,o)):(console.log("Could not find history file TFile to rename:",i),await this.plugin.app.vault.adapter.exists(i)||console.log(`Adapter confirms ${i} does not exist.`))}catch(r){r.message.includes("already exists")?(console.warn(`Cannot rename history file, target already exists: ${o}`),new X.Notice(`History file for ${e.basename} might be duplicated.`)):r.message.includes("does not exist")?console.warn(`Cannot rename history file, source does not exist: ${i}`):(console.error("Failed to rename history file:",{from:i,to:o},r),new X.Notice(`Failed to update history for renamed file ${e.basename}`))}}async deleteHistoryFile(e){let n=this.getHistoryFilePath(e);try{let i=this.plugin.app.vault.getAbstractFileByPath(n);i instanceof X.TFile?await this.plugin.app.vault.delete(i):await this.plugin.app.vault.adapter.exists(n)&&(await this.plugin.app.vault.adapter.remove(n),console.log(`Removed history file via adapter: ${n}`))}catch(i){i.message.includes("does not exist")||console.error("Failed to delete history file:",n,i)}}};var Ct=require("obsidian"),Ar=Kn(di());var Un=class{constructor(e){this.plugin=e,Ar.registerHelper("eq",function(n,i){return n===i}),this.entryTemplate=Ar.compile(xr)}async getHistoryForSession(e){if(!this.plugin.settings.chatHistory)return[];let n=e.historyPath,i=this.plugin.app.vault.getAbstractFileByPath(n);if(!(i instanceof Ct.TFile))return[];try{let o=await this.plugin.app.vault.read(i);return this.parseHistoryContent(o)}catch(o){return console.error(`Error reading agent session history from ${n}:`,o),[]}}async addEntryToSession(e,n){var d,p,m;if(!this.plugin.settings.chatHistory)return;let i=e.historyPath;await this.ensureAgentSessionsFolder();let o=this.plugin.app.vault.getAbstractFileByPath(i),r="";if(o instanceof Ct.TFile)try{r=await this.plugin.app.vault.read(o)}catch(h){console.error(`Error reading existing history from ${i}:`,h)}else r=this.generateSessionFrontmatter(e);let s=n.role.charAt(0).toUpperCase()+n.role.slice(1),u=n.message.split(`
`),f=this.entryTemplate({role:s,messageLines:u,timestamp:new Date().toISOString(),pluginVersion:this.plugin.manifest.version,fileVersion:"unknown",model:n.model,temperature:(d=n.metadata)==null?void 0:d.temperature,topP:(p=n.metadata)==null?void 0:p.topP,customPrompt:(m=n.metadata)==null?void 0:m.customPrompt,toolsUsed:[],isDefined:h=>h!==void 0}),c=r+`
`+f;try{o instanceof Ct.TFile?await this.plugin.app.vault.modify(o,c):await this.plugin.app.vault.create(i,c),e.lastActive=new Date}catch(h){throw console.error(`Error writing to agent session history ${i}:`,h),h}}async updateSessionMetadata(e){if(!this.plugin.settings.chatHistory)return;let n=e.historyPath,i=this.plugin.app.vault.getAbstractFileByPath(n);if(!(i instanceof Ct.TFile)){let r=this.generateSessionFrontmatter(e);await this.ensureAgentSessionsFolder(),await this.plugin.app.vault.create(n,r);return}let o=e.context.contextFiles.map(r=>`[[${r.basename}]]`);await this.plugin.app.fileManager.processFrontMatter(i,r=>{r.session_id=e.id,r.type=e.type,r.title=e.title,r.context_files=o,r.context_depth=e.context.contextDepth,r.enabled_tools=e.context.enabledTools,r.require_confirmation=e.context.requireConfirmation,r.created=e.created.toISOString(),r.last_active=e.lastActive.toISOString(),e.sourceNotePath?r.source_note_path=e.sourceNotePath:delete r.source_note_path,e.modelConfig&&e.modelConfig.model?r.model=e.modelConfig.model:delete r.model,e.modelConfig&&e.modelConfig.temperature!==void 0?r.temperature=e.modelConfig.temperature:delete r.temperature,e.modelConfig&&e.modelConfig.topP!==void 0?r.top_p=e.modelConfig.topP:delete r.top_p,e.modelConfig&&e.modelConfig.promptTemplate?r.prompt_template=e.modelConfig.promptTemplate:delete r.prompt_template})}async deleteSessionHistory(e){let n=e.historyPath,i=this.plugin.app.vault.getAbstractFileByPath(n);if(i instanceof Ct.TFile)try{await this.plugin.app.vault.delete(i)}catch(o){throw console.error(`Error deleting session history ${n}:`,o),o}}async getAllAgentSessions(){let e=this.getAgentSessionsFolderPath();try{let n=this.plugin.app.vault.getAbstractFileByPath(e);return!n||!("children"in n)?[]:n.children.filter(i=>i instanceof Ct.TFile&&i.extension==="md").sort((i,o)=>o.stat.mtime-i.stat.mtime)}catch(n){return console.error("Error listing agent sessions:",n),[]}}parseHistoryContent(e){let n=[],i=/^---\s*$/m,r=e.split(i).slice(2);for(let s of r){if(!s.trim())continue;let u=s.match(/^## (User|Assistant|Model)\s*$/m);if(!u)continue;let f=u[1].toLowerCase(),c=f==="assistant"||f==="model"?"model":"user",d=/^> \[!(user|assistant)\]\+\s*$/m;if(s.match(d)){let m=s.split(`
`),h=m.findIndex(y=>d.test(y));if(h!==-1){let y=[],v=!1;for(let S=h+1;S<m.length;S++){let _=m[S];if(_.startsWith("> [!metadata]")||y.length>0&&!_.startsWith(">"))break;if(_.startsWith("> "))y.push(_.substring(2)),v=!0;else if(v)break}let T=y.join(`
`).trim();if(T){let S=s.match(/\| Time \| ([^|]+) \|/),_=S?new Date(S[1].trim()):new Date,x=s.match(/\| Model \| ([^|]+) \|/),C=x?x[1].trim():void 0,w=s.match(/\*\*Tool:\*\* `([^`]+)`/),P=s.match(/\*\*Status:\*\* (Success|Error)/),M={role:c,message:T,notePath:"",created_at:_,model:C};w&&(M.metadata={...M.metadata,toolName:w[1],toolStatus:P?P[1].toLowerCase():void 0}),n.push(M)}}}}return n}generateSessionFrontmatter(e){let n=e.context.contextFiles.map(o=>`[[${o.basename}]]`),i={session_id:e.id,type:e.type,title:e.title,context_files:n,context_depth:e.context.contextDepth,enabled_tools:e.context.enabledTools,require_confirmation:e.context.requireConfirmation,created:e.created.toISOString(),last_active:e.lastActive.toISOString()};return e.sourceNotePath&&(i.source_note_path=e.sourceNotePath),e.modelConfig&&(e.modelConfig.model&&(i.model=e.modelConfig.model),e.modelConfig.temperature!==void 0&&(i.temperature=e.modelConfig.temperature),e.modelConfig.topP!==void 0&&(i.top_p=e.modelConfig.topP),e.modelConfig.promptTemplate&&(i.prompt_template=e.modelConfig.promptTemplate)),`---
${Object.entries(i).map(([o,r])=>`${o}: ${JSON.stringify(r)}`).join(`
`)}
---

# ${e.title}

`}async ensureAgentSessionsFolder(){let e=this.getAgentSessionsFolderPath();await this.plugin.app.vault.adapter.exists(e)||await this.plugin.app.vault.createFolder(e)}getAgentSessionsFolderPath(){return(0,Ct.normalizePath)(`${this.plugin.settings.historyFolder}/Agent-Sessions`)}};Mt();var Pr=class{constructor(e){this.plugin=e,this.markdownHistory=new _r(e),this.sessionHistory=new Un(e)}async setupHistoryCommands(){if(this.plugin.settings.chatHistory)try{this.plugin.addCommand({id:"gemini-scribe-clear-conversations",name:"Clear All Chat History",callback:async()=>{await this.clearHistory()}})}catch(e){console.error("Failed to add commands",e)}}async onLayoutReady(){await this.setupHistory(),await this.markdownHistory.migrateAllLegacyFiles()}async setupHistory(){this.plugin.app.vault.on("rename",this.renameHistoryFile.bind(this)),this.plugin.app.vault.on("delete",this.handleFileDelete.bind(this))}async onUnload(){this.plugin.app.vault.off("rename",this.renameHistoryFile.bind(this)),this.plugin.app.vault.off("delete",this.handleFileDelete.bind(this))}async renameHistoryFile(e,n){let i=this.plugin.settings.historyFolder,o=(0,ot.normalizePath)(e.path),r=(0,ot.normalizePath)(n),s=(0,ot.normalizePath)(i+"/");o.startsWith(s)||r.startsWith(s)||e instanceof ot.TFile&&await this.markdownHistory.renameHistoryFile(e,n)}async handleFileDelete(e){e instanceof ot.TFile&&await this.markdownHistory.deleteHistoryFile(e.path)}async appendHistoryForFile(e,n){await this.markdownHistory.appendHistoryForFile(e,n)}async getHistoryForFile(e){return await this.markdownHistory.getHistoryForFile(e)}async clearHistoryForFile(e){return await this.markdownHistory.clearHistoryForFile(e)}async getHistoryForSession(e){if(e.type==="note-chat"&&e.sourceNotePath){let n=this.plugin.app.vault.getAbstractFileByPath(e.sourceNotePath);if(n instanceof ot.TFile)return await this.markdownHistory.getHistoryForFile(n)}else if(e.type==="agent-session")return await this.sessionHistory.getHistoryForSession(e);return[]}async addEntryToSession(e,n){if(e.type==="note-chat"&&e.sourceNotePath){let i=this.plugin.app.vault.getAbstractFileByPath(e.sourceNotePath);i instanceof ot.TFile&&await this.markdownHistory.appendHistoryForFile(i,n)}else e.type==="agent-session"&&await this.sessionHistory.addEntryToSession(e,n)}async updateSessionMetadata(e){e.type==="agent-session"&&await this.sessionHistory.updateSessionMetadata(e)}async deleteSessionHistory(e){if(e.type==="agent-session")await this.sessionHistory.deleteSessionHistory(e);else if(e.type==="note-chat"&&e.sourceNotePath){let n=this.plugin.app.vault.getAbstractFileByPath(e.sourceNotePath);n instanceof ot.TFile&&await this.markdownHistory.clearHistoryForFile(n)}}async getAllAgentSessions(){return await this.sessionHistory.getAllAgentSessions()}async appendHistory(e){let n=this.plugin.app.workspace.getActiveFile();n&&await this.appendHistoryForFile(n,e)}async clearHistory(){await this.markdownHistory.clearHistory()}};var Gn=require("obsidian");var He=require("@codemirror/view"),Dt=require("@codemirror/state");function em(t,e,n=void 0){let i={force:()=>{}},o=null;async function*r(...s){o&&clearTimeout(o);let u=null;try{await new Promise(f=>{u=o=setTimeout(()=>f(),e),i.force=()=>{o&&clearTimeout(o),f()}})}catch(f){if(n!==void 0)throw n}for await(let f of t(...s)){if(u!==o)break;yield f}}return{debounced:r,force:()=>i.force()}}var fx=Object.defineProperty,dx=(t,e,n)=>e in t?fx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Vn=(t,e,n)=>(dx(t,typeof e!="symbol"?e+"":e,n),n),Ir=Dt.StateField.define({create(){return{suggestion:null}},update(t,e){let n=e.effects.find(i=>i.is(gl));return e.state.doc&&n&&(n.value.doc==null||e.state.doc==n.value.doc)?{suggestion:n.value.suggestion}:{suggestion:null}}}),gl=Dt.StateEffect.define();function px(t,e){let n=t.state.selection.main.head,i=[],o=He.Decoration.widget({widget:new dl(e),side:1});return i.push(o.range(n)),He.Decoration.set(i)}var dl=class extends He.WidgetType{constructor(e){super(),Vn(this,"suggestion"),this.suggestion=e}toDOM(){let e=document.createElement("span");return e.style.opacity="0.4",e.className="cm-inline-suggestion",e.textContent=this.suggestion,e}},pl=t=>{let e=0;return He.ViewPlugin.fromClass(class{async update(n){let i=n.state.doc;if(!n.docChanged)return;let o=++e;for await(let r of t(n.state)){if(o!=e)return;n.view.dispatch({effects:gl.of({suggestion:r,doc:i})})}}})},ml=class{constructor(){Vn(this,"decorations"),this.decorations=He.Decoration.none}update(e){var n;let i=(n=e.state.field(Ir))==null?void 0:n.suggestion;if(!i){this.decorations=He.Decoration.none;return}this.decorations=px(e.view,i.display_suggestion)}},tm=He.ViewPlugin.fromClass(ml,{decorations:t=>t.decorations}),hl=class{constructor(e,n){Vn(this,"suggestFn"),Vn(this,"keymap"),Vn(this,"completionId"),Vn(this,"run",i=>{var o,r;let s=(o=i.state.field(Ir))==null?void 0:o.suggestion;return s?(i.dispatch({...mx(i.state,s.complete_suggestion,i.state.selection.main.head,i.state.selection.main.head)}),(r=s.accept_hook)==null||r.call(s),(async()=>{if(this.suggestFn==null)return;let u=++this.completionId;for await(let f of this.suggestFn(i.state)){if(u!=this.completionId)return;i.dispatch({effects:gl.of({suggestion:{complete_suggestion:f.complete_suggestion,display_suggestion:f.display_suggestion,accept_hook:f.accept_hook},doc:null})})}})(),!0):!1}),this.suggestFn=e,this.keymap=Dt.Prec.highest(He.keymap.of([{key:n,run:i=>this.run(i)}])),this.completionId=0}};function mx(t,e,n,i){return{...t.changeByRange(o=>{if(o==t.selection.main)return{changes:{from:n,to:i,insert:e},range:Dt.EditorSelection.cursor(n+e.length)};let r=i-n;return!o.empty||r&&t.sliceDoc(o.from-r,o.from)!=t.sliceDoc(n,i)?{range:o}:{changes:{from:o.from-r,to:o.from,insert:e},range:Dt.EditorSelection.cursor(o.from-r+e.length)}}),userEvent:"input.complete"}}function nm(t){return typeof t=="string"?{complete_suggestion:t,display_suggestion:t}:t}function hx(t){return async function*(e){let n=await t(e);if(typeof n=="string"||"complete_suggestion"in n){yield nm(n);return}for await(let i of n)yield nm(i)}}function yl(t){let{delay:e=500,accept_shortcut:n="Tab"}=t,i=hx(t.fetchFn),{debounced:o,force:r}=em(i,e);return{extension:n?[Ir,pl(o),tm,new hl(t.continue_suggesting?i:null,n).keymap]:[Ir,pl(o),tm],force_fetch:r}}var br=class{constructor(e){this.force_fetch=()=>{};this.TYPING_DELAY=750;this.completionsOn=!1;this.plugin=e,this.prompts=new fe(e),this.debouncedComplete=(0,Gn.debounce)(()=>this.force_fetch(),this.TYPING_DELAY,!0)}async*complete(){if(!this.completionsOn)return;let e=this.plugin.app.workspace.getActiveViewOfType(Gn.MarkdownView);if(!e)return;let n=e.editor,i=n.getCursor(),r=n.getLine(i.line).substring(0,i.ch),s=r.length>0&&!r.endsWith(" "),u=n.getRange({line:0,ch:0},i),f=n.getRange(i,{line:n.lastLine(),ch:n.getLine(n.lastLine()).length}),c=await this.generateNextSentence(u,f),d=s?" "+c:c;yield{display_suggestion:d,complete_suggestion:d}}async generateNextSentence(e,n){let i=Oe.createCompletionsModel(this.plugin),o={prompt:this.prompts.completionsPrompt({contentBeforeCursor:e,contentAfterCursor:n})};return(await i.generateModelResponse(o)).markdown.replace(/\n$/,"")}async setupCompletions(){let{extension:e,force_fetch:n}=yl({fetchFn:()=>this.complete()});this.force_fetch=n,this.plugin.registerEditorExtension(e)}async setupCompletionsCommands(){try{this.plugin.addCommand({id:"gemini-scribe-toggle-completions",name:"Toggle completions",callback:()=>{this.completionsOn=!this.completionsOn,new Gn.Notice(`Gemini Scribe Completions are now ${this.completionsOn?"enabled":"disabled"}.`),this.completionsOn&&this.force_fetch()}})}catch(e){console.error("Error setting up completion commands:",e)}}};var pm=require("obsidian");Nt();Nt();var kr=class{constructor(e){this.cache=null;this.CACHE_DURATION=24*60*60*1e3;this.API_BASE="https://generativelanguage.googleapis.com/v1beta";this.plugin=e}async discoverModels(e=!1){if(!e&&this.cache&&this.isCacheValid())return this.cache;try{let i={models:await this.fetchModelsFromAPI(),lastUpdated:Date.now(),success:!0};return this.cache=i,await this.persistCache(i),i}catch(n){let i={models:[],lastUpdated:Date.now(),success:!1,error:n instanceof Error?n.message:"Unknown error"};return this.cache||i}}async fetchModelsFromAPI(){let e=this.plugin.settings.apiKey;if(!e)throw new Error("API key not configured");let n=[],i;do{let f=new URL(`${this.API_BASE}/models`);f.searchParams.set("key",e),i&&f.searchParams.set("pageToken",i),f.searchParams.set("pageSize","50");let c=await fetch(f.toString());if(!c.ok)throw new Error(`API request failed: ${c.status} ${c.statusText}`);let d=await c.json();n=n.concat(d.models||[]),i=d.nextPageToken}while(i);let o=n.filter(f=>this.isGenerativeModel(f)),r=await Promise.allSettled(o.map(f=>this.fetchModelDetails(f,e))),s=r.filter(f=>f.status==="fulfilled"&&f.value!==null).map(f=>f.value),u=r.length-s.length;return u>0&&console.warn(`Failed to fetch detailed information for ${u} models`),s}async fetchModelDetails(e,n){try{let i=new URL(`${this.API_BASE}/${e.name}`);i.searchParams.set("key",n);let o=await fetch(i.toString());if(!o.ok)return console.warn(`Failed to fetch details for model ${e.name}: ${o.status}`),e;let r=await o.json();return{...e,maxTemperature:r==null?void 0:r.maxTemperature,topP:r==null?void 0:r.topP,topK:r==null?void 0:r.topK}}catch(i){return console.warn(`Error fetching model details for ${e.name}:`,i),e}}isGenerativeModel(e){var n;return((n=e.supportedGenerationMethods)==null?void 0:n.includes("generateContent"))&&e.name.includes("gemini")&&!e.name.includes("vision")}isCacheValid(){return!!(this.cache&&Date.now()-this.cache.lastUpdated<this.CACHE_DURATION)}async persistCache(e){let n=await this.plugin.loadData()||{};n.modelDiscoveryCache=e,await this.plugin.saveData(n)}async loadCache(){let e=await this.plugin.loadData()||{};this.cache=e.modelDiscoveryCache||null}clearCache(){this.cache=null}getCacheInfo(){var e;return{hasCache:!!this.cache,isValid:this.isCacheValid(),lastUpdated:(e=this.cache)==null?void 0:e.lastUpdated}}};var Hn=class{static mapToGeminiModels(e){let n=e.map(i=>({value:this.extractModelId(i.name),label:this.generateLabel(i),defaultForRoles:this.inferDefaultRoles(i)}));return this.deduplicateModels(n)}static extractModelId(e){return e.replace(/^models\//,"")}static generateLabel(e){return e.displayName?e.displayName:this.extractModelId(e.name).split("-").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ")}static inferDefaultRoles(e){let n=this.extractModelId(e.name).toLowerCase(),i=[];return n.includes("pro")?i.push("chat"):n.includes("flash")?i.push("summary"):n.includes("lite")&&i.push("completions"),(n.includes("experimental")||n.includes("thinking"))&&(i.includes("chat")||i.push("chat")),i.length===0&&i.push("chat"),i}static mergeWithExistingModels(e,n){let i=new Map(n.map(s=>[s.value,s])),o=this.getCurrentDefaultModels(n),r=e.map(s=>{let u=i.get(s.value);return u?{...s,defaultForRoles:u.defaultForRoles,label:this.shouldUpdateLabel(u.label,s.label)?s.label:u.label}:s});return this.ensureRoleDefaults(r,o)}static getCurrentDefaultModels(e){let n={};for(let i of["chat","summary","completions"]){let o=e.find(r=>{var s;return(s=r.defaultForRoles)==null?void 0:s.includes(i)});o&&(n[i]=o.value)}return n}static ensureRoleDefaults(e,n){var o;let i=new Map(e.map(r=>[r.value,r]));for(let r of["chat","summary","completions"]){let s=n[r];if(!e.some(f=>{var c;return(c=f.defaultForRoles)==null?void 0:c.includes(r)}))if(s&&i.has(s)){let f=i.get(s);f.defaultForRoles=[...f.defaultForRoles||[],r]}else{let f=this.findBestModelForRole(e,r);f&&!((o=f.defaultForRoles)!=null&&o.includes(r))&&(f.defaultForRoles=[...f.defaultForRoles||[],r])}}return e}static findBestModelForRole(e,n){let i=this.sortModelsByPreference(e);for(let o of i){let r=o.value.toLowerCase();switch(n){case"chat":if(r.includes("pro"))return o;break;case"summary":if(r.includes("flash"))return o;break;case"completions":if(r.includes("lite")||r.includes("flash"))return o;break}}return i[0]}static shouldUpdateLabel(e,n){let i=s=>s.toLowerCase().replace(/[^a-z0-9]/g,""),o=i(e),r=i(n);return o!==r}static filterModels(e,n={}){return e.filter(i=>!(n.excludeExperimental&&i.value.includes("experimental")||n.minNameLength&&i.value.length<n.minNameLength))}static deduplicateModels(e){let n=new Map;for(let i of e){let o=n.get(i.value);o?this.shouldPreferModel(i,o)&&n.set(i.value,i):n.set(i.value,i)}return Array.from(n.values())}static shouldPreferModel(e,n){let i=!e.label.includes("-"),o=!n.label.includes("-");if(i!==o)return i;if(e.label.length!==n.label.length)return e.label.length<n.label.length;let r=e.value.match(/\d{2}-\d{2}$/),s=n.value.match(/\d{2}-\d{2}$/);return r&&s?r[0]>s[0]:!1}static sortModelsByPreference(e){return[...e].sort((n,i)=>{let o=v=>{let T=v.match(/gemini-(\d+(?:\.\d+)?)/i);return T?parseFloat(T[1]):0},r=o(n.value),s=o(i.value);if(r!==s)return s-r;let u=v=>v.includes("pro")?3:v.includes("flash")?2:v.includes("lite")?1:0,f=u(n.value),c=u(i.value);if(f!==c)return c-f;let d=v=>{let T=v.match(/(\d{2})-(\d{2})$/);if(T){let S=parseInt(T[1]),_=parseInt(T[2]);return S*100+_}return 0},p=d(n.value),m=d(i.value);if(p>0&&m>0)return m-p;if(p>0&&m===0)return-1;if(m>0&&p===0)return 1;let h=!n.value.includes("experimental")&&!n.value.includes("preview"),y=!i.value.includes("experimental")&&!i.value.includes("preview");return h!==y?h?-1:1:n.value.localeCompare(i.value)})}};var rt=class{static getParameterRanges(e){if(!e||e.length===0)return this.DEFAULT_RANGES;let n=e.map(o=>o.maxTemperature).filter(o=>o!=null),i=n.length>0?n.reduce((o,r)=>Math.max(o,r),0):this.DEFAULT_RANGES.temperature.max;return{temperature:{min:0,max:Math.max(i,1),step:.1},topP:{min:0,max:1,step:.01}}}static getModelParameterInfo(e){return e.map(n=>({modelName:n.name,maxTemperature:n.maxTemperature,topP:n.topP,topK:n.topK}))}static validateTemperature(e,n,i=[]){if(n){let r=i.find(s=>s.name===n||s.displayName===n);if((r==null?void 0:r.maxTemperature)!==void 0&&e>r.maxTemperature)return{isValid:!1,adjustedValue:r.maxTemperature,warning:`Temperature ${e} exceeds ${n} limit of ${r.maxTemperature}. Adjusted to ${r.maxTemperature}.`}}let o=this.getParameterRanges(i);if(e<o.temperature.min||e>o.temperature.max){let r=Math.max(o.temperature.min,Math.min(o.temperature.max,e));return{isValid:!1,adjustedValue:r,warning:`Temperature ${e} is outside valid range [${o.temperature.min}, ${o.temperature.max}]. Adjusted to ${r}.`}}return{isValid:!0}}static validateTopP(e,n,i=[]){let o=this.getParameterRanges(i);if(e<o.topP.min||e>o.topP.max){let r=Math.max(o.topP.min,Math.min(o.topP.max,e));return{isValid:!1,adjustedValue:r,warning:`Top P ${e} is outside valid range [${o.topP.min}, ${o.topP.max}]. Adjusted to ${r}.`}}return{isValid:!0}}static getParameterDisplayInfo(e){let n=this.getParameterRanges(e),i=e&&e.length>0,o=e.map(u=>u.topP).filter(u=>u!=null),r=[...new Set(o)].sort((u,f)=>u-f),s=r.length>0?`Range: ${n.topP.min} to ${n.topP.max} (model defaults: ${r.join(", ")})`:`Range: ${n.topP.min} to ${n.topP.max}`;return{temperature:`Range: ${n.temperature.min} to ${n.temperature.max}`,topP:s,hasModelData:i}}};rt.DEFAULT_RANGES={temperature:{min:0,max:2,step:.1},topP:{min:0,max:1,step:.01}};var Xt=class Xt{constructor(e){this.plugin=e,this.discoveryService=new kr(e)}async getAvailableModels(e={}){var n;if(!((n=this.plugin.settings.modelDiscovery)!=null&&n.enabled))return this.filterModelsForVersion(Xt.staticModels);try{let i=await this.discoveryService.discoverModels(e.forceRefresh);if(i.success&&i.models.length>0){let o=Hn.mapToGeminiModels(i.models);return o=Hn.sortModelsByPreference(o),e.preserveUserCustomizations&&(o=Hn.mergeWithExistingModels(o,Xt.staticModels)),this.filterModelsForVersion(o)}}catch(i){console.warn("Model discovery failed, falling back to static models:",i)}return this.filterModelsForVersion(Xt.staticModels)}async updateModels(e={}){let n=await this.getAvailableModels(e),i=this.getCurrentGeminiModels();return this.detectModelChanges(n,i)?(this.updateGlobalModelsList(n),Zn(this.plugin.settings)):{updatedSettings:this.plugin.settings,settingsChanged:!1,changedSettingsInfo:[]}}getCurrentGeminiModels(){return(Nt(),Wr(Jr)).GEMINI_MODELS||[]}updateGlobalModelsList(e){let n=(Nt(),Wr(Jr));n.setGeminiModels&&n.setGeminiModels(e)}detectModelChanges(e,n){if(e.length!==n.length)return!0;let i=new Set(e.map(r=>r.value)),o=new Set(n.map(r=>r.value));return!this.areSetsEqual(i,o)}areSetsEqual(e,n){return e.size===n.size&&[...e].every(i=>n.has(i))}async initialize(){await this.discoveryService.loadCache()}getDiscoveryService(){return this.discoveryService}static getStaticModels(){return[...Xt.staticModels]}filterModelsForVersion(e){return e.filter(n=>{let i=n.value.toLowerCase();if(i.includes("gemini-2.5"))return!0;if(i.includes("gemini-2.0"))return!1;let o=i.match(/gemini-(\d+)\.(\d+)/);if(o){let r=parseInt(o[1]),s=parseInt(o[2]);if(r>2||r===2&&s>=5)return!0}return console.debug(`Filtering out deprecated model ${n.value} - only Gemini 2.5+ supported`),!1})}async getDiscoveryStatus(){var n;if(!(((n=this.plugin.settings.modelDiscovery)==null?void 0:n.enabled)||!1))return{enabled:!1,working:!1};try{let i=await this.discoveryService.discoverModels(!1);return{enabled:!0,working:i.success,lastUpdate:i.lastUpdated,error:i.error}}catch(i){return{enabled:!0,working:!1,error:i instanceof Error?i.message:"Unknown error"}}}async refreshModels(){try{let e=await this.updateModels({forceRefresh:!0,preserveUserCustomizations:!0});return{success:!0,modelsFound:(await this.getAvailableModels({forceRefresh:!0})).length,changes:e.settingsChanged}}catch(e){return{success:!1,modelsFound:0,changes:!1,error:e instanceof Error?e.message:"Unknown error"}}}async getParameterRanges(){var e;if(!((e=this.plugin.settings.modelDiscovery)!=null&&e.enabled))return rt.getParameterRanges([]);try{let n=await this.discoveryService.discoverModels(!1),i=n.success?n.models:[];return rt.getParameterRanges(i)}catch(n){return console.warn("Failed to get parameter ranges from discovered models:",n),rt.getParameterRanges([])}}async getDiscoveredModels(){var e;if(!((e=this.plugin.settings.modelDiscovery)!=null&&e.enabled))return[];try{let n=await this.discoveryService.discoverModels(!1);return n.success?n.models:[]}catch(n){return console.warn("Failed to get discovered models:",n),[]}}async validateParameters(e,n,i){let o=await this.getDiscoveredModels();return{temperature:rt.validateTemperature(e,i,o),topP:rt.validateTopP(n,i,o)}}async getParameterDisplayInfo(){let e=await this.getDiscoveredModels();return rt.getParameterDisplayInfo(e)}};Xt.staticModels=[{value:"gemini-2.5-pro",label:"Gemini 2.5 Pro",defaultForRoles:["chat"]},{value:"gemini-2.5-flash",label:"Gemini 2.5 Flash",defaultForRoles:["summary"]},{value:"gemini-2.5-flash-lite-preview-06-17",label:"Gemini 2.5 Flash Lite",defaultForRoles:["completions"]}];var Rr=Xt;var Y=require("obsidian"),Nr=class{constructor(e,n){this.plugin=e;this.vault=n}getPromptsDirectory(){return(0,Y.normalizePath)(`${this.plugin.settings.historyFolder}/Prompts`)}async ensurePromptsDirectory(){await this.vault.createFolder(this.plugin.settings.historyFolder).catch(()=>{});let e=this.getPromptsDirectory(),n=this.vault.getAbstractFileByPath(e);(!n||!(n instanceof Y.TFolder))&&await this.vault.createFolder(e)}async loadPromptFromFile(e){try{let n=this.vault.getAbstractFileByPath(e);if(!(n instanceof Y.TFile))return null;let i=this.plugin.app.metadataCache.getFileCache(n),o=(i==null?void 0:i.frontmatter)||{},r="";if(i!=null&&i.sections){let f=(await this.vault.read(n)).split(`
`);for(let c of i.sections){if(c.type==="yaml")continue;let d=c.position.start.line,p=c.position.end.line;for(let m=d;m<=p&&m<f.length;m++)r+=f[m]+`
`}}else{let u=await this.vault.read(n);r=this.extractContentWithoutFrontmatter(u)}let s=Array.isArray(o.tags)?o.tags:[];return{name:o.name||"Unnamed Prompt",description:o.description||"",version:o.version||1,overrideSystemPrompt:o.override_system_prompt||!1,tags:s,content:r.trim()}}catch(n){return console.error("Error loading prompt file:",n),null}}extractContentWithoutFrontmatter(e){let n=/^---\n([\s\S]*?)\n---\n([\s\S]*)$/,i=e.match(n);return i?i[2]:e}async getPromptFromNote(e){var s;let n=this.plugin.app.metadataCache.getFileCache(e),i=(s=n==null?void 0:n.frontmatter)==null?void 0:s["gemini-scribe-prompt"];if(!i)return null;let o=this.extractPathFromWikilink(i);if(!o)return null;let r=this.plugin.app.metadataCache.getFirstLinkpathDest(o,e.path);return!r||!(r instanceof Y.TFile)?null:await this.loadPromptFromFile(r.path)}async getPromptHistoryInfo(e){var u;let n=this.plugin.app.metadataCache.getFileCache(e),i=(u=n==null?void 0:n.frontmatter)==null?void 0:u["gemini-scribe-prompt"];if(!i)return null;let o=this.extractPathFromWikilink(i);if(!o)return null;let r=this.plugin.app.metadataCache.getFirstLinkpathDest(o,e.path);if(!r||!(r instanceof Y.TFile))return null;let s=await this.loadPromptFromFile(r.path);return s?`[[${r.basename}\\|${s.name}]]`:null}extractPathFromWikilink(e){let n=e;return n.startsWith("[[")&&n.endsWith("]]")&&(n=n.slice(2,-2)),n.split("|")[0].split("#")[0].split("^")[0].trim()||null}async listAvailablePrompts(){let e=this.getPromptsDirectory();if(!(this.vault.getAbstractFileByPath(e)instanceof Y.TFolder))return[];let i=[],o=this.vault.getMarkdownFiles().filter(r=>r.path.startsWith(e));for(let r of o){let s=await this.loadPromptFromFile(r.path);s&&i.push({path:r.path,name:s.name,description:s.description,tags:s.tags})}return i}async createDefaultPrompts(){let e=this.getPromptsDirectory(),n=(0,Y.normalizePath)(`${e}/example-expert.md`);if(this.vault.getAbstractFileByPath(n))return;await this.vault.create(n,`---
name: "Subject Matter Expert"
description: "A knowledgeable expert who provides detailed, accurate information"
version: 1
override_system_prompt: false
tags: ["general", "expert"]
---

You are a subject matter expert with comprehensive knowledge across multiple domains. When answering questions:

- Provide accurate, well-researched information
- Cite relevant sources when possible
- Explain complex concepts clearly
- Acknowledge limitations in your knowledge
- Offer multiple perspectives when appropriate

Focus on being helpful while maintaining intellectual honesty.`)}setupPromptCommands(){this.plugin.settings.enableCustomPrompts&&(this.plugin.addCommand({id:"gemini-scribe-apply-custom-prompt",name:"Apply Custom Prompt to Current Note",callback:()=>this.applyCustomPromptToCurrentNote()}),this.plugin.addCommand({id:"gemini-scribe-remove-custom-prompt",name:"Remove Custom Prompt from Current Note",callback:()=>this.removeCustomPromptFromCurrentNote()}),this.plugin.addCommand({id:"gemini-scribe-create-custom-prompt",name:"Create New Custom Prompt",callback:()=>this.createNewCustomPrompt()}))}async applyCustomPromptToCurrentNote(){try{if(!this.plugin.settings.enableCustomPrompts){new Y.Notice("Custom prompts are disabled. Enable them in plugin settings.");return}let e=this.plugin.gfile.getActiveFile();if(!e){new Y.Notice("No active file to apply prompt to");return}if(!this.plugin.gfile.isMarkdownFile(e)){new Y.Notice("Custom prompts can only be applied to markdown files");return}let n=await this.listAvailablePrompts();if(n.length===0){new Y.Notice("No custom prompts found. Create prompts in the Prompts folder first.");return}this.showPromptSelectionModal(e,n)}catch(e){console.error("Error applying custom prompt:",e),new Y.Notice("Failed to apply custom prompt")}}showPromptSelectionModal(e,n){new vl(this.plugin.app,this,e,n).open()}async applyPromptToFile(e,n){try{let o=`[[${this.extractPromptNameFromPath(n.path)}]]`;await this.plugin.app.fileManager.processFrontMatter(e,r=>{r["gemini-scribe-prompt"]=o}),new Y.Notice(`Applied custom prompt: ${n.name}`),this.plugin.geminiView&&await this.plugin.geminiView.forceRefreshPromptIndicator()}catch(i){console.error("Error applying prompt to file:",i),new Y.Notice("Failed to apply custom prompt to note")}}async removeCustomPromptFromCurrentNote(){var e;try{if(!this.plugin.settings.enableCustomPrompts){new Y.Notice("Custom prompts are disabled. Enable them in plugin settings.");return}let n=this.plugin.gfile.getActiveFile();if(!n){new Y.Notice("No active file to remove prompt from");return}if(!this.plugin.gfile.isMarkdownFile(n)){new Y.Notice("Custom prompts can only be removed from markdown files");return}let i=this.plugin.app.metadataCache.getFileCache(n);if(!((e=i==null?void 0:i.frontmatter)==null?void 0:e["gemini-scribe-prompt"])){new Y.Notice("No custom prompt is applied to this note");return}await this.plugin.app.fileManager.processFrontMatter(n,r=>{delete r["gemini-scribe-prompt"]}),new Y.Notice("Removed custom prompt from note"),this.plugin.geminiView&&await this.plugin.geminiView.forceRefreshPromptIndicator()}catch(n){console.error("Error removing custom prompt:",n),new Y.Notice("Failed to remove custom prompt from note")}}extractPromptNameFromPath(e){let n=this.vault.getAbstractFileByPath(e);return n instanceof Y.TFile?n.basename:(e.split("/").pop()||"").replace(".md","")}async createNewCustomPrompt(){try{if(!this.plugin.settings.enableCustomPrompts){new Y.Notice("Custom prompts are disabled. Enable them in plugin settings.");return}await this.ensurePromptsDirectory(),new Cl(this.plugin.app,async n=>{if(!n||n.trim()===""){new Y.Notice("Prompt name cannot be empty");return}let i=n.trim().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-");if(!i){new Y.Notice("Invalid prompt name. Please use alphanumeric characters, spaces, hyphens, or underscores.");return}let o=this.getPromptsDirectory(),r=`${i.toLowerCase()}.md`,s=(0,Y.normalizePath)(`${o}/${r}`);if(this.vault.getAbstractFileByPath(s)){new Y.Notice(`A prompt file named "${r}" already exists.`);return}let f=`---
name: "${n}"
description: "Brief description of what this prompt does"
version: 1
override_system_prompt: false
tags: ["category", "type"]
---

# Instructions for the AI

Your custom prompt content goes here. This will modify how the AI behaves when applied to notes.

## Tips:
- Be specific about the desired behavior
- Include examples if helpful
- Consider the context this will be used in

## Example Usage:
This prompt will be applied to notes and will supplement the default system prompt unless override_system_prompt is set to true.`;try{let c=await this.vault.create(s,f);await this.plugin.app.workspace.openLinkText(c.path,"",!0),new Y.Notice(`Created new custom prompt: ${n}`)}catch(c){console.error("Error creating prompt file:",c),new Y.Notice("Failed to create prompt file")}}).open()}catch(e){console.error("Error creating new custom prompt:",e),new Y.Notice("Failed to create new custom prompt")}}},vl=class extends Y.SuggestModal{constructor(n,i,o,r){super(n);this.promptManager=i;this.targetFile=o;this.prompts=r;this.setPlaceholder("Select a custom prompt to apply...")}getSuggestions(n){let i=n.toLowerCase();return n?this.prompts.filter(o=>o.name.toLowerCase().includes(i)||o.description.toLowerCase().includes(i)||o.tags.some(r=>r.toLowerCase().includes(i))):this.prompts}renderSuggestion(n,i){let o=i.createDiv({cls:"suggestion-content"});o.createDiv({text:n.name,cls:"suggestion-title"}),n.description&&o.createDiv({text:n.description,cls:"suggestion-note"}),n.tags.length>0&&o.createDiv({cls:"suggestion-aux"}).setText(`Tags: ${n.tags.join(", ")}`)}onChooseSuggestion(n,i){setTimeout(async()=>{try{await this.promptManager.applyPromptToFile(this.targetFile,n)}catch(o){console.error("Error applying prompt:",o),new Y.Notice("Failed to apply custom prompt")}},0)}},Cl=class extends Y.Modal{constructor(e,n){super(e),this.onSubmit=n}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Create New Custom Prompt"});let n=e.createDiv({cls:"prompt-input-container"});n.createEl("label",{text:"Prompt Name:"}),this.inputEl=n.createEl("input",{type:"text",placeholder:"Enter a name for your custom prompt..."}),this.inputEl.style.width="100%",this.inputEl.style.marginTop="8px",this.inputEl.style.padding="8px",this.inputEl.style.border="1px solid var(--background-modifier-border)",this.inputEl.style.borderRadius="4px",this.inputEl.addEventListener("keydown",s=>{s.key==="Enter"?(s.preventDefault(),this.submit()):s.key==="Escape"&&this.close()});let i=e.createDiv({cls:"prompt-button-container"});i.style.marginTop="16px",i.style.display="flex",i.style.gap="8px",i.style.justifyContent="flex-end";let o=i.createEl("button",{text:"Cancel"});o.style.padding="8px 16px",o.addEventListener("click",()=>this.close());let r=i.createEl("button",{text:"Create"});r.style.padding="8px 16px",r.style.backgroundColor="var(--interactive-accent)",r.style.color="var(--text-on-accent)",r.style.border="none",r.style.borderRadius="4px",r.addEventListener("click",()=>this.submit()),setTimeout(()=>this.inputEl.focus(),100)}submit(){let e=this.inputEl.value.trim();e&&(this.close(),this.onSubmit(e))}onClose(){let{contentEl:e}=this;e.empty()}};var Lr=require("obsidian");var bi=class{constructor(e){this.plugin=e,this.prompts=new fe(e)}buildSelectionPrompt(e){let n=e.fullContent.substring(0,e.selectionStart)+"[SELECTION_START]"+e.selectedText+"[SELECTION_END]"+e.fullContent.substring(e.selectionEnd);return this.prompts.selectionRewritePrompt({selectedText:e.selectedText,instructions:e.instructions,documentWithMarkers:n})}async rewriteSelection(e,n,i){let o=e.getCursor("from"),r=e.getCursor("to"),s=e.posToOffset(o),u=e.posToOffset(r),c={prompt:this.buildSelectionPrompt({selectedText:n,instructions:i,fullContent:e.getValue(),selectionStart:s,selectionEnd:u}),conversationHistory:[],userMessage:i};try{new Lr.Notice("Rewriting selected text...");let p=await Oe.createRewriteModel(this.plugin).generateModelResponse(c);e.replaceSelection(p.markdown.trim()),new Lr.Notice("Text rewritten successfully")}catch(d){console.error("Failed to rewrite text:",d),new Lr.Notice("Failed to rewrite text: "+d.message)}}};var im=require("obsidian"),ki=class extends im.Modal{constructor(e,n,i){super(e),this.selectedText=n,this.onSubmit=i,this.modalEl.addClass("gemini-scribe-rewrite-modal")}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Rewrite Selected Text"});let n=e.createDiv({cls:"gemini-scribe-section"});n.createEl("label",{text:"Selected text:",cls:"gemini-scribe-label"}),n.createDiv({cls:"gemini-scribe-preview-text"}).createDiv({cls:"gemini-scribe-preview-content"}).setText(this.selectedText);let r=e.createDiv({cls:"gemini-scribe-section"});r.createEl("label",{text:"Instructions:",cls:"gemini-scribe-label"}),this.instructionsEl=r.createEl("textarea",{placeholder:`How would you like to rewrite this text?

Examples:
\u2022 Make it more concise
\u2022 Fix grammar and spelling
\u2022 Make it more formal/casual
\u2022 Expand with more detail
\u2022 Simplify the language`,cls:"gemini-scribe-instructions-input"});let s=e.createEl("button",{text:"Rewrite",cls:"gemini-scribe-submit-button mod-cta"});s.onclick=()=>this.submit(),this.instructionsEl.focus(),this.instructionsEl.addEventListener("keydown",u=>{u.key==="Enter"&&(u.ctrlKey||u.metaKey)&&(u.preventDefault(),this.submit())}),this.modalEl.addEventListener("keydown",u=>{u.key==="Escape"&&(u.preventDefault(),this.close())})}submit(){let e=this.instructionsEl.value;e.trim()&&(this.close(),this.onSubmit(e))}onClose(){let{contentEl:e}=this;e.empty()}};Mt();var he=require("obsidian");function Pt(t,e){let n=e.settings.historyFolder;return!!(t===n||t.startsWith(n+"/")||t===".obsidian"||t.startsWith(".obsidian/"))}var Dl=class{constructor(){this.name="read_file";this.displayName="Read File";this.category="read_only";this.description="Read the contents of a file in the vault";this.parameters={type:"object",properties:{path:{type:"string",description:"Path to the file to read"}},required:["path"]}}async execute(e,n){let i=n.plugin;try{let o=(0,he.normalizePath)(e.path);if(Pt(o,i))return{success:!1,error:`Cannot read from system folder: ${e.path}`};let r=i.app.vault.getAbstractFileByPath(o);if(!r)return{success:!1,error:`File not found: ${e.path}`};if(!(r instanceof he.TFile))return{success:!1,error:`Path is not a file: ${e.path}`};let s=await i.app.vault.read(r);return{success:!0,data:{path:e.path,content:s,size:r.stat.size,modified:r.stat.mtime}}}catch(o){return{success:!1,error:`Error reading file: ${o instanceof Error?o.message:"Unknown error"}`}}}},Tl=class{constructor(){this.name="write_file";this.displayName="Write File";this.category="vault_ops";this.description="Write content to a file in the vault (creates new file or overwrites existing)";this.requiresConfirmation=!0;this.parameters={type:"object",properties:{path:{type:"string",description:"Path to the file to write"},content:{type:"string",description:"Content to write to the file"}},required:["path","content"]};this.confirmationMessage=e=>`Write content to file: ${e.path}

Content preview:
${e.content.substring(0,200)}${e.content.length>200?"...":""}`}async execute(e,n){var o;let i=n.plugin;try{let r=(0,he.normalizePath)(e.path);if(Pt(r,i))return{success:!1,error:`Cannot write to system folder: ${e.path}`};let s=i.app.vault.getAbstractFileByPath(r),u=!s;if(s instanceof he.TFile?await i.app.vault.modify(s,e.content):(await i.app.vault.create(r,e.content),s=i.app.vault.getAbstractFileByPath(r)),s instanceof he.TFile&&n.session&&u){let f=(o=i.app.workspace.getLeavesOfType("gemini-agent-view")[0])==null?void 0:o.view;if(f&&"getCurrentSessionForToolExecution"in f){let c=f.getCurrentSessionForToolExecution();if(c&&!c.context.contextFiles.includes(s)&&(c.context.contextFiles.push(s),"updateContextFilesList"in f&&"updateSessionHeader"in f)){let d=f.contextPanel;d&&(f.updateContextFilesList(d.querySelector(".gemini-agent-files-list")),f.updateSessionHeader(),f.updateSessionMetadata())}}}return{success:!0,data:{path:r,action:s?"modified":"created",size:e.content.length}}}catch(r){return{success:!1,error:`Error writing file: ${r instanceof Error?r.message:"Unknown error"}`}}}},El=class{constructor(){this.name="list_files";this.displayName="List Files";this.category="read_only";this.description="List files and folders in a directory";this.parameters={type:"object",properties:{path:{type:"string",description:"Path to the directory to list (empty string for root)"},recursive:{type:"boolean",description:"Whether to list files recursively"}},required:["path"]}}async execute(e,n){let i=n.plugin;try{let o=e.path||"",r=i.app.vault.getAbstractFileByPath(o);if(o&&!r)return{success:!1,error:`Folder not found: ${e.path}`};if(o&&!(r instanceof he.TFolder))return{success:!1,error:`Path is not a folder: ${e.path}`};let u=(e.recursive?i.app.vault.getMarkdownFiles():(r==null?void 0:r.children)||i.app.vault.getRoot().children).filter(f=>e.recursive&&o&&!f.path.startsWith(o)?!1:!Pt(f.path,i)).map(f=>({name:f.name,path:f.path,type:f instanceof he.TFile?"file":"folder",size:f instanceof he.TFile?f.stat.size:void 0,modified:f instanceof he.TFile?f.stat.mtime:void 0}));return{success:!0,data:{path:o,files:u,count:u.length}}}catch(o){return{success:!1,error:`Error listing files: ${o instanceof Error?o.message:"Unknown error"}`}}}},Sl=class{constructor(){this.name="create_folder";this.displayName="Create Folder";this.category="vault_ops";this.description="Create a new folder in the vault";this.requiresConfirmation=!0;this.parameters={type:"object",properties:{path:{type:"string",description:"Path of the folder to create"}},required:["path"]};this.confirmationMessage=e=>`Create folder: ${e.path}`}async execute(e,n){let i=n.plugin;try{let o=(0,he.normalizePath)(e.path);return Pt(o,i)?{success:!1,error:`Cannot create folder in system directory: ${e.path}`}:i.app.vault.getAbstractFileByPath(o)?{success:!1,error:`Path already exists: ${e.path}`}:(await i.app.vault.createFolder(o),{success:!0,data:{path:o,action:"created"}})}catch(o){return{success:!1,error:`Error creating folder: ${o instanceof Error?o.message:"Unknown error"}`}}}},wl=class{constructor(){this.name="delete_file";this.displayName="Delete File";this.category="vault_ops";this.description="Delete a file or folder from the vault";this.requiresConfirmation=!0;this.parameters={type:"object",properties:{path:{type:"string",description:"Path of the file or folder to delete"}},required:["path"]};this.confirmationMessage=e=>`Delete file or folder: ${e.path}

This action cannot be undone.`}async execute(e,n){let i=n.plugin;try{let o=(0,he.normalizePath)(e.path);if(Pt(o,i))return{success:!1,error:`Cannot delete system folder: ${e.path}`};let r=i.app.vault.getAbstractFileByPath(o);if(!r)return{success:!1,error:`File or folder not found: ${e.path}`};let s=r instanceof he.TFile?"file":"folder";return await i.app.vault.delete(r),{success:!0,data:{path:e.path,type:s,action:"deleted"}}}catch(o){return{success:!1,error:`Error deleting file: ${o instanceof Error?o.message:"Unknown error"}`}}}},Ml=class{constructor(){this.name="move_file";this.displayName="Move/Rename File";this.category="vault_ops";this.description="Move or rename a file in the vault";this.requiresConfirmation=!0;this.parameters={type:"object",properties:{sourcePath:{type:"string",description:"Current path of the file to move"},targetPath:{type:"string",description:"New path for the file (including filename)"}},required:["sourcePath","targetPath"]};this.confirmationMessage=e=>`Move file from: ${e.sourcePath}
To: ${e.targetPath}`}async execute(e,n){let i=n.plugin;try{let o=(0,he.normalizePath)(e.sourcePath),r=(0,he.normalizePath)(e.targetPath);if(Pt(o,i))return{success:!1,error:`Cannot move from system folder: ${e.sourcePath}`};if(Pt(r,i))return{success:!1,error:`Cannot move to system folder: ${e.targetPath}`};let s=i.app.vault.getAbstractFileByPath(o);if(!s)return{success:!1,error:`Source file not found: ${e.sourcePath}`};if(!(s instanceof he.TFile))return{success:!1,error:`Source path is not a file: ${e.sourcePath}`};if(await i.app.vault.adapter.exists(r))return{success:!1,error:`Target path already exists: ${e.targetPath}`};let f=r.substring(0,r.lastIndexOf("/"));return f&&!await i.app.vault.adapter.exists(f)&&await i.app.vault.createFolder(f).catch(()=>{}),await i.app.vault.rename(s,r),{success:!0,data:{sourcePath:e.sourcePath,targetPath:r,action:"moved"}}}catch(o){return{success:!1,error:`Error moving file: ${o instanceof Error?o.message:"Unknown error"}`}}}},Fl=class{constructor(){this.name="search_files";this.displayName="Search Files";this.category="read_only";this.description="Search for files in the vault by name pattern";this.parameters={type:"object",properties:{pattern:{type:"string",description:"Search pattern (supports wildcards: * matches any characters, ? matches single character)"},limit:{type:"number",description:"Maximum number of results to return"}},required:["pattern"]}}async execute(e,n){let i=n.plugin;try{let o=i.app.vault.getMarkdownFiles(),r=e.limit||50,s=e.pattern.includes("*")||e.pattern.includes("?"),u;if(s){let c=e.pattern.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,".");!e.pattern.startsWith("*")&&!e.pattern.startsWith("?")&&(c="^"+c),!e.pattern.endsWith("*")&&!e.pattern.endsWith("?")&&(c=c+"$"),u=new RegExp(c,"i")}else{let c=e.pattern.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");u=new RegExp(c,"i")}let f=o.filter(c=>Pt(c.path,i)?!1:u.test(c.name)||u.test(c.path)).slice(0,r).map(c=>({name:c.name,path:c.path,size:c.stat.size,modified:c.stat.mtime}));return{success:!0,data:{pattern:e.pattern,matches:f,count:f.length,truncated:o.filter(c=>u.test(c.name)||u.test(c.path)).length>r}}}catch(o){return{success:!1,error:`Error searching files: ${o instanceof Error?o.message:"Unknown error"}`}}}};function om(){return[new Dl,new Tl,new El,new Sl,new wl,new Ml,new Fl]}var yx={apiKey:"",apiProvider:"gemini",chatModelName:Tt("chat"),summaryModelName:Tt("summary"),completionsModelName:Tt("completions"),sendContext:!1,maxContextDepth:2,searchGrounding:!1,summaryFrontmatterKey:"summary",userName:"User",chatHistory:!1,historyFolder:"gemini-scribe",showModelPicker:!1,debugMode:!1,maxRetries:3,initialBackoffDelay:1e3,streamingEnabled:!0,modelDiscovery:{enabled:!1,autoUpdateInterval:24,lastUpdate:0,fallbackToStatic:!0},enableCustomPrompts:!1,allowSystemPromptOverride:!1,temperature:.7,topP:1,stopOnToolError:!0,loopDetectionEnabled:!0,loopDetectionThreshold:3,loopDetectionTimeWindowSeconds:30},Vr=class extends dm.Plugin{async onload(){await this.setupGeminiScribe(),this.ribbonIcon=this.addRibbonIcon("sparkles","Open Gemini Chat",()=>{this.activateView()}),this.addRibbonIcon("bot","Open Agent Mode",()=>{this.activateAgentView()}),this.registerView(hi,e=>this.geminiView=new Yo(e,this)),this.registerView(vi,e=>this.agentView=new xn(e,this)),this.addCommand({id:"gemini-scribe-open-view",name:"Open Gemini Chat",callback:()=>this.activateView()}),this.addCommand({id:"gemini-scribe-open-agent-view",name:"Open Agent Mode",callback:()=>this.activateAgentView()}),this.addCommand({id:"gemini-scribe-rewrite-selection",name:"Rewrite selected text with AI",editorCheckCallback:(e,n,i)=>{let o=n.getSelection();if(e)return o.length>0;new ki(this.app,o,async s=>{await new bi(this).rewriteSelection(n,o,s)}).open()}}),this.registerEvent(this.app.workspace.on("editor-menu",(e,n,i)=>{let o=n.getSelection();o&&e.addItem(r=>{r.setTitle("Rewrite with Gemini").setIcon("bot-message-square").onClick(()=>{new ki(this.app,o,async u=>{await new bi(this).rewriteSelection(n,o,u)}).open()})})})),this.addSettingTab(new mi(this.app,this)),this.app.workspace.onLayoutReady(()=>this.onLayoutReady())}async setupGeminiScribe(){await this.loadSettings(),this.prompts=new fe(this),this.promptManager=new Nr(this,this.app.vault),this.geminiApi=gt.createApi(this),this.gfile=new On(this),this.modelManager=new Rr(this),await this.modelManager.initialize(),this.settings.modelDiscovery.enabled&&this.updateModelsIfNeeded(),this.history=new Pr(this),await this.history.setupHistoryCommands(),this.sessionManager=new Sn(this),this.sessionHistory=new Un(this),this.app.workspace.layoutReady&&await this.history.onLayoutReady,this.toolRegistry=new Mn(this),this.toolExecutionEngine=new wn(this,this.toolRegistry);let e=om();for(let o of e)this.toolRegistry.registerTool(o);let{getWebTools:n}=await Promise.resolve().then(()=>(fm(),cm)),i=n();for(let o of i)this.toolRegistry.registerTool(o);this.completions=new br(this),await this.completions.setupCompletions(),await this.completions.setupCompletionsCommands(),this.summarizer=new ir(this),await this.summarizer.setupSummarizaitonCommand()}async activateView(){let{workspace:e}=this.app,n=null,i=e.getLeavesOfType(hi);i.length>0?(n=i[0],await e.revealLeaf(n)):(n=e.getLeftLeaf(!1),n?(await n.setViewState({type:hi,active:!0}),await e.revealLeaf(n)):console.error("Could not find a leaf to open the view"))}async activateAgentView(){let{workspace:e}=this.app,n=null,i=e.getLeavesOfType(vi);i.length>0?(n=i[0],await e.revealLeaf(n)):(n=e.getRightLeaf(!1),n?(await n.setViewState({type:vi,active:!0}),await e.revealLeaf(n)):console.error("Could not find a leaf to open the agent view"))}async onLayoutReady(){this.settings.enableCustomPrompts&&this.promptManager&&(await this.promptManager.ensurePromptsDirectory(),await this.promptManager.createDefaultPrompts(),this.promptManager.setupPromptCommands()),await this.history.onLayoutReady()}async loadSettings(){var e;this.settings=Object.assign({},yx,await this.loadData()),(e=this.settings.modelDiscovery)!=null&&e.enabled||await this.updateModelVersions()}async updateModelVersions(){let{updatedSettings:e,settingsChanged:n,changedSettingsInfo:i}=Zn(this.settings);n&&(this.settings=e,console.log("ObsidianGemini: Updating model versions in settings..."),i.forEach(o=>console.log(`- ${o}`)),await this.saveData(this.settings),new pm.Notice("Gemini model settings updated to current defaults."))}async saveSettings(){await this.saveData(this.settings),await this.setupGeminiScribe(),this.settings.modelDiscovery.enabled&&this.modelManager&&this.updateModelsIfNeeded()}async updateModelsIfNeeded(){if(!this.settings.modelDiscovery.enabled||!this.modelManager)return;let e=Date.now(),n=this.settings.modelDiscovery.lastUpdate,i=this.settings.modelDiscovery.autoUpdateInterval*60*60*1e3;if(e-n>i)try{let o=await this.modelManager.updateModels({preserveUserCustomizations:!0});o.settingsChanged&&(this.settings=o.updatedSettings,await this.saveData(this.settings),o.changedSettingsInfo.length>0&&console.log("Model settings updated:",o.changedSettingsInfo.join(", "))),this.settings.modelDiscovery.lastUpdate=e,await this.saveData(this.settings)}catch(o){console.warn("Failed to update models during auto-update:",o)}}getModelManager(){return this.modelManager}onunload(){var e,n;console.debug("Unloading Gemini Scribe"),(e=this.history)==null||e.onUnload(),(n=this.ribbonIcon)==null||n.remove()}};
/*! Bundled license information:

@google/genai/dist/web/index.mjs:
  (**
   * @license
   * Copyright 2025 Google LLC
   * SPDX-License-Identifier: Apache-2.0
   *)
*/


/* nosourcemap */